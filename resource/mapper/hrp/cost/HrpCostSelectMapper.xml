<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.cost.dao.HrpCostSelectMapper">
	<resultMap type="com.chd.hrp.cost.entity.HrpCostSelect" id="hrpCostSelect">
		<result property="id" column="id" />
		<result property="text" column="text" />
	</resultMap>   
	<!-- 科室级次 -->
	<select id="queryHosDeptLevel" resultMap="hrpCostSelect">
	select id,to_char(text) text
		from (
			select max(dept_level) id, max(dept_level) text
			from hos_dept_dict 
		 <where>
			 <if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			  and is_stop = 0
		 </where>
            group by dept_level 
			order by dept_level
      
		)
		union all
		select 0 as id, '末级' as text
		from dual

<!--          select * from ( -->
<!--               select distinct 99 as id, '末级' as text -->
<!--                 from hos_dept_dict b -->
<!--                  where b.group_id = #{group_id} -->
<!--                       and b.hos_id = #{hos_id} -->
<!--                       and b.is_stop = 0 -->
<!--                        ) -->
	</select>
	<select id="queryIncomeType" resultMap="hrpCostSelect">
		SELECT
		INCOME_TYPE_ID id,
		INCOME_TYPE_NAME text
		FROM COST_INCOME_TYPE
		<where>
			is_stop = 0
			<if test="key != null and key != ''">
				and (
				INCOME_TYPE_CODE like '%${key}%' or
				INCOME_TYPE_NAME
				like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by INCOME_TYPE_CODE
	</select>

	<select id="queryDeptNature" resultMap="hrpCostSelect">
		SELECT
		NATURE_ID id,
		NATURE_NAME text
		FROM COST_DEPT_NATURE
		<where>
			<if test="key != null and key != ''">
				and (
				NATURE_CODE like '%${key}%' or
				NATURE_NAME like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by NATURE_CODE
	</select>

	<!-- 成本项目收入项目来源 -->
	<select id="queryDataSource" resultMap="hrpCostSelect">
		select
			busi_data_source_code id,
			busi_data_source_name text
		from
		cost_busi_sourec_dict
		<where>
		    <if test="busi_data_source_type != null and busi_data_source_type != ''">
				and busi_data_source_type = #{busi_data_source_type}
			</if>
			<if test="key != null and key != ''">
				and (
				busi_data_source_code like '%${key}%' or
				busi_data_source_name like '%${key}%'
				)
			</if>
		</where>
		order by busi_data_source_code
	</select>

	<select id="queryItemDict" resultMap="hrpCostSelect">
		SELECT
		COST_ITEM_CODE id,
		COST_ITEM_NAME text
		FROM COST_ITEM_DICT
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_last != null  and is_last != ''">
				and is_last = #{is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				COST_ITEM_CODE like '%${key}%' or
				COST_ITEM_NAME like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by COST_ITEM_CODE
	</select>
	<select id="queryItemDictLast" resultMap="hrpCostSelect">
		SELECT
		COST_ITEM_CODE id,
		COST_ITEM_NAME text
		FROM COST_ITEM_DICT
		<where>
			is_stop = 0 and is_last=1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			
			<if test="key != null and key != ''">
				and (
				COST_ITEM_CODE like '%${key}%' or
				COST_ITEM_NAME like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by COST_ITEM_CODE
	</select>


	<select id="queryDeptTypeDictNo" resultMap="hrpCostSelect">
		SELECT
		COST_TYPE_ID id,
		COST_TYPE_NAME text
		FROM
		COST_TYPE_DICT
		<where>
			<if test="key != null and key != ''">
				and (
				COST_TYPE_CODE like '%${key}%' or
				COST_TYPE_NAME like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by COST_TYPE_CODE
	</select>
   
    <select id="queryItemDictNoItemGrade" resultMap="hrpCostSelect">
			 select 
			    item_grade id,
				to_char(item_grade) text
			 from cost_item_dict_no
			 where group_id = #{group_id}
			 and hos_id = #{hos_id}
			 and copy_code = #{copy_code}
			 <if test="is_last != null and is_last != ''">
				and is_last = #{is_last}
			</if>
			 group by item_grade
			 order by id
    
    </select> 
	<select id="queryItemDictNo" resultMap="hrpCostSelect">
		SELECT
		cidn.COST_ITEM_ID||'.'||cidn.COST_ITEM_NO||'.'||cidn.cost_item_code id,
		case cidn.item_grade
		when 1 then cidn.COST_ITEM_NAME  
           when 2 then '　　'|| cidn.COST_ITEM_NAME
           when 3 then '　　　　'|| cidn.COST_ITEM_NAME   
           when 4 then '　　　　　　'|| cidn.COST_ITEM_NAME
           when 5 then '　　　　　　　　'|| cidn.COST_ITEM_NAME 
           when 6 then '                                                ' || cidn.COST_ITEM_NAME
       end as text
		FROM COST_ITEM_DICT_NO cidn
<!-- 		left join acc_dept_attr ada on ada.group_id=cidn.group_id and ada.hos_id=cidn.hos_id -->
		<where>
			cidn.is_stop = 0 
			<if test="group_id != null  and group_id != ''">
				and cidn.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and cidn.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and cidn.copy_code = #{copy_code}
			</if>
			<if test="is_last != null  and is_last != ''">
				and cidn.is_last=#{is_last}
			</if>
	
			<if test="key != null and key != ''">
				and (
				cidn.COST_ITEM_CODE like '%${key}%' or
				cidn.COST_ITEM_NAME like
				'%${key}%'
				or
				cidn.spell_code like '%${key}%'
				or
				cidn.wbx_code like '%${key}%'
				)
			</if>
<!-- 	         <if  test="type_code=01"> -->
<!-- 	         and ada.type_code = ${type_code} -->
<!-- 	         </if> -->
		</where> 
		order by cidn.COST_ITEM_CODE
	</select>
	<select id="queryItemDictNoLast" resultMap="hrpCostSelect">
		SELECT
		cidn.COST_ITEM_ID||'.'||cidn.COST_ITEM_NO id,
		cidn.COST_ITEM_NAME as text
		FROM
		COST_ITEM_DICT_NO cidn
		
		<where>
			cidn.is_stop = 0 and cidn.is_last=1
			<if test="group_id != null  and group_id != ''">
				and cidn.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and cidn.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and cidn.copy_code = #{copy_code}
			</if>
	
			<if test="key != null and key != ''">
				and (
				cidn.COST_ITEM_CODE like '%${key}%' or
				cidn.COST_ITEM_NAME like
				'%${key}%'
				or
				cidn.spell_code like '%${key}%'
				or
				cidn.wbx_code like '%${key}%'
				)
			</if>
	         
		</where>
		order by cidn.COST_ITEM_CODE
	</select>
    <select id="queryItemDictCodeLast" resultMap="hrpCostSelect">
		SELECT
		cidn.COST_ITEM_CODE id,
		cidn.COST_ITEM_CODE ||' '|| cidn.COST_ITEM_NAME as text
		FROM
		COST_ITEM_DICT_NO cidn
		
		<where>
			cidn.is_stop = 0 and cidn.is_last=1
			<if test="group_id != null  and group_id != ''">
				and cidn.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and cidn.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and cidn.copy_code = #{copy_code}
			</if>
	
			<if test="key != null and key != ''">
				and (
				cidn.COST_ITEM_CODE like '%${key}%' or
				cidn.COST_ITEM_NAME like
				'%${key}%'
				or
				cidn.spell_code like '%${key}%'
				or
				cidn.wbx_code like '%${key}%'
				)
			</if>
	         
		</where>
		order by cidn.COST_ITEM_CODE
	</select>
	<select id="queryIncomeItemArrt" resultMap="hrpCostSelect">
		SELECT
		INCOME_ITEM_ID id,
		INCOME_ITEM_NAME text
		FROM
		COST_INCOME_ITEM_ARRT
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				INCOME_ITEM_CODE like '%${key}%' or
				INCOME_ITEM_NAME
				like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by INCOME_ITEM_CODE
	</select>

	<select id="queryChargeKindArrt" resultMap="hrpCostSelect">
		SELECT
		CHARGE_KIND_ID id,
<!-- 		CHARGE_KIND_code ||'.'|| CHARGE_KIND_NAME text -->
		CHARGE_KIND_NAME text
		FROM
		COST_CHARGE_KIND_ARRT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				CHARGE_KIND_CODE like '%${key}%' or
				CHARGE_KIND_NAME
				like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by CHARGE_KIND_CODE
	</select>


	<select id="queryChargeItemArrt" resultMap="hrpCostSelect">
		SELECT
		b.CHARGE_ITEM_ID id,
		b.CHARGE_ITEM_CODE ||'.'|| b.CHARGE_ITEM_NAME text
		FROM
		COST_CHARGE_ITEM_ARRT b
		<where>
			<if test="group_id != null  and group_id != ''">
				and b.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and b.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and b.copy_code = #{copy_code}
			</if>
			<if test="charge_kind_id != null  and charge_kind_id != ''">
				and b.CHARGE_KIND_ID = #{charge_kind_id}
			</if>
			<if test="key != null and key != ''">
				and (
				b.CHARGE_ITEM_CODE like '%${key}%' or
				b.CHARGE_ITEM_NAME
				like '%${key}%'
				or
				b.spell_code like '%${key}%' or
				b.wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by CHARGE_ITEM_CODE
	</select>

	<select id="queryMateTypeArrt" resultMap="hrpCostSelect">
		SELECT
		MATE_TYPE_CODE id,
		MATE_TYPE_CODE||' '||MATE_TYPE_NAME text
		FROM COST_MATE_TYPE_ARRT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_last != null and is_last != '' ">
				and is_last = ${is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				MATE_TYPE_CODE like '%${key}%' or
				MATE_TYPE_NAME like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			
		</where>
		order by MATE_TYPE_CODE
	</select>
	<select id="queryFassetTypeArrt" resultMap="hrpCostSelect">
		SELECT
		ASSET_TYPE_CODE id,
		ASSET_TYPE_NAME text
		FROM
		COST_FASSET_TYPE_ARRT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_last != null and is_last != '' ">
				and is_last = #{is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				ASSET_TYPE_CODE like '%${key}%' or
				ASSET_TYPE_NAME
				like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by ASSET_TYPE_CODE
	</select>
	<select id="queryIassetTypeArrt" resultMap="hrpCostSelect">
		SELECT
		ASSET_TYPE_CODE id,
		ASSET_TYPE_NAME text
		FROM
		COST_IASSET_TYPE_ARRT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_last != null and is_last != '' ">
				and is_last = #{is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				ASSET_TYPE_CODE like '%${key}%' or
				ASSET_TYPE_NAME
				like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by ASSET_TYPE_CODE
	</select>
	<select id="queryEmpTitleArrt" resultMap="hrpCostSelect">
		SELECT
		TITLE_CODE id,
		TITLE_NAME text
		FROM COST_EMP_TITLE_ATTR
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				TITLE_CODE like '%${key}%' or
				TITLE_NAME like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by TITLE_CODE
	</select>
	<select id="queryEmpTypeArrt" resultMap="hrpCostSelect">
		SELECT distinct
		CETA.EMP_KIND_CODE id,
		CETA.EMP_KIND_NAME text
		FROM
		COST_EMP_TYPE_ATTR CETA
		LEFT JOIN HOS_EMP_DICT HED ON
		CETA.EMP_KIND_CODE = HED.KIND_CODE
		<where>
			<if test="group_id != null  and group_id != ''">
				and CETA.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and CETA.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and CETA.copy_code = #{copy_code}
			</if>
			<if test="emp_id != null  and emp_id != ''">
				and HED.emp_id = #{emp_id}
			</if>
			<if test="emp_no != null  and emp_no != ''">
				and HED.emp_no = #{emp_no}
			</if>
			<if test="key != null and key != ''">
				and (
				CETA.EMP_KIND_CODE like '%${key}%' or
				CETA.EMP_KIND_NAME like
				'%${key}%'
				or
				CETA.spell_code like '%${key}%'
				or
				CETA.wbx_code like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			HED.group_id=b.group_id and HED.hos_id=b.hos_id and HED.emp_id=b.perm_code
			and user_id=#{user_id})
		</where>
		order by CETA.EMP_KIND_CODE
	</select>

	<select id="queryCostEmpDict" resultMap="hrpCostSelect">
		SELECT
		he.EMP_ID||'.'||hdd.EMP_NO||'.'||hdd.EMP_CODE id,
		he.EMP_NAME
		text
		FROM hos_emp he , HOS_EMP_DICT hdd
		<where>
			he.emp_id = hdd.emp_id and
			he.emp_code = hdd.emp_code and
			he.group_id =
			hdd.group_id and
			he.hos_id = hdd.hos_id
			and he.is_stop = '0'
			and
			hdd.is_stop= '0'
			<if test="group_id != null  and group_id != ''">
				and he.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and he.hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				he.EMP_ID like '%${key}%' or
				he.EMP_NAME like
				'%${key}%'
				or
				he.spell_code like '%${key}%' or
				he.wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by he.EMP_ID
	</select>

	<select id="queryEmpArrt" resultMap="hrpCostSelect">
		SELECT
		CEA.EMP_ID||'.'||CEA.EMP_NO id,
		CEA.EMP_NAME text
		FROM
		COST_EMP_ATTR CEA
		left join HOS_EMP_DICT HED
		ON CEA.EMP_ID = HED.EMP_ID
		AND CEA.EMP_NO = HED.EMP_NO
		<where>
			<if test="group_id != null  and group_id != ''">
				and CEA.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and CEA.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and CEA.copy_code = #{copy_code}
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and HED.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and HED.dept_no = #{dept_no}
			</if>
			<if test="key != null and key != ''">
				and (
				CEA.EMP_ID like '%${key}%' or
				CEA.EMP_NAME like
				'%${key}%'
				or
				CEA.spell_code like '%${key}%' or
				CEA.wbx_code like
				'%${key}%'
				)
			</if>
			AND HED.IS_STOP = '0'
		</where>
		order by CEA.EMP_ID
	</select>

	<select id="queryWageItemArrt" resultMap="hrpCostSelect">
		select distinct a.wage_item_code as id, a.wage_item_name as text
		from
		cost_wage_item_arrt a
		left join cost_emp_kind_wage_item_set s
		on
		s.wage_item_code = a.wage_item_code
		<where>
			a.is_stop='0'
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="emp_kind_code != null  and emp_kind_code != ''">
				and s.emp_kind_code = #{emp_kind_code}
			</if>
			<if test="key != null and key != ''">
				and (
				a.wage_item_code like '%${key}%' or
				a.wage_item_name
				like
				'%${key}%'
				or
				a.spell_code like '%${key}%' or
				a.wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by a.wage_item_code
	</select>

	<select id="queryBonusItemArrt" resultMap="hrpCostSelect">
		select distinct
		cbia.bonus_item_code id,
		cbia.bonus_item_name text
		from
		cost_bonus_item_arrt cbia
		left join cost_emp_kind_bonus_item_set cekbis
		on cekbis.group_id = cbia.group_id
		and cekbis.hos_id = cbia.hos_id
		and
		cekbis.copy_code = cbia.copy_code
		and cekbis.bonus_item_code =
		cbia.bonus_item_code
		<where>
			<if test="group_id != null  and group_id != ''">
				and cbia.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and cbia.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and cbia.copy_code = #{copy_code}
			</if>
			<if test="emp_kind_code != null  and emp_kind_code != ''">
				and cekbis.emp_kind_code = #{emp_kind_code}
			</if>
			<if test="key != null and key != ''">
				and (
				cbia.bonus_item_code like '%${key}%' or
				cbia.bonus_item_name
				like '%${key}%'
				or
				cbia.spell_code like '%${key}%'
				or
				cbia.wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by cbia.bonus_item_code
	</select>
	<select id="queryDeptDictNo" resultMap="hrpCostSelect">
		SELECT a.dept_id || '.' || a.dept_no AS id, 
		 case a.dept_level 
           when 1 then a.dept_name  
           when 2 then '　　'|| a.dept_name 
           when 3 then '　　　　'|| a.dept_name   
           when 4 then '　　　　　　'|| a.dept_name 
           when 5 then '　　　　　　　　'|| a.dept_name 
       end as text
		FROM
		hos_dept_dict a
		LEFT JOIN ACC_DEPT_ATTR b ON a.group_id = b.group_id
		AND a.hos_id = b.hos_id
		AND a.dept_id = b.dept_id
		<where>
			    a.is_stop=0 
				and a.group_id = #{group_id}
				and a.hos_id = #{hos_id}
			<if test="type_code != null  and type_code != ''">
				and b.type_code in ${type_code}
			</if>
			<if test="natur_code != null  and natur_code != ''">
				and b.natur_code in ${natur_code}
			</if>
			<if test="key != null and key != ''">
				and (
				a.dept_code like '%${key}%' or
				a.dept_name like
				'%${key}%'
				or
				a.spell_code like '%${key}%' or
				a.wbx_code like
				'%${key}%'
				)
			</if>
			<if test="is_last !=null and is_last !='' ">
			and a.is_last = ${is_last}
			</if>
			 and to_char(a.dept_id) in (
		        select b.perm_code
		        from v_user_data_perm b
		        where b.group_id = #{group_id}
		          and b.hos_id = #{hos_id}
		          and b.user_id = #{user_id}
		          and b.table_code = 'HOS_DEPT_DICT'
		          and (b.is_write = 1
		            or b.is_read = 1)
		      )
		</where>
		order by a.dept_id
	</select>
	<select id="queryDeptDictNoLast" resultMap="hrpCostSelect">
		SELECT a.dept_id || '.' || a.dept_no AS id, 
		 a.dept_name as text
      
		FROM
		hos_dept_dict a
		LEFT JOIN ACC_DEPT_ATTR b ON a.group_id = b.group_id
		AND a.hos_id = b.hos_id
		AND a.dept_id = b.dept_id
		<where>
			a.is_stop=0 
			and a.is_last = 1
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			<if test="type_code != null  and type_code != ''">
				and b.type_code in ${type_code}
			</if>
			<if test="natur_code != null  and natur_code != ''">
				and b.natur_code in ${natur_code}
			</if>
			<if test="key != null and key != ''">
				and (
				a.dept_code like '%${key}%' or
				a.dept_name like '%${key}%'
				or a.spell_code like '%${key}%' 
				or a.wbx_code like '%${key}%'
				)
			</if>
			 and to_char(a.dept_id) in (
				select b.perm_code
				from v_user_data_perm b
				where b.group_id = #{group_id}
					and b.hos_id = #{hos_id}
					and b.user_id = #{user_id}
					and b.table_code = 'HOS_DEPT_DICT'
					and (b.is_write = 1
						or b.is_read = 1)
			)
		</where>
		order by a.dept_id
	</select>

	<select id="queryDeptDictCode" resultMap="hrpCostSelect">
		select a.dept_id || '.' || a.dept_no || '.' || a.dept_code as id,
      case a.dept_level 
           when 1 then a.dept_name  
           when 2 then '　　'|| a.dept_name 
           when 3 then '　　　　'|| a.dept_name   
           when 4 then '　　　　　　'|| a.dept_name 
           when 5 then '　　　　　　　　'|| a.dept_name 
       end as text
		from
		hos_dept_dict a
		left join acc_dept_attr b on a.group_id = b.group_id
    and a.hos_id = b.hos_id
    and a.dept_id = b.dept_id
		<where>
			  a.is_stop=0
		 and a.group_id = #{group_id}
		 and a.hos_id = #{hos_id}
		 and to_char(a.dept_id) in (   
				select b.perm_code
				from v_user_data_perm b
				where b.group_id = #{group_id}
					and b.hos_id = #{hos_id}
					and b.user_id = #{user_id}
					and b.table_code = 'HOS_DEPT_DICT'
					and (b.is_write = 1
						or b.is_read = 1)
			)
		<if test="type_code != null  and type_code != ''">
			and b.type_code in ${type_code}
		</if>
		<if test="natur_code != null  and natur_code != ''">
			and b.natur_code in ${natur_code}
		</if>
		<if test="key != null and key != ''">
			and (
			a.dept_code like '%${key}%' or
			a.dept_name like
			'%${key}%'
			or
			a.spell_code like '%${key}%' or
			a.wbx_code like
			'%${key}%'
			)
		</if>
		<!-- 	and to_char(a.dept_id) in (
				select b.perm_code
				from v_user_data_perm b
				where b.group_id = #{group_id}
					and b.hos_id = #{hos_id}
					and b.user_id = #{user_id}
					and b.table_code = 'HOS_DEPT_DICT'
					and (b.is_write = 1
						or b.is_read = 1)
			) -->
		</where>
		    order by a.dept_code
	</select>
	
	<select id="queryDeptDictCodeLast" resultMap="hrpCostSelect">
		select a.dept_id || '.' || a.dept_no || '.' || a.dept_code as id,
		a.dept_name as text
      
		from
		hos_dept_dict a
		left join acc_dept_attr b on a.group_id = b.group_id
    and a.hos_id = b.hos_id
    and a.dept_id = b.dept_id
		<where>
			a.is_stop=0 
			and a.is_last = 1
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>

			<if test="type_code != null  and type_code != ''">
				and b.type_code in ${type_code}
			</if>
			<if test="natur_code != null  and natur_code != ''">
				and b.natur_code in ${natur_code}
			</if>
			<if test="key != null and key != ''">
				and (
				a.dept_code like '%${key}%' or
				a.dept_name like
				'%${key}%'
				or
				a.spell_code like '%${key}%' or
				a.wbx_code like
				'%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and a.dept_id=b.perm_code
			and user_id=#{user_id})
		</where>
		         order by a.dept_code
	</select>

	<select id="queryCostPatientTypeDict" resultMap="hrpCostSelect">
		SELECT
		patient_code id,
		patient_name text
		FROM HOS_PATIENT_TYPE
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
				patient_code like '%${key}%' or
				patient_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by patient_code
	</select>

	<select id="queryDeptParaDict" resultMap="hrpCostSelect">
		SELECT
		PARA_CODE id,
		PARA_NAME text
		FROM COST_DEPT_PARA_DICT
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_sys != null  and is_sys != ''">
				and is_sys = #{is_sys}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
				PARA_CODE like '%${key}%' or
				PARA_NAME like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by PARA_CODE
	</select>

	<select id="queryMateArrt" resultMap="hrpCostSelect">
		SELECT
		MATE_ID id,
		MATE_NAME text
		FROM COST_MATE_ARRT
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="mate_type_id != null  and mate_type_id != ''">
				and mate_type_id = #{mate_type_id}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
				MATE_CODE like '%${key}%' or
				MATE_NAME like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by MATE_CODE
	</select>

	<select id="queryIassetArrt" resultMap="hrpCostSelect">
		SELECT
		ASSET_ID id,
		ASSET_NAME text
		FROM COST_IASSET_ARRT
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
				ASSET_CODE like '%${key}%' or
				ASSET_NAME like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by ASSET_CODE
	</select>


	<select id="queryIassetArrtType" resultMap="hrpCostSelect">
		SELECT
		ASSET_ID || '.' || ASSET_TYPE_ID id,
		ASSET_NAME text
		FROM
		COST_IASSET_ARRT
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
				ASSET_CODE like '%${key}%' or
				ASSET_NAME like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by ASSET_CODE
	</select>

	<select id="queryFassetArrt" resultMap="hrpCostSelect">
		SELECT
		ASSET_ID id,
		ASSET_NAME text
		FROM COST_FASSET_ARRT
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
				ASSET_CODE like '%${key}%' or
				ASSET_NAME like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by ASSET_CODE
	</select>

	<select id="queryFassetArrtType" resultMap="hrpCostSelect">
		SELECT
		ASSET_ID || '.' || ASSET_TYPE_ID id,
		ASSET_NAME text
		FROM
		COST_FASSET_ARRT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
				ASSET_CODE like '%${key}%' or
				ASSET_NAME like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by ASSET_CODE
	</select>

	<select id="querySourceArrt" resultMap="hrpCostSelect">
		SELECT
		SOURCE_ID id,
		SOURCE_NAME text
		FROM HOS_SOURCE
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
				SOURCE_ID like '%${key}%' or
				SOURCE_CODE like
				'%${key}%' or
				SOURCE_NAME like
				'%${key}%' or
				spell_code like '%${key}%'
				or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by SOURCE_CODE
	</select>

	<select id="queryWangSchemeSet" resultMap="hrpCostSelect">
		SELECT
		SCHEME_ID id,
		SCHEME_NAME text
		FROM
		COST_WAGE_SCHEME
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				SCHEME_ID like '%${key}%' or
				SCHEME_NAME
				like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by SCHEME_ID
	</select>

	<select id="queryServerItemDict" resultMap="hrpCostSelect">
		select
		  server_item_code id,
		  server_item_name text
		from cost_serve_item_dict
		<where>
		         group_id = #{group_id}
		     and hos_id = #{hos_id}
		     and copy_code = #{copy_code}
			<if test="key != null and key != ''">
				and (
				server_item_code like '%${key}%' or
				server_item_name
				like '%${key}%'
				)
			</if>
		</where>
		order by group_id,hos_id,copy_code,server_item_code
	</select>

	<select id="queryBonusSchemeSet" resultMap="hrpCostSelect">
		SELECT
		SCHEME_ID id,
		SCHEME_NAME text
		FROM
		COST_BONUS_SCHEME
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				SCHEME_ID like '%${key}%' or
				SCHEME_NAME
				like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by SCHEME_ID
	</select>


	<select id="queryDeptLevel" resultMap="hrpCostSelect">
		select max(dept_level) id,max(dept_level) text
		from
		hos_dept
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and dept_level like '%${key}%'
			</if>
		</where>
		group by dept_level
		order by dept_level
	</select>

	<select id="queryCostDeptKindDict" resultMap="hrpCostSelect">
		SELECT
		kind_code id,
		kind_name text
		FROM HOS_DEPT_KIND
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				kind_code like '%${key}%' or
				kind_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<if test="kind_code != null  and kind_code != ''">
				and kind_code in ${kind_code}
			</if>
		</where>
		order by kind_code
	</select>

	<select id="queryCostDeptDict" resultMap="hrpCostSelect">
		SELECT
		dept_id||'.'||dept_no id,
		dept_code||' '||dept_name text
		FROM
		HOS_DEPT_DICT a
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				dept_id like '%${key}%' or
				dept_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and a.sup_id=b.perm_code
			and user_id=#{user_id})
		</where>
		order by dept_id
	</select>

	<select id="queryCostDeptNature" resultMap="hrpCostSelect">
		SELECT
		NATUR_CODE id,
		NATUR_NAME text
		FROM ACC_DEPT_NATUR
		<where>
			<if test="key != null and key != ''">
				and (
				NATUR_CODE like '%${key}%' or
				NATUR_NAME like
				'%${key}%'
				)
			</if>
			<if test="kind_code != null  and kind_code != ''">
				and NATUR_CODE in ${kind_code}
			</if>
		</where>
		order by NATUR_CODE
	</select>


	<select id="queryCostIncomeItemArrt" resultMap="hrpCostSelect">
		SELECT
		income_item_code id,
		income_item_name text
		FROM
		COST_INCOME_ITEM_ARRT
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_last != null  and is_last != ''">
				and is_last = 1
			</if>
			<if test="key != null and key != ''">
				and (
				income_ITEM_CODE like '%${key}%' or
				income_ITEM_NAME
				like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by income_item_code
	</select>


	<!-- 2016/10/25 lxj 材料分类 上级编码 下拉框 -->
	<select id="queryMateTypeSupperCode" resultMap="hrpCostSelect">
		SELECT
		MATE_TYPE_CODE id,
		MATE_TYPE_CODE || ' ' ||MATE_TYPE_NAME text
		FROM COST_MATE_TYPE_ARRT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_last != null  and is_last != '' ">
				and is_last = #{is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				MATE_TYPE_CODE like '%${key}%' or
				MATE_TYPE_NAME like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by MATE_TYPE_CODE
	</select>

	<!-- 2016/10/25 lxj 固定资产分类 上级编码 下拉框 -->
	<select id="queryFassetTypeSupperCode" resultMap="hrpCostSelect">
		SELECT
		ASSET_TYPE_CODE id,
		ASSET_TYPE_CODE ||' '|| ASSET_TYPE_NAME text
		FROM COST_FASSET_TYPE_ARRT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_last != null  and is_last != ''">
				and is_last = #{is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				ASSET_TYPE_CODE like '%${key}%' or
				ASSET_TYPE_NAME
				like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by ASSET_TYPE_CODE
	</select>

	<!-- 2016/10/25 lxj 无形资产分类 上级编码 下拉框 -->
	<select id="queryIassetTypeSupperCode" resultMap="hrpCostSelect">
		SELECT
		ASSET_TYPE_CODE id,
		ASSET_TYPE_CODE|| ' ' ||ASSET_TYPE_NAME text
		FROM COST_IASSET_TYPE_ARRT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_last != null  and is_last != ''">
				and is_last = #{is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				ASSET_TYPE_CODE like '%${key}%' or
				ASSET_TYPE_NAME
				like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by ASSET_TYPE_CODE
	</select>
	<select id="queryParaType" resultMap="hrpCostSelect">
		SELECT
		type_code id,
		type_code|| ' ' ||type_name text
		FROM COST_PARA_TYPE
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="type_code != null  and type_code != ''">
				and type_code = #{type_code}
			</if>
			<if test="key != null and key != ''">
				and (
				type_code like '%${key}%' or
				type_name
				like
				'%${key}%'

				)
			</if>
		</where>
		order by type_code
	</select>
	<select id="queryParaNatur" resultMap="hrpCostSelect">
		SELECT
		para_code id,
		para_code|| ' ' ||para_name text
		FROM COST_PARA_NATUR 
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="para_code != null  and para_code != ''">
				and para_code = #{para_code}
			</if>
			<if test="bill_type != null  and bill_type != ''">
				and bill_type = #{bill_type}
			</if>
			<if test="key != null and key != ''">
				and (
				para_code like '%${key}%' or
				para_name
				like
				'%${key}%'

				)
			</if>
		</where>
		order by para_code
	</select>

   <select id="queryCostSubjItemMapByItem" resultMap="hrpCostSelect">
   
		  select 
			    cidn.cost_item_code id,
				cidn.cost_item_code ||''|| cidn.cost_item_name text
			 from cost_item_dict_no cidn
			 <where>cidn.group_id = #{group_id}
			 and cidn.hos_id = #{hos_id}
			 and cidn.copy_code = #{copy_code}
			 and cidn.is_last = 1
			 and cidn.is_stop = 0
			 <!-- and not exists  (
					 select 1 from cost_subj_item_map csim
					 where csim.group_id = cidn.group_id
					 and csim.hos_id = cidn.hos_id
					 and csim.copy_code = cidn.copy_code
					 and csim.item_code = cidn.cost_item_code
				) -->
 			<if test="key != null and key != ''">
				and ( cidn.cost_item_code like  '%${key}%' or
				      cidn.cost_item_name like  '%${key}%' or
				      cidn.spell_code     like  '%${key}%' or
				      cidn.wbx_code       like  '%${key}%' )
			</if>
			</where> 
			order by cidn.group_id,cidn.hos_id,cidn.copy_code,cidn.cost_item_code

   </select>
   
   <select id="queryCostSubjItemMapBySubj" resultMap="hrpCostSelect">
              select 
			     asubj.subj_code id,
				 asubj.subj_code ||' '||asubj.subj_name text
			 from acc_subj asubj
			 <where>
			     asubj.group_id = #{group_id}
			 and asubj.hos_id = #{hos_id}
			 and asubj.copy_code = #{copy_code}
			 and asubj.acc_year  = #{acc_year}
			 and asubj.is_stop = 0
			 and asubj.is_last = 1
			 <!-- and asubj.subj_type_code in ('05') -->
			 <!-- and not exists (
			    select 1 from cost_subj_item_map csim
					 where csim.group_id = asubj.group_id
					 and csim.hos_id = asubj.hos_id
					 and csim.copy_code = asubj.copy_code
					 and csim.subj_code = asubj.subj_code
			 ) -->
			<if test="key != null and key != ''">
				and ( asubj.subj_code  like  '%${key}%' or
				      asubj.subj_name  like  '%${key}%' or
				      asubj.spell_code like  '%${key}%' or
				      asubj.wbx_code   like  '%${key}%' )
			</if>
			</where>
		order by asubj.group_id,asubj.hos_id,asubj.copy_code,asubj.acc_year,asubj.subj_code
   </select>
   
    <select id="queryCostUserDefinedParaTarget" resultMap="hrpCostSelect">
			              
			with temp as
			 (select '01' id, '收入' text
			    from dual
			  union all
			  select '02' id, '门急诊人次' text
			    from dual
			  union all
			  select '03' id, '床日数' text from dual)
			select id,text from temp
			<where>
			  1 = 1
			  <if test="key != null and key != ''">
				and (id   like  '%${key}%' or
				     text like  '%${key}%' )
			</if>
			</where> 
			              
   </select>
</mapper>

