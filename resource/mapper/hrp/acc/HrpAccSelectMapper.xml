<?xml version="1.0" encoding="UTF-8" ?> 
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.acc.dao.HrpAccSelectMapper">
	<resultMap type="com.chd.hrp.acc.entity.HrpAccSelect" id="hrpAccSelect">
		<result property="id" column="id" />
		<result property="text" column="text" />
		<result property="search" column="search" />
		<result property="nature_code" column="nature_code" />
		<result property="nature_name" column="nature_name" />
		<result property="type_code" column="type_code" />
		<result property="type_name" column="type_name" />
	</resultMap>
	
	<select id="queryAccWxType" resultMap="hrpAccSelect">
		SELECT
		DICT_CODE id,
		DICT_NAME text
		FROM INIT_ACC_DICT
		where TABLE_CODE = 'ACC_ALY_WX_TYPE'
		order by DICT_CODE
	</select>
	
	<select id="queryAccYewuType" resultMap="hrpAccSelect">
		select DICT_CODE id,DICT_NAME text from INIT_ACC_DICT 
		where TABLE_CODE='HOS_DICT_TYPE' and TYPE_CODE=#{mod_code}
	</select>
	<select id="queryAccYewuDict" resultMap="hrpAccSelect">
		select DICT_CODE id,DICT_NAME text from HOS_DICT_TYPE 
		where GROUP_ID = #{group_id} and HOS_ID=#{hos_id} and COPY_CODE=#{copy_code}
		and TABLE_CODE=#{table_code}
	</select>
	<select id="queryAccBudgRange" resultMap="hrpAccSelect">
		select range_id id, note text from ACC_BUDG_RANGE 
		where GROUP_ID = #{group_id} and HOS_ID=#{hos_id} and COPY_CODE=#{copy_code}
	</select>
	
	<select id="queryAccBasType" resultMap="hrpAccSelect">
		SELECT
		DICT_CODE id,
		DICT_NAME text
		FROM INIT_ACC_DICT
		where TABLE_CODE = 'ACC_ALY_BAS_TYPE'
		order by DICT_CODE
	</select>
	
	<select id="queryBusiType" resultMap="hrpAccSelect">
		SELECT
		busi_type_code||'@'||log_name id,
		busi_type_code||' '||busi_type_name text
		FROM acc_busi_type
		where is_last=1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="mod_code != null  and mod_code != ''">
				and mod_code = #{mod_code}
			</if>
			<if test="is_vouch != null  and is_vouch != ''">
				and is_vouch = #{is_vouch}
			</if>
			<if test="key != null and key != ''">
				and (
				busi_type_code like '${key}%' or
				busi_type_name like '%${key}%'
				)
			</if>		
		order by busi_type_code
	</select>
	
	
	<select id="queryBudgPaymentItemDict" resultMap="hrpAccSelect">
		select
		payment_item_id||'@'||payment_item_no id,
		payment_item_code||' '||payment_item_name text
		from budg_payment_item_dict a
		where group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code}
			and is_fresh = 1 and is_last = 1
			and IS_LAST = 1
			<if test="key != null and key != ''">
				and (
				payment_item_code like '${key}%' or
				payment_item_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<if test="is_read != null and is_read != ''">
				and exists(
					select 1 from v_user_data_perm p 
					where p.table_code='BUDG_PAYMENT_ITEM_DICT' and p.group_id=a.group_id and p.hos_id=a.hos_id and p.copy_code=a.copy_code 
					and p.perm_code=a.payment_item_id and p.is_read=1 and p.user_id=#{user_id}
        		)
			</if>
			<if test="is_write != null and is_write != ''">
				and exists(
					select 1 from v_user_data_perm p 
					where p.table_code='BUDG_PAYMENT_ITEM_DICT' and p.group_id=a.group_id and p.hos_id=a.hos_id and p.copy_code=a.copy_code 
					and p.perm_code=a.payment_item_id and p.is_write=1 and p.user_id=#{user_id}
        		)
			</if>	
		order by payment_item_code
	</select>
	<select id="queryBudgPaymentItemDictDept" resultMap="hrpAccSelect">
		select
		payment_item_id||'@'||payment_item_no id,
		payment_item_code||' '||payment_item_name text
		from budg_payment_item_dict a
		where group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code}
			and is_fresh = 1 and is_last = 1
			and IS_LAST = 1
			<if test="key != null and key != ''">
				and (
				payment_item_code like '${key}%' or
				payment_item_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<if test="is_read != null and is_read != ''">
				and exists(
					select 1 from v_user_data_perm p 
					where p.table_code='BUDG_PAYMENT_ITEM_DICT' and p.group_id=a.group_id and p.hos_id=a.hos_id and p.copy_code=a.copy_code 
					and p.perm_code=a.payment_item_id and p.is_read=1 and p.user_id=#{user_id}
        		)
			</if>
			<if test="is_write != null and is_write != ''">
				and exists(
					select 1 from v_user_data_perm p 
					where p.table_code='BUDG_PAYMENT_ITEM_DICT' and p.group_id=a.group_id and p.hos_id=a.hos_id and p.copy_code=a.copy_code 
					and p.perm_code=a.payment_item_id and p.is_write=1 and p.user_id=#{user_id}
        		)
			</if>
			<if test="dept_id != null and dept_id != ''">
				and a.is_manage in (select case out_code
                                when '02' then
                                 '1'
                                else
                                 '0'
                              end
                         from acc_dept_attr
                        where dept_id = #{dept_id}
                        group by out_code)	
			</if>
			   
		order by payment_item_code
	</select>
	
	
	<select id="queryBudgPaymentItem" resultMap="hrpAccSelect">
		select
		payment_item_id id,
		payment_item_code||' '||payment_item_name text
		from budg_payment_item
		where
			<if test="group_id != null  and group_id != ''">
				 group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				payment_item_code like '${key}%' or
				payment_item_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>		
		order by payment_item_code
	</select>
	
	<select id="querySubjDict" resultMap="hrpAccSelect">
		SELECT
		subj_id id,
		subj_code||' '||SUBJ_NAME text
		FROM ACC_SUBJ
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="subj_id != null and subj_id != ''">
				and subj_id = #{subj_id}
			</if>
			<if test="subj_nature_code != null  and subj_nature_code != ''">
				and SUBJ_NATURE_CODE = #{subj_nature_code}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			 <if test="check_type_id != null  and check_type_id != ''">
			 	and (check1 = #{check_type_id} or check2 = #{check_type_id} or check3 = #{check_type_id} or check4 = #{check_type_id})
			 </if>
			 <!-- <if test="subj_nature_code != null and subj_nature_code !='' ">
			 	and subj_nature_code=#{subj_nature_code}
			 </if> -->
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or subj_type_code1 = #{subj_type_code1}
				 </if>
				 )
			 </if>
			 <if test="is_last != null and is_last !='' ">
			 	and is_last=#{is_last}
			 </if>
			 <if test="check_type_code != null and check_type_code !='' ">
			 	and (check1 in (check_type_code) 
			 			or check2 in (check_type_code) 
			 			or check3 in (check_type_code)
			 			or check4 in (check_type_code))
			 </if>
			 <if test="extras != null and extras != '' ">
			 	and subj_nature_code&lt;&gt;#{extras}
			 </if>
			<if test="key != null and key != ''">
				and (
				SUBJ_CODE like '${key}%' or
				SUBJ_NAME like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by SUBJ_CODE
	</select>
	
	
	<select id="queryBudgSysDict" resultMap="hrpAccSelect">
		select
		value_code id,
		value_name text
		from budg_sys_dict
		where 1 = 1
			<if test="f_code != null and f_code != ''">
				and f_code = #{f_code}
			</if>
			<if test="key != null and key != ''">
				and (
				value_code like '${key}%' or
				value_name like '%${key}%' 
				)
			</if>
			
			<!-- 是否显示审核 	1：显示 0不显示 -->
			<if test="is_showCheck == 0">
				and value_code &lt;&gt; '03'
			</if>		
		order by value_code
	</select>
	
	
	<select id="queryEmpDictById" resultMap="hrpAccSelect">
		SELECT
		emp_id||'.'||emp_no id,
		emp_code||' '||emp_name text
		FROM HOS_EMP_DICT
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and dept_no = #{dept_no}
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and dept_id = #{dept_id}
			</if>
			<if test="key != null and key != ''">
				and (
				emp_code like '${key}%' or
				emp_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>

		order by emp_id
	
	</select>
	<select id="querySubjType" resultMap="hrpAccSelect">
		SELECT
		SUBJ_TYPE_CODE id,
		SUBJ_TYPE_NAME text
		FROM ACC_SUBJ_TYPE
		<where>
			
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				subj_type_code like '${key}%' or
				subj_type_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by subj_type_code
	</select>
	
	<select id="querySubjTypeKind" resultMap="hrpAccSelect">
		SELECT
		SUBJ_TYPE_CODE||','||KIND_CODE id,
		SUBJ_TYPE_NAME text 
		FROM ACC_SUBJ_TYPE
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				subj_type_code like '${key}%' or
				subj_type_name like '%${key}%'
				)
			</if>
		</where>
		order by subj_type_code
	</select>
	
	<!-- 根据项目核算查找会计科目 -->
	<select id="querySubjByProjCheck" resultMap="hrpAccSelect">
		SELECT
			a.subj_id||'.'||a.subj_code id,
			a.subj_code||' '||a.subj_name text
		FROM ACC_SUBJ a
		left join (
			select distinct subj_id,group_id,hos_id,copy_code,acc_year
				<if test="colName !=null and colName !='' ">
					${colName}
				</if>
			from acc_vouch_check
			<where>
				<if test="group_id != null and group_id !='' ">
					and group_id = #{group_id}
				</if>
				<if test="hos_id != null and hos_id !='' ">
					and hos_id = #{hos_id}
				</if>
				<if test="copy_code != null and copy_code !='' ">
					and copy_code = #{copy_code}
				</if>
				<if test="acc_year != null and acc_year !='' ">
					and acc_year = #{acc_year}
				</if>
				<if test="sqlWhere !=null and sqlWhere !='' ">
					${sqlWhere}
				</if>
			</where> 
     		
		) b on a.group_id = b.group_id 
			and a.hos_id = b.hos_id 
			and a.copy_code= b.copy_code 
			and a.acc_year =b.acc_year 
			and a.subj_id=b.subj_id
		<where>
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="subj_id != null and subj_id != ''">
				and a.subj_id = #{subj_id}
			</if>
			<if test="subj_nature_code != null  and subj_nature_code != ''">
				and a.SUBJ_NATURE_CODE = #{subj_nature_code}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and a.SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			<if test="check_type_id != null  and check_type_id != ''">
			 	and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
			</if>
			 <!-- <if test="subj_nature_code != null and subj_nature_code !='' ">
			 	and subj_nature_code=#{subj_nature_code}
			 </if> -->
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (a.subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or a.subj_type_code1 = #{subj_type_code1}
				 </if>
				 )
			 </if>
			 <if test="is_last != null and is_last !='' ">
			 	and a.is_last=#{is_last}
			 </if>
			 <if test="check_type_code != null and check_type_code !='' ">
			 	and (a.check1 in (check_type_code) 
			 			or a.check2 in (check_type_code) 
			 			or a.check3 in (check_type_code)
			 			or a.check4 in (check_type_code))
			 </if>
			 <if test="extras != null and extras != '' ">
			 	and a.subj_nature_code&lt;&gt;#{extras}
			 </if>
			<if test="key != null and key != ''">
				and (
					a.SUBJ_CODE like '${key}%' or
					a.SUBJ_NAME like '%${key}%'
					or
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
			</if>
			<if test="sWhere != null and sWhere !='' ">
				${sWhere}
			</if>
			
		</where>
		order by a.SUBJ_CODE
	</select>
	<select id="querySubjToProj" resultMap="hrpAccSelect">
		select subj_id as id, 
		subj_code || ' ' || subj_name as text
		  from ACC_SUBJ
		 where group_id = #{group_id}
		   and hos_id = #{hos_id}
		   and copy_code =  #{copy_code}
		   and (subj_code like '4101%' or subj_code like '4201%')
		   and is_last = 1
		   and acc_year =  #{acc_year}
		 order by subj_code
	</select>
	
	
	<select id="querySubj" resultMap="hrpAccSelect">
		SELECT
			a.subj_code id,
			a.subj_code||' '||a.subj_name_all as text
		FROM ACC_SUBJ a
		<where>
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="subj_id != null and subj_id != ''">
				and a.subj_id = #{subj_id}
			</if>
			<if test="subj_nature_code != null  and subj_nature_code != ''">
				and a.SUBJ_NATURE_CODE = #{subj_nature_code}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and a.SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			 <if test="check_type_id != null  and check_type_id != ''">
			 	and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
			 </if>
			 <!-- <if test="subj_nature_code != null and subj_nature_code !='' ">
			 	and subj_nature_code=#{subj_nature_code}
			 </if> -->
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (a.subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or a.subj_type_code1 = #{subj_type_code1}
				 </if>
				 )
			 </if>
			 <if test="is_last != null and is_last !='' ">
			 	and a.is_last=#{is_last}
			 </if>
			 <if test="check_type_code != null and check_type_code !='' ">
			 	and (a.check1 in (check_type_code) 
			 			or a.check2 in (check_type_code) 
			 			or a.check3 in (check_type_code)
			 			or a.check4 in (check_type_code))
			 </if>
			 <if test="extras != null and extras != '' ">
			 	and a.subj_nature_code&lt;&gt;#{extras}
			 </if>
			<if test="key != null and key != ''">
				and (
					a.SUBJ_CODE like '${key}%' or
					a.SUBJ_NAME like '%${key}%'
					or
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.SUBJ_CODE
	</select>
	<!-- 账簿中的科目  -->
	<select id="querySubjByAccount" resultMap="hrpAccSelect">
	<!-- 申总要求辅助账中的科目应该显示全程  -->
		SELECT
			a.subj_id||'.'||a.subj_code id,
			a.subj_code||' '||a.subj_name_all text
		FROM ACC_SUBJ a
		left join ACC_CHECK_TYPE act1 on a.GROUP_ID = act1.GROUP_ID
         and a.HOS_ID = act1.HOS_ID
         and a.COPY_CODE = act1.COPY_CODE
        <!--  and a.check1 = act1.CHECK_TYPE_ID  -->
        and (a.check1 = act1.CHECK_TYPE_ID or a.check2 = act1.CHECK_TYPE_ID or a.check3 = act1.CHECK_TYPE_ID or a.check4 = act1.CHECK_TYPE_ID  )
		<where> 
			        a.group_id = #{group_id} 
				and a.hos_id = #{hos_id} 
				and a.copy_code = #{copy_code} 
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="subj_code != null and subj_code != ''">
				and a.subj_code = #{subj_code}
			</if>
			<if test="subj_nature_code != null  and subj_nature_code != ''">
				and a.SUBJ_NATURE_CODE = #{subj_nature_code}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and a.SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			 <if test="check_type_id != null  and check_type_id != ''">
			 	and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
			 </if> 
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (a.subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or a.subj_type_code1 = #{subj_type_code1}
				 </if>
				 )
			 </if>
			  <if test="sign ==1">
        AND act1.check_type_name='部门'
      	</if>
      	 <if test="sign ==2 ">
        AND act1.check_type_name='职工'
      	</if>
      	 <if test="sign ==3">
        AND act1.check_type_name='项目'
      	</if>
      	     <if test="sign ==4">
        AND act1.check_type_name='库房' 
      	</if>
      	     <if test="sign ==5">
        AND act1.check_type_name='客户'
      	</if>
      	     <if test="sign ==6">
        AND act1.check_type_name='供应商'
      	</if>
      	<if test="sign ==10">
        AND act1.check_type_name='单位' 
      	</if>
      	<if test="sign ==11">
        AND act1.is_sys=0
      	</if>
	    <if test="is_last != null and is_last !='' ">
			 	and a.is_last=#{is_last}
	    </if>
	    <if test="check_type_code != null and check_type_code !='' ">
			 	and (a.check1 in (check_type_code) 
			 			or a.check2 in (check_type_code) 
			 			or a.check3 in (check_type_code)
			 			or a.check4 in (check_type_code))
	     </if>
	     <if test="extras != null and extras != '' ">
			 	and a.subj_nature_code&lt;&gt;#{extras}
	     </if>
	     <if test="key != null and key != ''">
				and (
					a.SUBJ_CODE like '${key}%' or
					a.SUBJ_NAME like '%${key}%'
					or
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
		 </if>
		</where>
		order by a.SUBJ_CODE
	</select>
	
	<select id="querySubjBylevel" resultMap="hrpAccSelect">
		SELECT
			a.subj_id||'.'||a.subj_code id,
			a.subj_code||' '||a.subj_name text
		FROM ACC_SUBJ a
		left join ACC_CHECK_TYPE act1 on a.GROUP_ID = act1.GROUP_ID
         and a.HOS_ID = act1.HOS_ID
         and a.COPY_CODE = act1.COPY_CODE
         and a.check1 = act1.CHECK_TYPE_ID 
		<where>
		    <!--  a.is_last = 1 -->
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="subj_id != null and subj_id != ''">
				and a.subj_id = #{subj_id}
			</if>
			<if test="subj_nature_code != null  and subj_nature_code != ''">
				and a.SUBJ_NATURE_CODE = #{subj_nature_code}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and a.SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			 <if test="check_type_id != null  and check_type_id != ''">
			 	and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
			 </if>
			 <!-- <if test="subj_nature_code != null and subj_nature_code !='' ">
			 	and subj_nature_code=#{subj_nature_code}
			 </if> -->
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (a.subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or a.subj_type_code1 = #{subj_type_code1}
				 </if>
				 )
			 </if>
			  <if test="sign ==1">
        AND act1.check_type_name='部门'
      	</if>
      	 <if test="sign ==2 ">
        AND act1.check_type_name='职工'
      	</if>
      	 <if test="sign ==3">
        AND act1.check_type_name='项目'
      	</if>
      	     <if test="sign ==4">
        AND act1.check_type_name='库房' 
      	</if>
      	     <if test="sign ==5">
        AND act1.check_type_name='客户'
      	</if>
      	     <if test="sign ==6">
        AND act1.check_type_name='供应商'
      	</if>
      	<if test="sign ==10">
        AND act1.check_type_name='单位' 
      	</if>
      	<if test="sign ==11">
        AND act1.is_sys=0
      	</if>
			 <if test="is_last != null and is_last !='' ">
			 	and a.is_last=#{is_last}
			 </if>
			 <if test="check_type_code != null and check_type_code !='' ">
			 	and (a.check1 in (check_type_code) 
			 			or a.check2 in (check_type_code) 
			 			or a.check3 in (check_type_code)
			 			or a.check4 in (check_type_code))
			 </if>
			 <if test="extras != null and extras != '' ">
			 	and a.subj_nature_code&lt;&gt;#{extras}
			 </if>
			<if test="key != null and key != ''">
				and (
					a.SUBJ_CODE like '${key}%' or
					a.SUBJ_NAME like '%${key}%' or
					a.SUBJ_NAME_ALL like '%${key}%' or 
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.SUBJ_CODE
	</select>
	
	
	
	<select id="querySubjAll" resultMap="hrpAccSelect">
		SELECT
			subj_code id,
			subj_code||' '||SUBJ_NAME_ALL text
		FROM ACC_SUBJ
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			 <if test="is_check != null  and is_check != ''">
			 	and (check1 = #{is_check} or check2 = #{is_check} or check3 = #{is_check} or check4 = #{is_check})
			 </if>
			 <if test="subj_nature_code != null and subj_nature_code !='' ">
			 	and subj_nature_code=#{subj_nature_code}
			 </if>
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or subj_type_code = #{subj_type_code1}
				 </if>
				 )
			 </if>
			 <if test="code_like != null and code_like !='' ">
			 	and subj_code like '${code_like}%'
			 </if>
			 <if test="is_last != null and is_last !='' ">
			 	and is_last=#{is_last}
			 </if>
			 <if test="kind_code != null and kind_code !='' ">
			 	and kind_code=#{kind_code}
			 </if>
			 
			<if test="key != null and key != ''">
				and (
					SUBJ_CODE like '${key}%' or
					SUBJ_NAME like '%${key}%' or
					SUBJ_NAME_ALL like '%${key}%'
					or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by SUBJ_CODE
	</select>
	
	 <select id="querySubjLevel" resultMap="hrpAccSelect">
	 	select id,to_char(text) text from (
	    	select 
		    	max(subj_level) id,
		    	max(subj_level) text 
	    	from ACC_SUBJ   
	    	<where>
				<if test="group_id != null  and group_id != ''">
					and group_id = #{group_id}
				</if>
				<if test="hos_id != null  and hos_id != ''">
					and hos_id = #{hos_id}
				</if>
				<if test="copy_code != null  and copy_code != ''">
					and copy_code = #{copy_code}
				</if>
				<if test="acc_year != null  and acc_year != ''">
					and acc_year = #{acc_year}
				</if>
				<if test="key != null and key != ''">
					and ( subj_level like '%${key}%' )
				</if>
			</where>
	    	group by subj_level 
	    	order by subj_level
    	) a
		union all
		select 99 as id,'末级' as text from dual
    </select>
    
    <select id="queryEcoLevel" resultMap="hrpAccSelect">
    	select 
    	max(eco_level) id,
    	max(eco_level) text 
    	from acc_eco_type   
    	<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="key != null and key != ''">
				and (
				eco_level like '%${key}%' 
				)
			</if>
		</where>
    	group by eco_level 
    	order by eco_level
    </select>
    
    <select id="queryFunLevel" resultMap="hrpAccSelect">
    	select 
    	max(fun_level) id,
    	max(fun_level) text 
    	from acc_fun_type   
    	<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="key != null and key != ''">
				and (
				fun_level like '%${key}%' 
				)
			</if>
		</where>
    	group by fun_level 
    	order by fun_level
    </select>
	
	<select id="querySubjNature" resultMap="hrpAccSelect">
		SELECT
		SUBJ_NATURE_CODE id,
		SUBJ_NATURE_NAME text
		FROM ACC_SUBJ_NATURE
		<where>
			
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				subj_nature_code like '${key}%' or
				subj_nature_name like '%${key}%'
				<!-- or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%' -->
				)
			</if>
		</where>
		order by subj_nature_code
	</select>
	
	<select id="queryVouchType" resultMap="hrpAccSelect">
		SELECT
		VOUCH_TYPE_CODE id,
		VOUCH_TYPE_NAME text
		FROM ACC_VOUCH_TYPE
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				VOUCH_TYPE_CODE like '${key}%' or
				VOUCH_TYPE_NAME like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by VOUCH_TYPE_CODE
	</select>
	
	<select id="queryCur" resultMap="hrpAccSelect">
		SELECT
		CUR_CODE id,
		CUR_NAME text
		FROM ACC_CUR
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="key != null and key != ''">
				and (
				CUR_CODE like '${key}%' or
				CUR_NAME like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by CUR_CODE
	</select>
	
	<select id="queryCheckType" resultMap="hrpAccSelect">
		SELECT
		CHECK_TYPE_ID id,
		CHECK_TYPE_NAME text
		FROM ACC_CHECK_TYPE
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="is_sys != null  and is_sys != ''">
				and is_sys = #{is_sys}
			</if>
			<if test="key != null and key != ''">
				and (
				CHECK_TYPE_ID like '${key}%' or
				
				CHECK_TYPE_NAME like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by is_sys desc,sort_code asc
	</select>
	
	
	
	
	<select id="queryCheckItem" resultMap="hrpAccSelect">
		SELECT
		CHECK_ITEM_ID id,
		CHECK_ITEM_CODE||' '||CHECK_ITEM_NAME text
		FROM ACC_CHECK_ITEM
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="check_type_id != null  and check_type_id != ''">
				and check_type_id in (${check_type_id})
			</if>
			<if test="key != null and key != ''">
				and (
				CHECK_ITEM_CODE like '${key}%' or
				CHECK_ITEM_NAME like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by CHECK_ITEM_CODE
	</select>
	<select id="queryCheckItemById" resultMap="hrpAccSelect">
		SELECT
		CHECK_ITEM_ID id,
		CHECK_ITEM_CODE||' '||CHECK_ITEM_NAME text
		FROM ACC_CHECK_ITEM
		<where>
			is_stop = 0
			
				and group_id = #{group_id}
			
			
				and hos_id = #{hos_id}
			
				and copy_code = #{copy_code}
			
			and check_type_id = #{check_type_id}
		</where>
		order by CHECK_ITEM_CODE
	</select>
	<select id="queryFunType" resultMap="hrpAccSelect">
		SELECT
		FUN_CODE id,
		FUN_NAME text
		FROM ACC_FUN_TYPE
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="fun_id != null  and fun_id != ''">
				and fun_id = #{fun_id}
			</if>
			<if test="fun_code != null  and fun_code != ''">
				and fun_code = #{fun_code}
			</if>
			<if test="key != null and key != ''">
				and (
				FUN_CODE like '${key}%' or
				FUN_NAME like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by FUN_CODE
	</select>
	
	<select id="queryEcoType" resultMap="hrpAccSelect">
		SELECT
		ECO_CODE id,
		ECO_NAME text
		FROM ACC_ECO_TYPE 
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="eco_id != null  and eco_id != ''">
				and eco_id = #{eco_id}
			</if>
			<if test="eco_code != null  and eco_code != ''">
				and eco_code = #{eco_code}
			</if>
			<if test="key != null and key != ''">
				and (
				ECO_CODE like '${key}%' or
				ECO_NAME like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by ECO_CODE
	</select>
	
	<select id="queryCashType" resultMap="hrpAccSelect">
		SELECT
		CASH_TYPE_ID id,
		CASH_TYPE_NAME text
		FROM ACC_CASH_TYPE 
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				CASH_TYPE_CODE like '${key}%' or
				CASH_TYPE_NAME like '%${key}%'
				or spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by CASH_TYPE_ID
	</select>
	
	<select id="queryDeptType" resultMap="hrpAccSelect">
		SELECT
		TYPE_CODE id,
		TYPE_NAME text
		FROM ACC_DEPT_TYPE 
		<where>
			<if test="kind_code != null  and kind_code != ''">
				and TYPE_CODE = #{kind_code}
			</if>
			<if test="key != null and key != ''">
				and (
				TYPE_CODE like '${key}%' or
				TYPE_NAME like '%${key}%'
				)
			</if>
			and type_code not in ('05','06')
		</where>
		order by TYPE_CODE
	</select>
	
	<select id="queryDeptNatur" resultMap="hrpAccSelect">
		SELECT
		NATUR_CODE id,
		NATUR_NAME text
		FROM ACC_DEPT_NATUR 
		<where>
			<if test="natur_code1 != null  and natur_code1 != ''">
				and natur_code in (#{natur_code1},#{natur_code2})
			</if>
			<if test="key != null and key != ''">
				and (
				NATUR_CODE like '${key}%' or
				NATUR_NAME like '%${key}%'
				)
			</if>
		</where>
		order by NATUR_CODE
	</select>
	
	<select id="queryDeptOut" resultMap="hrpAccSelect">
		SELECT
		OUT_CODE id,
		OUT_NAME text
		FROM ACC_DEPT_OUT 
		<where>
			<if test="key != null and key != ''">
				and (
				OUT_CODE like '${key}%' or
				OUT_NAME like '%${key}%'
				)
			</if>
		</where>
		order by OUT_CODE
	</select>
	
	<select id="queryEmpPay" resultMap="hrpAccSelect">
		SELECT
		PAY_TYPE_CODE id,
		PAY_TYPE_NAME text
		FROM ACC_EMP_PAY 
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			
			<if test="key != null and key != ''">
				and (
				PAY_TYPE_CODE like '${key}%' or
				PAY_TYPE_NAME like '%${key}%'
				)
			</if>
		</where>
		order by PAY_TYPE_CODE
	</select>
	<!-- 凭证状态 -->
	<select id="queryAccVouchState" resultMap="hrpAccSelect">
		SELECT
		STATE id,
		STATE_NAME text
		FROM ACC_VOUCH_STATE 
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				STATE like '${key}%' or
				STATE_NAME like '%${key}%'
				)
			</if>
		</where>
		order by STATE
	</select>
	
	<select id="queryPayType" resultMap="hrpAccSelect">
		SELECT
		pay_code id,
		pay_name text
		FROM ACC_PAY_TYPE 
		<where>
			source_code = 'HRP'
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			  
			  
			<if test="sql != null  and sql != ''">
				and ${sql}
			</if>
			<if test="key != null and key != ''">
				and (
				pay_code like '${key}%' or
				pay_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by pay_code
	</select>
	
	<select id="queryAccFinaContent" resultMap="hrpAccSelect">
		SELECT
		content_code id,
		content_name text
		FROM ACC_FINA_CONTENT 
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				content_code like '${key}%' or
				content_name like '%${key}%'
				)
			</if>
		</where>
		order by content_code
	</select>
	
	<select id="queryAccWageScheme" resultMap="hrpAccSelect">
		SELECT
		scheme_id id,
		scheme_code||' '||scheme_name text
		FROM ACC_WAGE_SCHEME 
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="wage_code != null  and wage_code != ''">
				and wage_code = #{wage_code}
			</if>
			<if test="scheme_type_code != null and scheme_type_code != ''">
				and scheme_type_code = #{scheme_type_code, jdbcType=VARCHAR}
			</if>
			<if test="key != null and key != ''">
				and (
				scheme_id like '${key}%' or
				scheme_code like '${key}%' or
				scheme_name like '%${key}%'
				)
			</if>
		</where>
		order by scheme_id
	</select>
	
	<select id="queryAccWageItem" resultMap="hrpAccSelect">
		SELECT
		item_code id,
		item_name text
		FROM ACC_WAGE_ITEM
		<where>
			<if test="is_stop != null  and is_stop != ''">
				and is_stop = #{is_stop}
			</if>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="wage_code != null  and wage_code != ''">
				and wage_code = #{wage_code}
			</if>
			<if test="item_code != null  and item_code != ''">
				and item_code = #{item_code}
			</if>
			<if test="item_cal != null  and item_cal != ''">
				and item_cal = #{item_cal}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="key != null and key != ''">
				and (
				item_code like '${key}%' or
				item_name like '%${key}%' or
				spell_code like '%${key}%'or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by item_code
	</select>
	
	<select id="queryAccWage" resultMap="hrpAccSelect">
		SELECT
		a.wage_code id,
		a.wage_name text
		FROM ACC_WAGE a
		<where>
			<if test="wage_code_where != null  and wage_code_where != ''">
				and a.wage_code not in ( ${wage_code_where})
			</if>
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				a.wage_code like '${key}%' or
				a.wage_name like '%${key}%'
				)
			</if>
			<if test="wage_where != null  and wage_where != ''">
				${wage_where}
			</if>
			<if test="is_read != null and is_read != ''">
				and exists(
					select 1 from v_user_data_perm p 
					where p.table_code='ACC_WAGE' and p.group_id=a.group_id and p.hos_id=a.hos_id and p.copy_code=a.copy_code 
					and p.perm_code=a.wage_code and p.is_read=1 and p.user_id=#{user_id}
        		)
			</if>
			<if test="is_write != null and is_write != ''">
				and exists(
					select 1 from v_user_data_perm p 
					where p.table_code='ACC_WAGE' and p.group_id=a.group_id and p.hos_id=a.hos_id and p.copy_code=a.copy_code 
					and p.perm_code=a.wage_code and p.is_write=1 and p.user_id=#{user_id}
        		)
			</if>	
		</where>
		order by wage_code
	</select>
	
	<select id="queryDeptDictNo" resultMap="hrpAccSelect">
		select a.dept_id||'.'|| a.dept_no id,a.dept_name text from
		hos_dept_dict a
		left join hos_dept b on a.group_id=b.group_id and
		a.hos_id=b.hos_id and
		a.dept_id=b.dept_id
		<where>
			a.is_stop=0 and b.is_last=1
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="kind_code != null  and kind_code != ''">
				and b.kind_code in ${kind_code}
			</if>
			<if test="key != null and key != ''">
				and (
				a.dept_code like '${key}%' or
				a.dept_name like
				'%${key}%'
				or
				b.spell_code like '%${key}%' or
				b.wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by a.dept_code
	</select>
	
	<select id="queryWageType" resultMap="hrpAccSelect">
		select
		a.type_id id,
		a.type_name text from
		ACC_WAGE_TYPE a
		<where>
		
			a.is_stop=0 
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				a.type_code like '${key}%' or
				a.type_name like
				'%${key}%'
				)
			</if> 
		</where>
		order by a.type_code
	</select>
	
	<select id="queryEmpDict" resultMap="hrpAccSelect">
		SELECT
		emp_id||'.'||emp_no id,
		emp_code||' '||emp_name text
		FROM HOS_EMP_DICT
		<where>
		 <if test="kind_code != null and kind_code != ''">
			 and kind_code in (
			select kind_code from hos_emp_kind
			<where>
				<if test="group_id != null  and group_id != ''">
					and group_id = #{group_id}
				</if>
				<if test="hos_id != null  and hos_id != ''">
					and hos_id = #{hos_id}
				</if>
					and kind_code = #{kind_code}
			</where>
			)
		 </if>
		 <if test="dept_id != null and dept_id != ''">
			 and dept_id in (
			select dept_id from hos_dept_dict
			<where>
				<if test="group_id != null  and group_id != ''">
					and group_id = #{group_id}
				</if>
				<if test="hos_id != null  and hos_id != ''">
					and hos_id = #{hos_id}
				</if>
				<if test="dept_id != null  and dept_id != ''">
					and dept_id = #{dept_id}
				</if>
				<if test="dept_no != null  and dept_no != ''">
					and dept_no = #{dept_no}
				</if>
			</where>
			)
		 </if>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				emp_id like '${key}%' or
				emp_code like '${key}%' or
				emp_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			and  is_stop = 0 
		</where>
		order by emp_id
	</select>
	
	
	<select id="queryAllEmpDict" resultMap="hrpAccSelect">
		SELECT
		emp_id||'.'||emp_no id,
		emp_code||' '||emp_name text
		FROM HOS_EMP_DICT
			where
					 	group_id = #{group_id}
					and hos_id = #{hos_id}
					<if test="key != null and key != ''">
				and (
					emp_code like '${key}%' or
					emp_name like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		order by emp_id
	</select>
	
	<select id="queryEmpDictByWageCode" resultMap="hrpAccSelect">
		SELECT
		hed.emp_id||'.'||emp_no id,
		hed.emp_code||' '||emp_name text
		FROM HOS_EMP_DICT hed
		left join acc_wage_emp_kind awek on hed.group_id = awek.group_id and hed.hos_id = awek.hos_id and hed.kind_code = awek.kind_code
		where
			hed.group_id = #{group_id}
			and hed.hos_id = #{hos_id}
			and hed.is_stop = #{is_stop}
			and awek.wage_code = #{wage_code}
		order by hed.emp_id
	</select>
	
	<select id="queryBankSelect" resultMap="hrpAccSelect">
		select
		bank_number id,
		simple_name text from
		ACC_BANK 
		<where>
			is_stop=0 
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				bank_number like '${key}%' or
				bank_name like 
				'%${key}%' or
				simple_name like
				'%${key}%'
				)
			</if>
		</where>
		order by bank_number,sort_code
	</select>
	
	<select id="queryCashItemSelect" resultMap="hrpAccSelect">
		select
			cash_item_id id,
			cash_item_code || ' ' || cash_item_name text 
		from
		ACC_CASH_ITEM 
		<where>
			is_stop=0 
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="cash_dire != null  and cash_dire != ''">
				and cash_dire = #{cash_dire}
			</if>
			<if test="key != null and key != ''">
				and (
				cash_item_code like '${key}%' or
				cash_item_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by cash_item_code,cash_item_name
	</select>
	
	<select id="queryDeptOutSelect" resultMap="hrpAccSelect">
		select
		out_name text,
		out_code id from
		acc_dept_out 
		<where>
			<if test="key != null and key != ''">
				and (
				out_code like '${key}%' or
				out_name like '%${key}%' 
				)
			</if>
		</where>
		order by out_code,out_name
	</select>

	<select id="queryAccPatientType" resultMap="hrpAccSelect">
		select patient_type_code as id, patient_type_name as text from
		acc_patient_type
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				patient_type_code like '${key}%' or
				patient_type_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by patient_type_code, patient_type_name
	</select>

	<select id="queryAccChargeType" resultMap="hrpAccSelect">
		select charge_type_code as id , charge_type_name as text from acc_charge_type
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				charge_type_code like '${key}%' or
				charge_type_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by charge_type_code, charge_type_name
	</select>
	
	<!-- 查询报表字典 -->
	<select id="querySuperReportDict" resultMap="hrpAccSelect">
		select dict_code as id , dict_code||' '||dict_name as text from rep_define_dict
		where is_stop=0 and group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code}
			<if test="mod_code != null  and mod_code != ''">
				mod_code=#{mod_code}
			</if>
			<if test="key != null and key != ''">
				and (dict_code like '${key}%' or dict_name like '%${key}%')
			</if>
		order by sort_code
	</select>
	
	<select id="queryCreateUser" resultMap="hrpAccSelect">
		select distinct su.user_id id,su.user_name text from acc_vouch av join 
		sys_user su on av.group_id = su.group_id
		and av.hos_id = su.hos_id and av.copy_code=su.copy_code
		and av.create_user=su.user_id 
		<where>
			<if test="group_id != null  and group_id != ''">
				and su.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and su.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and su.copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				su.user_name like '${key}%' or
				su.user_code like '%${key}%' or
				su.spell_code like '%${key}%' or
				su.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by su.user_id,su.user_name
	</select>
	
	<select id="queryAccPayAttr" resultMap="hrpAccSelect">
		select pay_type id,
       type_name text 
       from acc_pay_attr
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				pay_type like '${key}%' or
				type_name like '%${key}%' or
				)
			</if>
		</where>
		order by pay_type,type_name
	</select>
	<!-- 核算分类下拉框 -->
	<select id="queryCheckItemType" resultMap="hrpAccSelect">
		select type_code id,
       type_name text 
       from ACC_CHECK_ITEM_TYPE
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="check_type_id != null  and check_type_id != ''">
				and check_type_id = #{check_type_id}
			</if>
			<if test="key != null and key != ''">
				and (
				type_code like '${key}%' or
				type_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by sort_code 
	</select>
	
	<select id="queryHosDept" resultMap="hrpAccSelect">
		select 
			a.dept_id id, 
			a.dept_code||' '||a.dept_name text 
		from hos_dept_dict a
		<!-- <if test="is_perm != null and is_perm == '1'">
			join v_user_data_perm b
				on a.group_id = b.group_id and a.hos_id = b.hos_id
				and b.table_code = 'HOS_DEPT_DICT'
				and b.user_id = #{user_id}
				and a.dept_id = b.perm_code
		</if> -->
		WHERE a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.is_stop=0
		 <if test="is_perm != null and is_perm == '1'">
			and to_char(a.dept_id) in (select b.perm_code from  v_user_data_perm b
				where b.group_id = #{group_id} and   b.hos_id = #{hos_id}
				and b.table_code = 'HOS_DEPT_DICT'
				and b.user_id = #{user_id}
				)
				 
		</if>
			<if test="kind_code != null  and kind_code != ''">
				and a.kind_code in ${kind_code}
			</if>
			<if test="is_last != null  and is_last != ''">
				and a.is_last in ${is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				a.dept_code like '${key}%' or
				a.dept_name like '%${key}%'
				or
				a.spell_code like '%${key}%' or
				a.wbx_code like '%${key}%'
				)
			</if>
		order by a.dept_id
	</select>
	
	<select id="queryHosDeptKind" resultMap="hrpAccSelect">
		select
			a.kind_code id, a.kind_name text
		from hos_dept_kind a
		where a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.is_stop=0
		order by a.kind_code
	</select>
	
	<select id="queryWageItemNature" resultMap="hrpAccSelect">
		select nature_code id,
       		   nature_name text
        from ACC_WAGE_ITEM_NATURE
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				nature_code like '${key}%' or
				nature_name like '%${key}%'
				)
			</if>
		</where>
		order by nature_code 
	</select>
	
	<select id="queryWageItemType" resultMap="hrpAccSelect">
		select type_code,
       		   type_name 
        from ACC_WAGE_ITEM_TYPE
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				type_code like '${key}%' or
				type_name like '%${key}%'
				)
			</if>
		</where>
		order by type_code 
	</select>
	
	<select id="queryAccYear" resultMap="hrpAccSelect">
		<if test="wage_flag != null  and wage_flag != ''">
		select '本年度' id,
       		   '本年度' text from dual
         union all
		select '上一年' id,
       		   '上一年' text from dual
         union all
		</if>
		select acc_year id,
       		   acc_year text
        from ACC_YEAR
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (acc_year like '${key}%' )
			</if>
		</where>
	</select>
	
	<select id="queryAccTarget" resultMap="hrpAccSelect">
		select target_code ||','||hos_unit.unit_name id,
              target_code ||' '||target_name text
        from acc_target
        left join hos_unit
        on acc_target.group_id = hos_unit.group_id
        and acc_target.hos_id = hos_unit.hos_id
        and acc_target.unit_code = hos_unit.unit_code
		<where>
			<if test="group_id != null  and group_id != ''">
				and acc_target.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and acc_target.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and acc_target.copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (acc_target.target_code like '%${key}%'
				      or 
				     acc_target.target_name like '%${key}%'
				       or 
				     acc_target.spell_code like '%${key}%'
				       or 
				     acc_target.wbx_code like '%${key}%'
				   )
			</if>
		</where>
		order by target_code desc 
	</select>
	
	<select id="queryAccPaperType" resultMap="hrpAccSelect">
	
		select
           type_code id,type_code ||'  '||type_name text
		from acc_paper_type
         <where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (type_code like '%${target_code}%'
				      or 
				     type_name like '%${target_name}%'
				   )
			</if>
			   and is_stop = '0'
		</where>
          order by type_code
	</select>

	
	<select id="queryAccWageItemColumn" resultMap="hrpAccSelect">
		SELECT
		a.column_item id,
		a.item_name text
		FROM ACC_WAGE_ITEM a
		<where>
			<if test="scheme_id != null  and scheme_id != ''">
				exists (select b.column_item from acc_wage_scheme_item b where b.column_item= a.column_item and b.scheme_id = #{scheme_id})
			</if>
			<if test="is_stop != null  and is_stop != ''">
				and a.is_stop = #{is_stop}
			</if>
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="wage_code != null  and wage_code != ''">
				and a.wage_code = #{wage_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="key != null and key != ''">
				and (
				a.item_code like '${key}%' or
				a.item_name like '%${key}%' or
				a.spell_code like '%${key}%'or
				a.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.sort_code
	</select>
	
	<select id="queryAccWageColumn" resultMap="hrpAccSelect">
		SELECT
		item_code||'.'||column_item id,
		item_name text
		FROM ACC_WAGE_ITEM
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="wage_code != null  and wage_code != ''">
				and wage_code = #{wage_code}
			</if>
			<if test="key != null and key != ''">
				and (
				item_id like '${key}%' or
				item_name like '%${key}%'
				)
			</if>
		</where>
		order by item_code
	</select>
	
	<!-- 查询自定义辅助核算字典对应表 -->
	<select id="queryAccBusiZCheck" resultMap="hrpAccSelect">
		SELECT
		Z_CODE id,
		Z_NAME text
		FROM ACC_BUSI_ZCHECK
		where group_id = #{group_id} and hos_id = #{hos_id}  and copy_code = #{copy_code}
		order by Z_NAME
	</select>
	
	<select id="queryAccMultiPlan" resultMap="hrpAccSelect">
		SELECT
		 plan_code||' '||analy_type id,
		plan_code||' '||plan_name text
		FROM acc_multi_plan
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				plan_code like '${key}%' or
				plan_name like '%${key}%'
				)
			</if>
		</where>
		order by plan_code
	</select>
	
	<select id="queryAccYearMonth" resultMap="hrpAccSelect">
		<if test="wage_flag != null  and wage_flag == 1">
		select '本期间' id,
		 	   '本期间' text
		FROM dual  union all
		</if>
		SELECT
		 acc_month id,
		 acc_month text
		FROM acc_year_month
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and acc_year = #{acc_year}
			</if>
			<if test="key != null and key != ''">
				and acc_month like '%${key}%'
			</if>
		</where>

	</select>
	
	<select id="queryAccTellType" resultMap="hrpAccSelect">
		SELECT
		 tell_type_code||' '||kind_code id,
		 tell_type_name text
		FROM acc_tell_type
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				tell_type_code like '${key}%' or
				tell_type_name like '%${key}%'
				)
			</if>
			and nature_code = #{nature_code}
		</where>
		union all
		select '全部' id,
		'全部' text
		from dual 
	</select>
	
	<select id="queryGroupDict" resultMap="hrpAccSelect">
		SELECT
		'本集团' id,
		'本集团' text
		FROM dual
		union all
		SELECT
		to_char(group_id) id,
		group_SIMPLE text
		FROM sys_group_dict
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test=" key != null and key != ''">
				and (
				group_code like '%${key}%' or
				group_name like '%${key}%'
				)
			</if>
		</where>
	</select>
	
	<select id="queryHosInfo" resultMap="hrpAccSelect">
		SELECT
		'本医院' id,
		'本医院' text
		FROM dual
		union all
		SELECT
		to_char(hos_id) id,
		HOS_SIMPLE text
		FROM HOS_INFO_DICT
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null and key != ''">
				and (
				hos_code like '%${key}%' or
				hos_name like '%${key}%'
				)
			</if>
		</where>
	</select>
	
	<select id="queryHosCopy" resultMap="hrpAccSelect">
		SELECT
		'本账套' id,
		'本账套' text
		FROM dual
		union all
		SELECT
		copy_code id,
		copy_name text
		FROM hos_copy
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null and key != ''">
				and (
				copy_code like '%${key}%' or
				copy_name like '%${key}%'
				)
			</if>
		</where>
	</select>
	
	
	<select id="queryGroupDictDataType" resultMap="hrpAccSelect">
		SELECT
		to_char(group_id) id,
		group_SIMPLE text
		FROM sys_group_dict
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test=" key != null and key != ''">
				and (
				group_code like '%${key}%' or
				group_name like '%${key}%'
				)
			</if>
		</where>
		union all
		SELECT
		'0' id,
		'无' text 
		FROM dual
		
	</select>
	
	<select id="queryHosInfoDataType" resultMap="hrpAccSelect">
		SELECT
		to_char(hos_id) id,
		HOS_SIMPLE text
		FROM HOS_INFO_DICT
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null and key != ''">
				and (
				hos_code like '%${key}%' or
				hos_name like '%${key}%'
				)
			</if>
		</where>
		union all
		SELECT
		'0' id,
		'无' text
		FROM dual
	</select>
	
	<select id="queryHosCopyDataType" resultMap="hrpAccSelect">
		SELECT
		copy_code id,
		copy_name text
		FROM hos_copy
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null and key != ''">
				and (
				copy_code like '%${key}%' or
				copy_name like '%${key}%'
				)
			</if>
		</where>
		union all
		SELECT
		'0' id,
		'无' text
		FROM dual
		
	</select>
	
	<!--pj查询科目下拉框，根据条件匹配通用，不分页， value=code，text=code name -->
	<select id="querySubjCode" resultMap="hrpAccSelect">
		SELECT a.subj_code id, a.subj_code||' '||a.subj_name_all text,a.spell_code || a.wbx_code search
		FROM ACC_SUBJ a
		where a.group_id = #{group_id}  and a.hos_id = #{hos_id} and a.copy_code =  #{copy_code} and a.acc_year=#{acc_year}
		<if test="is_last != null and is_last !='' ">
			and a.is_last = #{is_last}
		</if>
		<if test="is_check != null and is_check !='' ">
			and a.is_check = #{is_check}
		</if>
		<if test="subj_nature_code != null and subj_nature_code != ''">
			and a.subj_nature_code = #{subj_nature_code}
		</if>
		<if test="subj_type_code != null and subj_type_code != ''">
			and a.subj_type_code = #{subj_type_code}
		</if>
		<if test="check_type_id != null and check_type_id != ''">
			and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
		</if>
		<if test="key != null and key != ''">
			and (a.SUBJ_CODE like '${key}%' or a.SUBJ_NAME like '%${key}%' or a.spell_code like '%${key}%' or a.wbx_code like '%${key}%')
		</if>
		order by a.SUBJ_CODE
	</select>
	
	
	<!--pj查询科目下拉框，根据条件匹配通用，不分页，value=id，text=code name -->
	<select id="querySubjId" resultMap="hrpAccSelect">
		SELECT a.subj_id id, a.subj_code||' '||a.subj_name text
		FROM ACC_SUBJ a
		where a.group_id = #{group_id}  and a.hos_id = #{hos_id} and a.copy_code =  #{copy_code} and a.acc_year=#{acc_year}
		<if test="is_last != null and is_last !='' ">
			and a.is_last = #{is_last}
		</if>
		<if test="is_check != null and is_check !='' ">
			and a.is_check = #{is_check}
		</if>
		<if test="subj_nature_code != null and subj_nature_code != ''">
			and a.subj_nature_code = #{subj_nature_code}
		</if>
		<if test="subj_type_code != null and subj_type_code != ''">
			and a.subj_type_code = #{subj_type_code}
		</if>
		<if test="check_type_id != null and check_type_id != ''">
			and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
		</if>
		<if test="key != null and key != ''">
			and (a.SUBJ_CODE like '${key}%' or a.SUBJ_NAME like '%${key}%' or a.spell_code like '%${key}%' or a.wbx_code like '%${key}%')
		</if>
		order by a.SUBJ_CODE
	</select>
	
	<!--pj根据科目编码，查询核算类型下拉框,根据条件匹配通用，不分页-->
	<select id="queryCheckTypeBySubjCode" resultMap="hrpAccSelect">
		SELECT a.CHECK_TYPE_ID id, a.CHECK_TYPE_NAME text FROM ACC_CHECK_TYPE a
		where a.group_id = #{group_id} and a.hos_id = #{hos_id} and a.copy_code = #{copy_code}
		<if test="subj_code != null and subj_code != ''">
			 and exists(
				select 1 from acc_subj s where s.group_id=a.group_id and s.hos_id=a.hos_id and s.copy_code=a.copy_code and s.acc_year=#{acc_year}
				and s.subj_code=#{subj_code}
				<choose>  
		            <when test="check=='1'">  
		                and s.check1=a.CHECK_TYPE_ID
		            </when>  
		            <when test="check=='2'">  
		                and s.check2=a.CHECK_TYPE_ID  
		            </when>
		            <when test="check=='3'">  
		                and s.check3=a.CHECK_TYPE_ID
		            </when>
		            <when test="check=='4'">  
		                and s.check4=a.CHECK_TYPE_ID
		            </when>  
		            <otherwise>  
		               and instr(','||s.check1|| ','||s.check2|| ','||s.check3|| ','||s.check4||',', ','||a.CHECK_TYPE_ID || ',') > 0 
		            </otherwise>  
		        </choose>  
			)
		</if>
		<if test="(begin_subj_code != null and begin_subj_code != '') or (end_subj_code != null and end_subj_code != '')">
			 and exists(
				select 1 from acc_subj s 
				where s.group_id=a.group_id 
					and s.hos_id=a.hos_id 
					and s.copy_code=a.copy_code 
					and s.acc_year=#{acc_year} 
					and (
						(nvl(#{begin_subj_code}, '**') = '**' and s.subj_code=#{end_subj_code})
						or
						(nvl(#{end_subj_code}, '**') = '**' and s.subj_code=#{begin_subj_code})
						or 
						(s.subj_code &gt;= #{begin_subj_code} and s.subj_code &lt;= #{end_subj_code})
					)
					and instr(','||s.check1|| ','||s.check2|| ','||s.check3|| ','||s.check4||',', ','||a.CHECK_TYPE_ID || ',') > 0 
			)
		</if>
		<if test="key != null and key != ''">
			and (a.CHECK_TYPE_code like '%${key}%' or a.CHECK_TYPE_NAME like '%${key}%' or a.spell_code like '%${key}%' or a.wbx_code like '%${key}%')
		</if>
		order by a.is_sys desc,a.sort_code asc
	</select>
	
	<!--pj根据核算类型ID，查询核算类型，为了queryCheckItemByType动态查询核算项 -->
	<select id="queryCheckTypeById" resultType="java.util.Map">
		SELECT check_table, column_id, column_no, column_code, column_name,is_sys,is_change,column_check from acc_check_type
		where group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code} and check_type_id =#{check_type_id}
	</select>
	
	<!--pj根据核算类型，查询核算项下拉框,根据条件匹配通用，不分页 -->
	<select id="queryCheckItemByType" resultMap="hrpAccSelect">
		SELECT 
			${column_id} id,
			${column_code}||' '||${column_name} text, 
			spell_code || wbx_code as search 
		FROM ${check_table}
		where group_id = #{group_id} and hos_id = #{hos_id} 
		<if test='is_sys=="0"'>
			and copy_code = #{copy_code}  and check_type_id =#{check_type_id} 
		</if>
		<if test='is_change=="1"'>
			and is_stop=0
		</if>
		<if test="key != null and key != ''">
			and (
				${column_code} like '${key}%' 
				or ${column_name} like '%${key}%' 
				or spell_code like '%${key}%' 
				or wbx_code like '%${key}%'
			)
		</if>
		order by ${column_code}
	</select>
	
	<!--根据核算类型，查询核算项下拉框,根据条件匹配通用 取前100条 -->
	<select id="queryCheckItemByTypeFy" resultMap="hrpAccSelect">
		SELECT * FROM(
			SELECT 
				${column_code} id,
				<!-- ${column_id} id, -->
				${column_code}||' '||${column_name} text
			FROM ${check_table}
			where group_id = #{group_id} and hos_id = #{hos_id} 
			<if test='is_sys=="0"'>
				and copy_code = #{copy_code}  and check_type_id =#{check_type_id} 
			</if>
			<if test='is_change=="1"'>
				and is_stop=0
			</if>
			<if test="key != null and key != ''">
				and (
					${column_code} like '${key}%' 
					or ${column_name} like '%${key}%' 
					or spell_code like '%${key}%' 
					or wbx_code like '%${key}%'
				)
			</if>
			order by ${column_code} asc
		)
		WHERE rownum &lt;= 100
	</select>
	<!--  出纳账管理    摘要字典 下拉框 -->
	<select id="queryAccTellSummaryById" resultMap="hrpAccSelect">
		SELECT
		sid id,
		summary text
		FROM acc_tell_summary
		where   	group_id = #{group_id,jdbcType=INTEGER} 
					and hos_id = #{hos_id,jdbcType=INTEGER} 
					and copy_code = #{copy_code,jdbcType=VARCHAR}  
					and user_id = #{user_id,jdbcType=INTEGER} 
			 
			<if test="key != null and key != ''">
				and (summary like '%${key}%' or
						spell_code like  '%${key}%'  or
						wbx_code like  '%${key}%'  
					)
			</if>		 
			order by summary
	</select>
	
	<select id="queryAccHisLog" resultMap="hrpAccSelect">
		SELECT
		 his_log_code id,
		 his_log_name text
		FROM init_acc_his_log_main
		<where>
			
			<if test="key != null and key != ''">
				and (
				his_log_code like '${key}%' or
				his_log_name like '%${key}%'
				)
			</if>
		</where>
	</select>
	
	<select id="queryProjEmp" resultMap="hrpAccSelect">
		SELECT
		apa.proj_id ||'.'|| apa.con_emp_id id,
		hed.emp_code||' '|| hed.emp_name text
		FROM acc_proj_attr apa
		left join hos_emp_dict hed on apa.group_id = hed.group_id
    	and apa.hos_id = hed.hos_id
    	and apa.con_emp_id = hed.emp_id
    	and hed.is_stop = 0 
		<where>
			<if test="group_id != null  and group_id != ''">
				and apa.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and apa.hos_id = #{hos_id}
			</if>
			<if test="proj_id != null  and proj_id != ''">
				and apa.proj_id = #{proj_id}
			</if>
		</where>
		order by apa.proj_id
	</select>
	
	<select id="queryBusiTypeByVouch" resultMap="hrpAccSelect">
		select to_char(a.busi_type_code) id, 
        case 
        when a.busi_type_code is null then '凭证制单'
        when instr(a.busi_type_code, 'A') > 0 then '期末处理'
        when instr(a.busi_type_code, 'B') > 0 then '工资转账'
        when instr(a.busi_type_code, 'C') > 0 then '出纳凭证'
        else bt.busi_type_name
      end as text
	from acc_vouch a
	left join acc_busi_type bt on bt.group_id = a.group_id
	    and bt.hos_id = a.hos_id
	    and bt.copy_code = a.copy_code
	    and a.busi_type_code = bt.busi_type_code 
    <where>
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="mod_code != null  and mod_code != ''">
				and a.mod_code = #{mod_code}
			</if>
			<if test="is_vouch != null  and is_vouch != ''">
				and a.is_vouch = #{is_vouch}
			</if>
			<if test="key != null and key != ''">
				and (
				bt.busi_type_code like '${key}%' or
				bt.busi_type_name like '%${key}%'
				)
			</if>
			and a.vouch_date between to_date(#{begin_date}, 'yyyy-MM-dd') and to_date(#{end_date}, 'yyyy-MM-dd')
		</where>			
		group by a.busi_type_code,bt.busi_type_name
	</select>
	<!--根据选择账套级联科目  -->
	<select id="querySubjByHosCopyRela" resultMap="hrpAccSelect">
		SELECT
			distinct a.subj_code id,
			a.subj_code||' '||a.subj_name text
		FROM ACC_SUBJ a
		LEFT JOIN ACC_CHECK_TYPE act1 ON a.GROUP_ID = act1.GROUP_ID
         		  AND a.HOS_ID = act1.HOS_ID
         		  AND a.COPY_CODE = act1.COPY_CODE
         		  AND a.check1 = act1.CHECK_TYPE_ID 
        LEFT JOIN HOS_COPY_RELA hcr ON a.group_id = hcr.group_id
				  AND a.hos_id = hcr.hos_id AND a.copy_code = hcr.copy_code
		<where>
		       a.group_id = #{group_id} 
			   and hcr.rela_code = #{rela_code}
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="subj_id != null and subj_id != ''">
				and a.subj_id = #{subj_id}
			</if>
			<if test="subj_nature_code != null  and subj_nature_code != ''">
				and a.SUBJ_NATURE_CODE = #{subj_nature_code}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and a.SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			 <if test="check_type_id != null  and check_type_id != ''">
			 	and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
			 </if>
			 <!-- <if test="subj_nature_code != null and subj_nature_code !='' ">
			 	and subj_nature_code=#{subj_nature_code}
			 </if> -->
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (a.subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or a.subj_type_code1 = #{subj_type_code1}
				 </if>
				 )
			 </if>
			  <if test="sign ==1">
        AND act1.check_type_name='部门'
      	</if>
      	 <if test="sign ==2 ">
        AND act1.check_type_name='职工'
      	</if>
      	 <if test="sign ==3">
        AND act1.check_type_name='项目'
      	</if>
      	     <if test="sign ==4">
        AND act1.check_type_name='库房' 
      	</if>
      	     <if test="sign ==5">
        AND act1.check_type_name='客户'
      	</if>
      	     <if test="sign ==6">
        AND act1.check_type_name='供应商'
      	</if>
      	<if test="sign ==10">
        AND act1.check_type_name='单位' 
      	</if>
      	<if test="sign ==11">
        AND act1.is_sys=0
      	</if>
			 <if test="is_last != null and is_last !='' ">
			 	and a.is_last=#{is_last}
			 </if>
			 <if test="check_type_code != null and check_type_code !='' ">
			 	and (a.check1 in (check_type_code) 
			 			or a.check2 in (check_type_code) 
			 			or a.check3 in (check_type_code)
			 			or a.check4 in (check_type_code))
			 </if>
			 <if test="extras != null and extras != '' ">
			 	and a.subj_nature_code&lt;&gt;#{extras}
			 </if>
			<if test="key != null and key != ''">
				and (
					a.SUBJ_CODE like '${key}%' or
					a.SUBJ_NAME like '%${key}%' or
					a.SUBJ_NAME_ALL like '%${key}%' or 
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.SUBJ_CODE
	</select>
	
	<!-- 查询科目下拉框，根据条件匹配通用，不分页， value=code，text=code name  search=拼音码 五笔码检索   用于 自定义辅助核算余额表-->
	<select id="querySubjCodeByRela" resultMap="hrpAccSelect">
		SELECT distinct a.subj_code id, a.subj_code||' '||a.subj_name_all text,a.spell_code || a.wbx_code search
		FROM ACC_SUBJ a
		LEFT JOIN HOS_COPY_RELA hcr ON a.group_id = hcr.group_id
				  AND a.hos_id = hcr.hos_id AND a.copy_code = hcr.copy_code
		where a.group_id = #{group_id}  
		and hcr.rela_code = #{rela_code}
		<!-- and a.hos_id = #{hos_id} and a.copy_code =  #{copy_code}  -->
		and a.acc_year=#{acc_year}
		<if test="is_last != null and is_last !='' ">
			and a.is_last = #{is_last}
		</if>
		<if test="is_check != null and is_check !='' ">
			and a.is_check = #{is_check}
		</if>
		<if test="subj_nature_code != null and subj_nature_code != ''">
			and a.subj_nature_code = #{subj_nature_code}
		</if>
		<if test="subj_type_code != null and subj_type_code != ''">
			and a.subj_type_code = #{subj_type_code}
		</if>
		<if test="check_type_id != null and check_type_id != ''">
			and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
		</if>
		<if test="key != null and key != ''">
			and (a.SUBJ_CODE like '${key}%' or a.SUBJ_NAME like '%${key}%' or a.spell_code like '%${key}%' or a.wbx_code like '%${key}%')
		</if>
		order by a.SUBJ_CODE
	</select>
	
	<!-- 账簿中的科目  -->
	<select id="querySubjByAccountRela" resultMap="hrpAccSelect">
	<!-- 申总要求辅助账中的科目应该显示全程  -->
		SELECT
			a.subj_id||'.'||a.subj_code id,
			a.subj_code||' '||a.subj_name_all text
		FROM ACC_SUBJ a
		left join ACC_CHECK_TYPE act1 on a.GROUP_ID = act1.GROUP_ID
         and a.HOS_ID = act1.HOS_ID
         and a.COPY_CODE = act1.COPY_CODE 
        and (a.check1 = act1.CHECK_TYPE_ID or a.check2 = act1.CHECK_TYPE_ID or a.check3 = act1.CHECK_TYPE_ID or a.check4 = act1.CHECK_TYPE_ID  )
		left join hos_copy_rela hcr on a.group_id = hcr.group_id and a.hos_id = hcr.hos_id and a.copy_code = hcr.copy_code
		<where> 
			    a.group_id = #{group_id} 
				and hcr.rela_code = #{rela_code}
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="subj_id != null and subj_id != ''">
				and a.subj_id = #{subj_id}
			</if>
			<if test="subj_nature_code != null  and subj_nature_code != ''">
				and a.SUBJ_NATURE_CODE = #{subj_nature_code}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and a.SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			 <if test="check_type_id != null  and check_type_id != ''">
			 	and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
			 </if> 
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (a.subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or a.subj_type_code1 = #{subj_type_code1}
				 </if>
				 )
			 </if>
			  <if test="sign ==1">
        AND act1.check_type_name='部门'
      	</if>
      	 <if test="sign ==2 ">
        AND act1.check_type_name='职工'
      	</if>
      	 <if test="sign ==3">
        AND act1.check_type_name='项目'
      	</if>
      	     <if test="sign ==4">
        AND act1.check_type_name='库房' 
      	</if>
      	     <if test="sign ==5">
        AND act1.check_type_name='客户'
      	</if>
      	     <if test="sign ==6">
        AND act1.check_type_name='供应商'
      	</if>
      	<if test="sign ==10">
        AND act1.check_type_name='单位' 
      	</if>
      	<if test="sign ==11">
        AND act1.is_sys=0
      	</if>
	    <if test="is_last != null and is_last !='' ">
			 	and a.is_last=#{is_last}
	    </if>
	    <if test="check_type_code != null and check_type_code !='' ">
			 	and (a.check1 in (check_type_code) 
			 			or a.check2 in (check_type_code) 
			 			or a.check3 in (check_type_code)
			 			or a.check4 in (check_type_code))
	     </if>
	     <if test="extras != null and extras != '' ">
			 	and a.subj_nature_code&lt;&gt;#{extras}
	     </if>
	     <if test="key != null and key != ''">
				and (
					a.SUBJ_CODE like '${key}%' or
					a.SUBJ_NAME like '%${key}%'
					or
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
		 </if>
		</where>
		order by a.SUBJ_CODE
	</select>
	
	<!-- 账簿方案列表 -->
	<select id="queryAccBookSch" resultMap="hrpAccSelect">
		SELECT sch_id id, che_name text
		FROM acc_book_sch 
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND create_user = #{user_id,jdbcType=INTEGER}
			AND page = #{page,jdbcType=VARCHAR}
			<if test=" key != null and key != ''">
				and (
					che_name like '%${key}%' or
					spell_code like '%${key}%'
				)
			</if>
	</select>
	
	<!-- 账簿方案单位列表 -->
	<select id="querySysHosAll" resultMap="hrpAccSelect">
		SELECT ${this_hos_id} id, 
			#{this_hos_name,jdbcType=VARCHAR} text
		FROM DUAL 
		UNION
		SELECT hos_id id, hos_name text
		FROM hos_info 
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND exists(
				SELECT 1 
				FROM v_user_data_perm 
				WHERE v_user_data_perm.group_id = #{group_id,jdbcType=INTEGER}
					AND v_user_data_perm.table_code = 'HOS_INFO'
					AND v_user_data_perm.user_id = #{user_id,jdbcType=INTEGER}
					AND v_user_data_perm.perm_code = hos_info.hos_id
			)
			<if test=" key != null and key != ''">
				and (
					hos_name like '%${key}%' or
					hos_simple like '%${key}%' or
					spell_code like '%${key}%'
				)
			</if>
	</select>
	
	<!-- 账簿方案账套列表 -->
	<select id="querySysHosCopyAll" resultMap="hrpAccSelect">
		SELECT #{this_copy_code,jdbcType=VARCHAR} id, 
			#{this_copy_name,jdbcType=VARCHAR} text
		FROM DUAL 
		UNION
		SELECT copy_code id, 
			copy_name text  
		FROM hos_copy 
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND exists(
				SELECT 1 
				FROM v_user_data_perm 
				WHERE v_user_data_perm.group_id = #{group_id,jdbcType=INTEGER}
					AND v_user_data_perm.hos_id in (${hos_id})
					AND v_user_data_perm.table_code = 'HOS_COPY'
					AND v_user_data_perm.user_id = #{user_id,jdbcType=INTEGER}
					AND v_user_data_perm.perm_code = hos_copy.copy_code
			)
			<if test=" key != null and key != ''">
				and (
					copy_code like '%${key}%' or 
					copy_name like '%${key}%'
				)
			</if>
	</select>
	
	<select id="queryAccPaperCheques" resultMap="hrpAccSelect">
		select cheques_id id,cheques_name text 
		from acc_paper_cheques 
		where group_id=#{group_id} and hos_id=#{hos_id} and copy_code=#{copy_code} 
		<if test="key != null and key != ''">
			and cheques_name like '${key}%'
		 </if>
	</select>
		<select id="queryCheckTypeIdByCheckName" resultMap="hrpAccSelect">
		select check_type_id id
		from ACC_CHECK_TYPE
		where group_id=#{group_id} and hos_id=#{hos_id} and copy_code=#{copy_code} and check_type_name=#{check_type_name}
	</select>
	
	<select id="queryEmpSet" resultMap="hrpAccSelect">
		SELECT
		attr_code id,
		attr_name text
		FROM acc_attr_dict 
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			
			<if test="key != null and key != ''">
				and (
				attr_code like '${key}%' or
				attr_name like '%${key}%' or
				spell_code like '${key}%' or
				wbx_code like '${key}%' 
				)
			</if>
		</where>
		order by attr_code
	</select>
	
	<select id="querySubjByCode" resultMap="hrpAccSelect">
		SELECT
			a.subj_code id,
			a.subj_code||' '||a.subj_name text
		FROM ACC_SUBJ a
		<where>
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="subj_id != null and subj_id != ''">
				and a.subj_id = #{subj_id}
			</if>
			<if test="subj_nature_code != null  and subj_nature_code != ''">
				and a.SUBJ_NATURE_CODE = #{subj_nature_code}
			</if>
			<if test="SUBJ_NATURE_CODE1 != null  and SUBJ_NATURE_CODE1 != ''">
				and a.SUBJ_NATURE_CODE in (#{SUBJ_NATURE_CODE1},#{SUBJ_NATURE_CODE2})
			</if>
			 <if test="check_type_id != null  and check_type_id != ''">
			 	and (a.check1 = #{check_type_id} or a.check2 = #{check_type_id} or a.check3 = #{check_type_id} or a.check4 = #{check_type_id})
			 </if>
			 <!-- <if test="subj_nature_code != null and subj_nature_code !='' ">
			 	and subj_nature_code=#{subj_nature_code}
			 </if> -->
			 <if test="subj_type_code != null and subj_type_code !='' ">
			 	and (a.subj_type_code = #{subj_type_code}
				 <if test="subj_type_code1 != null and subj_type_code1 !='' ">
				 	or a.subj_type_code1 = #{subj_type_code1}
				 </if>
				 )
			 </if>
			 <if test="is_last != null and is_last !='' ">
			 	and a.is_last=#{is_last}
			 </if>
			 <if test="check_type_code != null and check_type_code !='' ">
			 	and (a.check1 in (check_type_code) 
			 			or a.check2 in (check_type_code) 
			 			or a.check3 in (check_type_code)
			 			or a.check4 in (check_type_code))
			 </if>
			 <if test="extras != null and extras != '' ">
			 	and a.subj_nature_code&lt;&gt;#{extras}
			 </if>
			<if test="key != null and key != ''">
				and (
					a.SUBJ_CODE like '${key}%' or
					a.SUBJ_NAME like '%${key}%'
					or
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.SUBJ_CODE
	</select>
	
	<!-- 供应商字典通用方法-->
	<select id="queryHosSupDictUniversalMethod" resultMap="hrpAccSelect">
		SELECT
			sup_id||','||sup_no||','||sup_code id,
			sup_code||' '||sup_name text
		FROM HOS_SUP_DICT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="sup_id != null  and sup_id != ''">
				and sup_id = #{sup_id}
			</if>
			<if test="is_disable != null  and is_disable != ''">
				and is_disable = #{is_disable}
			</if>
			<if test="is_stop != null  and is_stop != ''">
				and is_stop = #{is_stop}
			</if>
			and is_mat = 1
			<if test="key != null and key != ''">
				and (
				sup_code like '${key}%' or 
				sup_name like '%${key}%'
				or
				spell_code like '%${key}%' 
				<!-- or wbx_code like '%${key}%' -->
				)
			</if>
		</where>
		order by sup_code
	</select>
	
	<select id="queryDrugsPrepaType" resultMap="hrpAccSelect">
		  select prepa_type_id ||'-'|| check_type_id||'-'||check_item_type_code id,
		       prepa_type_name text
			 from acc_drugs_prepa_type
			 where group_id = #{group_id}
			 and hos_id = #{hos_id}
			 and copy_code = #{copy_code}
			 and is_stop = '0'
			 and is_last = '1'
					 
	</select>

	
	<select id="queryAccDrugsPrepaType" resultMap="hrpAccSelect">
		SELECT
		PREPA_TYPE_ID id,
		PREPA_TYPE_CODE||' '||PREPA_TYPE_NAME text
		FROM ACC_DRUGS_PREPA_TYPE
		where is_last=1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				PREPA_TYPE_CODE like '${key}%' or
				PREPA_TYPE_NAME like '%${key}%' or
				SPELL_CODE like '%${key}%' or
				WBX_CODE   like '%${key}%'
				)
			</if>		
		order by PREPA_TYPE_CODE
	</select>
	
	
	
	<!-- 付款方式(结算方式) -->
	<select id="queryAccPayType" resultMap="hrpAccSelect">
		SELECT
		pay_code id,
		pay_name text
		FROM ACC_PAY_TYPE 
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			and is_stop = 0
			and source_code = 'HRP' 
			<if test="key != null and key != ''">
				and (
				pay_code like '%${key}%' or
				pay_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by pay_code
	</select>
	
	<!-- 仓库(虚仓) -->
	<select id="queryAccVirStore" parameterType="java.util.Map" resultMap="hrpAccSelect">
		SELECT
		     mss.set_id as id,
		     mss.set_code||' '||mss.set_name as text 
		FROM MAT_STORE_SET mss
		<where>
			<if test="group_id != null and group_id != '' ">
			     mss.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != '' ">
			     AND mss.hos_id = #{hos_id}
			</if>
			<if test="set_id != null and set_id != '' ">
			     AND mss.set_id = #{set_id}
			</if>
		</where>
		order by mss.set_code
	</select>
	
	<!-- 通过参数控制 仓库权限 -->
	<select id="queryAccStoreDictDate" resultMap="hrpAccSelect">
		select  a.store_id||','||a.store_no id, 
			a.store_code||' '||a.store_name text
		from HOS_STORE_DICT a 
		
        join mat_store c
        on a.group_id = c.group_id
        and a.hos_id = c.hos_id
        and a.store_id = c.store_id
     	<where>
     	<if  test="is_read != null  and is_read != '' or is_write != null  and is_write != '' or read_or_write != null  and read_or_write != ''">
		 to_char(a.store_id) in (select b.perm_code from   v_user_data_perm b 
			where b.group_id = #{group_id,jdbcType=INTEGER} and  b.hos_id = #{hos_id,jdbcType=INTEGER}
			and b.user_id = #{user_id,jdbcType=INTEGER} and b.table_code = 'HOS_STORE_DICT' 
		
          <if  test="is_read != null  and is_read != ''">
                and b.is_read = 1
          </if>
          <if  test="is_write != null and is_write != ''">
                 and b.is_write = 1 
          </if>
           <if  test="read_or_write != null and read_or_write != ''">
                 and  (b.is_write = 1 or b.is_read = 1 )
          </if>
			)
        </if>
        
     		<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="is_last != null and is_last != ''">
				and a.is_last = #{is_last}
			</if>
			<if test="store_id != null and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			and a.is_stop = 0
			and a.is_mat = 1
			<if test="is_com != null">
				and c.is_com = #{is_com,jdbcType=INTEGER}
			</if>
			<if test="key != null and key != ''">
				and (
					a.store_code like '${key}%' or
					a.store_name like '%${key}%' 
				or
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.store_code	
	</select>
	
	<select id="querySysUser" resultMap="hrpAccSelect">
		SELECT
			user_id id,
			user_code ||' '|| user_name text
		FROM SYS_USER
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="user_code != null  and user_code != ''">
				and user_code = #{user_code}
			</if>
			and is_stop = 0
			<if test="key != null and key != ''">
				and (
				user_code like '${key}%' or 
				user_name like '%${key}%'
				or
				spell_code like '%${key}%' or 
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by user_code
	</select>
	
	<!-- 采购发票  付款条件下拉框 -->
	<select id="queryAccPayTerm" resultMap="hrpAccSelect">
		SELECT
		pay_term_id id,
		pay_term_code ||' '|| pay_term_name text
		FROM MAT_PAY_TERM 
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			and is_stop = 0
			<if test="key != null and key != ''">
				and (
				pay_term_code like '${key}%' or
				pay_term_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by pay_term_code
	</select>
	
	<!-- 通过参数控制 编制科室权限 -->
	<select id="queryAccDeptDictDate" resultMap="hrpAccSelect">
		select a.dept_id||','||a.dept_no id,
			a.dept_code||' '||a.dept_name text
		from hos_dept_dict a
		<!-- <if  test="is_read != null  and is_read != '' or is_write != null  and is_write != '' or read_or_write != null  and read_or_write != ''">
		
		join v_user_data_perm b on a.group_id = b.group_id
          and a.hos_id = b.hos_id
          and b.user_id =  #{user_id,jdbcType=INTEGER}
          and b.table_code = 'HOS_DEPT_DICT'
          and b.perm_code = to_char(a.dept_id)
          <if  test="is_read != null  and is_read != ''">
                and b.is_read = 1
          </if>
          <if  test="is_write != null and is_write != ''">
                 and b.is_write = 1 
          </if>
           <if  test="read_or_write != null and read_or_write != ''">
                 and (b.is_write = 1 or b.is_read = 1) 
          </if>
          

        </if> -->
     	<where>
     	<if  test="is_read != null  and is_read != '' or is_write != null  and is_write != '' or read_or_write != null  and read_or_write != ''">
		
		to_char(a.dept_id) in (select b.perm_code from  v_user_data_perm b where b.group_id =  #{group_id,jdbcType=INTEGER}
          and  b.hos_id =  #{hos_id,jdbcType=INTEGER}
          and b.user_id =  #{user_id,jdbcType=INTEGER}
          and b.table_code = 'HOS_DEPT_DICT'
          <if  test="is_read != null  and is_read != ''">
                and b.is_read = 1
          </if>
          <if  test="is_write != null and is_write != ''">
                 and b.is_write = 1 
          </if>
           <if  test="read_or_write != null and read_or_write != ''">
                 and (b.is_write = 1 or b.is_read = 1) 
          </if>
          )

        </if>
        
     		<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="is_last != null and is_last != ''">
				and a.is_last = #{is_last}
			</if>
			<if test="dept_id != null and dept_id != ''">
				and a.dept_id = #{dept_id}
			</if>
			and a.is_stop = 0
			<if test="key != null and key != ''">
				and (
					a.dept_code like '${key}%' or
					a.dept_name like '%${key}%' 
				or
					a.spell_code like '%${key}%' or
					a.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.dept_code	
	</select>
	
	<!-- 供应商字典含停用的不显示-->
	<select id="queryHosSupDictDisable" resultMap="hrpAccSelect">
		SELECT
			sup_id||','||sup_no id,
			sup_code||' '||sup_name text
		FROM HOS_SUP_DICT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="sup_id != null  and sup_id != ''">
				and sup_id = #{sup_id}
			</if>
			and is_stop = 0
			and is_disable = 0
			and is_mat = 1
			<if test="key != null and key != ''">
				and (
				sup_code like '${key}%' or 
				sup_name like '%${key}%'
				or
				spell_code like '%${key}%' 
				<!-- or wbx_code like '%${key}%' -->
				)
			</if>
		</where>
		order by sup_code
	</select>
	
	<select id="queryAccNaturs" resultMap="hrpAccSelect">
		select naturs_code id,
		naturs_code || ' ' || naturs_name text
		from ass_naturs a
		where
		exists (
		select 1 from v_user_data_perm b
		where
		b.group_id=#{group_id}
		and b.hos_id=#{hos_id}
		and a.naturs_code=b.perm_code
		and user_id=#{user_id}
		AND TABLE_CODE = upper('ass_naturs')
		and (b.is_read = 1
		or b.is_write = 1 )
		)

		order by
		naturs_code
	</select>
	
	<!-- 采购入库供应商下拉框单独的 -->
	<select id="queryHosSupDictNo" resultMap="hrpAccSelect">
		SELECT
		sup_id||'@'||sup_no id,
		sup_code||' '||sup_name text
		FROM
		HOS_SUP_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				sup_code like '%${key}%' or
				sup_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by sup_code
	
	</select>
	
	<select id="queryContractMain" resultMap="hrpAccSelect">
		select
		acm.contract_id id,
		nvl(acm.CONTRACT_ORI_NO,acm.CONTRACT_NO) text
		from ass_contract_main acm
		<where>
			<if test="group_id != null  and group_id != ''">
				and acm.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and acm.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and acm.copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				acm.CONTRACT_NO like '%${key}%' or
				acm.CONTRACT_NAME
				like '%${key}%'
				)
			</if>
		</where>
		order by acm.CONTRACT_NO
	</select>
	
	<select id="queryHosSupDict" resultMap="hrpAccSelect">
		SELECT
		sup_id||'@'||sup_no id,
		sup_code||' '||sup_name text
		FROM
		HOS_SUP_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				sup_code like '%${key}%' or
				sup_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.sup_id)=b.perm_code
			and user_id=#{user_id}
			AND TABLE_CODE =
			upper('HOS_SUP_DICT')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by sup_code
	</select>
	
	<!-- 查找仓库 -->
	<select id="queryHosStoreDict" resultMap="hrpAccSelect">
		SELECT
		store_id||'@'||store_no id,
		store_code||' '||store_name text
		FROM
		HOS_STORE_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				store_code like '%${key}%' or
				store_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%' or
				store_id like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (
			select 1 from v_user_data_perm b
			where
			a.group_id=b.group_id
			and a.hos_id=b.hos_id
			and to_char(a.store_id)=b.perm_code
			AND TABLE_CODE = upper('hos_store_dict')
			and user_id=#{user_id}
			and (b.is_read = 1
			or b.is_write = 1 )
			)

			<!-- 添加性质权限 -->
			<if test="naturs_code != null and naturs_code != ''">
				and exists (select 1 from ass_naturs_store_map t
				where t.group_id = #{group_id}
				and t.hos_id = #{hos_id}
				and t.copy_code = #{copy_code}
				and t.naturs_code = #{naturs_code}
				and a.store_id = t.store_id
				)
			</if>
		</where>
		order by store_code
	</select>
	
	<select id="queryHosDictTypeDict" resultMap="hrpAccSelect">
		SELECT
		dict_code id,
		dict_name text
		FROM HOS_DICT_TYPE
		<where>
			and group_id = #{group_id}
			and hos_id = #{hos_id}
			and copy_code = #{copy_code}
			and table_code = #{table_code}
			<if test="is_stop != null  and is_stop != ''">
				and is_stop = #{is_stop}
			</if>
		</where>
		order by dict_code
	</select>
	
	<select id="queryInitAccDict" resultMap="hrpAccSelect">
		SELECT
		DICT_CODE id,
		DICT_NAME text
		FROM INIT_ACC_DICT
		where TABLE_CODE = #{table_code}
		order by DICT_CODE
	</select>
</mapper>

