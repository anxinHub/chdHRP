<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.acc.dao.commonbuilder.AccSubjMapper">
  
	<resultMap id="accSubj"  type="com.chd.hrp.acc.entity.AccSubj">
        <result property="subj_id" column="subj_id"/>
        <result property="group_id" column="group_id"/>
        <result property="hos_id" column="hos_id"/>
        <result property="copy_code" column="copy_code"/>
        <result property="acc_year" column="acc_year"/>
        <result property="subj_code" column="subj_code"/>
        <result property="cur_code" column="cur_code"/>
        <result property="subj_type_code" column="subj_type_code"/>
        <result property="kind_code" column="kind_code"/>
        <result property="subj_nature_code" column="subj_nature_code"/>
        <result property="subj_nature_name" column="subj_nature_name"/>
        <result property="vouch_type_code" column="vouch_type_code"/>
        <result property="super_code" column="super_code"/>
        <result property="subj_name" column="subj_name"/>
        <result property="subj_name_all" column="subj_name_all"/>
        <result property="subj_name_en" column="subj_name_en"/>
        <result property="is_cash" column="is_cash"/>
        <result property="is_bill" column="is_bill"/>
        <result property="is_jrsz" column="is_jrsz"/>
        <result property="is_wlhx" column="is_wlhx"/>
        <result property="subj_dire" column="subj_dire"/>
        <result property="subj_level" column="subj_level"/>
        <result property="is_last" column="is_last"/>
        <result property="spell_code" column="spell_code"/>
        <result property="wbx_code" column="wbx_code"/>
        <result property="is_stop" column="is_stop"/>
        <result property="is_remit" column="is_remit"/>
        <result property="is_check" column="is_check"/>
        <result property="check1" column="check1"/>
        <result property="check2" column="check2"/>
        <result property="check3" column="check3"/>
        <result property="check4" column="check4"/>
        <result property="check5" column="check5"/>
        <result property="check6" column="check6"/>
        <result property="check7" column="check7"/>
        <result property="check8" column="check8"/>
        <result property="check9" column="check9"/>
        <result property="check10" column="check10"/>
		<result property="debit" column="debit"/>	
		<result property="bal_os" column="bal_os"/>
		<result property="end_os" column="end_os"/>
		<result property="check1_str" column="check1_str"/>
        <result property="check2_str" column="check2_str"/>
        <result property="check3_str" column="check3_str"/>
        <result property="check4_str" column="check4_str"/>
        <result property="check5_str" column="check5_str"/>
        <result property="check6_str" column="check6_str"/>
        <result property="check7_str" column="check7_str"/>
        
        <!-- 以下用于返回科目挂的辅助核算信息 add by alfred-->
        <result property="check_type_name" column="check_type_name"/>
        <result property="column_id" column="column_id"/>
        <result property="column_no" column="column_no"/>
        <result property="column_code" column="column_code"/>
        <result property="column_name" column="column_name"/>
        <result property="column_check" column="column_check"/>
        <!-- 以下用于返回科目挂的辅助核算类型信息 -->
        <result property="check_type_code1" column="check_type_code1"/>
        <result property="check_type_code2" column="check_type_code2"/>
        <result property="check_type_code3" column="check_type_code3"/>
        <result property="check_type_code4" column="check_type_code4"/>
        <!-- 会计科目所挂部门支出性质 -->
        <result property="out_code" column="out_code"/>
        <result property="out_name" column="out_name"/>
        <result property="judge_subj_code" column="judge_subj_code"/>
        
        <result property="error_type" column="error_type"/>
        <result property="check1_name" column="check1_name"/>
        <result property="check2_name" column="check2_name"/>
        <result property="check3_name" column="check3_name"/>
        <result property="check4_name" column="check4_name"/>
	</resultMap>
	
	<resultMap id="accSubj1"  type="java.util.Map">
        <result property="subj_id" column="subj_id"/>
        <result property="group_id" column="group_id"/>
        <result property="hos_id" column="hos_id"/>
        <result property="copy_code" column="copy_code"/>
        <result property="acc_year" column="acc_year"/>
        <result property="subj_code" column="subj_code"/>
        <result property="cur_code" column="cur_code"/>
        <result property="subj_type_code" column="subj_type_code"/>
        <result property="kind_code" column="kind_code"/>
        <result property="subj_nature_code" column="subj_nature_code"/>
        <result property="subj_nature_name" column="subj_nature_name"/>
        <result property="vouch_type_code" column="vouch_type_code"/>
        <result property="super_code" column="super_code"/>
        <result property="subj_name" column="subj_name"/>
        <result property="subj_name_all" column="subj_name_all"/>
        <result property="subj_name_en" column="subj_name_en"/>
        <result property="is_cash" column="is_cash"/>
        <result property="is_bill" column="is_bill"/>
        <result property="is_wlhx" column="is_wlhx"/>
       <!--  <result property="is_pact" column="is_pact"/> -->
        <result property="subj_dire" column="subj_dire"/>
        <result property="subj_level" column="subj_level"/>
        <result property="is_last" column="is_last"/>
        <result property="spell_code" column="spell_code"/>
        <result property="wbx_code" column="wbx_code"/>
        <result property="is_stop" column="is_stop"/>
        <result property="is_remit" column="is_remit"/>
        <result property="is_check" column="is_check"/>
        <result property="check1" column="check1"/>
        <result property="check2" column="check2"/>
        <result property="check3" column="check3"/>
        <result property="check4" column="check4"/>
        <result property="check5" column="check5"/>
        <result property="check6" column="check6"/>
        <result property="check7" column="check7"/>
        <result property="check8" column="check8"/>
        <result property="check9" column="check9"/>
        <result property="check10" column="check10"/>
		<result property="debit" column="debit"/>	
		<result property="bal_os" column="bal_os"/>
		<result property="end_os" column="end_os"/>
		<result property="check1_str" column="check1_str"/>
        <result property="check2_str" column="check2_str"/>
        <result property="check3_str" column="check3_str"/>
        <result property="check4_str" column="check4_str"/>
        <result property="check5_str" column="check5_str"/>
        <result property="check6_str" column="check6_str"/>
        <result property="check7_str" column="check7_str"/>
        
        <!-- 以下用于返回科目挂的辅助核算信息 add by alfred-->
        <result property="check_type_name" column="check_type_name"/>
        <result property="column_id" column="column_id"/>
        <result property="column_no" column="column_no"/>
        <result property="column_code" column="column_code"/>
        <result property="column_name" column="column_name"/>
        <result property="column_check" column="column_check"/>
        <!-- 以下用于返回科目挂的辅助核算类型信息 -->
        <result property="check_type_code1" column="check_type_code1"/>
        <result property="check_type_code2" column="check_type_code2"/>
        <result property="check_type_code3" column="check_type_code3"/>
        <result property="check_type_code4" column="check_type_code4"/>
        <!-- 会计科目所挂部门支出性质 -->
        <result property="out_code" column="out_code"/>
        <result property="out_name" column="out_name"/>
        
        <result property="error_type" column="error_type"/>
	</resultMap>
	 
    <insert id="addAccSubj" useGeneratedKeys="true" >
    
        INSERT INTO ACC_SUBJ (
                    subj_id
			 ,
                    group_id
			 ,
                    hos_id
			 ,
                    copy_code
			 ,
                    acc_year
			 ,
                    subj_code
			 ,
                    cur_code
			 ,
                    subj_type_code, kind_code
			 ,
                    subj_nature_code
			 ,
                    vouch_type_code
			 ,
                    super_code
			 ,
                    subj_name
			 ,
                    subj_name_all
			 ,
                    subj_name_en
			 ,
                    is_cash
             ,       
             		is_bill
             ,      
             		is_jrsz
             ,    
                	is_wlhx
             ,     
                    is_remit
			 ,
                    subj_dire
			 ,
                    subj_level
			 ,
                    is_last
			 ,
                    spell_code
			 ,
                    wbx_code
			 ,
                    is_stop
			 ,
                    is_check
			 ,
                    check1
			 ,
                    check2
			 ,
                    check3
			 ,
                    check4
			 ,
                    check5
			 ,
                    check6
			 ,
                    check7
			 ,
                    check8
			 ,
                    check9
			 ,
                    check10
             ,
             		check_type_code1
             ,		
                    check_type_code2
             ,
                    check_type_code3
             ,
                    check_type_code4
             ,
             		out_code
			 
        ) VALUES (
		ACC_SUBJ_SEQ.nextval			 ,
		#{group_id}			 ,
		#{hos_id}			 ,
		#{copy_code}			 ,
		#{acc_year}			 ,
		#{subj_code}			 ,
		#{cur_code}			 ,
		#{subj_type_code}			 ,
		#{kind_code}			 ,
		#{subj_nature_code ,jdbcType=VARCHAR}			 ,
		#{vouch_type_code ,jdbcType=VARCHAR}			 ,
		#{super_code}			 ,
		#{subj_name}			 ,
		#{subj_name_all}			 ,
		#{subj_name_en ,jdbcType=NVARCHAR}			 ,
		#{is_cash}			 ,
		#{is_bill}			 ,
		#{is_jrsz}			 ,
		#{is_wlhx}			 ,
		#{is_remit ,jdbcType=INTEGER}          ,
		#{subj_dire}			 ,
		#{subj_level}			 ,
		#{is_last}			 ,
		#{spell_code}			 ,
		#{wbx_code}			 ,
		#{is_stop}			 ,
		#{is_check}			 ,
		#{check1 ,jdbcType=INTEGER}			 ,
		#{check2 ,jdbcType=INTEGER}			 ,
		#{check3 ,jdbcType=INTEGER}			 ,
		#{check4 ,jdbcType=INTEGER}			 ,
		#{check5 ,jdbcType=INTEGER}			 ,
		#{check6 ,jdbcType=INTEGER}			 ,
		#{check7 ,jdbcType=INTEGER}			 ,
		#{check8 ,jdbcType=INTEGER}			 ,
		#{check9 ,jdbcType=INTEGER}			 ,
		#{check10 ,jdbcType=INTEGER}		 ,
		#{check_type_code1 ,jdbcType=VARCHAR}		 ,
		#{check_type_code2 ,jdbcType=VARCHAR}		 ,
		#{check_type_code3 ,jdbcType=VARCHAR}		 ,
		#{check_type_code4 ,jdbcType=VARCHAR}		 , 
		#{out_code ,jdbcType=VARCHAR}
        )
    
    </insert>
    
    <insert id="addBatchAccSubj" parameterType="java.util.List">
    <foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">
        INSERT INTO ACC_SUBJ (
                    
                    subj_id
			<if test="item.group_id != null and item.group_id != ''">	
			 ,
                    group_id
                    </if>
			<if test="item.hos_id != null and item.hos_id != ''">	
			 ,
                    hos_id
                    </if>
			<if test="item.copy_code != null and item.copy_code != ''">	
			 ,
                    copy_code
                    </if>
			<if test="item.acc_year != null and item.acc_year != ''">	
			 ,
                    acc_year
                    </if>
			<if test="item.subj_code != null and item.subj_code != ''">	
			 ,
                    subj_code
                    </if>
			<if test="item.cur_code != null and item.cur_code != ''">	
			 ,
                    cur_code
                    </if>
			<if test="item.subj_type_code != null and item.subj_type_code != ''">	
			 ,
                    subj_type_code
                    </if>
			<if test="item.kind_code != null and item.kind_code != ''">	
			 ,
                    kind_code
                    </if>
			<if test="item.subj_nature_code != null and item.subj_nature_code != ''">	
			 ,
                    subj_nature_code
                    </if>
			<if test="item.vouch_type_code != null and item.vouch_type_code != ''">	
			 ,
                    vouch_type_code
                    </if>
			<if test="item.super_code != null and item.super_code != ''">	
			 ,
                    super_code
                    </if>
			<if test="item.subj_name != null and item.subj_name != ''">	
			 ,
                    subj_name
                    </if>
			<if test="item.subj_name_all != null and item.subj_name_all != ''">	
			 ,
                    subj_name_all
                    </if>
			<if test="item.subj_name_en != null and item.subj_name_en != ''">	
			 ,
                    subj_name_en
                    </if>
			<if test="item.is_cash != null and (item.is_cash==0 or item.is_cash!='')">	
			 ,
                    is_cash
                    </if>
			<if test="item.is_bill != null and item.is_bill != ''">	
             ,       
                    is_bill
                    </if>
            <if test="item.is_jrsz != null and item.is_jrsz != ''">	
             ,       
                    is_jrsz
                    </if>
                    <if test="item.is_wlhx != null and item.is_wlhx != ''">	
             ,       
                    is_wlhx
                    </if>
			<if test="item.is_remit !=null and (item.is_remit==0 or item.is_remit!='') ">	
             ,
                    is_remit
                    </if>
			<if test="item.subj_dire != null and (item.subj_dire==0 or item.subj_dire!='')">	
			 ,
                    subj_dire
                    </if>
			<if test="item.subj_level != null and item.subj_level != ''">	
			 ,
                    subj_level
                    </if>
			<if test="item.is_last != null and (item.is_last==0 or item.is_last!='')">	
			 ,
                    is_last
                    </if>
			<if test="item.spell_code != null and item.spell_code != ''">	
			 ,
                    spell_code
                    </if>
			<if test="item.wbx_code != null and item.wbx_code != ''">	
			 ,
                    wbx_code
                    </if>
			<if test="item.is_stop != null and (item.is_stop==0 or item.is_stop!='')">	
			 ,
                    is_stop
                    </if>
			<if test="item.out_code != null and item.out_code != ''">	
             ,		
             		out_code
             		</if>
			<if test="item.is_check != null and (item.is_check==0 or item.is_check!='')">	
			 ,
                    is_check
                    </if>
            <if test="item.check1 != null and item.check1 != ''">		
			 ,
                    check1
                    </if>
            <if test="item.check2 != null and item.check2 != ''">		
			 ,
                    check2
                    </if>
            <if test="item.check3 != null and item.check3 != ''">		
			 ,
                    check3
                    </if>
            <if test="item.check4 != null and item.check4 != ''">		
			 ,
                    check4
                    </if>
             <!-- ,
             		check_type_code1
             ,		
                    check_type_code2
             ,
                    check_type_code3
             ,
                    check_type_code4 -->
			 
        ) values(
         ACC_SUBJ_SEQ.nextval
			<if test="item.group_id != null and item.group_id != ''">	
         	,
			#{item.group_id}	
			</if>
			<if test="item.hos_id != null and item.hos_id != ''">			 
			,
			#{item.hos_id}	
			</if>
			<if test="item.copy_code != null and item.copy_code != ''">		
			 ,
			#{item.copy_code}	
			</if>
			<if test="item.acc_year != null and item.acc_year != ''">		 
			,
			#{item.acc_year}	
			</if>
			<if test="item.subj_code != null and item.subj_code != ''">		 
			,
			#{item.subj_code}
			</if>
			<if test="item.cur_code != null and item.cur_code != ''">			 
			,
			#{item.cur_code}	
			</if>
			<if test="item.subj_type_code != null and item.subj_type_code != ''">		 
			,
			#{item.subj_type_code}	
			</if>
			<if test="item.kind_code != null and item.kind_code != ''">		 
			,
			#{item.kind_code}	
			</if>
			<if test="item.subj_nature_code != null and item.subj_nature_code != ''">		 
			,
			#{item.subj_nature_code ,jdbcType=VARCHAR}	
			</if>
			<if test="item.vouch_type_code != null and item.vouch_type_code != ''">		 
			,
			#{item.vouch_type_code ,jdbcType=VARCHAR}	
			</if>
			<if test="item.super_code != null and item.super_code != ''">		 
			,
			#{item.super_code}	
			</if>
			<if test="item.subj_name != null and item.subj_name != ''">		 
			,
			#{item.subj_name}	
			</if>
			<if test="item.subj_name_all != null and item.subj_name_all != ''">		 
			,
			#{item.subj_name_all}	
			</if>
			<if test="item.subj_name_en != null and item.subj_name_en != ''">		 
			,
			#{item.subj_name_en ,jdbcType=NVARCHAR}	
			</if>
			<if test="item.is_cash != null and (item.is_cash==0 or item.is_cash!='')">		 
			,
			#{item.is_cash}	
			</if>
			<if test="item.is_bill != null and item.is_bill != ''">		 
			,
			#{item.is_bill}
			</if>
			<if test="item.is_jrsz != null and item.is_jrsz != ''">		 
			,
			#{item.is_jrsz}
			</if>
			<if test="item.is_wlhx != null and item.is_wlhx != ''">		 
			,
			#{item.is_wlhx}
			</if>
			<if test="item.is_remit !=null and (item.is_remit==0 or item.is_remit!='') ">		 
			,
			#{item.is_remit ,jdbcType=INTEGER}   
			</if>
			<if test="item.subj_dire != null and (item.subj_dire==0 or item.subj_dire!='')">       
			,
			#{item.subj_dire}	
			</if>
			<if test="item.subj_level != null and item.subj_level != ''">		 
			,
			#{item.subj_level}	
			</if>
			<if test="item.is_last != null and (item.is_last==0 or item.is_last!='')">		 
			,
			#{item.is_last}	
			</if>
			<if test="item.spell_code != null and item.spell_code != ''">		 
			,
			#{item.spell_code}	
			</if>
			<if test="item.wbx_code != null and item.wbx_code != ''">		 
			,
			#{item.wbx_code}	
			</if>
			<if test="item.is_stop != null and (item.is_stop==0 or item.is_stop!='')">		
			 ,
			#{item.is_stop}	
			</if>
			<if test="item.out_code != null and item.out_code != ''">		 
			,
			#{item.out_code}	
			</if>
			<if test="item.is_check != null and (item.is_check==0 or item.is_check!='')">		
			 ,
			#{item.is_check}
			</if>
			<if test="item.check1 != null and item.check1 != ''">			 
			,
			#{item.check1 ,jdbcType=INTEGER}	
			</if>
			<if test="item.check2 != null and item.check2 != ''">		 
			,
			#{item.check2 ,jdbcType=INTEGER}		
			</if>
			<if test="item.check3 != null and item.check3 != ''">		 
			,
			#{item.check3 ,jdbcType=INTEGER}
			</if>
			<if test="item.check4 != null and item.check4 != ''">				 
			,#{item.check4 ,jdbcType=INTEGER}			 
			</if>
			<!-- ,
			#{check_type_code1 ,jdbcType=VARCHAR}		 ,
			#{check_type_code2 ,jdbcType=VARCHAR}		 ,
			#{check_type_code3 ,jdbcType=VARCHAR}		 ,
			#{check_type_code4 ,jdbcType=VARCHAR} -->
			)	 
    </foreach>
   
    </insert>

	<update id="updateAccSubj" parameterType="java.util.Map">
    
        UPDATE acc_subj SET
        	  subj_code=#{subj_code},
			 cur_code = #{cur_code}
			 ,
			 subj_type_code = #{subj_type_code}
			 ,
			 kind_code = #{kind_code}
			 ,
			 subj_nature_code = #{subj_nature_code}
			 ,
			 vouch_type_code = #{vouch_type_code}
			 ,
			 super_code = #{super_code_new}
			 ,
			 subj_name = #{subj_name}
			 ,
			 subj_name_all = #{subj_name_all}
			 ,
			 subj_name_en = #{subj_name_en}
			 ,
			 is_cash = #{is_cash}
			 ,
			 is_bill = #{is_bill}
			 ,
			 is_jrsz = #{is_jrsz}
			 ,
			 is_wlhx = #{is_wlhx}
			 ,
			 is_remit = #{is_remit}
			 ,
			 subj_dire = #{subj_dire}
			 ,
			 subj_level = #{subj_level}
			 ,
			 spell_code = #{spell_code}
			 ,
			 wbx_code = #{wbx_code}
			 ,
			 is_stop = #{is_stop}
			 ,
			 is_check = #{is_check}
			 ,
			 check1 = #{check1}
			 ,
			 check2 = #{check2}
			 ,
			 check3 = #{check3}
			 ,
			 check4 = #{check4}
			 ,
			 check5 = #{check5}
			 ,
			 check6 = #{check6}
			 ,
			 check7 = #{check7}
			 ,
			 check8 = #{check8}
			 ,
			 check9 = #{check9}
			 ,
			 check10 = #{check10}
			 ,
			 check_type_code1 = #{check_type_code1}
			 ,
			 check_type_code2 = #{check_type_code2}
			 ,
			 check_type_code3 = #{check_type_code3}
			 ,
			 check_type_code4 = #{check_type_code4}
			 ,
			 out_code = #{out_code}
			 
        WHERE 
		 subj_id = #{subj_id}  and  group_id = #{group_id} and 
		 hos_id = #{hos_id} and  copy_code = #{copy_code} and  acc_year = #{acc_year}
			

	</update>
	<update id="updateBatchAccSubj" parameterType="java.util.List">
     
	<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
        UPDATE acc_subj SET
			 
			 is_last = 0
			 
        WHERE 
		
		 group_id = #{item.group_id}
			  and 
		 hos_id = #{item.hos_id}
			  and 
		 copy_code = #{item.copy_code}
			  and 
		 acc_year = #{item.acc_year}
			  and 
		 subj_code = #{item.super_code}
			 
    </foreach>
	</update>

	<delete id="deleteAccSubj" parameterType="java.util.Map">

		DELETE FROM acc_subj WHERE
		subj_id = #{subj_id} and
		group_id = #{group_id} and
		hos_id = #{hos_id} and
		copy_code = #{copy_code} and
		acc_year = #{acc_year} and
		subj_code = #{subj_code}

	</delete>
	<delete id="deleteBatchAccSubj" parameterType="java.util.List">
		DELETE FROM acc_subj WHERE
		<foreach collection="list" index="index" item="item" open="("
			separator="or" close=")">
			<!-- subj_id = #{item.subj_id}
			and -->
			group_id = #{item.group_id}
			and
			hos_id = #{item.hos_id}
			and
			copy_code = #{item.copy_code}
			and
			acc_year = #{item.acc_year}
			and 
			subj_code like '${item.subj_code}%'
		</foreach>
   
    </delete>
    
	<select id="queryAccSubjByCode" resultType="com.chd.hrp.acc.entity.AccSubj"
		parameterType="java.util.Map">
		SELECT
		asubj.subj_id,
		asubj.group_id,
		asubj.hos_id,
		asubj.copy_code,
		asubj.acc_year,
		asubj.subj_code,
		asubj.cur_code,
		ac.cur_name,
		asubj.subj_type_code,
		asubj.kind_code,
		ast.subj_type_name,
		asubj.subj_nature_code,
		asn.subj_nature_name,
		asubj.vouch_type_code,
		(select vouch_type_name from acc_vouch_type avt where asubj.GROUP_ID = avt.GROUP_ID AND asubj.HOS_ID = avt.HOS_ID AND asubj.COPY_CODE = avt.COPY_CODE AND asubj.vouch_type_code = avt.vouch_type_code) vouch_type_name, 
		asubj.super_code,
		asubj.subj_name,
		asubj.subj_name_all,
		asubj.subj_name_en,
		asubj.is_cash,
		asubj.is_bill,
		asubj.is_jrsz,
		asubj.is_wlhx,
		asubj.subj_dire,
		asubj.subj_level,
		asubj.is_last,
		asubj.is_remit,
		asubj.spell_code,
		asubj.wbx_code,
		asubj.is_stop,
		asubj.is_check,
		asubj.check1,
		act1.check_type_name check1_name,
		act1.column_check column1_check,
		asubj.check2,
		act2.check_type_name check2_name,
		act2.column_check column2_check,
		asubj.check3,
		act3.check_type_name check3_name,
		act3.column_check column3_check,
		asubj.check4,
		act4.check_type_name check4_name,
		act4.column_check column4_check,
		asubj.check_type_code1,asubj.check_type_code2,
		asubj.check_type_code3,asubj.check_type_code4,
		ado.out_code,ado.out_name
		FROM ACC_SUBJ asubj
		left join ACC_SUBJ_NATURE asn on 
				asubj.GROUP_ID = asn.GROUP_ID and
				asubj.HOS_ID = asn.HOS_ID and
				asubj.COPY_CODE = asn.COPY_CODE and
				asubj.SUBJ_NATURE_CODE = asn.SUBJ_NATURE_CODE 
		left join ACC_SUBJ_TYPE ast on 
				asubj.GROUP_ID = ast.GROUP_ID and
				asubj.HOS_ID = ast.HOS_ID and
				asubj.COPY_CODE = ast.COPY_CODE and
				asubj.subj_type_code = ast.subj_type_code
		left join ACC_CUR ac on 
				asubj.GROUP_ID = ac.GROUP_ID and
				asubj.HOS_ID = ac.HOS_ID and
				asubj.COPY_CODE = ac.COPY_CODE and
				asubj.acc_year = ac.acc_year and
				asubj.cur_code = ac.cur_code
		left join ACC_CHECK_TYPE act1 on asubj.GROUP_ID = act1.GROUP_ID AND asubj.HOS_ID = act1.HOS_ID AND asubj.COPY_CODE = act1.COPY_CODE AND asubj.check1 = act1.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act2 on asubj.GROUP_ID = act2.GROUP_ID AND asubj.HOS_ID = act2.HOS_ID AND asubj.COPY_CODE = act2.COPY_CODE AND asubj.check2 = act2.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act3 on asubj.GROUP_ID = act3.GROUP_ID AND asubj.HOS_ID = act3.HOS_ID AND asubj.COPY_CODE = act3.COPY_CODE AND asubj.check3 = act3.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act4 on asubj.GROUP_ID = act4.GROUP_ID AND asubj.HOS_ID = act4.HOS_ID AND asubj.COPY_CODE = act4.COPY_CODE AND asubj.check4 = act4.CHECK_TYPE_ID
		left join acc_dept_out ado on ado.out_code = asubj.out_code
		WHERE
				asubj.group_id = #{group_id} and
				asubj.hos_id = #{hos_id} and
				asubj.copy_code = #{copy_code} and
				asubj.acc_year = #{acc_year} and
				<!-- asubj.subj_id = #{subj_id} -->
				asubj.subj_code=#{subj_code}

	</select>
	
	
	
	
	
	<select id="queryAccSubj_id" parameterType="java.util.Map" resultMap="accSubj">
	
		SELECT * FROM ACC_SUBJ asubj,ACC_SUBJ_NATURE asn 
			<where>
				asubj.GROUP_ID = asn.GROUP_ID and
            	asubj.HOS_ID = asn.HOS_ID and
            	asubj.COPY_CODE = asn.COPY_CODE and
            	asubj.SUBJ_NATURE_CODE = asn.SUBJ_NATURE_CODE
            	<if test="group_id != null and group_id != ''">
                    AND asubj.group_id = #{group_id}
               </if>
			    <if test="hos_id != null and hos_id != ''">
                    AND asubj.hos_id = #{hos_id}
               </if>
			    <if test="copy_code != null and copy_code != ''">
                    AND asubj.copy_code = #{copy_code}
               </if>
			    <if test="acc_year != null and acc_year != ''">
                    AND asubj.acc_year = #{acc_year}
               </if>
			    <if test="subj_code != null and subj_code != ''">
                    AND asubj.subj_code = #{subj_code}
               </if>
			</where>
	</select>
	<select id="queryAccSubj" parameterType="java.util.Map" resultMap="accSubj" >
      
        SELECT 
            asubj.subj_id,
            asubj.group_id,
            asubj.hos_id,
            asubj.copy_code,
            asubj.acc_year,
            asubj.subj_code,
            asubj.cur_code,
            asubj.subj_type_code,
            asubj.kind_code,
            asubj.subj_nature_code,
            asn.subj_nature_name,
            asubj.vouch_type_code,
            asubj.super_code,
            asubj.subj_name,
            asubj.subj_name_all,
            asubj.subj_name_en,
            asubj.is_cash,
            asubj.is_bill,
            asubj.is_jrsz,
            asubj.is_remit,
            asubj.subj_dire,
            asubj.subj_level,
            asubj.is_last,
            asubj.spell_code,
            asubj.wbx_code,
            asubj.is_stop,
            asubj.is_check,
            act1.check_type_name check1_name,
            act2.check_type_name check2_name,
            act3.check_type_name check3_name,
            act4.check_type_name check4_name        
        FROM ACC_SUBJ asubj 
        left join ACC_SUBJ_NATURE asn  ON
	        		asubj.GROUP_ID = asn.GROUP_ID and
	            	asubj.HOS_ID = asn.HOS_ID and
	            	asubj.COPY_CODE = asn.COPY_CODE and
	            	asubj.SUBJ_NATURE_CODE = asn.SUBJ_NATURE_CODE
	    left join ACC_CHECK_TYPE act1 on asubj.GROUP_ID = act1.GROUP_ID AND asubj.HOS_ID = act1.HOS_ID AND asubj.COPY_CODE = act1.COPY_CODE AND asubj.check1 = act1.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act2 on asubj.GROUP_ID = act2.GROUP_ID AND asubj.HOS_ID = act2.HOS_ID AND asubj.COPY_CODE = act2.COPY_CODE AND asubj.check2 = act2.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act3 on asubj.GROUP_ID = act3.GROUP_ID AND asubj.HOS_ID = act3.HOS_ID AND asubj.COPY_CODE = act3.COPY_CODE AND asubj.check3 = act3.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act4 on asubj.GROUP_ID = act4.GROUP_ID AND asubj.HOS_ID = act4.HOS_ID AND asubj.COPY_CODE = act4.COPY_CODE AND asubj.check4 = act4.CHECK_TYPE_ID        	
            <where>                     
			    <if test="subj_id != null and subj_id != ''">
                    AND asubj.subj_id = #{subj_id}
               </if>
			    <if test="group_id != null and group_id != ''">
                    AND asubj.group_id = #{group_id}
               </if>
			    <if test="hos_id != null and hos_id != ''">
                    AND asubj.hos_id = #{hos_id}
               </if>
			    <if test="copy_code != null and copy_code != ''">
                    AND asubj.copy_code = #{copy_code}
               </if>
			    <if test="acc_year != null and acc_year != ''">
                    AND asubj.acc_year = #{acc_year}
               </if>
			    <if test="subj_code != null and subj_code != ''">
                    AND asubj.subj_code like #{subj_code}||'%'
               </if>
			    <if test="cur_code != null and cur_code != ''">
                    AND asubj.cur_code = #{cur_code}
               </if>
			    <if test="subj_type_code != null and subj_type_code != ''">
                    AND asubj.subj_type_code = #{subj_type_code}
               </if>
			    <if test="subj_nature_code != null and subj_nature_code != ''">
                    AND asubj.subj_nature_code = #{subj_nature_code}
               </if>
			    <!-- <if test="vouch_type_code != null and vouch_type_code != ''">
                    AND asubj.vouch_type_code = #{vouch_type_code}
               </if> -->
			    <if test="super_code != null and super_code != ''">
                    AND asubj.super_code = #{super_code}
               </if>
			    <if test="subj_name != null and subj_name != ''">
                    and ( asubj.subj_name like '%${subj_name}%' or
                    asubj.subj_name_all like '%${subj_name}%' or
                    upper(asubj.spell_code) like '%${subj_name}%' or
                    lower(asubj.spell_code) like '%${subj_name}%' or
                    upper(asubj.wbx_code) like '%${subj_name}%' or
                    lower(asubj.wbx_code) like '%${subj_name}%' 
                    ) 
               </if>
			    <if test="subj_name_all != null and subj_name_all != ''"> 
                    AND asubj.subj_name_all = #{subj_name_all}
               </if>
			    <if test="subj_name_en != null and subj_name_en != ''">
                    AND asubj.subj_name_en = #{subj_name_en}
               </if>
			    <if test="is_cash != null and is_cash != ''">
                    AND asubj.is_cash = #{is_cash}
               </if>
			    <if test="subj_dire != null and subj_dire != ''">
                    AND asubj.subj_dire = #{subj_dire}
               </if>
			    <if test="subj_level != null and subj_level != ''">
                    AND asubj.subj_level = #{subj_level}
               </if>
			    <if test="is_last != null and is_last != ''">
                    AND asubj.is_last = #{is_last}
               </if>
			    <if test="spell_code != null and spell_code != ''">
                    AND asubj.spell_code = #{spell_code}
               </if>
			    <if test="wbx_code != null and wbx_code != ''">
                    AND asubj.wbx_code = #{wbx_code}
               </if>
			    <if test="is_stop != null and is_stop != ''">
                    AND asubj.is_stop = #{is_stop}
               </if>
			    <if test="is_check != null and is_check != ''">
                    AND asubj.is_check = #{is_check}
               </if>
			    <if test="check1 != null and check1 != ''">
                    AND asubj.check1 = #{check1}
               </if>
			    <if test="check2 != null and check2 != ''">
                    AND asubj.check2 = #{check2}
               </if>
			    <if test="check3 != null and check3 != ''">
                    AND asubj.check3 = #{check3}
               </if>
			    <if test="check4 != null and check4 != ''">
                    AND asubj.check4 = #{check4}
               </if>
			    <if test="check5 != null and check5 != ''">
                    AND asubj.check5 = #{check5}
               </if>
			    <if test="check6 != null and check6 != ''">
                    AND asubj.check6 = #{check6}
               </if>
			    <if test="check7 != null and check7 != ''">
                    AND asubj.check7 = #{check7}
               </if>
			    <if test="check8 != null and check8 != ''">
                    AND asubj.check8 = #{check8}
               </if>
			    <if test="check9 != null and check9 != ''">
                    AND asubj.check9 = #{check9}
               </if>
			    <if test="check10 != null and check10 != ''">
                    AND asubj.check10 = #{check10}
               </if>
        </where>   
				order by asubj.subj_code asc
    </select>
<!--     打印用 -->
<select id="queryAccSubjPrint" parameterType="java.util.Map" resultMap="accSubj1" >
      
        SELECT 
            asubj.subj_id,
            asubj.group_id,
            asubj.hos_id,
            asubj.copy_code,
            asubj.acc_year,
            asubj.subj_code,
            asubj.cur_code,
            asubj.subj_type_code,
            asubj.subj_nature_code,
            asn.subj_nature_name,
            asubj.vouch_type_code,
            asubj.super_code,
            asubj.subj_name,
            asubj.subj_name_all,
            asubj.subj_name_en,
            asubj.is_cash,
            asubj.is_bill,
            <!-- asubj.is_pact, -->
            asubj.is_remit,
            asubj.subj_dire,
            asubj.subj_level,
            asubj.is_last,
            asubj.spell_code,
            asubj.wbx_code,
            asubj.is_stop,
            asubj.is_check,
            act1.check_type_name check1_name,
            act2.check_type_name check2_name,
            act3.check_type_name check3_name,
            act4.check_type_name check4_name        
        FROM ACC_SUBJ asubj 
        left join ACC_SUBJ_NATURE asn  ON
	        		asubj.GROUP_ID = asn.GROUP_ID and
	            	asubj.HOS_ID = asn.HOS_ID and
	            	asubj.COPY_CODE = asn.COPY_CODE and
	            	asubj.SUBJ_NATURE_CODE = asn.SUBJ_NATURE_CODE
	    left join ACC_CHECK_TYPE act1 on asubj.GROUP_ID = act1.GROUP_ID AND asubj.HOS_ID = act1.HOS_ID AND asubj.COPY_CODE = act1.COPY_CODE AND asubj.check1 = act1.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act2 on asubj.GROUP_ID = act2.GROUP_ID AND asubj.HOS_ID = act2.HOS_ID AND asubj.COPY_CODE = act2.COPY_CODE AND asubj.check2 = act2.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act3 on asubj.GROUP_ID = act3.GROUP_ID AND asubj.HOS_ID = act3.HOS_ID AND asubj.COPY_CODE = act3.COPY_CODE AND asubj.check3 = act3.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act4 on asubj.GROUP_ID = act4.GROUP_ID AND asubj.HOS_ID = act4.HOS_ID AND asubj.COPY_CODE = act4.COPY_CODE AND asubj.check4 = act4.CHECK_TYPE_ID        	
            <where>                     
			    <if test="subj_id != null and subj_id != ''">
                    AND asubj.subj_id = #{subj_id}
               </if>
			    <if test="group_id != null and group_id != ''">
                    AND asubj.group_id = #{group_id}
               </if>
			    <if test="hos_id != null and hos_id != ''">
                    AND asubj.hos_id = #{hos_id}
               </if>
			    <if test="copy_code != null and copy_code != ''">
                    AND asubj.copy_code = #{copy_code}
               </if>
			    <if test="acc_year != null and acc_year != ''">
                    AND asubj.acc_year = #{acc_year}
               </if>
			    <if test="subj_code != null and subj_code != ''">
                    AND asubj.subj_code like #{subj_code}||'%'
               </if>
			    <if test="cur_code != null and cur_code != ''">
                    AND asubj.cur_code = #{cur_code}
               </if>
			    <if test="subj_type_code != null and subj_type_code != ''">
                    AND asubj.subj_type_code = #{subj_type_code}
               </if>
			    <if test="subj_nature_code != null and subj_nature_code != ''">
                    AND asubj.subj_nature_code = #{subj_nature_code}
               </if>
			    <!-- <if test="vouch_type_code != null and vouch_type_code != ''">
                    AND asubj.vouch_type_code = #{vouch_type_code}
               </if> -->
			    <if test="super_code != null and super_code != ''">
                    AND asubj.super_code = #{super_code}
               </if>
			    <if test="subj_name != null and subj_name != ''">
                    and ( asubj.subj_name like '%${subj_name}%' or
                    asubj.subj_name_all like '%${subj_name}%' or
                    asubj.spell_code like '%${subj_name}%' or
                    asubj.wbx_code like '%${subj_name}%'
                    ) 
               </if>
			    <if test="subj_name_all != null and subj_name_all != ''">
                    AND asubj.subj_name_all = #{subj_name_all}
               </if>
			    <if test="subj_name_en != null and subj_name_en != ''">
                    AND asubj.subj_name_en = #{subj_name_en}
               </if>
			    <if test="is_cash != null and is_cash != ''">
                    AND asubj.is_cash = #{is_cash}
               </if>
			    <if test="subj_dire != null and subj_dire != ''">
                    AND asubj.subj_dire = #{subj_dire}
               </if>
			    <if test="subj_level != null and subj_level != ''">
                    AND asubj.subj_level = #{subj_level}
               </if>
			    <if test="is_last != null and is_last != ''">
                    AND asubj.is_last = #{is_last}
               </if>
			    <if test="spell_code != null and spell_code != ''">
                    AND asubj.spell_code = #{spell_code}
               </if>
			    <if test="wbx_code != null and wbx_code != ''">
                    AND asubj.wbx_code = #{wbx_code}
               </if>
			    <if test="is_stop != null and is_stop != ''">
                    AND asubj.is_stop = #{is_stop}
               </if>
			    <if test="is_check != null and is_check != ''">
                    AND asubj.is_check = #{is_check}
               </if>
			    <if test="check1 != null and check1 != ''">
                    AND asubj.check1 = #{check1}
               </if>
			    <if test="check2 != null and check2 != ''">
                    AND asubj.check2 = #{check2}
               </if>
			    <if test="check3 != null and check3 != ''">
                    AND asubj.check3 = #{check3}
               </if>
			    <if test="check4 != null and check4 != ''">
                    AND asubj.check4 = #{check4}
               </if>
			    <if test="check5 != null and check5 != ''">
                    AND asubj.check5 = #{check5}
               </if>
			    <if test="check6 != null and check6 != ''">
                    AND asubj.check6 = #{check6}
               </if>
			    <if test="check7 != null and check7 != ''">
                    AND asubj.check7 = #{check7}
               </if>
			    <if test="check8 != null and check8 != ''">
                    AND asubj.check8 = #{check8}
               </if>
			    <if test="check9 != null and check9 != ''">
                    AND asubj.check9 = #{check9}
               </if>
			    <if test="check10 != null and check10 != ''">
                    AND asubj.check10 = #{check10}
               </if>
        </where>   
				order by asubj.subj_code asc
    </select>
    
    
	
	<select id="queryAccSubjList"  resultType="com.chd.hrp.acc.entity.AccSubj">

		SELECT
		asubj.subj_id,
		asubj.group_id,
		asubj.hos_id,
		asubj.copy_code,
		asubj.acc_year,
		asubj.subj_code,
		asubj.cur_code,
		asubj.subj_type_code,
		asubj.kind_code,
		asubj.subj_nature_code,
		asubj.vouch_type_code,
		asubj.super_code,
		asubj.subj_name,
		asubj.subj_name_all,
		asubj.subj_name_en,
		asubj.is_cash,
		asubj.is_bill,
		asubj.is_jrsz,
		asubj.is_remit,
		asubj.subj_dire,
		asubj.subj_level,
		asubj.is_last,
		asubj.spell_code,
		asubj.wbx_code,
		asubj.is_stop,
		asubj.is_check,
		asubj.check1,
		asubj.check2,
		asubj.check3,
		asubj.check4,
		asubj.check5,
		asubj.check6,
		asubj.check7,
		asubj.check8,
		asubj.check9,
		asubj.check10
		FROM ACC_SUBJ asubj
		<where>
		 not exists(
		select acs.subj_id, acs.subj_code  from ACC_SUBJ acs 
		<where>
		<if test="group_id != null and group_id != ''">
				AND acs.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND acs.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND acs.copy_code = #{copy_code}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acs.acc_year = #{acc_year}
			</if>
			<if test="subj_code != null and subj_code != ''">
				AND acs.subj_code = #{subj_code}
			</if>
		</where>
		)
			<if test="nature_code != null  and nature_code != ''">
			and asubj.subj_nature_code = #{nature_code}
			</if>
			<if test="hos_code != null and hos_code != ''">
			AND asubj.hos_id = #{hos_code}
			</if>
			<if test="copy_id != null and copy_id != ''">
				AND asubj.copy_code = #{copy_id}
			</if>
			<if test="acct_year_month != null  and acct_year_month != ''">
			and asubj.acc_year = #{acct_year_month}
			</if>
		</where>
		order by asubj.subj_id asc
	</select>

   <!-- 检查科目是否挂了辅助核算 -->
    <select id="queryAccSubjCheck" parameterType="java.util.Map" resultMap="accSubj" >
      
        SELECT subj_id,subj_code,subj_name,check1,check2,check3,check4
        FROM ACC_SUBJ 
        where  group_id = #{group_id} AND hos_id = #{hos_id}  AND copy_code = #{copy_code}
        and (check1=#{check_type_id} or check2=#{check_type_id} or check3=#{check_type_id} or check4=#{check_type_id})
        
    </select>
    
<!--     <select id="queryAccSubjByMenu" parameterType="java.util.Map" resultMap="accSubj"> -->
<!-- 	SELECT -->
<!-- 	  subj_id, -->
<!-- 		group_id, -->
<!-- 		hos_id, -->
<!-- 		copy_code, -->
<!-- 		acc_year, -->
<!-- 		subj_code, -->
<!-- 		cur_code, -->
<!-- 		subj_type_code, -->
<!-- 		subj_nature_code, -->
<!-- 		vouch_type_code, -->
<!-- 		super_code, -->
<!-- 		subj_name, -->
<!-- 		subj_name_all, -->
<!-- 		subj_name_en, -->
<!-- 		is_cash, -->
<!-- 		is_bill, -->
<!-- 		is_remit, -->
<!-- 		subj_dire, -->
<!-- 		subj_level, -->
<!-- 		is_last, -->
<!-- 		spell_code, -->
<!-- 		wbx_code, -->
<!-- 		is_stop, -->
<!-- 		is_check -->
<!-- 	FROM ACC_SUBJ  -->
<!-- 	<where> -->
<!-- 		<if test="group_id != null and group_id != ''"> -->
<!-- 			and group_id = #{group_id} -->
<!-- 		</if> -->
<!-- 		<if test="hos_id != null and hos_id != ''"> -->
<!-- 			and hos_id = #{hos_id} -->
<!-- 		</if> -->
<!-- 		<if test="copy_code != null and copy_code != ''"> -->
<!-- 			and copy_code = #{copy_code} -->
<!-- 		</if> -->
<!-- 		<if test="acc_year != null and acc_year != ''"> -->
<!-- 			and acc_year = #{acc_year}  -->
<!-- 		</if> -->
<!-- 		<if test="is_stop != null and is_stop != ''"> -->
<!-- 			and is_stop = #{is_stop}  -->
<!-- 		</if> -->
<!-- 		<if test="is_last != null and is_last != ''"> -->
<!-- 			and is_last = #{is_last}  -->
<!-- 		</if> -->
<!-- 		<if test="subj_type_code != null and subj_type_code != ''"> -->
<!--             AND subj_type_code = #{subj_type_code} -->
<!--         </if> -->
<!--         <if test="subj_code != null and subj_code != ''"> -->
<!--             AND subj_code = #{subj_code} -->
<!--         </if> -->
<!--         <if test="subj_id != null and subj_id != ''"> -->
<!--             AND subj_id = #{subj_id} -->
<!--         </if> -->
<!--          <if test="super_code != null and super_code != ''"> --> 
<!--              AND super_code = #{super_code} --> 
<!--         </if> --> 
<!--         <if test="queryTree != null and queryTree != ''"> -->
<!--             and (${select_code} like '%${queryTree}%' -->
<!--              or upper(spell_code) like '%${queryTree}%' -->
<!--              or lower(spell_code) like '%${queryTree}%' -->
<!--             ) -->
<!--         </if> -->
<!--          <if test="sign ==1"> -->
<!--         AND check1=3  -->
<!--       	</if> -->
<!--       	 <if test="sign ==2 "> -->
<!--         AND check1=4 -->
<!--       	</if> -->
<!--       	 <if test="sign ==3"> -->
<!--         AND check1=5  -->
<!--       	</if> -->
<!--       	     <if test="sign ==4"> -->
<!--         AND check1=6  -->
<!--       	</if> -->
<!--       	     <if test="sign ==5"> -->
<!--         AND check1=7 -->
<!--       	</if> -->
<!--       	     <if test="sign ==6"> -->
<!--         AND check1=8  -->
<!--       	</if> -->
<!--       	<if test="sign ==10"> -->
<!--         AND check1=10  -->
<!--       	</if> -->
<!--       	<if test="sign ==11"> -->
<!--         AND check1=11  -->
<!--          and check1=12 -->
<!--          and check1=13 -->
<!--       	</if> -->
<!-- 	</where> -->
<!-- 	order by subj_code -->
<!-- </select> -->
     <select id="queryAccSubjByMenu" parameterType="java.util.Map" resultMap="accSubj">
	
	with subj_tmp as ( select asubj.subj_id, asubj.group_id, asubj.hos_id, asubj.copy_code, asubj.acc_year
      , asubj.subj_code, asubj.cur_code, asubj.subj_type_code, asubj.subj_nature_code
      , asubj.vouch_type_code, asubj.super_code, asubj.subj_name, asubj.subj_name_all, asubj.subj_name_en
      , asubj.is_cash, asubj.is_bill,<!-- asubj.is_pact, --> asubj.is_remit, asubj.subj_dire, asubj.subj_level
      , asubj.is_last, asubj.spell_code, asubj.wbx_code, asubj.is_stop, asubj.is_check
      , act1.check_type_name as check1_name
    from ACC_SUBJ asubj
    left join ACC_CHECK_TYPE act1 on asubj.GROUP_ID = act1.GROUP_ID
    and asubj.HOS_ID = act1.HOS_ID
    and asubj.COPY_CODE = act1.COPY_CODE
   <!--  and asubj.check1 = act1.CHECK_TYPE_ID  -->
     and (asubj.check1 = act1.CHECK_TYPE_ID or asubj.check2 = act1.CHECK_TYPE_ID or asubj.check3 = act1.CHECK_TYPE_ID or asubj.check4 = act1.CHECK_TYPE_ID  )
		
	<where>
		<if test="group_id != null and group_id != ''">
			and asubj.group_id = #{group_id}
		</if>
		<if test="hos_id != null and hos_id != ''">
			and asubj.hos_id = #{hos_id}
		</if>
		<if test="copy_code != null and copy_code != ''">
			and asubj.copy_code = #{copy_code}
		</if>
		<if test="acc_year != null and acc_year != ''">
			and asubj.acc_year = #{acc_year} 
		</if>
		<if test="is_stop != null and is_stop != ''">
			and asubj.is_stop = #{is_stop} 
		</if>
		<if test="is_last != null and is_last != ''">
			and asubj.is_last = #{is_last} 
		</if>
		<if test="subj_type_code != null and subj_type_code != ''">
            AND asubj.subj_type_code = #{subj_type_code}
        </if>
        <if test="subj_code != null and subj_code != ''">
            AND asubj.subj_code = #{subj_code} 
        </if>
        <if test="subj_id != null and subj_id != ''">
            AND asubj.subj_id = #{subj_id}
        </if>
<!--         <if test="super_code != null and super_code != ''"> -->
<!--             AND super_code = #{super_code} -->
<!--         </if> -->
        <if test="queryTree != null and queryTree != ''">
            and (asubj.${select_code} like '%${queryTree}%'
             or upper(asubj.spell_code) like '%${queryTree}%'
             or lower(asubj.spell_code) like '%${queryTree}%'
            )
        </if>
         <if test="subj_level != null and subj_level != ''">
           <choose>
           		<when test="subj_level != 99 ">
           		 	and asubj.subj_level &lt;= #{subj_level}  and asubj.is_last = 1  
           		</when>
           		<otherwise>
           			and asubj.is_last = 1
           		</otherwise>
           </choose>
        </if>
        <if test="sign ==1">
        AND act1.check_type_name='部门'
      	</if>
      	<if test="sign ==2 ">
        AND act1.check_type_name='职工'
      	</if>
      	 <if test="sign ==3">
        AND act1.check_type_name='项目'
      	</if>
      	     <if test="sign ==4">
        AND act1.check_type_name='库房' 
      	</if>
      	     <if test="sign ==5">
        AND act1.check_type_name='客户'
      	</if>
      	     <if test="sign ==6">
        AND act1.check_type_name='供应商'
      	</if>
      	<if test="sign ==10">
        AND act1.check_type_name='单位' 
      	</if>
      	<if test="sign ==11">
        AND act1.is_sys=0
      	</if>
	</where>
	order by subj_code
	)
select st.*,c.subj_code as judge_subj_code from subj_tmp st
left join subj_tmp c 
on st.super_code = c.subj_code
order by st.subj_code
</select>

<select id="queryAccSubjByCashOrCheck" parameterType="java.util.Map" resultMap="accSubj">

		SELECT subj_dire as subj_dire,is_cash as is_cash,is_bill as is_bill,is_check as is_check,subj_code as subj_code,subj_id as subj_id,subj_nature_code as subj_nature_code FROM ACC_SUBJ
		<where>
			<if test="subj_code != null and subj_code != ''">
				and (subj_code = #{subj_code} )
			</if>
			<if test="subj_id != null and subj_id!= ''">
				and (subj_id = #{subj_id} )
			</if>
			<if test="group_id != null and group_id != ''">
				and (group_id = #{group_id} )
			</if>
			<if test="hos_id != null and hos_id != ''">
				and (hos_id = #{hos_id} )
			</if>
			<if test="copy_code != null and copy_code != ''">
				and (copy_code = #{copy_code} )
			</if>
			<if test="acc_year != null and acc_year != ''">
				and (acc_year = #{acc_year} )
			</if>
			<if test="is_stop != null and is_stop != ''">
				and (is_stop = #{is_stop} )
			</if>
			<if test="is_last != null and is_last != ''">
				and (is_last = #{is_last} )
			</if>
			<if test="sql != null and sql != ''">
				and (${sql} )
			</if>
		</where>
	</select>
<select id="queryAccSubjWithCheckType" parameterType="java.util.Map" resultMap="accSubj">

		with 
check_1 as
(
select 
a_subj.check1 as check1,act.check_type_name as check_type_name,act.column_id as column_id,
act.column_no as column_no,act.column_code as column_code,act.column_name as column_name,
act.column_check as column_check 
from ACC_SUBJ  a_subj left join acc_check_type  act 
on a_subj.group_id = act.group_id and a_subj.hos_id = act.hos_id and a_subj.copy_code = act.copy_code and a_subj.check1 = act.check_type_id
<where>
			<if test="subj_code != null and subj_code != ''">and (a_subj.subj_code = #{subj_code} )</if>
			<if test="subj_id != null and subj_id!= ''">and (a_subj.subj_id = #{subj_id} )</if>
			<if test="group_id != null and group_id != ''">and (a_subj.group_id = #{group_id} )</if>
			<if test="hos_id != null and hos_id != ''">and (a_subj.hos_id = #{hos_id} )</if>
			<if test="copy_code != null and copy_code != ''">and (a_subj.copy_code = #{copy_code} )</if>
			<if test="acc_year != null and acc_year != ''">and (a_subj.acc_year = #{acc_year} )</if>
			<if test="is_stop != null and is_stop != ''">and (a_subj.is_stop = #{is_stop} )</if>
			<if test="is_last != null and is_last != ''">and (a_subj.is_last = #{is_last} )</if>
			<if test="sql != null and sql != ''">and (${sql} )</if>
</where>
),
check_2 as
(
select 
a_subj.check2 as check2,act.check_type_name as check_type_name,act.column_id as column_id,
act.column_no as column_no,act.column_code as column_code,act.column_name as column_name,
act.column_check as column_check 
from ACC_SUBJ  a_subj left join acc_check_type  act 
on a_subj.group_id = act.group_id and a_subj.hos_id = act.hos_id and a_subj.copy_code = act.copy_code and a_subj.check2 = act.check_type_id
<where>
			<if test="subj_code != null and subj_code != ''">and (a_subj.subj_code = #{subj_code} )</if>
			<if test="subj_id != null and subj_id!= ''">and (a_subj.subj_id = #{subj_id} )</if>
			<if test="group_id != null and group_id != ''">and (a_subj.group_id = #{group_id} )</if>
			<if test="hos_id != null and hos_id != ''">and (a_subj.hos_id = #{hos_id} )</if>
			<if test="copy_code != null and copy_code != ''">and (a_subj.copy_code = #{copy_code} )</if>
			<if test="acc_year != null and acc_year != ''">and (a_subj.acc_year = #{acc_year} )</if>
			<if test="is_stop != null and is_stop != ''">and (a_subj.is_stop = #{is_stop} )</if>
			<if test="is_last != null and is_last != ''">and (a_subj.is_last = #{is_last} )</if>
			<if test="sql != null and sql != ''">and (${sql} )</if>
</where>
),
check_3 as
(
select 
a_subj.check3 as check3,act.check_type_name as check_type_name,act.column_id as column_id,
act.column_no as column_no,act.column_code as column_code,act.column_name as column_name,
act.column_check as column_check 
from ACC_SUBJ  a_subj left join acc_check_type  act 
on a_subj.group_id = act.group_id and a_subj.hos_id = act.hos_id and a_subj.copy_code = act.copy_code and a_subj.check3 = act.check_type_id
<where>
			<if test="subj_code != null and subj_code != ''">and (a_subj.subj_code = #{subj_code} )</if>
			<if test="subj_id != null and subj_id!= ''">and (a_subj.subj_id = #{subj_id} )</if>
			<if test="group_id != null and group_id != ''">and (a_subj.group_id = #{group_id} )</if>
			<if test="hos_id != null and hos_id != ''">and (a_subj.hos_id = #{hos_id} )</if>
			<if test="copy_code != null and copy_code != ''">and (a_subj.copy_code = #{copy_code} )</if>
			<if test="acc_year != null and acc_year != ''">and (a_subj.acc_year = #{acc_year} )</if>
			<if test="is_stop != null and is_stop != ''">and (a_subj.is_stop = #{is_stop} )</if>
			<if test="is_last != null and is_last != ''">and (a_subj.is_last = #{is_last} )</if>
			<if test="sql != null and sql != ''">and (${sql} )</if>
</where>
),
check_4 as
(
select 
a_subj.check4 as check4,act.check_type_name as check_type_name,act.column_id as column_id,
act.column_no as column_no,act.column_code as column_code,act.column_name as column_name,
act.column_check as column_check 
from ACC_SUBJ  a_subj left join acc_check_type  act 
on a_subj.group_id = act.group_id and a_subj.hos_id = act.hos_id and a_subj.copy_code = act.copy_code and a_subj.check4 = act.check_type_id
<where>
			<if test="subj_code != null and subj_code != ''">and (a_subj.subj_code = #{subj_code} )</if>
			<if test="subj_id != null and subj_id!= ''">and (a_subj.subj_id = #{subj_id} )</if>
			<if test="group_id != null and group_id != ''">and (a_subj.group_id = #{group_id} )</if>
			<if test="hos_id != null and hos_id != ''">and (a_subj.hos_id = #{hos_id} )</if>
			<if test="copy_code != null and copy_code != ''">and (a_subj.copy_code = #{copy_code} )</if>
			<if test="acc_year != null and acc_year != ''">and (a_subj.acc_year = #{acc_year} )</if>
			<if test="is_stop != null and is_stop != ''">and (a_subj.is_stop = #{is_stop} )</if>
			<if test="is_last != null and is_last != ''">and (a_subj.is_last = #{is_last} )</if>
			<if test="sql != null and sql != ''">and (${sql} )</if>
</where>
)

select check1,check_type_name,column_id,column_no,column_code,column_name,column_check  from check_1 where check1 is not null
union all
select check2,check_type_name,column_id,column_no,column_code,column_name,column_check  from check_2 where check2 is not null
union all
select check3,check_type_name,column_id,column_no,column_code,column_name,column_check  from check_3 where check3 is not null
union all
select check4,check_type_name,column_id,column_no,column_code,column_name,column_check  from check_4 where check4 is not null
	</select>
	
	<!--根据父级编码查询科目全称 -->
	<select id="querySubjBySuperCode" resultType="java.lang.String" parameterType="java.util.Map">
		SELECT subj_name_all FROM ACC_SUBJ 
		where group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code} 
		and acc_year = #{acc_year} and subj_code=#{super_code}
	</select>
	
	
	<!-- 检查辅助核算是否使用 -->
	<select id="existsVouchLederBySubjCheck" resultType="java.lang.Integer" parameterType="java.util.Map">
		select sum(cnt) from
		(
			select nvl(count(v.${check_filed}),0) cnt from acc_vouch_check v
			where v.group_id = #{group_id} and v.hos_id=#{hos_id} and v.copy_code=#{copy_code}
			and v.subj_code=#{subj_code}  and v.acc_year=#{acc_year} and v.${check_filed} is not null 
			union all
			select nvl(count(l.${check_filed}),0) cnt from acc_leder_check l
			where l.group_id = #{group_id} and l.hos_id=#{hos_id} and l.copy_code=#{copy_code} 
			and l.subj_code=#{subj_code}   and l.acc_year=#{acc_year} and l.${check_filed} is not null 
		) 
	</select>
	
	<!--删除操作，判断是否为末级 -->
	<select id="existsSubjByIsLast" resultType="String" parameterType="java.util.Map">
		SELECT subj_code FROM ACC_SUBJ 
		where group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code}  and is_last=0 
		and subj_id in (${subjIdIsLast})
	</select>
	
	
	<!-- 删除操作，根据父科目查询是否有子科目，没有就修改为末级
		  修改编码操作，根据父科目查询是否有子科目，老的父科目没有就修改为末级
	 -->
	<update id="updateSubjIsLastBySuperSubjCode" parameterType="java.util.Map" >
		  
	     update acc_subj set is_last=1 where 
	     subj_id in(
		     select subj_id from acc_subj where subj_code not in(    
			     select super_code from acc_subj 
			     where super_code in(${super_code}) 
			     and group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code} and acc_year = #{acc_year}
			     group by super_code
			 ) 
		     and subj_code in(${super_code})
		     and group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code} and acc_year = #{acc_year}
	     )
   </update>
   
   
	<!-- 添加操作，更新父级是否末级
		修改编码操作，新的父科目没有就修改为非末级 -->
	<update id="updateSubjIsLastBySubjCode" parameterType="java.util.Map">
	
		update acc_subj set is_last=#{is_last}
		where group_id = #{group_id} and hos_id = #{hos_id} and copy_code = #{copy_code} 
		and acc_year = #{acc_year} and subj_code =#{super_code}
	</update>
	
	<!-- 按行业性质导会计科目 -->
	<insert id="addBatchAccSubjByNatureCode" parameterType="java.util.Map">
		INSERT INTO acc_subj (subj_id,group_id,hos_id,copy_code,acc_year, SUBJ_CODE, CUR_CODE, SUBJ_TYPE_CODE, SUBJ_NATURE_CODE,
		VOUCH_TYPE_CODE, super_code, SUBJ_NAME, SUBJ_NAME_ALL, SUBJ_NAME_EN, IS_CASH,IS_BILL, SUBJ_DIRE, SUBJ_LEVEL, IS_LAST, SPELL_CODE, 
		WBX_CODE,is_stop,is_check,is_remit,kind_code)
		select ACC_SUBJ_SEQ.nextval, #{group_id}, #{hos_id}, #{copy_code}, #{acc_year},SUBJ_CODE, CUR_CODE, SUBJ_TYPE_CODE, SUBJ_NATURE_CODE, 
		VOUCH_TYPE_CODE, super_code, SUBJ_NAME, SUBJ_NAME_ALL, SUBJ_NAME_EN, IS_CASH,IS_BILL, SUBJ_DIRE, SUBJ_LEVEL, IS_LAST, SPELL_CODE, 
		WBX_CODE,0,0,0,kind_code
 		from hos_subj 
 		where nature_code=#{nature_code}
	</insert>
	
	<!-- 按医院历史年度、按集团导会计科目 -->
	<insert id="addBatchAccSubjByAccYear" parameterType="java.util.Map" >
    	INSERT INTO acc_subj (subj_id,group_id,hos_id,copy_code,acc_year, SUBJ_CODE, CUR_CODE, SUBJ_TYPE_CODE, SUBJ_NATURE_CODE, KIND_CODE,
    	VOUCH_TYPE_CODE, super_code, SUBJ_NAME, SUBJ_NAME_ALL, SUBJ_NAME_EN, IS_CASH,IS_BILL, SUBJ_DIRE, SUBJ_LEVEL, IS_LAST, SPELL_CODE, 
    	WBX_CODE,is_stop,is_check,is_remit,check1,check2,check3,check4,check5,check6,check7,check8,check9,check10,out_code,check_type_code1,check_type_code2,check_type_code3,check_type_code4)
		select ACC_SUBJ_SEQ.nextval, #{group_id}, #{hos_id}, #{copy_code}, #{acc_year},SUBJ_CODE, CUR_CODE, SUBJ_TYPE_CODE, SUBJ_NATURE_CODE, KIND_CODE,
		VOUCH_TYPE_CODE, super_code, SUBJ_NAME, SUBJ_NAME_ALL, SUBJ_NAME_EN, IS_CASH,IS_BILL, SUBJ_DIRE, SUBJ_LEVEL, IS_LAST, SPELL_CODE, 
		WBX_CODE,is_stop,is_check,is_remit,check1,check2,check3,check4,check5,check6,check7,check8,check9,check10,out_code,check_type_code1,check_type_code2,check_type_code3,check_type_code4
 		from acc_subj 
 		where group_id=#{group_id} and hos_id=#{select_hos_id} and copy_code=#{select_copy_code} and acc_year=#{select_acc_year}
       
	</insert> 
	
	<select id="queryAccSubjCode" resultType="com.chd.hrp.acc.entity.AccSubj"
		parameterType="java.util.Map">
		SELECT
		asubj.subj_code,
		asubj.subj_id,asubj.is_last
		FROM ACC_SUBJ asubj
		WHERE
		asubj.group_id = #{group_id} and
		asubj.hos_id = #{hos_id} and
		asubj.copy_code = #{copy_code} and
		asubj.acc_year = #{acc_year} and
		<if test="is_last!= null and is_last !='' ">
		asubj.is_last=#{is_last}  and
		</if>
		asubj.subj_code = #{subj_code}

	</select>
	
	<select id="queryDistinctAccSubjList" parameterType="java.util.Map" resultMap="accSubj">
    	select  asubj.subj_code,asubj.subj_name,asubj.subj_name_en,ac.cur_name,ast.subj_type_name,asn.subj_nature_name,
		avt.vouch_type_name,asubj.subj_dire,asubj.is_remit,asubj.is_cash,act1.check_type_name check1_name,
		act2.check_type_name check2_name,act3.check_type_name check3_name,act4.check_type_name check4_name,
		'导入科目编码重复' error_type from acc_subj asubj
		left join ACC_SUBJ_NATURE asn on asubj.GROUP_ID = asn.GROUP_ID and asubj.HOS_ID = asn.HOS_ID and
		asubj.COPY_CODE = asn.COPY_CODE and asubj.SUBJ_NATURE_CODE = asn.SUBJ_NATURE_CODE 
		left join ACC_SUBJ_TYPE ast on asubj.GROUP_ID = ast.GROUP_ID and asubj.HOS_ID = ast.HOS_ID 
		and asubj.COPY_CODE = ast.COPY_CODE and asubj.subj_type_code = ast.subj_type_code
		left join ACC_CUR ac on asubj.GROUP_ID = ac.GROUP_ID and asubj.HOS_ID = ac.HOS_ID and
		asubj.COPY_CODE = ac.COPY_CODE and asubj.acc_year = ac.acc_year and asubj.cur_code = ac.cur_code
		left join acc_vouch_type avt on asubj.GROUP_ID = avt.GROUP_ID AND asubj.HOS_ID = avt.HOS_ID 
		AND asubj.COPY_CODE = avt.COPY_CODE AND asubj.vouch_type_code = avt.vouch_type_code
		left join ACC_CHECK_TYPE act1 on asubj.GROUP_ID = act1.GROUP_ID AND asubj.HOS_ID = act1.HOS_ID AND asubj.COPY_CODE = act1.COPY_CODE AND asubj.check1 = act1.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act2 on asubj.GROUP_ID = act2.GROUP_ID AND asubj.HOS_ID = act2.HOS_ID AND asubj.COPY_CODE = act2.COPY_CODE AND asubj.check2 = act2.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act3 on asubj.GROUP_ID = act3.GROUP_ID AND asubj.HOS_ID = act3.HOS_ID AND asubj.COPY_CODE = act3.COPY_CODE AND asubj.check3 = act3.CHECK_TYPE_ID
		left join ACC_CHECK_TYPE act4 on asubj.GROUP_ID = act4.GROUP_ID AND asubj.HOS_ID = act4.HOS_ID AND asubj.COPY_CODE = act4.COPY_CODE AND asubj.check4 = act4.CHECK_TYPE_ID
		left join acc_dept_out ado on ado.out_code = asubj.out_code    
		where asubj.subj_code in (select subj_code from acc_subj
		where group_id = #{group_id} and hos_id = #{hos_id}
		and copy_code =#{copy_code} and acc_year= #{acc_year}
		group by subj_code having count(1) >= 2)
		group by asubj.subj_code,asubj.subj_name,asubj.subj_name_en,ac.cur_name,ast.subj_type_name,asn.subj_nature_name,
		avt.vouch_type_name,asubj.subj_dire,asubj.is_remit,asubj.is_cash,act1.check_type_name,
		act2.check_type_name,act3.check_type_name,act4.check_type_name	
    	
    </select>
	
	<select id="queryAccSubjNature" parameterType="java.util.Map" resultMap="accSubj">
	     
	     select 
	          subj_nature_code 
	          from acc_subj 
	   <where>
		<if test="group_id != null and group_id != ''">
			and group_id = #{group_id}
		</if>
		<if test="hos_id != null and hos_id != ''">
			and hos_id = #{hos_id}
		</if>
		<if test="copy_code != null and copy_code != ''">
			and copy_code = #{copy_code}
		</if> 
		<if test="acc_year != null and acc_year != ''">
			and acc_year = #{acc_year} 
		</if>
		<if test="subj_id != null and subj_id != ''">
			and subj_id = #{subj_id} 
		</if>
		<if test="subj_nature_code != null and subj_nature_code != ''">
			and subj_nature_code = #{subj_nature_code} 
		</if>
		</where>
	</select>
	
	<select id="prcUpdateSubjInfoALL" statementType="CALLABLE" parameterType="java.util.Map" >
	
	<![CDATA[ {call PKG_COMM.prc_UpdateSubjInfoALL(
			#{group_id,jdbcType=INTEGER, mode=IN},  
	        #{hos_id,jdbcType=INTEGER, mode=IN},  
	        #{copy_code,jdbcType=VARCHAR, mode=IN},  
	        #{acc_year,jdbcType=VARCHAR, mode=IN},
	        #{prm_AppCode,jdbcType=INTEGER,mode=OUT},
	        #{prm_ErrTxt,jdbcType=VARCHAR,mode=OUT}
        )} 
		 ]]>
	
	</select>
	
	<select id="prcUpdateSubjInfoSigle" statementType="CALLABLE" parameterType="java.util.Map" >
	
	<![CDATA[ {call PKG_COMM.prc_UpdateSubjInfoSigle(
			#{group_id,jdbcType=INTEGER, mode=IN},  
	        #{hos_id,jdbcType=INTEGER, mode=IN},  
	        #{copy_code,jdbcType=VARCHAR, mode=IN},  
	        #{acc_year,jdbcType=VARCHAR, mode=IN},
	        #{subj_code,jdbcType=VARCHAR, mode=IN},
	        #{prm_AppCode,jdbcType=INTEGER,mode=OUT},
	        #{prm_ErrTxt,jdbcType=VARCHAR,mode=OUT}
        )} 
		 ]]>
	
	</select>
	
	<select id="prcUpdateSubjInfo" statementType="CALLABLE" parameterType="java.util.Map" >
	
	<![CDATA[ {call PKG_COMM.prc_UpdateSubjInfo(
			#{group_id,jdbcType=INTEGER, mode=IN},  
	        #{hos_id,jdbcType=INTEGER, mode=IN},  
	        #{copy_code,jdbcType=VARCHAR, mode=IN},  
	        #{acc_year,jdbcType=VARCHAR, mode=IN},
	        #{subj_code,jdbcType=VARCHAR, mode=IN},
	        #{prm_AppCode,jdbcType=INTEGER,mode=OUT},
	        #{prm_ErrTxt,jdbcType=VARCHAR,mode=OUT}
        )} 
		 ]]>
	
	</select>
	
	<!-- 账簿中通过subj_code 查询subj_id   用于 通过科目选择器选择多个科目  -->
	<select id="queryAccSubjByCodeSearchId" resultType="java.lang.String" parameterType="java.util.Map">
	
	 select  to_char(wm_concat(a.subj_id)) as subj_id from acc_subj a 
	 	where a.group_id =	#{group_id,jdbcType=INTEGER}
	 		 and a.hos_id  = #{hos_id,jdbcType=INTEGER}
	 		 and a.copy_code= #{copy_code,jdbcType=VARCHAR}
			 and a.subj_code in(${subj_codes})
	</select>
	
	<select id="querySynGroupSubjCode" resultType="Integer"
		parameterType="java.util.Map">
		SELECT count(*)
		FROM ACC_SUBJ
		WHERE group_id = #{group_id,jdbcType=INTEGER}
		and hos_id = #{hos_id,jdbcType=INTEGER}
		and copy_code = #{copy_code,jdbcType=VARCHAR}
		and acc_year = #{acc_year,jdbcType=VARCHAR}
		and subj_code = #{subj_code,jdbcType=VARCHAR}
	</select>
	
	<insert id="addBatchAccSynGroupSubj" parameterType="java.util.Map">
		INSERT INTO acc_subj (subj_id,group_id,hos_id,copy_code,acc_year, SUBJ_CODE, CUR_CODE, SUBJ_TYPE_CODE, kind_code, SUBJ_NATURE_CODE, 
    	VOUCH_TYPE_CODE, super_code, SUBJ_NAME, SUBJ_NAME_ALL, SUBJ_NAME_EN, IS_CASH,IS_BILL, SUBJ_DIRE, SUBJ_LEVEL, IS_LAST, SPELL_CODE, 
    	WBX_CODE,is_stop,is_check,is_remit,check1,check2,check3,check4,check5,check6,check7,check8,check9,check10,out_code,check_type_code1,check_type_code2,check_type_code3,check_type_code4)
		select ACC_SUBJ_SEQ.nextval, #{group_id}, #{hos_id}, #{copy_code}, #{acc_year},SUBJ_CODE, CUR_CODE, SUBJ_TYPE_CODE, kind_code, SUBJ_NATURE_CODE, 
		VOUCH_TYPE_CODE, super_code, SUBJ_NAME, SUBJ_NAME_ALL, SUBJ_NAME_EN, IS_CASH,IS_BILL, SUBJ_DIRE, SUBJ_LEVEL, IS_LAST, SPELL_CODE, 
		WBX_CODE,is_stop,is_check,is_remit,check1,check2,check3,check4,check5,check6,check7,check8,check9,check10,out_code,check_type_code1,check_type_code2,check_type_code3,check_type_code4
 		from acc_subj 
 		where group_id=#{group_id}
 		and hos_id='0' and copy_code='0' and acc_year='0'
	</insert>
	
	 <select id="queryGroupSubjCode" parameterType="java.util.Map" resultType="java.util.HashMap" >
      select * from acc_subj 
   		 where group_id=#{group_id} and hos_id='0' and copy_code='0' and acc_year=#{acc_year} 
   		 	
     </select>
     
     <update id="updateBatchGroupAccSubj" parameterType="java.util.List">
     
	<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
        UPDATE acc_subj 
			<trim prefix="SET"  suffixOverrides=",">  
			 	<if test="item.cur_code != null and item.cur_code != ''">
					cur_code = #{item.cur_code},
				</if>
				<if test="item.subj_type_code != null and item.subj_type_code != ''">
					subj_type_code = #{item.subj_type_code},
				</if>
				<if test="item.kind_code != null and item.kind_code != ''">
					kind_code = #{item.kind_code},
				</if>
				<if test="item.subj_nature_code != null and item.subj_nature_code != ''">
					subj_nature_code = #{item.subj_nature_code},
				</if>
				<if test="item.vouch_type_code != null and item.vouch_type_code != ''">
					vouch_type_code = #{item.vouch_type_code},
				</if>
				<if test="item.super_code != null and item.super_code != ''">
					super_code = #{item.super_code},
				</if>
				<if test="item.subj_name != null and item.subj_name != ''">
					subj_name = #{item.subj_name},
				</if>
				<if test="item.subj_name_all != null and item.subj_name_all != ''">
					subj_name_all = #{item.subj_name_all},
				</if>
				<if test="item.subj_name_en != null and item.subj_name_en != ''">
					subj_name_en = #{item.subj_name_en},
				</if>
				<if test="item.is_cash != null and item.is_cash != ''">
					is_cash = #{item.is_cash},
				</if>
				<if test="item.is_bill != null and item.is_bill != ''">
					is_bill = #{item.is_bill},
				</if>
				<if test="item.subj_dire != null and item.subj_dire != ''">
					subj_dire = #{item.subj_dire},
				</if>
				<if test="item.subj_level != null and item.subj_level != ''">
					subj_level = #{item.subj_level},
				</if>
				<if test="item.is_last != null and item.is_last != ''">
					is_last = #{item.is_last},
				</if>
				<if test="item.spell_code != null and item.spell_code != ''">
					spell_code = #{item.spell_code},
				</if>
				<if test="item.wbx_code != null and item.wbx_code != ''">
					wbx_code = #{item.wbx_code},
				</if>
				<if test="item.is_stop != null and item.is_stop != ''">
					is_stop = #{item.is_stop},
				</if>
				<if test="item.is_check != null and item.is_check != ''">
					is_check = #{item.is_check},
				</if>
				<if test="item.is_remit != null and item.is_remit != ''">
					is_remit = #{item.is_remit},
				</if>
				<if test="item.check1 != null and item.check1 != ''">
					check1 = #{item.check1},
				</if>
				<if test="item.check2 != null and item.check2 != ''">
					check2 = #{item.check2},
				</if>
				<if test="item.check3 != null and item.check3 != ''">
					check3 = #{item.check3},
				</if>
				<if test="item.check4 != null and item.check4 != ''">
					check4 = #{item.check4},
				</if>
				<if test="item.check5 != null and item.check5 != ''">
					check5 = #{item.check5},
				</if>
				<if test="item.check6 != null and item.check6 != ''">
					check6 = #{item.check6},
				</if>
				<if test="item.check7 != null and item.check7 != ''">
					check7 = #{item.check7},
				</if>
				<if test="item.check8 != null and item.check8 != ''">
					check8 = #{item.check8},
				</if>
				<if test="item.check9 != null and item.check9 != ''">
					check9 = #{item.check9},
				</if>
				<if test="item.check10 != null and item.check10 != ''">
					check10 = #{item.check10},
				</if>
				<if test="item.check_type_code1 != null and item.check_type_code1 != ''">
					check_type_code1 = #{item.check_type_code1},
				</if>
				<if test="item.check_type_code2 != null and item.check_type_code2 != ''">
					check_type_code2 = #{item.check_type_code2},
				</if>
				<if test="item.check_type_code3 != null and item.check_type_code3 != ''">
					check_type_code3 = #{item.check_type_code3},
				</if>
				<if test="item.check_type_code4 != null and item.check_type_code4 != ''">
					check_type_code4 = #{item.check_type_code4},
				</if>
			</trim>
        WHERE 
		
		 group_id = #{item.group_id}
			  and 
		 hos_id = #{item.hos_id}
			  and 
		 copy_code = #{item.copy_code}
			  and 
		 acc_year = #{item.acc_year}
			  and 
		 subj_code = #{item.subj_code}
			 
    </foreach>
	</update>
	
	<select id="queryAccSubjByLast" resultType="java.util.Map"
		parameterType="java.util.Map">
	   with current_tmp as (select hs.subj_code
			from ACC_SUBJ hs
			where hs.group_id = #{group_id}
				and hs.hos_id = #{hos_id}
				and hs.copy_code = #{copy_code}
				and hs.acc_year = #{acc_year}
				and hs.is_last = 1
				and hs.subj_code like #{super_code}||'%'
			  ),
			subj_tmp as (
			select  hs.subj_code,hs.subj_id
			from ACC_SUBJ hs 
			where hs.group_id = #{group_id}
				and hs.hos_id = #{hos_id}
				and hs.copy_code = #{copy_code}
				and hs.acc_year = #{acc_year}
				and hs.is_last = 0
				and hs.subj_code = #{super_code}
			  )
			  
			  select a.subj_code,a.subj_id,count(b.subj_code) as b_subj_code from subj_tmp a
			  left join current_tmp b on b.subj_code like a.subj_code ||'%'
			  group by a.subj_code,a.subj_id
			   order by a.subj_code 
 
	 
		  <!-- SELECT count(1)  ,min(hs.subj_id) subj_id
		FROM ACC_SUBJ hs
		WHERE hs.group_id = #{group_id}
		and hs.hos_id = #{hos_id}
		and hs.copy_code = #{copy_code}
		and hs.acc_year = #{acc_year}
		and hs.is_last =1
 		and hs.subj_code like #{super_code}||'%'   -->
 		 
	</select>
	
	<select id="queryAccSubjByCount" resultType="Integer"
		parameterType="java.util.Map">
		SELECT count(*)
		FROM ACC_SUBJ
		WHERE group_id = #{group_id,jdbcType=INTEGER}
		and hos_id = #{hos_id,jdbcType=INTEGER}
		and copy_code = #{copy_code,jdbcType=VARCHAR}
		and acc_year = #{acc_year,jdbcType=VARCHAR}
		and subj_code = #{super_code,jdbcType=VARCHAR}
	</select>
	
	<select id="queryAccSubjBySuperId" resultType="java.util.Map"
		parameterType="java.util.Map">
		    SELECT subj_code
		FROM ACC_SUBJ
		WHERE group_id = #{group_id,jdbcType=INTEGER}
		and hos_id = #{hos_id,jdbcType=INTEGER}
		and copy_code = #{copy_code,jdbcType=VARCHAR}
		and acc_year = #{acc_year,jdbcType=VARCHAR}
		and subj_code = #{super_code,jdbcType=VARCHAR}
	</select>
	
	<update id="updateGroupSubj" parameterType="java.util.List" >
		  <foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
        <if test="item.is_check == 1">
        UPDATE acc_subj 
			<trim prefix="SET"  suffixOverrides=",">  
			<if test="item.check1 != null and item.check1 != ''">
			 check1= (
		      select check_type_id
		      from acc_check_type
		      where check_table=(
		        select check_table
		        from acc_check_type
		        where check_type_id=(
		          select check1 
		          from acc_subj
		          where check1 is not null
		          and group_id=#{item.group_id}
		          and hos_id=0
		          and copy_code='0'
		          and subj_code=#{item.subj_code}
		        )
		      )
	          and group_id=#{item.group_id}
	          and hos_id=#{item.hos_id}
	          and copy_code=#{item.copy_code}
		      
		 ),
		 </if>
		 <if test="item.check2 != null and item.check2 != ''">
			 check2= (
		      select check_type_id
		      from acc_check_type
		      where check_table=(
		        select check_table
		        from acc_check_type
		        where check_type_id=(
		          select check2 
		          from acc_subj
		          where check2 is not null
		          and group_id=#{item.group_id}
		          and hos_id=0
		          and copy_code='0'
		          and subj_code=#{item.subj_code}
		        )
		      )
		      and group_id=#{item.group_id}
	          and hos_id=#{item.hos_id}
	          and copy_code=#{item.copy_code}
		 ),
		 </if>
		 <if test="item.check3 != null and item.check3 != ''">
			 check3= (
		      select check_type_id
		      from acc_check_type
		      where check_table=(
		        select check_table
		        from acc_check_type
		        where check_type_id=(
		          select check3 
		          from acc_subj
		          where check3 is not null
		          and group_id=#{item.group_id}
		          and hos_id=0
		          and copy_code='0'
		          and subj_code=#{item.subj_code}
		        )
		      )
		      and group_id=#{item.group_id}
	          and hos_id=#{item.hos_id}
	          and copy_code=#{item.copy_code}
		 ),
		 </if>
		  <if test="item.check4 != null and item.check4 != ''">
			 check4= (
		      select check_type_id
		      from acc_check_type
		      where check_table=(
		        select check_table
		        from acc_check_type
		        where check_type_id=(
		          select check4 
		          from acc_subj
		          where check4 is not null
		          and group_id=#{item.group_id}
		          and hos_id=0
		          and copy_code='0'
		          and subj_code=#{item.subj_code}
		        )
		      )
		     and group_id=#{item.group_id}
	          and hos_id=#{item.hos_id}
	          and copy_code=#{item.copy_code}
		 ),
		 </if>
		 </trim>
		where 
		group_id=#{item.group_id}
		and hos_id=#{item.hos_id}
		and copy_code=#{item.copy_code}
		and subj_code=#{item.subj_code}
		and is_check=1
		</if>
		</foreach>
	</update>
	
	<!-- 校验当前期间是否存在 -->
	<select id="existsAccYearMonth" parameterType="java.util.Map" resultType="java.lang.Integer">
		SELECT count(0) 
		FROM acc_year_month 
		WHERE group_id = #{group_id,jdbcType=INTEGER} 
			AND hos_id = #{hos_id,jdbcType=INTEGER} 
			AND copy_code = #{copy_code,jdbcType=VARCHAR} 
			AND acc_year = #{acc_year,jdbcType=VARCHAR} 
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}			
			</if>
	</select>
	
	<!-- 查询科目用于导入 -->
	<select id="queryAccSubjListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.subj_code as "subj_code", a.subj_name as "subj_name", a.subj_name_all as "subj_name_all", 
			a.is_last as "is_last", b.cut as "have_vouch", c.cut as "have_init_leder", d.cut as "have_bal_amt"
		FROM acc_subj a 
		LEFT JOIN (
			SELECT subj_code, count(1) cut 
			FROM acc_vouch_detail 
			WHERE group_id = #{group_id,jdbcType=INTEGER}
				AND hos_id = #{hos_id,jdbcType=INTEGER}
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			GROUP BY subj_code
		) b 
			ON a.subj_code = b.subj_code 
		LEFT JOIN (
			SELECT subj_code, count(1) cut 
			FROM acc_leder 
			WHERE group_id = #{group_id,jdbcType=INTEGER}
				AND hos_id = #{hos_id,jdbcType=INTEGER}
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
				AND acc_month = '00'
			GROUP BY subj_code
		) c 
			ON a.subj_code = c.subj_code 
		LEFT JOIN (
			SELECT subj_code, count(1) cut 
			FROM acc_vouch_check 
			WHERE group_id = #{group_id,jdbcType=INTEGER}
				AND hos_id = #{hos_id,jdbcType=INTEGER}
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
				AND is_init = 1 
				AND debit + credit > nvl(bal_amt, 0)
			GROUP BY subj_code
		) d 
			ON a.subj_code = d.subj_code 
		WHERE a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.acc_year = #{acc_year,jdbcType=VARCHAR}
	</select>
	<!-- 查询科目类别用于导入 -->
	<select id="queryAccSubjTypeListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT subj_type_code, subj_type_name, kind_code
		FROM acc_subj_type
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
	</select>
	<!-- 查询科目性质用于导入 -->
	<select id="queryAccSubjNatureListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT subj_nature_code, subj_nature_name
		FROM acc_subj_nature
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
	</select>
	<!-- 查询币种用于导入 -->
	<select id="queryAccCurListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT cur_code, cur_name
		FROM acc_cur
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND acc_year = #{acc_year,jdbcType=VARCHAR}
	</select>
	<!-- 查询凭证类型用于导入 -->
	<select id="queryAccVouchTypeListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT vouch_type_code, vouch_type_name
		FROM acc_vouch_type
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND is_stop = 0
	</select>
	<!-- 查询支出性质用于导入 -->
	<select id="queryAccDeptOutListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT out_code, out_name
		FROM acc_dept_out
	</select>
	<!-- 查询辅助核算用于导入 -->
	<select id="queryAccCheckListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT check_type_name, check_type_id
		FROM acc_check_type
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND is_stop = 0
	</select>
	<!-- 查询核算分类  部门分类用于导入 -->
	<select id="queryHosDeptKindListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT kind_code, kind_name
		FROM hos_dept_kind
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND is_stop = 0
	</select>
	<!-- 查询核算分类  职工分类用于导入 -->
	<select id="queryHosEmpKindListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT kind_code, kind_name
		FROM hos_emp_kind
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND is_stop = 0
	</select>
	<!-- 查询核算分类  项目分类用于导入 -->
	<select id="queryHosProjTypeListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT type_code, type_name
		FROM hos_proj_type
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND is_stop = 0
	</select>
	<!-- 查询核算分类  库房分类用于导入 -->
	<select id="queryHosStoreTypeListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT type_code, type_name
		FROM hos_store_type
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND is_stop = 0
	</select>
	<!-- 查询核算分类  客户分类用于导入 -->
	<select id="queryHosCusTypeListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT type_code, type_name
		FROM hos_cus_type
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND is_stop = 0
	</select>
	<!-- 查询核算分类  供应商分类用于导入 -->
	<select id="queryHosSupTypeListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT type_code, type_name
		FROM hos_sup_type
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND is_stop = 0
	</select>
	<!-- 查询核算分类  资金来源分类用于导入 -->
	<select id="queryHosSourceTypeListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT nature_code, nature_name
		FROM hos_source_nature
	</select>
	<!-- 查询核算分类  自定义辅助核算分类用于导入 -->
	<select id="queryAccCheckItemTypeListForImport" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT a.type_code, a.type_name, b.check_type_name
		FROM acc_check_item_type a 
		LEFT JOIN acc_check_type b 
			ON a.group_id = b.group_id 
			AND a.hos_id = b.hos_id 
			AND a.copy_code = b.copy_code 
			AND a.check_type_id = b.check_type_id 
		WHERE a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.is_stop = 0
	</select>
	<!-- 批量添加会计科目导入专用 -->
	<insert id="insertAccSubjForImport" parameterType="java.util.List">
		INSERT INTO acc_subj(
			subj_id, group_id, hos_id, copy_code, acc_year, subj_code, subj_name, subj_name_all, cur_code, is_remit, 
			subj_type_code, subj_nature_code, vouch_type_code, super_code, subj_name_en, kind_code, is_cash, 
			subj_level, is_last, spell_code, wbx_code, is_stop, subj_dire, is_check, check1, check2, check3, check4, 
			check_type_code1, check_type_code2, check_type_code3, check_type_code4, out_code, is_bill, is_pact 
		)
		SELECT ACC_SUBJ_SEQ.NEXTVAL, tmp.* FROM(
		<foreach collection="list" item="item" index="index" separator="union all">
			SELECT 
				#{item.group_id,jdbcType=INTEGER} group_id, 
				#{item.hos_id,jdbcType=INTEGER} hos_id, 
				#{item.copy_code,jdbcType=VARCHAR} copy_code, 
				#{item.acc_year,jdbcType=VARCHAR} acc_year, 
				#{item.subj_code,jdbcType=VARCHAR} subj_code, 
				#{item.subj_name,jdbcType=VARCHAR} subj_name, 
				#{item.subj_name_all,jdbcType=VARCHAR} subj_name_all, 
				#{item.cur_code,jdbcType=VARCHAR} cur_code, 
				#{item.is_remit,jdbcType=INTEGER} is_remit, 
				#{item.subj_type_code,jdbcType=VARCHAR} subj_type_code, 
				#{item.subj_nature_code,jdbcType=VARCHAR} subj_nature_code, 
				#{item.vouch_type_code,jdbcType=VARCHAR} vouch_type_code, 
				#{item.super_code,jdbcType=VARCHAR} super_code, 
				#{item.subj_name_en,jdbcType=VARCHAR} subj_name_en, 
				#{item.kind_code,jdbcType=VARCHAR} kind_code, 
				#{item.is_cash,jdbcType=INTEGER} is_cash, 
				#{item.subj_level,jdbcType=INTEGER} subj_level, 
				#{item.is_last,jdbcType=INTEGER} is_last, 
				#{item.spell_code,jdbcType=VARCHAR} spell_code, 
				#{item.wbx_code,jdbcType=VARCHAR} wbx_code, 
				#{item.is_stop,jdbcType=INTEGER} is_stop, 
				#{item.subj_dire,jdbcType=INTEGER} subj_dire, 
				#{item.is_check,jdbcType=INTEGER} is_check, 
				#{item.check1,jdbcType=INTEGER} check1, 
				#{item.check2,jdbcType=INTEGER} check2, 
				#{item.check3,jdbcType=INTEGER} check3, 
				#{item.check4,jdbcType=INTEGER} check4, 
				#{item.check_type_code1,jdbcType=VARCHAR} check_type_code1, 
				#{item.check_type_code2,jdbcType=VARCHAR} check_type_code2, 
				#{item.check_type_code3,jdbcType=VARCHAR} check_type_code3, 
				#{item.check_type_code4,jdbcType=VARCHAR} check_type_code4, 
				#{item.out_code,jdbcType=VARCHAR} out_code, 
				#{item.is_bill,jdbcType=INTEGER} is_bill, 
				#{item.is_pact,jdbcType=INTEGER} is_pact 
			FROM DUAL
		</foreach>
		) tmp
	</insert>
	<!-- 修改上级科目为非末级导入专用 -->
	<update id="updateAccSubjForImport" parameterType="java.util.Map">
		UPDATE acc_subj 
		SET is_last = 0, check1 = '', check2 = '', check3 = '', check4 = '', 
			check_type_code1 = '', check_type_code2 = '', 
			check_type_code3 = '', check_type_code4 = ''
		WHERE group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND acc_year = #{acc_year,jdbcType=VARCHAR}
			AND subj_code in (${subj_code})
	</update>
	
	<select id="queryAccSubjByVouch" parameterType="java.util.Map" resultType="java.util.Map">
		select sum(nvl(money,0)) as subjCount from (
		select sum(nvl(b.debit,0)+nvl(credit,0)) money
		from acc_vouch a
			left join acc_vouch_detail b on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.vouch_id = b.vouch_id 
		WHERE a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND b.subj_code = #{subj_code,jdbcType=VARCHAR}
			AND a.acc_year = #{acc_year,jdbcType=VARCHAR}
		union all
		select sum(nvl(a.bal_os,0)) money
		from acc_leder a
			left join acc_leder_check b on a.group_id = b.group_id
		and a.hos_id = b.hos_id
	  and a.copy_code = b.copy_code
	  and a.subj_code = b.subj_code
	  and a.acc_year = b.acc_year
	  and a.acc_month = b.acc_month 
		WHERE a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.subj_code = #{subj_code,jdbcType=VARCHAR}
			AND a.acc_year = #{acc_year,jdbcType=VARCHAR}
		)
	</select>
</mapper> 

