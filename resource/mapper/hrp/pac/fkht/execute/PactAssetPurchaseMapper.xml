<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.pac.dao.fkht.execute.PactAssetPurchaseMapper">
	<resultMap type="java.util.Map" id="result">
		<result property="group_id" column="group_id"/>
		<result property="hos_id" column="hos_id"/>
		<result property="copy_code" column="copy_code"/>
		<result property="pact_code" column="pact_code"/>
		<result property="pact_name" column="pact_name"/>
		<result property="sign_date" column="sign_date"/>
		<result property="sup_id" column="sup_id"/>
		<result property="sup_no" column="sup_no"/>
		<result property="sup_code" column="sup_code"/>
		<result property="sup_name" column="sup_name"/>
		<result property="dept_id" column="dept_id"/>
		<result property="dept_no" column="dept_no"/>
		<result property="dept_code" column="dept_code"/>
		<result property="dept_name" column="dept_name"/>
		<result property="pact_money" column="pact_money"/>
		<result property="ass_id" column="ass_id"/>
		<result property="ass_no" column="ass_no"/>
		<result property="ass_code" column="ass_code"/>
		<result property="ass_name" column="ass_name"/>
		<result property="ass_spec" column="ass_spec"/>
		<result property="ass_model" column="ass_model"/>
		<result property="ass_brand" column="ass_brand"/>
		<result property="ass_type" column="ass_type"/>
		<result property="ass_type_name" column="ass_type_name"/>
		<result property="amount" column="amount"/>
		<result property="in_amount" column="in_amount"/>
		<result property="un_amount" column="un_amount"/>
		<result property="in_date" column="in_date"/>
		<result property="ass_in_no" column="ass_in_no"/>
		<result property="type_name" column="type_name"/>
		 
		<result property="fac_id" column="fac_id"/>
		<result property="fac_no" column="fac_no"/>
		<result property="fac_code" column="fac_code"/>
		<result property="fac_name" column="fac_name"/>
		
		<result property="ins_amount" column="ins_amount"/>
		<result property="accept_amount" column="accept_amount"/>
		<result property="in_amount" column="in_amount"/>
		<result property="back_amount" column="back_amount"/>
		<result property="left_amount" column="left_amount"/>
		
		<result property="trade_type" column="trade_type"/>
		<result property="trade_type_name" column="trade_type_name"/>
		<result property="ins_no" column="ins_no"/>
		<result property="accept_no" column="accept_no"/>
		<result property="ass_back_no" column="ass_back_no"/>
		
		<result property="back_date" column="back_date"/>
		
		<result property="ass_naturs" column="ass_naturs"/>
		<result property="ass_card_no" column="ass_card_no"/>
		<result property="use_state" column="use_state"/>
		<result property="use_state_name" column="use_state_name"/>
		<result property="price" column="price"/>
		<result property="type_name" column="type_name"/>
				
	</resultMap>
	
	<resultMap type="java.util.Map" id="refMap">
		<result property="group_id" column="group_id"/>
		<result property="hos_id" column="hos_id"/>
		<result property="copy_code" column="copy_code"/>
		<result property="sup_id" column="sup_id"/>
		<result property="sup_no" column="sup_no"/>
		<result property="sup_code" column="sup_code"/>
		<result property="sup_name" column="sup_name"/>
		<result property="dept_id" column="dept_id"/>
		<result property="dept_no" column="dept_no"/>
		<result property="dept_code" column="dept_code"/>
		<result property="dept_name" column="dept_name"/>
		<result property="create_date" column="create_date"/>
		<result property="in_date" column="in_date"/>
		<result property="back_date" column="back_date"/>
		<result property="ass_in_no" column="ass_in_no"/>
		<result property="ass_back_no" column="ass_back_no"/>
		<result property="ass_naturs" column="ass_naturs"/>
		<result property="state" column="state"/>
		
		<result property="ass_id" column="ass_id"/>
		<result property="ass_no" column="ass_no"/>
		<result property="ass_code" column="ass_code"/>
		<result property="ass_name" column="ass_name"/>
		<result property="ass_spec" column="ass_spec"/>
		<result property="ass_model" column="ass_model"/>
		<result property="ass_brand" column="ass_brand"/>
		<result property="fac_id" column="fac_id"/>
		<result property="fac_no" column="fac_no"/>
		<result property="fac_code" column="fac_code"/>
		<result property="fac_name" column="fac_name"/>
		  
		<result property="ins_id" column="ins_id"/>
		<result property="ins_no" column="ins_no"/>
		<result property="ins_date" column="ins_date"/>
		<result property="accept_desc" column="accept_desc"/>
		<result property="pact_code" column="pact_code"/>
		<result property="ins_amount" column="ins_amount"/>
		<result property="ins_price" column="ins_price"/>
		<result property="ins_money" column="ins_money"/>
		<result property="ins_company" column="ins_company"/>
		<result property="ins_tele" column="ins_tele"/>
		<result property="ins_engr" column="ins_engr"/>
		<result property="ins_desc" column="ins_desc"/>
		
		<result property="accept_id" column="accept_id"/>
		<result property="accept_no" column="accept_no"/>
		<result property="accept_date" column="accept_date"/>
		<result property="accept_desc" column="accept_desc"/>
		<result property="accept_amount" column="accept_amount"/>
		<result property="is_well" column="is_well"/>
		<result property="accept_emp" column="accept_emp"/>
		<result property="emp_name" column="emp_name"/>
		<result property="store_id" column="store_id"/>
		<result property="store_no" column="store_no"/>
		<result property="store_code" column="store_code"/>
		<result property="store_name" column="store_name"/>
		
		<result property="in_amount" column="in_amount"/>
		<result property="price" column="price"/>
		<result property="in_money" column="in_money"/>
		<result property="reg_no" column="reg_no"/>
		<result property="ass_purpose" column="ass_purpose"/>
		<result property="invoice_no" column="invoice_no"/>
		<result property="invoice_date" column="invoice_date"/>
		<result property="note" column="note"/>
		
		<result property="back_amount" column="back_amount"/>
			 
		<result property="back_money" column="back_money"/>
		
		
		
	</resultMap>

	<select id="queryPactAssetPurchaseFKHT" parameterType="java.util.Map"	resultMap="result">
		with insInfo as(<!-- 安装数据 信息  -->
			select a.group_id , a.hos_id , a.copy_code ,  a.ins_id , a.ins_no, b.ass_id,b.ass_no ,c.ass_code , c.ass_name, 
					a.pact_code , c.ass_type_id ,sum(b.ins_amount) ins_amount
			from ass_ins_main a
			left join ass_ins_detail b
				on
					a.group_id = b.group_id
					and a.hos_id = b.hos_id
					and a.copy_code = b.copy_code
					and a.ins_id = b.ins_id 
			left join ass_no_dict c
				on
					b.group_id = c.group_id
					and b.hos_id = c.hos_id
					and b.copy_code = c.copy_code
					and b.ass_id = c.ass_id
					and b.ass_no = c.ass_no 
			where
				a.group_id = ${group_id}
				and a.hos_id = ${hos_id}
				and a.copy_code = ${copy_code}
				<if test="ass_name != bull and ass_name !=''">
				and (c.ass_code like ${ass_name} || '%'
						or c.ass_name like '%' ||${ass_name} || '%'
						or c.sepll_code like '%' || to_upper(${ass_name}) || '%'
						or c.wbx_code like '%' || to_upper(${ass_name}) || '%'
					)
				</if>
				<if test="is_ins ==0">
				and a.state = 1
				</if>
			group by  a.group_id , a.hos_id , a.copy_code ,a.ins_id , a.ins_no, b.ass_id,b.ass_no ,
				c.ass_code , c.ass_name, a.pact_code , c.ass_type_id 
		),
		acceptInfo as(<!-- 验收数据信息 -->
			select a.group_id , a.hos_id , a.copy_code ,a.accept_id , a.accept_no, b.ass_id,b.ass_no ,c.ass_code , c.ass_name, 
				a.pact_code, c.ass_type_id  , sum(b.accept_amount) accept_amount
			from ass_accept_main a
			left join ass_accept_detail b
				on
					a.group_id = b.group_id
					and a.hos_id = b.hos_id
					and a.copy_code = b.copy_code
					and a.accept_id = b.accept_id 
			left join ass_no_dict c
				on
					b.group_id = c.group_id
					and b.hos_id = c.hos_id
					and b.copy_code = c.copy_code
					and b.ass_id = c.ass_id
					and b.ass_no = c.ass_no 
			where
				a.group_id = ${group_id}
				and a.hos_id = ${hos_id}
				and a.copy_code = ${copy_code}
				<if test="ass_name != bull and ass_name !=''">
				and (c.ass_code like ${ass_name} || '%'
						or c.ass_name like '%' ||${ass_name} || '%'
						or c.sepll_code like '%' || to_upper(${ass_name}) || '%'
						or c.wbx_code like '%' || to_upper(${ass_name}) || '%'
					)
				</if>
				<if test="is_accept ==0">
				and a.state = 1
				</if>
			group by a.group_id , a.hos_id , a.copy_code ,a.accept_id , a.accept_no, b.ass_id,b.ass_no ,c.ass_code , 
				c.ass_name, a.pact_code , c.ass_type_id 
		),
		inInfo as(<!-- 入库数据信息  -->
			select a.group_id , a.hos_id , a.copy_code , a.ass_in_no, a.ass_id,a.ass_no ,c.ass_code ,c.ass_name,
				b.pact_code, c.ass_type_id , count(b.ass_card_no) in_amount
			from v_ass_in_detail a
			left join v_ass_card b
			  on
			    a.group_id = b.group_id
			    and a.hos_id = b.hos_id
			    and a.copy_code = b.copy_code
			    and a.ass_in_no = b.ass_in_no 
			    and a.ass_id = b.ass_id
			left join ass_no_dict c
			  on
			    a.group_id = c.group_id
			    and a.hos_id = c.hos_id
			    and a.copy_code = c.copy_code
			    and a.ass_id = c.ass_id
			    and a.ass_no = c.ass_no
			left join v_ass_in_main d
			  on
			    a.group_id = d.group_id
			    and a.hos_id = d.hos_id
			    and a.copy_code = d.copy_code
			    and a.ass_in_no = d.ass_in_no 
				
			where
				a.group_id = ${group_id}
				and a.hos_id = ${hos_id}
				and a.copy_code = ${copy_code}
				<if test="ass_name != bull and ass_name !=''">
				and (c.ass_code like ${ass_name} || '%'
						or c.ass_name like '%' ||${ass_name} || '%'
						or c.sepll_code like '%' || to_upper(${ass_name}) || '%'
						or c.wbx_code like '%' || to_upper(${ass_name}) || '%'
					)
				</if>
				<if test="is_in ==0">
				and d.state = 2
				</if>
			group by  a.group_id , a.hos_id , a.copy_code , a.ass_in_no, a.ass_id,a.ass_no ,
				c.ass_code ,c.ass_name,	b.pact_code, c.ass_type_id 
		),
		backInfo as(<!-- 退货数据信息  -->
			select a.group_id , a.hos_id , a.copy_code , a.ass_back_no, b.ass_id,b.ass_no ,c.ass_code , c.ass_name,
				b.pact_code , c.ass_type_id , count(1) back_amount
			from v_ass_back_detail a
			left join v_ass_card b
			  on
			    a.group_id = b.group_id
			    and a.hos_id = b.hos_id
			    and a.copy_code = b.copy_code
			    and a.ass_card_no = b.ass_card_no 
			left join ass_no_dict c
			  on
			    b.group_id = c.group_id
			    and b.hos_id = c.hos_id
			    and b.copy_code = c.copy_code
			    and b.ass_id = c.ass_id
			    and b.ass_no = c.ass_no 
			left join v_ass_back_main d
			  on
			    a.group_id = d.group_id
			    and a.hos_id = d.hos_id
			    and a.copy_code = d.copy_code
			    and a.ass_back_no = d.ass_back_no
				
			where
				a.group_id = ${group_id}
				and a.hos_id = ${hos_id}
				and a.copy_code = ${copy_code}
				<if test="ass_name != bull and ass_name !=''">
				and (c.ass_code like ${ass_name} || '%'
						or c.ass_name like '%' ||${ass_name} || '%'
						or c.sepll_code like '%' || to_upper(${ass_name}) || '%'
						or c.wbx_code like '%' || to_upper(${ass_name}) || '%'
					)
				</if>
			group by a.group_id, a.hos_id, a.copy_code, a.ass_back_no, b.ass_id,b.ass_no ,
				c.ass_code , c.ass_name, b.pact_code, c.ass_type_id 
		),
		numInfo as(<!-- 安装/验收/入库/退货 数据  集  -->
			select aa.group_id , aa.hos_id , aa.copy_code , aa.ass_id,aa.ass_no ,aa.ass_code , aa.ass_name, 
				aa.pact_code , aa.ass_type_id , aa.ins_amount ,bb.accept_amount ,cc.in_amount ,dd.back_amount 
			from insInfo aa
			left join acceptInfo bb
				on  aa.ass_id = bb.ass_id
				and aa.ass_no = bb.ass_no
				and aa.pact_code = bb.pact_code
			left join inInfo cc
				on  aa.ass_id = cc.ass_id
				and aa.ass_no = cc.ass_no
				and aa.pact_code = cc.pact_code
			left join backInfo dd
				on  aa.ass_id = dd.ass_id
				and aa.ass_no = dd.ass_no
				and aa.pact_code = dd.pact_code
		)
		SELECT pmf.pact_code, pmf.pact_name, pmf.sign_date, pmf.sup_id,pmf.sup_no ,hs.sup_code , hs.sup_name ,pmf.dept_id ,pmf.dept_no ,
			d.dept_code,d.dept_name,pmf.pact_money,t.ass_id,t.ass_no,t.ass_code,t.ass_name, pdf.item_spec ass_spec, pdf.item_model ass_model,
			pdf.item_brand ass_brand , pdf.fac_id , pdf.fac_no ,hfd.fac_code ,hfd.fac_name , pdf.amount , nvl(t.ins_amount,0) ins_amount,
			nvl(t.accept_amount,0) accept_amount ,nvl(t.in_amount,0) in_amount, nvl(t.back_amount,0) back_amount,
			( pdf.amount - nvl(t.in_amount,0) + nvl(t.back_amount,0)) left_amount
		FROM PACT_MAIN_FKHT pmf
		LEFT JOIN  PACT_DET_FKHT pdf
			on  pdf.group_id = pmf.group_id
			and pdf.hos_id = pmf.hos_id
			and pdf.copy_code = pmf.copy_code
			and pdf.pact_code = pmf.pact_code
		LEFT JOIN numInfo t
			on  t.group_id = pdf.group_id
			and t.hos_id = pdf.hos_id
			and t.copy_code = pdf.copy_code
			and t.pact_code = pdf.pact_code
			and t.ass_id = pdf.subject_id
			and t.ass_no = pdf.subject_no
		LEFT JOIN HOS_SUP_DICT hs 
			ON pmf.GROUP_ID = hs.GROUP_ID 
			AND pmf.HOS_ID = hs.HOS_ID 
			AND pmf.sup_id = hs.sup_id
			AND pmf.sup_no = hs.sup_no
		LEFT JOIN HOS_DEPT_DICT d 
			ON d.GROUP_ID = pmf.GROUP_ID 
			AND d.HOS_ID = pmf.HOS_ID
			AND d.dept_id = pmf.dept_id
			and d.dept_no = pmf.dept_no
		LEFT JOIN ASS_TYPE_DICT  atd
			on atd.group_id = t.group_id
			and atd.hos_id = t.hos_id
			and atd.copy_code = t.copy_code
			and atd.ass_type_id = t.ass_type_id
		LEFT JOIN HOS_FAC_DICT hfd
			on  hfd.group_id = pdf.group_id
			and hfd.hos_id = pdf.hos_id
			and hfd.fac_id = pdf.fac_id
			and hfd.fac_no = pdf.fac_no
		
		where
			pmf.group_id=#{group_id,jdbcType=NUMERIC}
			and pmf.hos_id=#{hos_id,jdbcType=NUMERIC}
			and pmf.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and pmf.SIGN_DATE  &gt;=	to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and pmf.SIGN_DATE  &lt;=	to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_type_code != null and pact_type_code != ''">
				and pmf.pact_type_code=#{pact_type_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_no != null and sup_no != ''">
				and pmf.sup_id=#{sup_no,jdbcType=VARCHAR}
			</if>
			<if test="pact_code != null and pact_code != ''">
				and pmf.pact_code like upper(#{pact_code,jdbcType=VARCHAR})||'%'
			</if>
			<if test="pact_name != null and pact_name != ''">
				and pmf.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
			</if>
			<!-- 签订科室 -->
			<if test="sign_dept != null and sign_dept != ''">
				and pmf.dept_id = #{sign_dept}
			</if>
			<if test="ass_natur != null and ass_natur != ''">
				and atd.ass_naturs = #{ass_natur}
			</if>
			<if test="ass_name != null and ass_name != ''">
				and t.ASS_NAME like '%'||#{ass_name,jdbcType=VARCHAR}||'%'
			</if>
			<if test="state_code != null and state_code != ''">
				and pmf.state_code = #{state_code}
			</if>
	</select>
	<select id="queryPactAssetPurchaseFKHTPrint" parameterType="java.util.Map"	resultMap="result">
		with insInfo as(<!-- 安装数据 信息  -->
			select a.group_id , a.hos_id , a.copy_code ,  a.ins_id , a.ins_no, b.ass_id,b.ass_no ,c.ass_code , c.ass_name, 
					a.pact_code , c.ass_type_id ,sum(b.ins_amount) ins_amount
			from ass_ins_main a
			left join ass_ins_detail b
				on
					a.group_id = b.group_id
					and a.hos_id = b.hos_id
					and a.copy_code = b.copy_code
					and a.ins_id = b.ins_id 
			left join ass_no_dict c
				on
					b.group_id = c.group_id
					and b.hos_id = c.hos_id
					and b.copy_code = c.copy_code
					and b.ass_id = c.ass_id
					and b.ass_no = c.ass_no 
			where
				a.group_id = ${group_id}
				and a.hos_id = ${hos_id}
				and a.copy_code = ${copy_code}
				<if test="ass_name != bull and ass_name !=''">
				and (c.ass_code like ${ass_name} || '%'
						or c.ass_name like '%' ||${ass_name} || '%'
						or c.sepll_code like '%' || to_upper(${ass_name}) || '%'
						or c.wbx_code like '%' || to_upper(${ass_name}) || '%'
					)
				</if>
				<if test="is_ins ==0">
				and a.state = 1
				</if>
			group by  a.group_id , a.hos_id , a.copy_code ,a.ins_id , a.ins_no, b.ass_id,b.ass_no ,
				c.ass_code , c.ass_name, a.pact_code , c.ass_type_id 
		),
		acceptInfo as(<!-- 验收数据信息 -->
			select a.group_id , a.hos_id , a.copy_code ,a.accept_id , a.accept_no, b.ass_id,b.ass_no ,c.ass_code , c.ass_name, 
				a.pact_code, c.ass_type_id  , sum(b.accept_amount) accept_amount
			from ass_accept_main a
			left join ass_accept_detail b
				on
					a.group_id = b.group_id
					and a.hos_id = b.hos_id
					and a.copy_code = b.copy_code
					and a.accept_id = b.accept_id 
			left join ass_no_dict c
				on
					b.group_id = c.group_id
					and b.hos_id = c.hos_id
					and b.copy_code = c.copy_code
					and b.ass_id = c.ass_id
					and b.ass_no = c.ass_no 
			where
				a.group_id = ${group_id}
				and a.hos_id = ${hos_id}
				and a.copy_code = ${copy_code}
				<if test="ass_name != bull and ass_name !=''">
				and (c.ass_code like ${ass_name} || '%'
						or c.ass_name like '%' ||${ass_name} || '%'
						or c.sepll_code like '%' || to_upper(${ass_name}) || '%'
						or c.wbx_code like '%' || to_upper(${ass_name}) || '%'
					)
				</if>
				<if test="is_accept ==0">
				and a.state = 1
				</if>
			group by a.group_id , a.hos_id , a.copy_code ,a.accept_id , a.accept_no, b.ass_id,b.ass_no ,c.ass_code , 
				c.ass_name, a.pact_code , c.ass_type_id 
		),
		inInfo as(<!-- 入库数据信息  -->
			select a.group_id , a.hos_id , a.copy_code , a.ass_in_no, a.ass_id,a.ass_no ,c.ass_code ,c.ass_name,
				b.pact_code, c.ass_type_id , count(b.ass_card_no) in_amount
			from v_ass_in_detail a
			left join v_ass_card b
			  on
			    a.group_id = b.group_id
			    and a.hos_id = b.hos_id
			    and a.copy_code = b.copy_code
			    and a.ass_in_no = b.ass_in_no 
			    and a.ass_id = b.ass_id
			left join ass_no_dict c
			  on
			    a.group_id = c.group_id
			    and a.hos_id = c.hos_id
			    and a.copy_code = c.copy_code
			    and a.ass_id = c.ass_id
			    and a.ass_no = c.ass_no
			left join v_ass_in_main d
			  on
			    a.group_id = d.group_id
			    and a.hos_id = d.hos_id
			    and a.copy_code = d.copy_code
			    and a.ass_in_no = d.ass_in_no 
				
			where
				a.group_id = ${group_id}
				and a.hos_id = ${hos_id}
				and a.copy_code = ${copy_code}
				<if test="ass_name != bull and ass_name !=''">
				and (c.ass_code like ${ass_name} || '%'
						or c.ass_name like '%' ||${ass_name} || '%'
						or c.sepll_code like '%' || to_upper(${ass_name}) || '%'
						or c.wbx_code like '%' || to_upper(${ass_name}) || '%'
					)
				</if>
				<if test="is_in ==0">
				and d.state = 2
				</if>
			group by  a.group_id , a.hos_id , a.copy_code , a.ass_in_no, a.ass_id,a.ass_no ,
				c.ass_code ,c.ass_name,	b.pact_code, c.ass_type_id 
		),
		backInfo as(<!-- 退货数据信息  -->
			select a.group_id , a.hos_id , a.copy_code , a.ass_back_no, b.ass_id,b.ass_no ,c.ass_code , c.ass_name,
				b.pact_code , c.ass_type_id , count(1) back_amount
			from v_ass_back_detail a
			left join v_ass_card b
			  on
			    a.group_id = b.group_id
			    and a.hos_id = b.hos_id
			    and a.copy_code = b.copy_code
			    and a.ass_card_no = b.ass_card_no 
			left join ass_no_dict c
			  on
			    b.group_id = c.group_id
			    and b.hos_id = c.hos_id
			    and b.copy_code = c.copy_code
			    and b.ass_id = c.ass_id
			    and b.ass_no = c.ass_no 
			left join v_ass_back_main d
			  on
			    a.group_id = d.group_id
			    and a.hos_id = d.hos_id
			    and a.copy_code = d.copy_code
			    and a.ass_back_no = d.ass_back_no
				
			where
				a.group_id = ${group_id}
				and a.hos_id = ${hos_id}
				and a.copy_code = ${copy_code}
				<if test="ass_name != bull and ass_name !=''">
				and (c.ass_code like ${ass_name} || '%'
						or c.ass_name like '%' ||${ass_name} || '%'
						or c.sepll_code like '%' || to_upper(${ass_name}) || '%'
						or c.wbx_code like '%' || to_upper(${ass_name}) || '%'
					)
				</if>
			group by a.group_id, a.hos_id, a.copy_code, a.ass_back_no, b.ass_id,b.ass_no ,
				c.ass_code , c.ass_name, b.pact_code, c.ass_type_id 
		),
		numInfo as(<!-- 安装/验收/入库/退货 数据  集  -->
			select aa.group_id , aa.hos_id , aa.copy_code , aa.ass_id,aa.ass_no ,aa.ass_code , aa.ass_name, 
				aa.pact_code , aa.ass_type_id , aa.ins_amount ,bb.accept_amount ,cc.in_amount ,dd.back_amount 
			from insInfo aa
			left join acceptInfo bb
				on  aa.ass_id = bb.ass_id
				and aa.ass_no = bb.ass_no
				and aa.pact_code = bb.pact_code
			left join inInfo cc
				on  aa.ass_id = cc.ass_id
				and aa.ass_no = cc.ass_no
				and aa.pact_code = cc.pact_code
			left join backInfo dd
				on  aa.ass_id = dd.ass_id
				and aa.ass_no = dd.ass_no
				and aa.pact_code = dd.pact_code
		)
		SELECT pmf.pact_code id, pmf.pact_code, pmf.pact_name, pmf.sign_date, pmf.sup_id,pmf.sup_no ,hs.sup_code , hs.sup_name ,pmf.dept_id ,pmf.dept_no ,
			d.dept_code,d.dept_name,pmf.pact_money,t.ass_id,t.ass_no,t.ass_code,t.ass_name, pdf.item_spec ass_spec, pdf.item_model ass_model,
			pdf.item_brand ass_brand , pdf.fac_id , pdf.fac_no ,hfd.fac_code ,hfd.fac_name , pdf.amount , nvl(t.ins_amount,0) ins_amount,
			nvl(t.accept_amount,0) accept_amount ,nvl(t.in_amount,0) in_amount, nvl(t.back_amount,0) back_amount,
			( pdf.amount - nvl(t.in_amount,0) + nvl(t.back_amount,0)) left_amount
		FROM PACT_MAIN_FKHT pmf
		LEFT JOIN  PACT_DET_FKHT pdf
			on  pdf.group_id = pmf.group_id
			and pdf.hos_id = pmf.hos_id
			and pdf.copy_code = pmf.copy_code
			and pdf.pact_code = pmf.pact_code
		LEFT JOIN numInfo t
			on  t.group_id = pdf.group_id
			and t.hos_id = pdf.hos_id
			and t.copy_code = pdf.copy_code
			and t.pact_code = pdf.pact_code
			and t.ass_id = pdf.subject_id
			and t.ass_no = pdf.subject_no
		LEFT JOIN HOS_SUP_DICT hs 
			ON pmf.GROUP_ID = hs.GROUP_ID 
			AND pmf.HOS_ID = hs.HOS_ID 
			AND pmf.sup_id = hs.sup_id
			AND pmf.sup_no = hs.sup_no
		LEFT JOIN HOS_DEPT_DICT d 
			ON d.GROUP_ID = pmf.GROUP_ID 
			AND d.HOS_ID = pmf.HOS_ID
			AND d.dept_id = pmf.dept_id
			and d.dept_no = pmf.dept_no
		LEFT JOIN ASS_TYPE_DICT  atd
			on atd.group_id = t.group_id
			and atd.hos_id = t.hos_id
			and atd.copy_code = t.copy_code
			and atd.ass_type_id = t.ass_type_id
		LEFT JOIN HOS_FAC_DICT hfd
			on  hfd.group_id = pdf.group_id
			and hfd.hos_id = pdf.hos_id
			and hfd.fac_id = pdf.fac_id
			and hfd.fac_no = pdf.fac_no
		
		where
			pmf.group_id=#{group_id,jdbcType=NUMERIC}
			and pmf.hos_id=#{hos_id,jdbcType=NUMERIC}
			and pmf.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and pmf.SIGN_DATE  &gt;=	to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and pmf.SIGN_DATE  &lt;=	to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_type_code != null and pact_type_code != ''">
				and pmf.pact_type_code=#{pact_type_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_no != null and sup_no != ''">
				and pmf.sup_id=#{sup_no,jdbcType=VARCHAR}
			</if>
			<if test="pact_code != null and pact_code != ''">
				and pmf.pact_code like upper(#{pact_code,jdbcType=VARCHAR})||'%'
			</if>
			<if test="pact_name != null and pact_name != ''">
				and pmf.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
			</if>
			<!-- 签订科室 -->
			<if test="sign_dept != null and sign_dept != ''">
				and pmf.dept_id = #{sign_dept}
			</if>
			<if test="ass_natur != null and ass_natur != ''">
				and atd.ass_naturs = #{ass_natur}
			</if>
			<if test="ass_name != null and ass_name != ''">
				and t.ASS_NAME like '%'||#{ass_name,jdbcType=VARCHAR}||'%'
			</if>
			<if test="state_code != null and state_code != ''">
				and pmf.state_code = #{state_code}
			</if>
	</select>
	<!-- 资产采购明细表 查询 -->
	<select id="queryPactAssetPurchaseDetailFKHT" parameterType="java.util.Map"		resultMap="result">
		SELECT a.ass_naturs,a.ass_card_no , a.use_state ,acus.state_name use_state_name , a.ass_id,a.ass_no,ad.ass_code, ad.ass_name,
				atd.ass_type_code ,atd.ass_type_name,a.ass_brand , a.ass_spec,a.ass_mondl ass_model,a.fac_id ,a.fac_no,
				e.fac_code , e.fac_name ,a.price,a.in_date,a.ass_in_no,bd.ass_back_no , bm.back_date , b.pact_code,
				b.pact_name,ptf.type_name,b.dept_id , b.dept_no , d.dept_code , d.dept_name, a.ven_id sup_id , 
				a.ven_no sup_no ,hs.sup_code ,hs.sup_name 
		FROM  V_ASS_CARD a
		LEFT JOIN ASS_CARD_USE_STATE acus 
			ON a.use_state = acus.state_code
			and acus.is_stop = 0
		LEFT JOIN PACT_MAIN_FKHT b 
			ON a.GROUP_ID = b.GROUP_ID 
			AND a.HOS_ID = b.HOS_ID 
			AND a.COPY_CODE = b.COPY_CODE 
			AND a.PACT_CODE = b.PACT_CODE
		LEFT JOIN HOS_SUP_DICT hs 
			ON a.GROUP_ID = hs.GROUP_ID
			AND a.HOS_ID = hs.HOS_ID 
			AND a.VEN_ID = hs.SUP_ID
			AND a.VEN_NO = hs.SUP_NO
		LEFT JOIN HOS_DEPT_DICT d 
			ON b.GROUP_ID = d.GROUP_ID 
			AND b.HOS_ID = d.HOS_ID
			AND b.dept_id = d.dept_id
			AND b.dept_no = d.dept_no
		LEFT JOIN HOS_FAC_DICT e 
			ON a.GROUP_ID = e.GROUP_ID 
			AND a.HOS_ID = e.HOS_ID
			AND a.fac_id = e.fac_id
			AND a.fac_no = e.fac_no
		LEFT JOIN ASS_NO_DICT ad 
			ON ad.GROUP_ID = a.GROUP_ID 
			AND ad.HOS_ID = a.HOS_ID 
			AND ad.COPY_CODE = a.COPY_CODE 
			AND ad.ASS_ID = a.ASS_ID 
			AND ad.ASS_NO = a.ASS_NO
		LEFT JOIN ASS_TYPE_DICT atd 
			ON atd.GROUP_ID = ad.GROUP_ID 
			AND atd.HOS_ID = ad.HOS_ID 
			AND atd.COPY_CODE = ad.COPY_CODE 
			AND atd.ASS_TYPE_ID = ad.ASS_TYPE_ID
		LEFT JOIN PACT_TYPE_FKHT ptf 
			ON ptf.GROUP_ID = b.GROUP_ID 
			AND ptf.COPY_CODE = b.COPY_CODE 
			AND ptf.HOS_ID = b.HOS_ID 
			AND ptf.type_code = b.PACT_TYPE_CODE
		LEFT JOIN V_ASS_BACK_DETAIL bd
			ON a.GROUP_ID = bd.GROUP_ID 
			AND a.HOS_ID = bd.HOS_ID 
			AND a.COPY_CODE = bd.COPY_CODE 
			AND a.ass_card_no = bd.ass_card_no
		LEFT JOIN V_ASS_BACK_MAIN bm
			ON bd.GROUP_ID = bd.GROUP_ID 
			AND bd.HOS_ID = bd.HOS_ID 
			AND bd.COPY_CODE = bd.COPY_CODE 
			AND bd.ass_back_no = bd.ass_back_no
		where
			a.group_id=#{group_id,jdbcType=NUMERIC}
			and a.hos_id=#{hos_id,jdbcType=NUMERIC}
			and a.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and b.SIGN_DATE  &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="end_date != null and end_date != ''">
				and b.SIGN_DATE  &lt;= to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_type_code != null and pact_type_code != ''">
				and b.pact_type_code=#{pact_type_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_no != null and sup_no != ''">
				and a.ven_id=#{sup_no,jdbcType=VARCHAR}
			</if>
			<if test="in_start_date != null and in_start_date != '' ">
				and a.in_date &gt;= to_date(#{in_start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="in_end_date != null and in_end_date != ''">
				and a.in_date &lt;= to_date(#{in_end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and b.pact_code like upper(#{pact_code,jdbcType=VARCHAR})||'%'
			</if>
			<if test="pact_name != null and pact_name != ''">
				and b.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
			</if>
			<if test="ass_type_id != null and ass_type_id != ''">
				and ad.ASS_TYPE_ID = #{ass_type_id}
			</if>
			<if test="ass_name != null and ass_name != ''">
				and (ad.ASS_CODE like #{ass_name,jdbcType=VARCHAR}||'%'
					or ad.ASS_NAME like '%'||#{ass_name,jdbcType=VARCHAR}||'%'
					or ad.SPELL_CODE like '%'||#{ass_name,jdbcType=VARCHAR}||'%'
					or ad.WBX_CODE like '%'||#{ass_name,jdbcType=VARCHAR}||'%'
				)
			</if>
			<if test="use_state != null and use_state != ''">
				and a.use_state = #{use_state}
			</if>
	</select>
	
	<!-- 资产采购执行查询 -->
	<select id="queryPactAssPurchaseFKHTDet" parameterType="java.util.Map" 	resultMap="result">
		with inInfo as (<!-- 资产采购入库数据处理 -->
			select distinct ss.group_id , ss.hos_id,ss.copy_code ,ss.ass_in_no ,ss.pact_code
			from V_ASS_CARD ss
			where ss.group_id = ${group_id} and ss.hos_id = ${hos_id} 
				and ss.copy_code = ${copy_code}
		),
		backInfo as (<!-- 资产采购退货数据处理 -->
			select ss.group_id , ss.hos_id,ss.copy_code , ss.ass_back_no ,tt.pact_code
			from V_ASS_BACK_DETAIL ss
			
			left join V_ASS_CARD tt
				on  ss.group_id = tt.group_id
				and ss.hos_id = tt.hos_id
				and ss.copy_code = tt.copy_code
				and ss.ass_card_no = tt.ass_card_no
			
			where ss.group_id = ${group_id} and ss.hos_id = ${hos_id} 
				and ss.copy_code = ${copy_code}
		)
		SELECT  pmf.group_id, pmf.hos_id, pmf.copy_code,pmf.pact_code, 
			pmf.pact_name,pmf.trade_type, pdd.value_name trade_type_name,
			pmf.sign_date, pmf.sup_id ,pmf.sup_no ,hs.sup_code,hs.sup_name ,
			pmf.dept_id , pmf.dept_no ,d.dept_code , d.dept_name,
			pmf.pact_money, nvl(ins.ins_no,0) ins_no , 
			nvl(aam.accept_no,0) accept_no, nvl(ain.ass_in_no,0) ass_in_no , 
			nvl(back.ass_back_no,0)  ass_back_no
		
		FROM  PACT_MAIN_FKHT pmf 
		LEFT JOIN HOS_SUP_DICT hs 
			ON pmf.GROUP_ID = hs.GROUP_ID 
			AND pmf.HOS_ID = hs.HOS_ID 
			AND pmf.sup_id = hs.SUP_ID
			AND PMF.SUP_NO = hs.SUP_NO
		LEFT JOIN HOS_DEPT_DICT d 
			ON 	pmf.GROUP_ID = d.GROUP_ID 
			AND pmf.HOS_ID = d.HOS_ID
			AND pmf.dept_id = d.dept_id 
			AND pmf.dept_no = d.dept_no 
		LEFT JOIN PACT_DICT_DATA pdd
			ON  pmf.TRADE_TYPE = pdd.VALUE_CODE
			AND pdd.f_code = 'TRADE_TYPE' 
		left join (select group_id , hos_id , copy_code ,  pact_code , nvl(count(1),0) ins_no
					from ass_ins_main 
					where group_id = ${group_id} and hos_id = ${hos_id} and copy_code = ${copy_code}
					group by group_id , hos_id , copy_code ,  pact_code 
				) ins
			on  pmf.group_id = ins.group_id
			and pmf.hos_id = ins.hos_id
			and pmf.copy_code = ins.copy_code
			and pmf.pact_code = ins.pact_code
			AND pdd.f_code = 'TRADE_TYPE' 
		left join (select group_id , hos_id , copy_code ,  pact_code , nvl(count(1),0) accept_no
					from ASS_ACCEPT_MAIN 
					where group_id = ${group_id} and hos_id = ${hos_id} and copy_code = ${copy_code}
					group by group_id , hos_id , copy_code ,  pact_code 
				) aam
			on  pmf.group_id = aam.group_id
			and pmf.hos_id = aam.hos_id
			and pmf.copy_code = aam.copy_code
			and pmf.pact_code = aam.pact_code
		left join  (select group_id , hos_id , copy_code ,  pact_code , nvl(count(1),0) ass_in_no
					from inInfo 
					where group_id = ${group_id} and hos_id = ${hos_id} and copy_code = ${copy_code}
					group by group_id , hos_id , copy_code ,  pact_code 
				) ain
			on  pmf.group_id = ain.group_id
			and pmf.hos_id = ain.hos_id
			and pmf.copy_code = ain.copy_code
			and pmf.pact_code = ain.pact_code
		left join  (select group_id , hos_id , copy_code ,  pact_code , nvl(count(1),0) ass_back_no
					from backInfo 
					where group_id = ${group_id} and hos_id = ${hos_id} and copy_code = ${copy_code}
					group by group_id , hos_id , copy_code ,  pact_code 
				) back
			on  pmf.group_id = back.group_id
			and pmf.hos_id = back.hos_id
			and pmf.copy_code = back.copy_code
			and pmf.pact_code = back.pact_code
		where
			pmf.group_id=#{group_id,jdbcType=NUMERIC}
			and pmf.hos_id=#{hos_id,jdbcType=NUMERIC}
			and pmf.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and pmf.SIGN_DATE  &gt;=	to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and pmf.SIGN_DATE  &lt;=	to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_type_code != null and pact_type_code != ''">
				and pmf.pact_type_code=#{pact_type_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and pmf.sup_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="min_money != null and min_money != ''">
				and pmf.pact_money &gt;= to_number(#{min_money})
			</if>
			<if test="max_money != null and max_money != ''">
				and pmf.pact_money &lt;= to_number(#{max_money})
			</if>
			<if test="pact_code != null and pact_code != ''">
				and pmf.pact_code like '%'|| upper(#{pact_code,jdbcType=VARCHAR})
			</if>
			<if test="pact_name != null and pact_name != ''">
				and pmf.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
			</if>
			<if test="trade_type != null and trade_type != ''">
				and pmf.trade_type = #{trade_type}
			</if>
			<if test="sign_dept != null and sign_dept != ''">
				and pmf.dept_id = #{sign_dept}
			</if>
			<if test="state_code != null and state_code != ''">
				and pmf.state_code = #{state_code}
			</if>
	</select>
	
	<!-- 资产采购执行查询 入库链接查询 -->
	<select id="queryPactAssPurchaseFKHTDetIn" parameterType="java.util.Map" 	resultMap="refMap">
		with inInfo as (<!-- 资产采购入库数据处理 -->
			select distinct tt.group_id , tt.hos_id,tt.copy_code ,tt.ass_in_no ,tt.pact_code
			from V_ASS_CARD tt
			where tt.group_id = ${group_id} and tt.hos_id = ${hos_id} 
				and tt.copy_code = ${copy_code}
		)
		SELECT  t.group_id, t.hos_id, t.copy_code,t.ass_naturs , t.ass_in_no, t.state,t.create_date,t.in_date,
			t.store_id,t.store_no,hsd.store_code ,hsd.store_name ,
			t.dept_id,t.dept_no ,d.dept_code, d.dept_name , t.invoice_no,t.invoice_date , t.in_money,t.note
		
		FROM  V_ASS_IN_MAIN t 
		LEFT JOIN HOS_DEPT_DICT d 
			ON 	t.GROUP_ID = d.GROUP_ID 
			AND t.HOS_ID = d.HOS_ID
			AND t.DEPT_ID = d.DEPT_ID 
			AND t.DEPT_NO = d.DEPT_NO
		LEFT JOIN HOS_STORE_DICT hsd
			ON 	t.GROUP_ID = hsd.GROUP_ID 
			AND t.HOS_ID = hsd.HOS_ID
			AND t.STORE_ID = hsd.STORE_ID 
			AND t.STORE_NO = hsd.STORE_NO 
		LEFT JOIN inInfo a
			ON 	t.GROUP_ID = a.GROUP_ID 
			AND t.HOS_ID = a.HOS_ID
			AND t.COPY_CODE = a.COPY_CODE 
			AND t.ASS_IN_NO = a.ASS_IN_NO 
		where
			t.group_id=#{group_id,jdbcType=NUMERIC}
			and t.hos_id=#{hos_id,jdbcType=NUMERIC}
			and t.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and t.create_date  &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and t.create_date  &lt;=to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and a.pact_code=#{pact_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and t.ven_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="start_date_confirm != null and start_date_confirm != '' ">
				and t.in_date  &gt;= to_date(#{start_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date_confirm != null and end_date_confirm != ''">
				and t.in_date  &lt;=to_date(#{end_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="ass_in_no != null and ass_in_no != ''">
				and a.ass_in_no like '%'||#{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="state != null and state != ''">
				and t.state = #{state}
			</if>
	</select>
	
	<!-- 资产采购执行查询 退货链接查询 -->
	<select id="queryPactAssPurchaseFKHTDetBack" parameterType="java.util.Map" 	resultMap="refMap">
		with backInfo as (<!-- 资产采购退货数据处理 -->
			select distinct ss.group_id , ss.hos_id,ss.copy_code ,ss.ass_back_no ,tt.pact_code
			from V_ASS_BACK_DETAIL ss
			left join V_ASS_CARD tt
				on  ss.group_id = tt.group_id
				and ss.hos_id = tt.hos_id
				and ss.copy_code = tt.copy_code
				and ss.ass_card_no = tt.ass_card_no
			
			where ss.group_id = ${group_id} and ss.hos_id = ${hos_id} 
				and ss.copy_code = ${copy_code}
		)
		SELECT  t.group_id, t.hos_id, t.copy_code,t.ass_naturs , t.ass_back_no, t.state,t.create_date,t.back_date,
			t.store_id,t.store_no,hsd.store_code ,hsd.store_name , t.invoice_no,t.invoice_date , t.back_money,t.note
		
		FROM  V_ASS_BACK_MAIN t 
		LEFT JOIN HOS_STORE_DICT hsd
			ON 	t.GROUP_ID = hsd.GROUP_ID 
			AND t.HOS_ID = hsd.HOS_ID
			AND t.STORE_ID = hsd.STORE_ID 
			AND t.STORE_NO = hsd.STORE_NO 
		LEFT JOIN backInfo a
			ON 	t.GROUP_ID = a.GROUP_ID 
			AND t.HOS_ID = a.HOS_ID
			AND t.COPY_CODE = a.COPY_CODE 
			AND t.ASS_BACK_NO = a.ASS_BACK_NO 
		where
			t.group_id=#{group_id,jdbcType=NUMERIC}
			and t.hos_id=#{hos_id,jdbcType=NUMERIC}
			and t.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and t.create_date  &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and t.create_date  &lt;=to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and a.pact_code=#{pact_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and t.ven_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="start_date_confirm != null and start_date_confirm != '' ">
				and t.back_date  &gt;= to_date(#{start_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date_confirm != null and end_date_confirm != ''">
				and t.back_date  &lt;=to_date(#{end_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="ass_back_no != null and ass_back_no != ''">
				and a.ass_back_no like '%'||#{ass_back_no,jdbcType=VARCHAR}
			</if>
			<if test="state != null and state != ''">
				and t.state = #{state}
			</if>
	</select>
	
	<!-- 资产采购执行汇总查询  安装链接查询 -->
	<select id="queryPactAssPurchaseFKHTMainIns" parameterType="java.util.Map" 	resultMap="refMap">
		select a.group_id , a.hos_id , a.copy_code ,  a.ins_id , a.ins_no, a.state , a.ins_date,
			a.dept_id, a.dept_no, hdd.dept_code, hdd.dept_name, a.accept_desc , b.ass_id,b.ass_no ,
			c.ass_code , c.ass_name, a.pact_code , b.ass_model  , b.ass_spec  , b.ass_brand  ,
			b.fac_id  , b. fac_no ,hfd.fac_code , hfd.fac_name , b.ins_amount, b.ins_price ,
			b.ins_money , b.ins_company  , b.ins_tele , b.ins_engr , b.ins_desc      
		from ass_ins_main a
		left join ass_ins_detail b
			on
				a.group_id = b.group_id
				and a.hos_id = b.hos_id
				and a.copy_code = b.copy_code
				and a.ins_id = b.ins_id 
		left join ass_no_dict c
			on
				b.group_id = c.group_id
				and b.hos_id = c.hos_id
				and b.copy_code = c.copy_code
				and b.ass_id = c.ass_id
				and b.ass_no = c.ass_no 
		LEFT JOIN HOS_DEPT_DICT hdd
			on  hdd.group_id = a.group_id
			and hdd.hos_id = a.hos_id
			and hdd.dept_id = a.dept_id
			and hdd.dept_no = a.dept_no
		LEFT JOIN HOS_FAC_DICT hfd
			on  hfd.group_id = b.group_id
			and hfd.hos_id = b.hos_id
			and hfd.fac_id = b.fac_id
			and hfd.fac_no = b.fac_no
			
		where
			a.group_id=#{group_id,jdbcType=NUMERIC}
			and a.hos_id=#{hos_id,jdbcType=NUMERIC}
			and a.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and a.ins_date  &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and a.ins_date  &lt;=to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and a.pact_code=#{pact_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and a.ven_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="ins_no != null and ins_no != ''">
				and a.ins_no like '%'||#{ins_no,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				and a.dept_id = #{dept_id}
			</if>
			<if test="state != null and state != ''">
				and a.state = #{state}
			</if>
			<if test="ass_name != null and ass_name != ''">
				and (c.ass_code like '%'|| #{ass_name}  or
					c.ass_name like '%'|| #{ass_name} ||'%' or
					c.spell_code like '%'|| to_upper(#{ass_name}) ||'%' or
					c.wbx_code like '%'|| to_upper(#{ass_name}) ||'%'
				)
			</if>
	</select>
	
	<!-- 资产采购执行汇总查询 验收链接查询 -->
	<select id="queryPactAssPurchaseFKHTMainAccept" parameterType="java.util.Map" 	resultMap="refMap">
		select a.group_id , a.hos_id , a.copy_code ,  a.accept_id , a.accept_no, a.state , a.accept_date,
			a.dept_id, a.dept_no, hdd.dept_code, hdd.dept_name, a.accept_emp , hed.emp_name ,a.accept_desc , 
			b.ass_id,b.ass_no ,	c.ass_code , c.ass_name, a.pact_code , b.ass_model  , b.ass_spec  , b.ass_brand  ,
			b.fac_id  , b. fac_no ,hfd.fac_code , hfd.fac_name , b.accept_amount, b.is_well , b.accept_desc  note   
		from ass_accept_main a
		left join ass_accept_detail b
			on
				a.group_id = b.group_id
				and a.hos_id = b.hos_id
				and a.copy_code = b.copy_code
				and a.accept_id = b.accept_id 
		left join ass_no_dict c
			on
				b.group_id = c.group_id
				and b.hos_id = c.hos_id
				and b.copy_code = c.copy_code
				and b.ass_id = c.ass_id
				and b.ass_no = c.ass_no 
		LEFT JOIN HOS_EMP_DICT hed
			on  hed.group_id = a.group_id
			and hed.hos_id = a.hos_id
			and hed.emp_id = a.accept_emp
			and hed.is_stop = 0
		LEFT JOIN HOS_DEPT_DICT hdd
			on  hdd.group_id = a.group_id
			and hdd.hos_id = a.hos_id
			and hdd.dept_id = a.dept_id
			and hdd.dept_no = a.dept_no
		LEFT JOIN HOS_FAC_DICT hfd
			on  hfd.group_id = b.group_id
			and hfd.hos_id = b.hos_id
			and hfd.fac_id = b.fac_id
			and hfd.fac_no = b.fac_no
			
		where
			a.group_id=#{group_id,jdbcType=NUMERIC}
			and a.hos_id=#{hos_id,jdbcType=NUMERIC}
			and a.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and a.accept_date  &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and a.accept_date  &lt;=to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and a.pact_code=#{pact_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and a.ven_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="accept_no != null and accept_no != ''">
				and a.accept_no like '%'||#{accept_no,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				and a.dept_id = #{dept_id}
			</if>
			<if test="state != null and state != ''">
				and a.state = #{state}
			</if>
			<if test="ass_name != null and ass_name != ''">
				and (c.ass_code like '%'|| #{ass_name}  or
					c.ass_name like '%'|| #{ass_name} ||'%' or
					c.spell_code like '%'|| to_upper(#{ass_name}) ||'%' or
					c.wbx_code like '%'|| to_upper(#{ass_name}) ||'%'
				)
			</if>
			<if test="is_well != null and is_well != ''">
				and b.is_well = #{is_well}
			</if>
	</select>
	
	<!-- 资产采购执行汇总查询 入库链接查询 -->
	<select id="queryPactAssPurchaseFKHTMainIn" parameterType="java.util.Map" 	resultMap="refMap">
		with inInfo as (<!-- 资产采购入库数据处理 -->
			select distinct tt.group_id , tt.hos_id,tt.copy_code ,tt.ass_in_no ,tt.pact_code
			from V_ASS_CARD tt
			where tt.group_id = ${group_id} and tt.hos_id = ${hos_id} 
				and tt.copy_code = ${copy_code}
		)
		SELECT  t.group_id, t.hos_id, t.copy_code,t.ass_naturs , t.ass_in_no, t.state,t.create_date,t.in_date,
			t.store_id,t.store_no,hsd.store_code ,hsd.store_name , t.dept_id,t.dept_no ,d.dept_code, d.dept_name , 
			t.invoice_no,t.invoice_date ,  t.note,a.pact_code , b.ass_id, b.ass_no , c.ass_code , c.ass_name,  
			b.ass_model  , b.ass_spec  , b.ass_brand  ,	b.fac_id  , b. fac_no ,hfd.fac_code , hfd.fac_name ,
			b.in_amount,b.price , (b.in_amount*b.price) in_money,b.reg_no, b.ass_purpose 
		
		FROM  V_ASS_IN_MAIN t 
		LEFT JOIN inInfo a
			ON 	t.GROUP_ID = a.GROUP_ID 
			AND t.HOS_ID = a.HOS_ID
			AND t.COPY_CODE = a.COPY_CODE 
			AND t.ASS_IN_NO = a.ASS_IN_NO 
		LEFT JOIN V_ASS_IN_DETAIL b
			ON 	t.GROUP_ID = b.GROUP_ID 
			AND t.HOS_ID = b.HOS_ID
			AND t.COPY_CODE = b.COPY_CODE 
			AND t.ASS_IN_NO = b.ASS_IN_NO 
		LEFT JOIN ASS_NO_DICT c
			ON 	b.GROUP_ID = c.GROUP_ID 
			AND b.HOS_ID = c.HOS_ID
			AND b.COPY_CODE = c.COPY_CODE 
			AND b.ASS_ID = c.ASS_ID 
			AND b.ASS_NO = c.ASS_NO 
		LEFT JOIN HOS_DEPT_DICT d 
			ON 	t.GROUP_ID = d.GROUP_ID 
			AND t.HOS_ID = d.HOS_ID
			AND t.DEPT_ID = d.DEPT_ID 
			AND t.DEPT_NO = d.DEPT_NO
		LEFT JOIN HOS_STORE_DICT hsd
			ON 	t.GROUP_ID = hsd.GROUP_ID 
			AND t.HOS_ID = hsd.HOS_ID
			AND t.STORE_ID = hsd.STORE_ID 
			AND t.STORE_NO = hsd.STORE_NO 
		LEFT JOIN HOS_FAC_DICT hfd
			on  hfd.group_id = b.group_id
			and hfd.hos_id = b.hos_id
			and hfd.fac_id = b.fac_id
			and hfd.fac_no = b.fac_no
		where
			t.group_id=#{group_id,jdbcType=NUMERIC}
			and t.hos_id=#{hos_id,jdbcType=NUMERIC}
			and t.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and t.create_date  &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and t.create_date  &lt;=to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and a.pact_code=#{pact_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and t.ven_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="start_date_confirm != null and start_date_confirm != '' ">
				and t.in_date  &gt;= to_date(#{start_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date_confirm != null and end_date_confirm != ''">
				and t.in_date  &lt;=to_date(#{end_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="ass_in_no != null and ass_in_no != ''">
				and t.ass_in_no like '%'||#{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="state != null and state != ''">
				and t.state = #{state}
			</if>
			<if test="ass_name != null and ass_name != ''">
				and (c.ass_code like '%'|| #{ass_name}  or
					c.ass_name like '%'|| #{ass_name} ||'%' or
					c.spell_code like '%'|| to_upper(#{ass_name}) ||'%' or
					c.wbx_code like '%'|| to_upper(#{ass_name}) ||'%'
				)
			</if>
	</select>
	
	<!-- 资产采购执行汇总查询 退货链接查询 -->
	<select id="queryPactAssPurchaseFKHTMainBack" parameterType="java.util.Map" 	resultMap="refMap">
		with backInfo as (<!-- 资产采购退货数据处理 -->
			select distinct ss.group_id , ss.hos_id,ss.copy_code ,ss.ass_back_no ,tt.pact_code
			from V_ASS_BACK_DETAIL ss
			left join V_ASS_CARD tt
				on  ss.group_id = tt.group_id
				and ss.hos_id = tt.hos_id
				and ss.copy_code = tt.copy_code
				and ss.ass_card_no = tt.ass_card_no
			
			where ss.group_id = ${group_id} and ss.hos_id = ${hos_id} 
				and ss.copy_code = ${copy_code}
		)
		SELECT  t.group_id, t.hos_id, t.copy_code,t.ass_naturs , t.ass_back_no, t.state,t.create_date,t.back_date,
			t.store_id,t.store_no,hsd.store_code ,hsd.store_name , t.invoice_no,t.invoice_date , t.note,
			a.pact_code , c.ass_id, c.ass_no , d.ass_code , d.ass_name,  
			c.ass_mondl ass_model  , c.ass_spec  , c.ass_brand  ,	c.fac_id  , c. fac_no ,hfd.fac_code , hfd.fac_name ,
			count(c.ass_card_no) back_amount
		
		FROM  V_ASS_BACK_MAIN t 
		LEFT JOIN HOS_STORE_DICT hsd
			ON 	t.GROUP_ID = hsd.GROUP_ID 
			AND t.HOS_ID = hsd.HOS_ID
			AND t.STORE_ID = hsd.STORE_ID 
			AND t.STORE_NO = hsd.STORE_NO 
		LEFT JOIN backInfo a
			ON 	t.GROUP_ID = a.GROUP_ID 
			AND t.HOS_ID = a.HOS_ID
			AND t.COPY_CODE = a.COPY_CODE 
			AND t.ASS_BACK_NO = a.ASS_BACK_NO 
		LEFT JOIN v_ass_back_detail b
			ON 	t.GROUP_ID = b.GROUP_ID 
			AND t.HOS_ID = b.HOS_ID
			AND t.COPY_CODE = b.COPY_CODE 
			AND t.ASS_BACK_NO = b.ASS_BACK_NO 
		LEFT JOIN V_ASS_CARD c
			ON 	b.GROUP_ID = c.GROUP_ID 
			AND b.HOS_ID = c.HOS_ID
			AND b.COPY_CODE = c.COPY_CODE 
			AND b.ASS_CARD_NO = c.ASS_CARD_NO 
		LEFT JOIN ASS_NO_DICT d
			ON 	d.GROUP_ID = c.GROUP_ID 
			AND d.HOS_ID = c.HOS_ID
			AND d.COPY_CODE = c.COPY_CODE 
			AND d.ASS_ID = c.ASS_ID 
			AND d.ASS_NO = c.ASS_NO
		LEFT JOIN HOS_FAC_DICT hfd
			on  hfd.group_id = c.group_id
			and hfd.hos_id = c.hos_id
			and hfd.fac_id = c.fac_id
			and hfd.fac_no = c.fac_no
		where
			t.group_id=#{group_id,jdbcType=NUMERIC}
			and t.hos_id=#{hos_id,jdbcType=NUMERIC}
			and t.copy_code=#{copy_code,jdbcType=VARCHAR}
			<if test="start_date != null and start_date != '' ">
				and t.create_date  &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and t.create_date  &lt;=to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and a.pact_code=#{pact_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and t.ven_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="start_date_confirm != null and start_date_confirm != '' ">
				and t.back_date  &gt;= to_date(#{start_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date_confirm != null and end_date_confirm != ''">
				and t.back_date  &lt;=to_date(#{end_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="ass_back_no != null and ass_back_no != ''">
				and t.ass_back_no like '%'||#{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="state != null and state != ''">
				and t.state = #{state}
			</if>
			<if test="ass_name != null and ass_name != ''">
				and (d.ass_code like '%'|| #{ass_name}  or
					d.ass_name like '%'|| #{ass_name} ||'%' or
					d.spell_code like '%'|| to_upper(#{ass_name}) ||'%' or
					d.wbx_code like '%'|| to_upper(#{ass_name}) ||'%'
				)
			</if>
	</select>
	
	
	<!-- @@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
	<!-- 资产采购应付款明细 查询 -->
	<select id="queryPactAssetPurchasePayMD" parameterType="java.util.Map" 	resultMap="refMap" >
		select 
	        ppf.pact_code ,pmf.pact_name ,pmf.sign_date ,pmf.sup_id  ,hs.sup_name
	        ,pmf.pact_money,ppf.pay_id ,ppf.pay_type 
	        ,case ppf.pay_type when 1 then '全款'   when 2 then '预付款'    when 3 then '期款'  when 4 then '尾款' end pay_type_name
	        ,ppf.summary  ,ppf.pay_cond,ppc.cond_name  ,ppf.pay_date  ,ppf.plan_money 
	        ,apbm.bill_money kpje ,(ppf.plan_money-apbm.bill_money) wkpje
	        ,appm.pay_money  fkje  ,(ppf.plan_money-appm.pay_money) ykqwfk
			from pact_plan_fkht ppf
			LEFT JOIN pact_main_fkht pmf
				on  ppf.group_id = pmf.group_id
				and ppf.hos_id = pmf.hos_id
				and ppf.copy_code = pmf.copy_code
				and ppf.pact_code = pmf.pact_code
			LEFT JOIN pact_pay_cond ppc
				on  ppf.group_id = ppc.group_id
				and ppf.hos_id = ppc.hos_id
				and ppf.copy_code = ppc.copy_code
				and ppf.pay_cond = ppc.cond_code
	            and ppc.is_stop = 0           
			LEFT JOIN hos_sup hs
				ON  ppf.group_id = hs.group_id 
				AND ppf.hos_id = hs.hos_id 
				AND pmf.sup_id = hs.sup_id 
	        LEFT JOIN ass_pre_bill_main apbm
				on  ppf.group_id = apbm.group_id 
				and ppf.hos_id = apbm.hos_id 
				and ppf.copy_code = apbm.copy_code
	            and apbm.pact_code =  pmf.pact_code
	        LEFT JOIN ass_pre_pay_detail appd
	            on  ppf.group_id = appd.group_id 
				and ppf.hos_id = appd.hos_id 
				and ppf.copy_code = appd.copy_code
	            and apbm.bill_no = appd.bill_no
	        LEFT JOIN ass_pre_pay_main appm
	            on  ppf.group_id = appm.group_id 
				and ppf.hos_id = appm.hos_id 
				and ppf.copy_code = appm.copy_code
	            and appd.pay_no = appm.pay_no
		where
			ppf.group_id=#{group_id,jdbcType=NUMERIC}
			and ppf.hos_id=#{hos_id,jdbcType=NUMERIC}
			and ppf.copy_code=#{copy_code,jdbcType=VARCHAR}
			and ppf.pay_type=2
			<if test="start_date != null and start_date != '' ">
				and pmf.SIGN_DATE &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and pmf.SIGN_DATE &lt;= to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_type_code != null and pact_type_code != ''">
				and pmf.pact_type_code=#{pact_type_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and pmf.sup_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="planPay_start_date != null and planPay_start_date != '' ">
				and ppf.pay_date &gt;= to_date(#{planPay_start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="planPay_end_date != null and planPay_end_date != ''">
				and ppf.pay_date &lt;= to_date(#{planPay_end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and pmf.pact_code like '%'|| upper(#{pact_code,jdbcType=VARCHAR})
			</if>
			<if test="pact_name != null and pact_name != ''">
				and pmf.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
			</if>
			<if test="sign_dept != null and sign_dept != ''">
				and pmf.dept_id = #{sign_dept}
			</if>
			<if test="state_code != null and state_code != ''">
				and pmf.state_code = #{state_code}
			</if>		    
  		UNION ALL
  		select 
	        ppf.pact_code ,pmf.pact_name ,pmf.sign_date ,pmf.sup_id  ,hs.sup_name
	        ,pmf.pact_money,ppf.pay_id ,ppf.pay_type 
	        ,case ppf.pay_type when 1 then '全款'   when 2 then '预付款'    when 3 then '期款'  when 4 then '尾款' end pay_type_name
	        ,ppf.summary  ,ppf.pay_cond,ppc.cond_name  ,ppf.pay_date  ,ppf.plan_money 
	        ,abm.bill_money kpje ,(ppf.plan_money-abm.bill_money) wkpje
	        ,apm.pay_money  fkje  ,(ppf.plan_money-apm.pay_money) ykqwfk
	        from pact_plan_fkht ppf  
			LEFT JOIN pact_main_fkht pmf
				on  ppf.group_id = pmf.group_id
				and ppf.hos_id = pmf.hos_id
				and ppf.copy_code = pmf.copy_code
				and ppf.pact_code = pmf.pact_code
			LEFT JOIN pact_pay_cond ppc
				on  ppf.group_id = ppc.group_id
				and ppf.hos_id = ppc.hos_id
				and ppf.copy_code = ppc.copy_code
				and ppf.pay_cond = ppc.cond_code
	            and ppc.is_stop = 0           
			LEFT JOIN hos_sup hs
				ON  ppf.group_id = hs.group_id 
				AND ppf.hos_id = hs.hos_id 
				AND pmf.sup_id = hs.sup_id 
	        LEFT JOIN ass_bill_main abm
				on  ppf.group_id = abm.group_id 
				and ppf.hos_id = abm.hos_id 
				and ppf.copy_code = abm.copy_code
	            and pmf.pact_code =  abm.pact_code 
	     LEFT JOIN ass_pay_detail apd
	            on  ppf.group_id = apd.group_id 
				and ppf.hos_id = apd.hos_id 
				and ppf.copy_code = apd.copy_code
	            and abm.bill_no = apd.bill_no     
	      LEFT JOIN ass_pay_main apm
	            on  ppf.group_id = apm.group_id 
				and ppf.hos_id = apm.hos_id 
				and ppf.copy_code = apm.copy_code
	            and apd.pay_no = apm.pay_no
		where
			ppf.group_id=#{group_id,jdbcType=NUMERIC}
			and ppf.hos_id=#{hos_id,jdbcType=NUMERIC}
			and ppf.copy_code=#{copy_code,jdbcType=VARCHAR}
			and ppf.pay_type!=2
			<if test="start_date != null and start_date != '' ">
				and pmf.SIGN_DATE &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="end_date != null and end_date != ''">
				and pmf.SIGN_DATE &lt;= to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_type_code != null and pact_type_code != ''">
				and pmf.pact_type_code=#{pact_type_code,jdbcType=VARCHAR}
			</if>
			<if test="sup_id != null and sup_id != ''">
				and pmf.sup_id=#{sup_id,jdbcType=VARCHAR}
			</if>
			<if test="planPay_start_date != null and planPay_start_date != '' ">
				and ppf.pay_date &gt;= to_date(#{planPay_start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
			</if>
			<if test="planPay_end_date != null and planPay_end_date != ''">
				and ppf.pay_date &lt;= to_date(#{planPay_end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
			</if>
			<if test="pact_code != null and pact_code != ''">
				and pmf.pact_code like '%'|| upper(#{pact_code,jdbcType=VARCHAR})
			</if>
			<if test="pact_name != null and pact_name != ''">
				and pmf.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
			</if>
			<if test="sign_dept != null and sign_dept != ''">
				and pmf.dept_id = #{sign_dept}
			</if>
			<if test="state_code != null and state_code != ''">
				and pmf.state_code = #{state_code}
			</if>          
	</select>
	
	<!-- 资产采购应付款 -->
	<select id="queryPactAssetPurchasePay" parameterType="java.util.Map" resultType="java.util.Map">
		select 
		    pmf.pact_code  ,pmf.pact_name  ,pmf.trade_type  ,pmf.sign_date ,pmf.dept_id ,pmf.pact_money htje
		    ,pda.value_name mylb  ,pda.value_code    
		    ,hsd.sup_name ,hsd.sup_id 
		    ,hdd.dept_name ks  ,hdd.dept_id ks_id
		    ,abm.bill_money b ,apbm.bill_money pb ,apm.pay_money p ,appm.pay_money pp
		    ,(abm.bill_money+apbm.bill_money) kpje
		    ,(pmf.pact_money-abm.bill_money-apbm.bill_money) wkpje
		    ,(apm.pay_money+appm.pay_money) fkje
		    ,(abm.bill_money+apbm.bill_money-apm.pay_money-appm.pay_money) ykpwfk
	    from pact_main_fkht pmf
		LEFT JOIN pact_dict_data pda
		    on pda.value_code = pmf.trade_type
		    and pda.f_code='TRADE_TYPE'
		LEFT JOIN hos_sup hsd
		    on hsd.group_id = pmf.group_id
		    and hsd.hos_id = pmf.hos_id
		    AND hsd.sup_id = pmf.sup_id 
		LEFT JOIN hos_dept hdd
		    on hdd.group_id = pmf.group_id
		    and hdd.hos_id = pmf.hos_id
		    AND hdd.dept_id = pmf.dept_id 
		LEFT JOIN ass_bill_main abm
		    on abm.group_id = pmf.group_id
		    and abm.hos_id = pmf.hos_id
		    and abm.copy_code = pmf.copy_code
		    and abm.pact_code = pmf.pact_code
		LEFT JOIN ass_pre_bill_main apbm
		    on apbm.group_id = pmf.group_id
		    and apbm.hos_id = pmf.hos_id
		    and apbm.copy_code = pmf.copy_code
		    and abm.pact_code = pmf.pact_code
		LEFT JOIN ass_pay_detail apd
		    on apd.group_id = pmf.group_id
		    and apd.hos_id = pmf.hos_id
		    and apd.copy_code = pmf.copy_code
		    and apd.bill_no = abm.bill_no
		LEFT JOIN ass_pay_main apm
		    on apm.group_id = pmf.group_id
		    and apm.hos_id = pmf.hos_id
		    and apm.copy_code = pmf.copy_code
		    and apm.pay_no= apd.pay_no
		LEFT JOIN ass_pre_pay_detail appd
		    on appd.group_id = pmf.group_id
		    and appd.hos_id = pmf.hos_id
		    and appd.copy_code = pmf.copy_code
		    and appd.bill_no = apbm.bill_no
		LEFT JOIN ass_pre_pay_main appm
		    on appd.group_id = pmf.group_id
		    and appd.hos_id = pmf.hos_id
		    and appd.copy_code = pmf.copy_code
		    and appd.pay_no= appd.pay_no
		where
			pmf.group_id=#{group_id,jdbcType=NUMERIC}
		    and pmf.hos_id=#{hos_id,jdbcType=NUMERIC}
		    and pmf.copy_code=#{copy_code,jdbcType=VARCHAR}
		    <if test="start_date != null and start_date != '' ">
		        and pmf.SIGN_DATE &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
		    </if>
		    <if test="end_date != null and end_date != ''">
		        and pmf.SIGN_DATE &lt;= to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
		    </if>
		    <if test="pact_type_code != null and pact_type_code != ''">
		        and pmf.pact_type_code=#{pact_type_code,jdbcType=VARCHAR}
		    </if>    
		    <if test="sup_id != null and sup_id != ''">
		        and pmf.sup_id=#{sup_id,jdbcType=VARCHAR}
		    </if>
			<if test="min_money != null and min_money != '' ">
		        and pmf.bill_money &gt;=  #{min_money} 
		    </if>
		    <if test="max_money != null and max_money != ''">
		        and pmf.bill_money &lt;= #{max_money}
		    </if>   
		    <if test="pact_code != null and pact_code != ''">
		        and pmf.pact_code like '%'|| upper(#{pact_code,jdbcType=VARCHAR})
		    </if>
		    <if test="pact_name != null and pact_name != ''">
		        and pmf.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
		    </if>
		    <if test="trade_type != null and trade_type != ''">
		        and pmf.trade_type=#{trade_type,jdbcType=VARCHAR}
		    </if>
		    <if test="sign_dept != null and sign_dept != ''">
		        and pmf.dept_id=#{sign_dept,jdbcType=VARCHAR}
		    </if>
		    <if test="state_code != null and state_code != ''">
		        and pmf.state_code=#{state_code,jdbcType=VARCHAR}
		    </if>
	</select>
	
	<!-- 付款记录 -->
	<select id="queryPactAssetPurchasePayPay" parameterType="java.util.Map" resultType="java.util.Map">
		with auditname as(
		    select he.emp_id  ,he.emp_name
		    from ${pm} apm
		    LEFT JOIN hos_emp he
			on he.group_id = apm.group_id
		    and he.hos_id = apm.hos_id
		    and he.emp_id = apm.audit_emp
		    where apm.group_id=#{group_id,jdbcType=NUMERIC}
		    and apm.hos_id=#{hos_id,jdbcType=NUMERIC}
		    and apm.copy_code=#{copy_code,jdbcType=VARCHAR}
		),
		createname as(
		    select he.emp_id  ,he.emp_name
		    from ${pm} apm
		    LEFT JOIN hos_emp he
		    on he.group_id = apm.group_id
		    and he.hos_id = apm.hos_id
		    and he.emp_id = apm.create_emp
			where apm.group_id=#{group_id,jdbcType=NUMERIC}
		    and apm.hos_id=#{hos_id,jdbcType=NUMERIC}
		    and apm.copy_code=#{copy_code,jdbcType=VARCHAR}
		)
		select
			apm.pay_no ,apm.note ,apm.pay_date ,apm.audit_emp jbr  ,apm.pay_money 
		    ,apm.create_emp ,apm.create_date ,apm.audit_emp ,apm.audit_date  ,apm.state , apm.state djType
		    ,auditname.emp_name audit_emp_name  ,auditname.emp_id audit_emp_id
			,createname.emp_name create_emp_name  ,createname.emp_id create_emp_id
		    ,abm.bill_no ,abm.invoice_no ,abm.bill_money 
		from ${pm} apm 
		LEFT JOIN auditname
			on apm.audit_emp = auditname.emp_id
		LEFT JOIN createname
			on apm.create_emp = createname.emp_id
		LEFT JOIN ${pd} apd
			on apd.group_id = apm.group_id
		 	and apd.hos_id = apm.hos_id
		 	and apd.copy_code = apm.copy_code
		 	and apd.pay_no = apm.pay_no
		LEFT JOIN ${bm} abm
			on abm.group_id = apm.group_id
			and abm.hos_id = apm.hos_id
			and abm.copy_code = apm.copy_code
			and abm.bill_no = apd.bill_no
		LEFT JOIN pact_main_fkht pmf
			on  pmf.group_id = apm.group_id
			and pmf.hos_id = apm.hos_id
			and pmf.copy_code = apm.copy_code
			and pmf.pact_code = abm.pact_code
		LEFT JOIN hos_sup hsd
		    on hsd.group_id = apm.group_id
		    and hsd.hos_id = apm.hos_id 
		    and hsd.sup_id = apm.ven_id	
		where	
			pmf.group_id=#{group_id,jdbcType=NUMERIC}
		    and pmf.hos_id=#{hos_id,jdbcType=NUMERIC}
		    and pmf.copy_code=#{copy_code,jdbcType=VARCHAR}
		    and pmf.pact_code=#{pact_code,jdbcType=VARCHAR}
		    <if test="start_date != null and start_date != '' ">
		        and apm.pay_date &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
		    </if>
		    <if test="end_date != null and end_date != ''">
		        and apm.pay_date &lt;= to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
		    </if>
		<!-- 	
			<if test="pact_name != null and pact_name != ''">
		        and pmf.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
		    </if>    
		    <if test="sup_name != null and sup_name != ''">
		        and hsd.sup_name like '%'||#{sup_name,jdbcType=VARCHAR}||'%'
		    </if>
		-->
		     <if test="start_date_confirm != null and start_date_confirm != '' ">
		        and apm.audit_date &gt;= to_date(#{start_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
		    </if>
		    <if test="end_date_confirm != null and end_date_confirm != ''">
		        and apm.audit_date &lt;= to_date(#{end_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd')
		    </if>
			<if test="pay_no != null and pay_no != ''">
		        and apm.pay_no like '%'||#{pay_no,jdbcType=VARCHAR}||'%'
		    </if>
			<if test="invoice_no != null and invoice_no != ''">
		        and abm.invoice_no like '%'||#{invoice_no,jdbcType=VARCHAR}||'%'
		    </if>
			<!--  单据类型
			<if test="pay_type != null and pay_type != ''">
		        and apm.pay_type = #{pay_type,jdbcType=VARCHAR}
		    </if> 
		    -->
			<if test="pay_state != null and pay_state != ''">
		        and apm.state = #{pay_state,jdbcType=VARCHAR}
		    </if>
	</select>
	
	<!-- 发票记录 -->
	<select id="queryPactAssetPurchasePayBill" parameterType="java.util.Map" resultType="java.util.Map">
		with auditname as(
		    select he.emp_id  ,he.emp_name
		    from ${bm}  abm
		    LEFT JOIN hos_emp he
			on he.group_id = abm.group_id
		    and he.hos_id = abm.hos_id
		    and he.emp_id = abm.audit_emp
		    where abm.group_id=#{group_id,jdbcType=NUMERIC}
		    and abm.hos_id=#{hos_id,jdbcType=NUMERIC}
		    and abm.copy_code=#{copy_code,jdbcType=VARCHAR}
		),
		createname as(
		    select he.emp_id  ,he.emp_name
		    from ${bm} abm
		    LEFT JOIN hos_emp he
		    on he.group_id = abm.group_id
		    and he.hos_id = abm.hos_id
		    and he.emp_id = abm.create_emp
			where abm.group_id=#{group_id,jdbcType=NUMERIC}
		    and abm.hos_id=#{hos_id,jdbcType=NUMERIC}
		    and abm.copy_code=#{copy_code,jdbcType=VARCHAR}
		)
		select 
			abm.bill_no ,abm.bill_date ,abm.invoice_no ,abm.note ,abm.bill_money 
			,abm.create_date ,abm.create_emp ,abm.audit_date ,abm.audit_emp
			,auditname.emp_name audit_emp_name  ,auditname.emp_id audit_emp_id
			,createname.emp_name create_emp_name  ,createname.emp_id create_emp_id
			, abm.state  ,abm.state dklx  
		from ${bm} abm 
		LEFT JOIN auditname
			on abm.audit_emp = auditname.emp_id
		LEFT JOIN createname
			on abm.create_emp = createname.emp_id
		LEFT JOIN pact_main_fkht pmf
		    on  pmf.group_id = abm.group_id
		    and pmf.hos_id = abm.hos_id
		    and pmf.copy_code = abm.copy_code
		    and pmf.pact_code = abm.pact_code
		LEFT JOIN hos_sup hsd
		    on hsd.group_id = abm.group_id
		    and hsd.hos_id = abm.hos_id 
		    and hsd.sup_id = abm.ven_id	    
		where 
			abm.group_id=#{group_id,jdbcType=NUMERIC}
		    and abm.hos_id=#{hos_id,jdbcType=NUMERIC}
		    and abm.copy_code=#{copy_code,jdbcType=VARCHAR}
		    <if test="start_date != null and start_date != '' ">
		        and abm.bill_date &gt;= to_date(#{start_date,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
		    </if>
		    <if test="end_date != null and end_date != ''">
		        and abm.bill_date &lt;= to_date(#{end_date,jdbcType=TIMESTAMP},'yyyy-MM-dd')
		    </if>
			<if test="pact_name != null and pact_name != ''">
		        and pmf.pact_name like '%'||#{pact_name,jdbcType=VARCHAR}||'%'
		    </if>    
		    <if test="sup_name != null and sup_name != ''">
		        and hsd.sup_name like '%'||#{sup_name,jdbcType=VARCHAR}||'%'
		    </if>	
			<if test="start_date_confirm != null and start_date_confirm != '' ">
		        and abm.audit_date &gt;= to_date(#{start_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd') 
		    </if>
		    <if test="end_date_confirm != null and end_date_confirm != ''">
		        and abm.audit_date &lt;= to_date(#{end_date_confirm,jdbcType=TIMESTAMP},'yyyy-MM-dd')
		    </if>
			<if test="invoice_no != null and invoice_no != ''">
		        and abm.invoice_no like '%'||#{invoice_no,jdbcType=VARCHAR}||'%'
		    </if>
			<if test="pay_state != null and pay_state != ''">
		        and apm.state = #{pay_state,jdbcType=VARCHAR}
		    </if>
			<!--  单据类型
			<if test="pay_type != null and pay_type != ''">
		        and apm.pay_type = #{pay_type,jdbcType=VARCHAR}
		    </if> 
		    -->
	</select>


</mapper>