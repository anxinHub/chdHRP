<?xml version="1.0" encoding="UTF-8" ?>
<root>

	<sql id="rf_acc_ncye_ck" type="fun" desc="取辅助账科目年初余额"><![CDATA[
	    /*-------------------------------------------------------------------------
   || 函数名称 ：RF_ACC_NCYE_CK
   || 功能描述 ：取辅助账科目年初余额
   || 参数描述 ：参数标识          名称             输入/输出    类型
   ||            -------------------------------------------------------------
   ||            prm_group_id       集团             IN           NUMBER
   ||            prm_hos_id         医院             IN           NUMBER
   ||            prm_copy_code      账套             IN           VARCHAR2
   ||            prm_acc_year       年度             IN           VARCHAR2
   ||            prm_cur            币种:RMB/USB     IN           VARCHAR2  
   ||            prm_subj_code      会计科目         IN           VARCHAR2
   ||            prm_check_type     核算类           IN           VARCHAR2
   ||            prm_check_item     核算项           IN           VARCHAR2 
   ||
   || 返 回 值 ：                   辅助项余额       OUT          NUMBER
   ||
   || 作    者 ：           完成日期 ：
   ||-------------------------------------------------------------------------
   || 修改记录 ：           修改日期：
   ||-------------------------------------------------------------------------*/
  CREATE OR REPLACE FUNCTION RF_ACC_NCYE_CK( prm_group_id       IN    NUMBER        --集团
                                            ,prm_hos_id         IN    NUMBER        --医院
                                            ,prm_copy_code      IN    VARCHAR2      --帐套
                                            ,prm_acc_year       IN    VARCHAR2      --年度
                                            ,prm_cur            IN    VARCHAR2      --币种  RMB/USB
                                            ,prm_subj_code      IN    VARCHAR2      --科目编码
                                            ,prm_check_type     IN    VARCHAR2      --核算类
                                            ,prm_check_item     IN    VARCHAR2      --核算项
                                            ) RETURN NUMBER
  IS
    n_count           integer:= 0 ;
    n_ret             NUMBER(19,6);

    v_CHECK_TYPE_ID   ACC_CHECK_TYPE.Check_Type_Id%type;
    v_column_check    ACC_CHECK_TYPE.Column_Check%type;
    v_sql             varchar2(4000);


  BEGIN
    --初始化变量
    n_ret          :=  0 ;

    v_CHECK_TYPE_ID := 0       ;
    v_column_check  := 'CHECK1';
    v_sql           := ''      ;


    --检查辅助核算类表是否存在数据
    SELECT count(1)
      into n_count
      FROM ACC_CHECK_TYPE
     WHERE group_id        = prm_group_id
       AND hos_id          = prm_hos_id
       AND copy_code       = prm_copy_code
       AND check_type_name = prm_check_type
       AND  is_stop        = 0;

    if n_count = 0 then
       return 0;
    else
       n_count := 0 ;
    end if;

    --获取核算类对应的列
    SELECT CHECK_TYPE_ID,Column_Check
      into v_CHECK_TYPE_ID,v_column_check
      FROM ACC_CHECK_TYPE
     WHERE group_id        = prm_group_id
       AND hos_id          = prm_hos_id
       AND copy_code       = prm_copy_code
       AND check_type_name = prm_check_type
       AND  is_stop        = 0
      ;

      if prm_cur = 'RMB' then    --币种为RMB
          if v_column_check = 'CHECK1' then  --部门
              select nvl(sum(t1.bal_os), 0)
                into n_ret
                from acc_leder_check t1             
               left join hos_dept_dict t3
                  on t1.check1_id = t3.dept_id
                 and t1.CHECK1_NO = t3.dept_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year 
                 and t1.acc_month      = '00' 
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.dept_code      = prm_check_item;

         elsif v_column_check = 'CHECK2' then --职工
              select nvl(sum(t1.bal_os), 0)
                into n_ret
                from acc_leder_check t1              
               left join hos_emp_dict t3
                  on t1.check2_id = t3.emp_id
                 and t1.check1_no = t3.emp_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.emp_code       = prm_check_item;

         elsif v_column_check = 'CHECK3' then --项目
              select nvl(sum(t1.bal_os), 0)
                into n_ret
                from acc_leder_check t1              
               left join hos_proj_dict t3
                  on t1.check3_id = t3.proj_id
                 and t1.check3_no = t3.proj_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.proj_code      = prm_check_item;

          elsif v_column_check = 'CHECK4' then --库房
              select nvl(sum(t1.bal_os), 0)
                into n_ret
                from acc_leder_check t1              
               left join hos_store_dict t3
                  on t1.check4_id = t3.store_id
                 and t1.check4_no = t3.store_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.store_code     = prm_check_item;

          elsif v_column_check = 'CHECK5' then --客户
              select nvl(sum(t1.bal_os), 0)
                into n_ret
                from acc_leder_check t1            
               left join HOS_CUS_DICT t3
                  on t1.check5_id = t3.cus_id
                 and t1.check5_no = t3.cus_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.Cus_Code      = prm_check_item;

         elsif v_column_check = 'CHECK6' then --供应商
              select nvl(sum(t1.bal_os), 0)
                into n_ret
                from acc_leder_check t1               
               left join HOS_SUP_DICT t3
                  on t1.check6_id = t3.sup_id
                 and t1.check6_no = t3.sup_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.sup_code       = prm_check_item;

           elsif v_column_check = 'CHECK7' then --资金来源
              select nvl(sum(t1.bal_os), 0)
                into n_ret
                from acc_leder_check t1             
               left join HOS_SOURCE t3
                  on t1.check7_id = t3.source_id
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.source_code    = prm_check_item;

           elsif v_column_check = 'CHECK8' then --单位
              select nvl(sum(t1.bal_os), 0)
                into n_ret
                from acc_leder_check t1              
               left join V_HOS_DICT t3
                  on t1.check8_id = t3.hos_id
                 and t1.group_id  = t3.group_id
			     and t3.is_stop   = 0
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.hos_code       = prm_check_item
				 and t3.is_stop        = 0;
         else    --自定义 ZCHECK1
           v_sql :='select nvl(sum(t1.bal_os), 0)
                      from acc_leder_check t1                    
                     left join ACC_CHECK_ITEM t3
                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                       and t1.group_id  = t3.group_id
                       and t1.hos_id    = t3.hos_id
                       and t1.copy_code = t3.copy_code
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                       and t1.acc_month      = ''00''
                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
              ;
              execute immediate v_sql into n_ret;
         end if;
      else  --币种为外币
          if v_column_check = 'CHECK1' then  --部门
              select nvl(sum(t1.bal_os_w), 0)
                into n_ret
                from acc_leder_check t1              
               left join hos_dept_dict t3
                  on t1.check1_id = t3.dept_id
                 and t1.CHECK1_NO = t3.dept_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.dept_code      = prm_check_item;

         elsif v_column_check = 'CHECK2' then --职工
              select nvl(sum(t1.bal_os_w), 0)
                into n_ret
                from acc_leder_check t1             
               left join hos_emp_dict t3
                  on t1.check2_id = t3.emp_id
                 and t1.check1_no = t3.emp_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.emp_code       = prm_check_item;

         elsif v_column_check = 'CHECK3' then --项目
              select nvl(sum(t1.bal_os_w), 0)
                into n_ret
                from acc_leder_check t1           
               left join hos_proj_dict t3
                  on t1.check3_id = t3.proj_id
                 and t1.check3_no = t3.proj_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.proj_code      = prm_check_item;

          elsif v_column_check = 'CHECK4' then --库房
              select nvl(sum(t1.bal_os_w), 0)
                into n_ret
                from acc_leder_check t1             
               left join hos_store_dict t3
                  on t1.check4_id = t3.store_id
                 and t1.check4_no = t3.store_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.store_code     = prm_check_item;

          elsif v_column_check = 'CHECK5' then --客户
              select nvl(sum(t1.bal_os_w), 0)
                into n_ret
                from acc_leder_check t1             
               left join HOS_CUS_DICT t3
                  on t1.check5_id = t3.cus_id
                 and t1.check5_no = t3.cus_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.Cus_Code      = prm_check_item;

         elsif v_column_check = 'CHECK6' then --供应商
              select nvl(sum(t1.bal_os_w), 0)
                into n_ret
                from acc_leder_check t1              
               left join HOS_SUP_DICT t3
                  on t1.check6_id = t3.sup_id
                 and t1.check6_no = t3.sup_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.sup_code       = prm_check_item;

           elsif v_column_check = 'CHECK7' then --资金来源
              select nvl(sum(t1.bal_os_w), 0)
                into n_ret
                from acc_leder_check t1              
               left join HOS_SOURCE t3
                  on t1.check7_id = t3.source_id
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.source_code    = prm_check_item;

           elsif v_column_check = 'CHECK8' then --单位
              select nvl(sum(t1.bal_os_w), 0)
                into n_ret
                from acc_leder_check t1            
               left join V_HOS_DICT t3
                  on t1.check8_id = t3.hos_id
                 and t1.group_id  = t3.group_id
			     and t3.is_stop   = 0
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.hos_code       = prm_check_item
				 and t3.is_stop        = 0;
         else    --自定义 ZCHECK1
           v_sql :='select nvl(sum(t1.bal_os_w), 0)
                      from acc_leder_check t1                    
                     left join ACC_CHECK_ITEM t3
                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                       and t1.group_id  = t3.group_id
                       and t1.hos_id    = t3.hos_id
                       and t1.copy_code = t3.copy_code
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                       and t1.acc_month      = ''00''
                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
              ;
              execute immediate v_sql into n_ret;
         end if;
    end if;

    return n_ret;

  EXCEPTION
      WHEN NO_DATA_FOUND THEN
         return 0;
      WHEN OTHERS THEN
         return 0;
  END RF_ACC_NCYE_CK;
	 
	
	]]></sql>
	
	<sql id="rf_acc_qmye_ck" type="fun" desc="取辅助账科目余额"><![CDATA[
	    /*-------------------------------------------------------------------------
   || 函数名称 ：RF_ACC_QMYE_CK
   || 功能描述 ：取辅助核算期末余额
   || 参数描述 ：参数标识          名称             输入/输出    类型
   ||            -------------------------------------------------------------
   ||            prm_group_id       集团             IN           NUMBER
   ||            prm_hos_id         医院             IN           NUMBER
   ||            prm_copy_code      账套             IN           VARCHAR2
   ||            prm_acc_year       年度             IN           VARCHAR2
   ||            prm_acc_month      月份             IN           VARCHAR2
   ||            prm_subj_code      会计科目         IN           VARCHAR2
   ||            prm_check_type     核算类           IN           VARCHAR2
   ||            prm_check_item     核算项           IN           VARCHAR2
   ||            prm_cur            币种:RMB/USB     IN           VARCHAR2   
   ||            prm_con_acc        是否包含未记账   IN           NUMBER
   ||
   || 返 回 值 ：                   辅助项余额       OUT          NUMBER
   ||
   || 作    者 ：           完成日期 ：
   ||-------------------------------------------------------------------------
   || 修改记录 ：           修改日期：
   ||-------------------------------------------------------------------------*/
  CREATE OR REPLACE FUNCTION RF_ACC_QMYE_CK( prm_group_id       IN    NUMBER        --集团
                                            ,prm_hos_id         IN    NUMBER        --医院
                                            ,prm_copy_code      IN    VARCHAR2      --帐套
                                            ,prm_acc_year       IN    VARCHAR2      --年度
                                            ,prm_acc_month      IN    VARCHAR2      --月份
                                            ,prm_subj_code      IN    VARCHAR2      --科目编码
                                            ,prm_check_type     IN    VARCHAR2      --核算类
                                            ,prm_check_item     IN    VARCHAR2      --核算项
                                            ,prm_cur            IN    VARCHAR2      --币种  RMB/USB
                                            ,prm_con_acc        IN    NUMBER        --是否包括未记账 0:不包含未记账  1:包含未记账
                                            ) RETURN NUMBER
  IS
    n_init_money      NUMBER(19,6);  --初始余额
    n_period_money    NUMBER(19,6);  --累计发生额
    n_count           integer:= 0 ;
    n_ret             NUMBER(19,6);
    n_dire            acc_subj.subj_dire%type;

    v_CHECK_TYPE_ID   ACC_CHECK_TYPE.Check_Type_Id%type;
    v_column_check    ACC_CHECK_TYPE.Column_Check%type;
    v_sql             varchar2(4000);


  BEGIN
    --初始化变量
    n_init_money   :=  0 ;
    n_period_money :=  0 ;
    n_ret          :=  0 ;
    n_dire         :=  0 ; -- 0:借方 ,1:贷方

    v_CHECK_TYPE_ID := 0       ;
    v_column_check  := 'CHECK1';
    v_sql           := ''      ;


    --检查辅助核算类表是否存在数据
    SELECT count(1)
      into n_count
      FROM ACC_CHECK_TYPE
     WHERE group_id        = prm_group_id
       AND hos_id          = prm_hos_id
       AND copy_code       = prm_copy_code
       AND check_type_name = prm_check_type
       AND  is_stop        = 0;

    if n_count = 0 then
       return 0;
    else
       n_count := 0 ;
    end if;

    --获取核算类对应的列
    SELECT CHECK_TYPE_ID,Column_Check
      into v_CHECK_TYPE_ID,v_column_check
      FROM ACC_CHECK_TYPE
     WHERE group_id        = prm_group_id
       AND hos_id          = prm_hos_id
       AND copy_code       = prm_copy_code
       AND check_type_name = prm_check_type
       AND  is_stop        = 0
      ;

    if prm_con_acc = 0 then      --从帐表中获取
      if prm_cur = 'RMB' then    --币种为RMB
          if v_column_check = 'CHECK1' then  --部门
              select nvl(sum(t1.end_os), 0)
                into n_ret
                from acc_leder_check t1             
               left join hos_dept_dict t3
                  on t1.check1_id = t3.dept_id
                 and t1.CHECK1_NO = t3.dept_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.dept_code      = prm_check_item;

         elsif v_column_check = 'CHECK2' then --职工
              select nvl(sum(t1.end_os), 0)
                into n_ret
                from acc_leder_check t1              
               left join hos_emp_dict t3
                  on t1.check2_id = t3.emp_id
                 and t1.check1_no = t3.emp_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.emp_code       = prm_check_item;

         elsif v_column_check = 'CHECK3' then --项目
              select nvl(sum(t1.end_os), 0)
                into n_ret
                from acc_leder_check t1              
               left join hos_proj_dict t3
                  on t1.check3_id = t3.proj_id
                 and t1.check3_no = t3.proj_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.proj_code      = prm_check_item;

          elsif v_column_check = 'CHECK4' then --库房
              select nvl(sum(t1.end_os), 0)
                into n_ret
                from acc_leder_check t1              
               left join hos_store_dict t3
                  on t1.check4_id = t3.store_id
                 and t1.check4_no = t3.store_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.store_code     = prm_check_item;

          elsif v_column_check = 'CHECK5' then --客户
              select nvl(sum(t1.end_os), 0)
                into n_ret
                from acc_leder_check t1            
               left join HOS_CUS_DICT t3
                  on t1.check5_id = t3.cus_id
                 and t1.check5_no = t3.cus_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.Cus_Code      = prm_check_item;

         elsif v_column_check = 'CHECK6' then --供应商
              select nvl(sum(t1.end_os), 0)
                into n_ret
                from acc_leder_check t1               
               left join HOS_SUP_DICT t3
                  on t1.check6_id = t3.sup_id
                 and t1.check6_no = t3.sup_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.sup_code       = prm_check_item;

           elsif v_column_check = 'CHECK7' then --资金来源
              select nvl(sum(t1.end_os), 0)
                into n_ret
                from acc_leder_check t1             
               left join HOS_SOURCE t3
                  on t1.check7_id = t3.source_id
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.source_code    = prm_check_item;

           elsif v_column_check = 'CHECK8' then --单位
              select nvl(sum(t1.end_os), 0)
                into n_ret
                from acc_leder_check t1              
               left join V_HOS_DICT t3
                  on t1.check8_id = t3.hos_id
                 and t1.group_id  = t3.group_id
			     and t3.is_stop   = 0
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.hos_code       = prm_check_item
				 and t3.is_stop        = 0;
         else    --自定义 ZCHECK1
           v_sql :='select nvl(sum(t1.end_os), 0)
                      from acc_leder_check t1                    
                     left join ACC_CHECK_ITEM t3
                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                       and t1.group_id  = t3.group_id
                       and t1.hos_id    = t3.hos_id
                       and t1.copy_code = t3.copy_code
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                       and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
              ;
              execute immediate v_sql into n_ret;
         end if;
      else  --币种为外币
          if v_column_check = 'CHECK1' then  --部门
              select nvl(sum(t1.end_os_w), 0)
                into n_ret
                from acc_leder_check t1              
               left join hos_dept_dict t3
                  on t1.check1_id = t3.dept_id
                 and t1.CHECK1_NO = t3.dept_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.dept_code      = prm_check_item;

         elsif v_column_check = 'CHECK2' then --职工
              select nvl(sum(t1.end_os_w), 0)
                into n_ret
                from acc_leder_check t1             
               left join hos_emp_dict t3
                  on t1.check2_id = t3.emp_id
                 and t1.check1_no = t3.emp_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.emp_code       = prm_check_item;

         elsif v_column_check = 'CHECK3' then --项目
              select nvl(sum(t1.end_os_w), 0)
                into n_ret
                from acc_leder_check t1           
               left join hos_proj_dict t3
                  on t1.check3_id = t3.proj_id
                 and t1.check3_no = t3.proj_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.proj_code      = prm_check_item;

          elsif v_column_check = 'CHECK4' then --库房
              select nvl(sum(t1.end_os_w), 0)
                into n_ret
                from acc_leder_check t1             
               left join hos_store_dict t3
                  on t1.check4_id = t3.store_id
                 and t1.check4_no = t3.store_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.store_code     = prm_check_item;

          elsif v_column_check = 'CHECK5' then --客户
              select nvl(sum(t1.end_os_w), 0)
                into n_ret
                from acc_leder_check t1             
               left join HOS_CUS_DICT t3
                  on t1.check5_id = t3.cus_id
                 and t1.check5_no = t3.cus_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.Cus_Code      = prm_check_item;

         elsif v_column_check = 'CHECK6' then --供应商
              select nvl(sum(t1.end_os_w), 0)
                into n_ret
                from acc_leder_check t1              
               left join HOS_SUP_DICT t3
                  on t1.check6_id = t3.sup_id
                 and t1.check6_no = t3.sup_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.sup_code       = prm_check_item;

           elsif v_column_check = 'CHECK7' then --资金来源
              select nvl(sum(t1.end_os_w), 0)
                into n_ret
                from acc_leder_check t1              
               left join HOS_SOURCE t3
                  on t1.check7_id = t3.source_id
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.source_code    = prm_check_item;

           elsif v_column_check = 'CHECK8' then --单位
              select nvl(sum(t1.end_os_w), 0)
                into n_ret
                from acc_leder_check t1            
               left join V_HOS_DICT t3
                  on t1.check8_id = t3.hos_id
                 and t1.group_id  = t3.group_id
			     and t3.is_stop   = 0
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = prm_acc_month
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.hos_code       = prm_check_item
				 and t3.is_stop        = 0;
         else    --自定义 ZCHECK1
           v_sql :='select nvl(sum(t1.end_os_w), 0)
                      from acc_leder_check t1                    
                     left join ACC_CHECK_ITEM t3
                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                       and t1.group_id  = t3.group_id
                       and t1.hos_id    = t3.hos_id
                       and t1.copy_code = t3.copy_code
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                       and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
              ;
              execute immediate v_sql into n_ret;
         end if;
      end if;
    else    --从凭证中获取

       --默认为上级科目余额与下级科目余额方向一致
       select nvl(subj_dire,0)   --没有维护默认借方
         into n_dire
         from acc_subj
        where group_id  = prm_group_id
          and hos_id    = prm_hos_id
          and copy_code = prm_copy_code
          and acc_year  = prm_acc_year
          and subj_code = prm_subj_code;

      if prm_cur = 'RMB' then    --币种为RMB

         if v_column_check = 'CHECK1' then  --部门
              select count(1)
                into n_count
                from acc_leder_check t1             
               left join hos_dept_dict t3
                  on t1.check1_id = t3.dept_id
                 and t1.CHECK1_NO = t3.dept_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.dept_code      = prm_check_item;

         elsif v_column_check = 'CHECK2' then --职工
              select count(1)
                into n_count
                from acc_leder_check t1             
               left join hos_emp_dict t3
                  on t1.check2_id = t3.emp_id
                 and t1.check1_no = t3.emp_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.emp_code       = prm_check_item;

         elsif v_column_check = 'CHECK3' then --项目
              select count(1)
                into n_count
                from acc_leder_check t1              
               left join hos_proj_dict t3
                  on t1.check3_id = t3.proj_id
                 and t1.check3_no = t3.proj_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.proj_code      = prm_check_item;

          elsif v_column_check = 'CHECK4' then --库房
              select count(1)
                into n_count
                from acc_leder_check t1              
               left join hos_store_dict t3
                  on t1.check4_id = t3.store_id
                 and t1.check4_no = t3.store_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.store_code     = prm_check_item;

          elsif v_column_check = 'CHECK5' then --客户
              select count(1)
                into n_count
                from acc_leder_check t1              
               left join HOS_CUS_DICT t3
                  on t1.check5_id = t3.cus_id
                 and t1.check5_no = t3.cus_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.Cus_Code      = prm_check_item;

         elsif v_column_check = 'CHECK6' then --供应商
              select count(1)
                into n_count
                from acc_leder_check t1              
               left join HOS_SUP_DICT t3
                  on t1.check6_id = t3.sup_id
                 and t1.check6_no = t3.sup_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.sup_code       = prm_check_item;

           elsif v_column_check = 'CHECK7' then --资金来源
             select count(1)
                into n_count
                from acc_leder_check t1              
               left join HOS_SOURCE t3
                  on t1.check7_id = t3.source_id
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.source_code    = prm_check_item;

           elsif v_column_check = 'CHECK8' then --单位
              select count(1)
                into n_count
                from acc_leder_check t1            
               left join V_HOS_DICT t3
                  on t1.check8_id = t3.hos_id
                 and t1.group_id  = t3.group_id
                 and t3.is_stop   = 0
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.hos_code       = prm_check_item
				         and t3.is_stop        = 0;
         else    --自定义 ZCHECK1
           v_sql :='select count(1)
                      from acc_leder_check t1                    
                     left join ACC_CHECK_ITEM t3
                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                       and t1.group_id  = t3.group_id
                       and t1.hos_id    = t3.hos_id
                       and t1.copy_code = t3.copy_code
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                       and t1.acc_month      = ''00''
                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
              ;
              execute immediate v_sql into n_count;
         end if;

         if n_count > 0 then

           v_sql := '';

           --获取初始账年初余额
           if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.end_os), 0)
                  into n_init_money
                  from acc_leder_check t1               
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;

           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.end_os), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check2_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;

           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.end_os), 0)
                  into n_init_money
                  from acc_leder_check t1               
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;

            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.end_os), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;

            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.end_os), 0)
                  into n_init_money
                  from acc_leder_check t1            
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;

           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.end_os), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;

             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.end_os), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;

             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.end_os), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
                   and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
				           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.end_os), 0)
                        from acc_leder_check t1                      
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month      = ''00''
                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_init_money;
              end if;
         end if;


         if v_column_check = 'CHECK1' then  --部门
             if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join hos_dept_dict t4
                     on t1.check1_id  = t4.dept_id
                    and t1.check1_no  = t4.dept_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.dept_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                   left join hos_dept_dict t4
                     on t1.check1_id  = t4.dept_id
                    and t1.check1_no  = t4.dept_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.dept_code   = prm_check_item;
             end if;

         elsif v_column_check = 'CHECK2' then --职工

               if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                   
                   left join hos_emp_dict t4
                     on t1.check2_id  = t4.emp_id
                    and t1.check2_no  = t4.emp_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.emp_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                  left join hos_emp_dict t4
                    on t1.check2_id = t4.emp_id
                   and t1.check2_no = t4.emp_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.emp_code   = prm_check_item;
             end if;

         elsif v_column_check = 'CHECK3' then --项目

              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                   
                   left join hos_proj_dict t4
                     on t1.check3_id  = t4.proj_id
                    and t1.check3_no  = t4.proj_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.proj_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                  left join hos_proj_dict t4
                    on t1.check3_id = t4.proj_id
                   and t1.check3_no = t4.proj_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.proj_code   = prm_check_item;
             end if;
          elsif v_column_check = 'CHECK4' then --库房
              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join hos_store_dict t4
                     on t1.check4_id  = t4.store_id
                    and t1.check4_no  = t4.store_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.store_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                  left join hos_store_dict t4
                    on t1.check4_id = t4.store_id
                   and t1.check4_no = t4.store_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.store_code   = prm_check_item;
             end if;
          elsif v_column_check = 'CHECK5' then --客户
              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join HOS_CUS_DICT t4
                     on t1.check5_id  = t4.cus_id
                    and t1.check5_no  = t4.cus_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.cus_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                  left join HOS_CUS_DICT t4
                    on t1.check5_id = t4.cus_id
                   and t1.check5_no = t4.cus_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.cus_code   = prm_check_item;
             end if;
         elsif v_column_check = 'CHECK6' then --供应商
             if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join HOS_SUP_DICT t4
                     on t1.check6_id  = t4.sup_id
                    and t1.check6_no  = t4.sup_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.sup_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                  left join HOS_SUP_DICT t4
                    on t1.check6_id = t4.sup_id
                   and t1.check6_no = t4.sup_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.sup_code   = prm_check_item;
             end if;
           elsif v_column_check = 'CHECK7' then --资金来源
              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                   left join HOS_SOURCE t4
                     on t1.check7_id  = t4.source_id
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.source_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                  left join HOS_SOURCE t4
                    on t1.check7_id = t4.source_id
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.source_code  = prm_check_item;
             end if;
           elsif v_column_check = 'CHECK8' then --单位
              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                   
                   left join V_HOS_DICT t4
                     on t1.check8_id  = t4.hos_id
                    and t1.group_id   = t4.group_id
                    and t4.is_stop    = 0
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.hos_code   = prm_check_item
				          and t4.is_stop    = 0;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                  left join V_HOS_DICT t4
                    on t1.check8_id = t4.hos_id
                   and t1.group_id  = t4.group_id
                   and t4.is_stop   = 0
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.hos_code   = prm_check_item
				          and t4.is_stop    = 0;
             end if;
         else    --自定义 ZCHECK1

             if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 v_sql :='select  nvl(sum(t1.DEBIT), 0) - nvl(sum(t1.credit), 0)
                            from acc_vouch_check t1
                            left join acc_vouch t2
                             on t1.vouch_id  = t2.vouch_id
                            and t1.group_id  = t2.group_id
                            and t1.hos_id    = t2.hos_id
                            and t1.copy_code = t2.copy_code
                            and t1.acc_year  = t2.acc_year                          
                          left join ACC_CHECK_ITEM t4
                           on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                           and t1.group_id  = t4.group_id
                           and t1.hos_id    = t4.hos_id
                           and t1.copy_code = t4.copy_code
                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                         where t1.group_id       =   '|| to_char(prm_group_id)    || '
                           and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                           and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                           and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                           and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                           and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                           and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                          ;
                  Dbms_Output.put_line(v_sql);
                 execute immediate v_sql into n_period_money;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 v_sql :='select  nvl(sum(t1.credit), 0) - nvl(sum(t1.DEBIT), 0)
                            from acc_vouch_check t1
                            left join acc_vouch t2
                             on t1.vouch_id  = t2.vouch_id
                            and t1.group_id  = t2.group_id
                            and t1.hos_id    = t2.hos_id
                            and t1.copy_code = t2.copy_code
                            and t1.acc_year  = t2.acc_year                         
                          left join ACC_CHECK_ITEM t4
                           on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                           and t1.group_id  = t4.group_id
                           and t1.hos_id    = t4.hos_id
                           and t1.copy_code = t4.copy_code
                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                         where t1.group_id       =   '|| to_char(prm_group_id)    || '
                           and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                           and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                           and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                           and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                           and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                           and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                          ;
                 execute immediate v_sql into n_period_money;
             end if;

          end if;
          n_ret := n_init_money + n_period_money;

      else   --外币
          if v_column_check = 'CHECK1' then  --部门
              select count(1)
                into n_count
                from acc_leder_check t1              
               left join hos_dept_dict t3
                  on t1.check1_id = t3.dept_id
                 and t1.CHECK1_NO = t3.dept_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.dept_code      = prm_check_item;

         elsif v_column_check = 'CHECK2' then --职工
              select count(1)
                into n_count
                from acc_leder_check t1              
               left join hos_emp_dict t3
                  on t1.check2_id = t3.emp_id
                 and t1.check1_no = t3.emp_no
                 and t1.group_id = t3.group_id
                 and t1.hos_id   = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.emp_code       = prm_check_item;

         elsif v_column_check = 'CHECK3' then --项目
              select count(1)
                into n_count
                from acc_leder_check t1               
               left join hos_proj_dict t3
                  on t1.check3_id = t3.proj_id
                 and t1.check3_no = t3.proj_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.proj_code      = prm_check_item;

          elsif v_column_check = 'CHECK4' then --库房
              select count(1)
                into n_count
                from acc_leder_check t1              
               left join hos_store_dict t3
                  on t1.check4_id = t3.store_id
                 and t1.check4_no = t3.store_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.store_code     = prm_check_item;

          elsif v_column_check = 'CHECK5' then --客户
              select count(1)
                into n_count
                from acc_leder_check t1               
               left join HOS_CUS_DICT t3
                  on t1.check5_id = t3.cus_id
                 and t1.check5_no = t3.cus_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.Cus_Code      = prm_check_item;

         elsif v_column_check = 'CHECK6' then --供应商
              select count(1)
                into n_count
                from acc_leder_check t1              
               left join HOS_SUP_DICT t3
                  on t1.check6_id = t3.sup_id
                 and t1.check6_no = t3.sup_no
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.sup_code       = prm_check_item;

           elsif v_column_check = 'CHECK7' then --资金来源
             select count(1)
                into n_count
                from acc_leder_check t1              
               left join HOS_SOURCE t3
                  on t1.check7_id = t3.source_id
                 and t1.group_id  = t3.group_id
                 and t1.hos_id    = t3.hos_id
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.source_code    = prm_check_item;

           elsif v_column_check = 'CHECK8' then --单位
              select count(1)
                into n_count
                from acc_leder_check t1             
               left join V_HOS_DICT t3
                  on t1.check8_id = t3.hos_id
                 and t1.group_id  = t3.group_id
                 and t3.is_stop   = 0
               where t1.group_id       = prm_group_id
                 and t1.hos_id         = prm_hos_id
                 and t1.copy_code      = prm_copy_code
                 and t1.acc_year       = prm_acc_year
                 and t1.acc_month      = '00'
                 and t1.subj_code   like prm_subj_code || '%'
                 and t3.hos_code       = prm_check_item
				         and t3.is_stop        = 0;
         else    --自定义 ZCHECK1
           v_sql :='select count(1)
                      from acc_leder_check t1                    
                     left join ACC_CHECK_ITEM t3
                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                       and t1.group_id  = t3.group_id
                       and t1.hos_id    = t3.hos_id
                       and t1.copy_code = t3.copy_code
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                       and t1.acc_month      = ''00''
                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
              ;
              execute immediate v_sql into n_count;
         end if;

         if n_count > 0 then

           v_sql := '';

           --获取初始账年初余额
           if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.end_os_w), 0)
                  into n_init_money
                  from acc_leder_check t1               
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;

           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.end_os_w), 0)
                  into n_init_money
                  from acc_leder_check t1               
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check2_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;

           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.end_os_w), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;

            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.end_os_w), 0)
                  into n_init_money
                  from acc_leder_check t1               
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;

            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.end_os_w), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;

           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.end_os_w), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;

             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.end_os_w), 0)
                  into n_init_money
                  from acc_leder_check t1                
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;

             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.end_os_w), 0)
                  into n_init_money
                  from acc_leder_check t1               
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
                   and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = '00'
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
				           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.end_os_w), 0)
                        from acc_leder_check t1                     
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month      = ''00''
                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_init_money;
              end if;
         end if;


         if v_column_check = 'CHECK1' then  --部门
             if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.debit_w), 0) - nvl(sum(t1.credit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join hos_dept_dict t4
                     on t1.check1_id  = t4.dept_id
                    and t1.check1_no  = t4.dept_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.dept_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.debit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join hos_dept_dict t4
                     on t1.check1_id  = t4.dept_id
                    and t1.check1_no  = t4.dept_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.dept_code   = prm_check_item;
             end if;

         elsif v_column_check = 'CHECK2' then --职工

               if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT_w), 0) - nvl(sum(t1.credit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                   left join hos_emp_dict t4
                     on t1.check2_id  = t4.emp_id
                    and t1.check2_no  = t4.emp_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.emp_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.DEBIT_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                   
                  left join hos_emp_dict t4
                    on t1.check2_id = t4.emp_id
                   and t1.check2_no = t4.emp_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.emp_code   = prm_check_item;
             end if;

         elsif v_column_check = 'CHECK3' then --项目

              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT_w), 0) - nvl(sum(t1.credit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                   left join hos_proj_dict t4
                     on t1.check3_id  = t4.proj_id
                    and t1.check3_no  = t4.proj_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.proj_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.DEBIT_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                  left join hos_proj_dict t4
                    on t1.check3_id = t4.proj_id
                   and t1.check3_no = t4.proj_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.proj_code   = prm_check_item;
             end if;
          elsif v_column_check = 'CHECK4' then --库房
              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT_w), 0) - nvl(sum(t1.credit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join hos_store_dict t4
                     on t1.check4_id  = t4.store_id
                    and t1.check4_no  = t4.store_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.store_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.DEBIT_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                  left join hos_store_dict t4
                    on t1.check4_id = t4.store_id
                   and t1.check4_no = t4.store_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.store_code   = prm_check_item;
             end if;
          elsif v_column_check = 'CHECK5' then --客户
              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT_w), 0) - nvl(sum(t1.credit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join HOS_CUS_DICT t4
                     on t1.check5_id  = t4.cus_id
                    and t1.check5_no  = t4.cus_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.cus_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.DEBIT_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                  left join HOS_CUS_DICT t4
                    on t1.check5_id = t4.cus_id
                   and t1.check5_no = t4.cus_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.cus_code   = prm_check_item;
             end if;
         elsif v_column_check = 'CHECK6' then --供应商
             if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT_w), 0) - nvl(sum(t1.credit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                   left join HOS_SUP_DICT t4
                     on t1.check6_id  = t4.sup_id
                    and t1.check6_no  = t4.sup_no
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.sup_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.DEBIT_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                  left join HOS_SUP_DICT t4
                    on t1.check6_id = t4.sup_id
                   and t1.check6_no = t4.sup_no
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.sup_code   = prm_check_item;
             end if;
           elsif v_column_check = 'CHECK7' then --资金来源
              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT_w), 0) - nvl(sum(t1.credit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                   left join HOS_SOURCE t4
                     on t1.check7_id  = t4.source_id
                    and t1.group_id   = t4.group_id
                    and t1.hos_id     = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.source_code   = prm_check_item;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.DEBIT_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                  left join HOS_SOURCE t4
                    on t1.check7_id = t4.source_id
                   and t1.group_id  = t4.group_id
                   and t1.hos_id    = t4.hos_id
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.source_code  = prm_check_item;
             end if;
           elsif v_column_check = 'CHECK8' then --单位
              if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 select nvl(sum(t1.DEBIT_w), 0) - nvl(sum(t1.credit_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                 
                   left join V_HOS_DICT t4
                     on t1.check8_id  = t4.hos_id
                    and t1.group_id   = t4.group_id
                    and t4.is_stop    = 0
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month   <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.hos_code   = prm_check_item
				          and t4.is_stop    = 0;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.DEBIT_w), 0)
                   into n_period_money
                   from acc_vouch_check t1
                   left join acc_vouch t2
                     on t1.vouch_id  = t2.vouch_id
                    and t1.group_id  = t2.group_id
                    and t1.hos_id    = t2.hos_id
                    and t1.copy_code = t2.copy_code
                    and t1.acc_year  = t2.acc_year                  
                  left join V_HOS_DICT t4
                    on t1.check8_id = t4.hos_id
                   and t1.group_id  = t4.group_id
                   and t4.is_stop    = 0
                 where t1.group_id   = prm_group_id
                  and t1.hos_id      = prm_hos_id
                  and t1.copy_code   = prm_copy_code
                  and t1.acc_year    = prm_acc_year
                  and t2.acc_month  <= prm_acc_month
                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                  and t1.subj_code   like prm_subj_code || '%'
                  and t4.hos_code   = prm_check_item
				          and t4.is_stop    = 0  ;
             end if;
         else    --自定义 ZCHECK1

             if n_dire = 0  then  --余额方向为借方时：年初余额+借方发生-贷方发生

                 v_sql :='select  nvl(sum(t1.DEBIT_w), 0) - nvl(sum(t1.credit_w), 0)
                            from acc_vouch_check t1
                            left join acc_vouch t2
                             on t1.vouch_id  = t2.vouch_id
                            and t1.group_id  = t2.group_id
                            and t1.hos_id    = t2.hos_id
                            and t1.copy_code = t2.copy_code
                            and t1.acc_year  = t2.acc_year                          
                          left join ACC_CHECK_ITEM t4
                           on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                           and t1.group_id  = t4.group_id
                           and t1.hos_id    = t4.hos_id
                           and t1.copy_code = t4.copy_code
                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                         where t1.group_id       =   '|| to_char(prm_group_id)    || '
                           and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                           and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                           and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                           and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                           and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                           and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                          ;
                 execute immediate v_sql into n_period_money;

             else  --余额方向为贷方时：年初余额+贷方发生-借方发生
                 v_sql :='select  nvl(sum(t1.credit_w), 0) - nvl(sum(t1.DEBIT_w), 0)
                            from acc_vouch_check t1
                            left join acc_vouch t2
                             on t1.vouch_id  = t2.vouch_id
                            and t1.group_id  = t2.group_id
                            and t1.hos_id    = t2.hos_id
                            and t1.copy_code = t2.copy_code
                            and t1.acc_year  = t2.acc_year                          
                          left join ACC_CHECK_ITEM t4
                           on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                           and t1.group_id  = t4.group_id
                           and t1.hos_id    = t4.hos_id
                           and t1.copy_code = t4.copy_code
                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                         where t1.group_id       =   '|| to_char(prm_group_id)    || '
                           and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                           and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                           and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                           and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                           and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                           and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                          ;
                 execute immediate v_sql into n_period_money;
             end if;
          end if;
          n_ret := n_init_money + n_period_money;
      end if;
    end if;

    return n_ret;

  EXCEPTION
      WHEN NO_DATA_FOUND THEN
         return 0;
      WHEN OTHERS THEN
         return 0;
  END RF_ACC_QMYE_CK;
	 
	
	]]></sql>
	
	
	<sql id="rf_acc_bnlj_ck" type="fun" desc="取辅助核算本年累计借方发生额"><![CDATA[
	    /*-------------------------------------------------------------------------
	   || 函数名称 ：RF_ACC_BNLJ_CK
	   || 功能描述 ：取辅助核算本年累计借方发生额
	   || 参数描述 ：参数标识          名称             输入/输出    类型
	   ||            -------------------------------------------------------------
	   ||            prm_group_id       集团             IN           NUMBER
	   ||            prm_hos_id         医院             IN           NUMBER
	   ||            prm_copy_code      账套             IN           VARCHAR2
	   ||            prm_acc_year       年度             IN           VARCHAR2
	   ||            prm_acc_month      月份             IN           VARCHAR2
	   ||            prm_subj_code      会计科目         IN           VARCHAR2
	   ||            prm_check_type     核算类           IN           VARCHAR2
	   ||            prm_check_item     核算项           IN           VARCHAR2
	   ||            prm_cur            币种:RMB/USB     IN           VARCHAR2   
	   ||            prm_con_acc        是否包含未记账   IN           NUMBER
	   ||
	   || 返 回 值 ：                   辅助项本年累计借方发生额       OUT          NUMBER
	   ||
	   || 作    者 ：           完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：           修改日期：
	   ||-------------------------------------------------------------------------*/
	CREATE OR REPLACE FUNCTION RF_ACC_BNLJ_CK( prm_group_id       IN    NUMBER        --集团
	                                            ,prm_hos_id         IN    NUMBER        --医院
	                                            ,prm_copy_code      IN    VARCHAR2      --帐套
	                                            ,prm_acc_year       IN    VARCHAR2      --年度
	                                            ,prm_acc_month      IN    VARCHAR2      --月份
	                                            ,prm_subj_code      IN    VARCHAR2      --科目编码
	                                            ,prm_check_type     IN    VARCHAR2      --核算类
	                                            ,prm_check_item     IN    VARCHAR2      --核算项
	                                            ,prm_cur            IN    VARCHAR2      --币种  RMB/USB
	                                            ,prm_con_acc        IN    NUMBER        --是否包括未记账 0:不包含未记账  1:包含未记账
	                                            ) RETURN NUMBER
	  IS
	    n_init_money      NUMBER(19,6);  --初始余额
	    n_period_money    NUMBER(19,6);  --累计发生额
	    n_count           integer:= 0 ;
	    n_ret             NUMBER(19,6);
	
	    v_CHECK_TYPE_ID   ACC_CHECK_TYPE.Check_Type_Id%type;
	    v_column_check    ACC_CHECK_TYPE.Column_Check%type;
	    v_sql             varchar2(4000);
	
	
	  BEGIN
	    --初始化变量
	    n_init_money   :=  0 ;
	    n_period_money :=  0 ;
	    n_ret          :=  0 ;   
	    v_CHECK_TYPE_ID := 0       ;
	    v_column_check  := 'CHECK1';
	    v_sql           := ''      ;
	
	
	    --检查辅助核算类表是否存在数据
	    SELECT count(1)
	      into n_count
	      FROM ACC_CHECK_TYPE
	     WHERE group_id        = prm_group_id
	       AND hos_id          = prm_hos_id
	       AND copy_code       = prm_copy_code
	       AND check_type_name = prm_check_type
	       AND  is_stop        = 0;
	
	    if n_count = 0 then
	       return 0;
	    else
	       n_count := 0 ;
	    end if;
	
	    --获取核算类对应的列
	    SELECT CHECK_TYPE_ID,Column_Check
	      into v_CHECK_TYPE_ID,v_column_check
	      FROM ACC_CHECK_TYPE
	     WHERE group_id        = prm_group_id
	       AND hos_id          = prm_hos_id
	       AND copy_code       = prm_copy_code
	       AND check_type_name = prm_check_type
	       AND  is_stop        = 0
	      ;
	
	    if prm_con_acc = 0 then      --从帐表中获取年初累计
	      if prm_cur = 'RMB' then    --币种为RMB
	          if v_column_check = 'CHECK1' then  --部门
	              select nvl(sum(t1.sum_od), 0)
	                into n_ret
	                from acc_leder_check t1	               
	               left join hos_dept_dict t3
	                  on t1.check1_id = t3.dept_id
	                 and t1.CHECK1_NO = t3.dept_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.dept_code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK2' then --职工
	              select nvl(sum(t1.sum_od), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_emp_dict t3
	                  on t1.check2_id = t3.emp_id
	                 and t1.check1_no = t3.emp_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.emp_code       = prm_check_item;
	
	         elsif v_column_check = 'CHECK3' then --项目
	              select nvl(sum(t1.sum_od), 0)
	                into n_ret
	                from acc_leder_check t1	             
	               left join hos_proj_dict t3
	                  on t1.check3_id = t3.proj_id
	                 and t1.check3_no = t3.proj_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.proj_code      = prm_check_item;
	
	          elsif v_column_check = 'CHECK4' then --库房
	              select nvl(sum(t1.sum_od), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_store_dict t3
	                  on t1.check4_id = t3.store_id
	                 and t1.check4_no = t3.store_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.store_code     = prm_check_item;
	
	          elsif v_column_check = 'CHECK5' then --客户
	              select nvl(sum(t1.sum_od), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join HOS_CUS_DICT t3
	                  on t1.check5_id = t3.cus_id
	                 and t1.check5_no = t3.cus_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.Cus_Code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK6' then --供应商
	              select nvl(sum(t1.sum_od), 0)
	                into n_ret
	                from acc_leder_check t1	               
	               left join HOS_SUP_DICT t3
	                  on t1.check6_id = t3.sup_id
	                 and t1.check6_no = t3.sup_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.sup_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK7' then --资金来源
	              select nvl(sum(t1.sum_od), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join HOS_SOURCE t3
	                  on t1.check7_id = t3.source_id
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.source_code    = prm_check_item;
	
	           elsif v_column_check = 'CHECK8' then --单位
	              select nvl(sum(t1.sum_od), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join V_HOS_DICT t3
	                  on t1.check8_id = t3.hos_id
	                 and t1.group_id  = t3.group_id
					 and t3.is_stop   = 0
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.hos_code       = prm_check_item
	         and t3.is_stop        = 0;
	         else    --自定义 ZCHECK1
	           v_sql :='select nvl(sum(t1.sum_od), 0)
	                      from acc_leder_check t1	                     
	                     left join ACC_CHECK_ITEM t3
	                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                       and t1.group_id  = t3.group_id
	                       and t1.hos_id    = t3.hos_id
	                       and t1.copy_code = t3.copy_code
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                       and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
	                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	              ;
	              execute immediate v_sql into n_ret;
	         end if;
	      else  --币种为外币
	          if v_column_check = 'CHECK1' then  --部门
	              select nvl(sum(t1.sum_od_w), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_dept_dict t3
	                  on t1.check1_id = t3.dept_id
	                 and t1.CHECK1_NO = t3.dept_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.dept_code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK2' then --职工
	              select nvl(sum(t1.sum_od_w), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_emp_dict t3
	                  on t1.check2_id = t3.emp_id
	                 and t1.check1_no = t3.emp_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.emp_code       = prm_check_item;
	
	         elsif v_column_check = 'CHECK3' then --项目
	              select nvl(sum(t1.sum_od_w), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_proj_dict t3
	                  on t1.check3_id = t3.proj_id
	                 and t1.check3_no = t3.proj_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.proj_code      = prm_check_item;
	
	          elsif v_column_check = 'CHECK4' then --库房
	              select nvl(sum(t1.sum_od_w), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_store_dict t3
	                  on t1.check4_id = t3.store_id
	                 and t1.check4_no = t3.store_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.store_code     = prm_check_item;
	
	          elsif v_column_check = 'CHECK5' then --客户
	              select nvl(sum(t1.sum_od_w), 0)
	                into n_ret
	                from acc_leder_check t1	               
	               left join HOS_CUS_DICT t3
	                  on t1.check5_id = t3.cus_id
	                 and t1.check5_no = t3.cus_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.Cus_Code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK6' then --供应商
	              select nvl(sum(t1.sum_od_w), 0)
	                into n_ret
	                from acc_leder_check t1	               
	               left join HOS_SUP_DICT t3
	                  on t1.check6_id = t3.sup_id
	                 and t1.check6_no = t3.sup_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.sup_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK7' then --资金来源
	              select nvl(sum(t1.sum_od_w), 0)
	                into n_ret
	                from acc_leder_check t1	               
	               left join HOS_SOURCE t3
	                  on t1.check7_id = t3.source_id
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.source_code    = prm_check_item;
	
	           elsif v_column_check = 'CHECK8' then --单位
	              select nvl(sum(t1.sum_od_w), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join V_HOS_DICT t3
	                  on t1.check8_id = t3.hos_id
	                 and t1.group_id  = t3.group_id
	           and t3.is_stop   = 0
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.hos_code       = prm_check_item
	         and t3.is_stop        = 0;
	         else    --自定义 ZCHECK1
	           v_sql :='select nvl(sum(t1.sum_od_w), 0)
	                      from acc_leder_check t1	                   
	                     left join ACC_CHECK_ITEM t3
	                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                       and t1.group_id  = t3.group_id
	                       and t1.hos_id    = t3.hos_id
	                       and t1.copy_code = t3.copy_code
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                       and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
	                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	              ;
	              execute immediate v_sql into n_ret;
	         end if;
	      end if;
	    else    --包含未记账，从凭证中获取
	    
	
	      if prm_cur = 'RMB' then    --币种为RMB
	
	         if v_column_check = 'CHECK1' then  --部门
	              select count(1)
	                into n_count
	                from acc_leder_check t1	             
	               left join hos_dept_dict t3
	                  on t1.check1_id = t3.dept_id
	                 and t1.CHECK1_NO = t3.dept_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.dept_code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK2' then --职工
	              select count(1)
	                into n_count
	                from acc_leder_check t1	            
	               left join hos_emp_dict t3
	                  on t1.check2_id = t3.emp_id
	                 and t1.check1_no = t3.emp_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.emp_code       = prm_check_item;
	
	         elsif v_column_check = 'CHECK3' then --项目
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join hos_proj_dict t3
	                  on t1.check3_id = t3.proj_id
	                 and t1.check3_no = t3.proj_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.proj_code      = prm_check_item;
	
	          elsif v_column_check = 'CHECK4' then --库房
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join hos_store_dict t3
	                  on t1.check4_id = t3.store_id
	                 and t1.check4_no = t3.store_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.store_code     = prm_check_item;
	
	          elsif v_column_check = 'CHECK5' then --客户
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join HOS_CUS_DICT t3
	                  on t1.check5_id = t3.cus_id
	                 and t1.check5_no = t3.cus_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.Cus_Code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK6' then --供应商
	              select count(1)
	                into n_count
	                from acc_leder_check t1	             
	               left join HOS_SUP_DICT t3
	                  on t1.check6_id = t3.sup_id
	                 and t1.check6_no = t3.sup_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.sup_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK7' then --资金来源
	             select count(1)
	                into n_count
	                from acc_leder_check t1	             
	               left join HOS_SOURCE t3
	                  on t1.check7_id = t3.source_id
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.source_code    = prm_check_item;
	
	           elsif v_column_check = 'CHECK8' then --单位
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join V_HOS_DICT t3
	                  on t1.check8_id = t3.hos_id
	                 and t1.group_id  = t3.group_id
	                 and t3.is_stop   = 0
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.hos_code       = prm_check_item
	                 and t3.is_stop        = 0;
	         else    --自定义 ZCHECK1
	           v_sql :='select count(1)
	                      from acc_leder_check t1	                    
	                     left join ACC_CHECK_ITEM t3
	                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                       and t1.group_id  = t3.group_id
	                       and t1.hos_id    = t3.hos_id
	                       and t1.copy_code = t3.copy_code
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                       and t1.acc_month      = ''00''
	                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	              ;
	              execute immediate v_sql into n_count;
	         end if;
	
	         if n_count > 0 then
	
	           v_sql := '';
	
	           --获取初始账年初余额
	           if v_column_check = 'CHECK1' then  --部门
	                select nvl(sum(t1.sum_od), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_dept_dict t3
	                    on t1.check1_id = t3.dept_id
	                   and t1.CHECK1_NO = t3.dept_no
	                   and t1.group_id = t3.group_id
	                   and t1.hos_id   = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.dept_code      = prm_check_item;
	
	           elsif v_column_check = 'CHECK2' then --职工
	                select nvl(sum(t1.sum_od), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join hos_emp_dict t3
	                    on t1.check2_id = t3.emp_id
	                   and t1.check2_no = t3.emp_no
	                   and t1.group_id = t3.group_id
	                   and t1.hos_id   = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.emp_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK3' then --项目
	                select nvl(sum(t1.sum_od), 0)
	                  into n_init_money
	                  from acc_leder_check t1	              
	                 left join hos_proj_dict t3
	                    on t1.check3_id = t3.proj_id
	                   and t1.check3_no = t3.proj_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.proj_code      = prm_check_item;
	
	            elsif v_column_check = 'CHECK4' then --库房
	                select nvl(sum(t1.sum_od), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_store_dict t3
	                    on t1.check4_id = t3.store_id
	                   and t1.check4_no = t3.store_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.store_code     = prm_check_item;
	
	            elsif v_column_check = 'CHECK5' then --客户
	                select nvl(sum(t1.sum_od), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join HOS_CUS_DICT t3
	                    on t1.check5_id = t3.cus_id
	                   and t1.check5_no = t3.cus_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.Cus_Code      = prm_check_item;
	
	           elsif v_column_check = 'CHECK6' then --供应商
	                select nvl(sum(t1.sum_od), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join HOS_SUP_DICT t3
	                    on t1.check6_id = t3.sup_id
	                   and t1.check6_no = t3.sup_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.sup_code       = prm_check_item;
	
	             elsif v_column_check = 'CHECK7' then --资金来源
	                select nvl(sum(t1.sum_od), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join HOS_SOURCE t3
	                    on t1.check7_id = t3.source_id
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.source_code    = prm_check_item;
	
	             elsif v_column_check = 'CHECK8' then --单位
	                select nvl(sum(t1.sum_od), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join V_HOS_DICT t3
	                    on t1.check8_id = t3.hos_id
	                   and t1.group_id  = t3.group_id
	                   and t3.is_stop   = 0
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.hos_code       = prm_check_item
	                   and t3.is_stop        = 0;
	           else    --自定义 ZCHECK1
	             v_sql :='select nvl(sum(t1.sum_od), 0)
	                        from acc_leder_check t1	                      
	                       left join ACC_CHECK_ITEM t3
	                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                         and t1.group_id  = t3.group_id
	                         and t1.hos_id    = t3.hos_id
	                         and t1.copy_code = t3.copy_code
	                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                         and t1.acc_month      = ''00''
	                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	                ;
	                execute immediate v_sql into n_init_money;
	              end if;
	         end if;
	
	
	         if v_column_check = 'CHECK1' then  --部门            
	
	                 select nvl(sum(t1.DEBIT), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join hos_dept_dict t4
	                     on t1.check1_id  = t4.dept_id
	                    and t1.check1_no  = t4.dept_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.dept_code   = prm_check_item;
	
	            
	
	         elsif v_column_check = 'CHECK2' then --职工
	              
	
	                 select nvl(sum(t1.DEBIT), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join hos_emp_dict t4
	                     on t1.check2_id  = t4.emp_id
	                    and t1.check2_no  = t4.emp_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.emp_code   = prm_check_item;
	            
	
	         elsif v_column_check = 'CHECK3' then --项目
	
	                 select nvl(sum(t1.DEBIT), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join hos_proj_dict t4
	                     on t1.check3_id  = t4.proj_id
	                    and t1.check3_no  = t4.proj_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.proj_code   = prm_check_item;
	
	            
	          elsif v_column_check = 'CHECK4' then --库房
	             
	                 select nvl(sum(t1.DEBIT), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join hos_store_dict t4
	                     on t1.check4_id  = t4.store_id
	                    and t1.check4_no  = t4.store_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.store_code   = prm_check_item;
	            
	          elsif v_column_check = 'CHECK5' then --客户
	           
	                 select nvl(sum(t1.DEBIT), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join HOS_CUS_DICT t4
	                     on t1.check5_id  = t4.cus_id
	                    and t1.check5_no  = t4.cus_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.cus_code   = prm_check_item;
	
	            
	         elsif v_column_check = 'CHECK6' then --供应商
	          
	                 select nvl(sum(t1.DEBIT), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join HOS_SUP_DICT t4
	                     on t1.check6_id  = t4.sup_id
	                    and t1.check6_no  = t4.sup_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.sup_code   = prm_check_item;
	
	          
	           elsif v_column_check = 'CHECK7' then --资金来源
	           
	                 select nvl(sum(t1.DEBIT), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join HOS_SOURCE t4
	                     on t1.check7_id  = t4.source_id
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.source_code   = prm_check_item;
	            
	           elsif v_column_check = 'CHECK8' then --单位
	            
	                 select nvl(sum(t1.DEBIT), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join V_HOS_DICT t4
	                     on t1.check8_id  = t4.hos_id
	                    and t1.group_id   = t4.group_id
	                    and t4.is_stop    = 0
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.hos_code   = prm_check_item
	                  and t4.is_stop    = 0;
	
	            
	         else    --自定义 ZCHECK1
	            
	                 v_sql :='select  nvl(sum(t1.DEBIT), 0)
	                            from acc_vouch_check t1
	                            left join acc_vouch t2
	                             on t1.vouch_id  = t2.vouch_id
	                            and t1.group_id  = t2.group_id
	                            and t1.hos_id    = t2.hos_id
	                            and t1.copy_code = t2.copy_code
	                            and t1.acc_year  = t2.acc_year	                       
	                          left join ACC_CHECK_ITEM t4
	                           on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
	                           and t1.group_id  = t4.group_id
	                           and t1.hos_id    = t4.hos_id
	                           and t1.copy_code = t4.copy_code
	                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                         where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                           and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                           and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                           and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                           and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
	                           and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                           and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	                          ;
	                  Dbms_Output.put_line(v_sql);
	                 execute immediate v_sql into n_period_money;
	         
	
	          end if;
	          n_ret := n_init_money + n_period_money;
	
	      else   --外币
	          if v_column_check = 'CHECK1' then  --部门
	              select count(1)
	                into n_count
	                from acc_leder_check t1	            
	               left join hos_dept_dict t3
	                  on t1.check1_id = t3.dept_id
	                 and t1.CHECK1_NO = t3.dept_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.dept_code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK2' then --职工
	              select count(1)
	                into n_count
	                from acc_leder_check t1	             
	               left join hos_emp_dict t3
	                  on t1.check2_id = t3.emp_id
	                 and t1.check1_no = t3.emp_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.emp_code       = prm_check_item;
	
	         elsif v_column_check = 'CHECK3' then --项目
	              select count(1)
	                into n_count
	                from acc_leder_check t1	             
	               left join hos_proj_dict t3
	                  on t1.check3_id = t3.proj_id
	                 and t1.check3_no = t3.proj_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.proj_code      = prm_check_item;
	
	          elsif v_column_check = 'CHECK4' then --库房
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join hos_store_dict t3
	                  on t1.check4_id = t3.store_id
	                 and t1.check4_no = t3.store_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.store_code     = prm_check_item;
	
	          elsif v_column_check = 'CHECK5' then --客户
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join HOS_CUS_DICT t3
	                  on t1.check5_id = t3.cus_id
	                 and t1.check5_no = t3.cus_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.Cus_Code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK6' then --供应商
	              select count(1)
	                into n_count
	                from acc_leder_check t1	             
	               left join HOS_SUP_DICT t3
	                  on t1.check6_id = t3.sup_id
	                 and t1.check6_no = t3.sup_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.sup_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK7' then --资金来源
	             select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join HOS_SOURCE t3
	                  on t1.check7_id = t3.source_id
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.source_code    = prm_check_item;
	
	           elsif v_column_check = 'CHECK8' then --单位
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join V_HOS_DICT t3
	                  on t1.check8_id = t3.hos_id
	                 and t1.group_id  = t3.group_id
	                 and t3.is_stop   = 0
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.hos_code       = prm_check_item
	                 and t3.is_stop        = 0;
	         else    --自定义 ZCHECK1
	           v_sql :='select count(1)
	                      from acc_leder_check t1	                     
	                     left join ACC_CHECK_ITEM t3
	                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                       and t1.group_id  = t3.group_id
	                       and t1.hos_id    = t3.hos_id
	                       and t1.copy_code = t3.copy_code
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                       and t1.acc_month      = ''00''
	                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	              ;
	              execute immediate v_sql into n_count;
	         end if;
	
	         if n_count > 0 then
	
	           v_sql := '';
	
	           --获取初始账年初余额
	           if v_column_check = 'CHECK1' then  --部门
	                select nvl(sum(t1.sum_od_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_dept_dict t3
	                    on t1.check1_id = t3.dept_id
	                   and t1.CHECK1_NO = t3.dept_no
	                   and t1.group_id = t3.group_id
	                   and t1.hos_id   = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.dept_code      = prm_check_item;
	
	           elsif v_column_check = 'CHECK2' then --职工
	                select nvl(sum(t1.sum_od_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_emp_dict t3
	                    on t1.check2_id = t3.emp_id
	                   and t1.check2_no = t3.emp_no
	                   and t1.group_id = t3.group_id
	                   and t1.hos_id   = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.emp_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK3' then --项目
	                select nvl(sum(t1.sum_od_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_proj_dict t3
	                    on t1.check3_id = t3.proj_id
	                   and t1.check3_no = t3.proj_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.proj_code      = prm_check_item;
	
	            elsif v_column_check = 'CHECK4' then --库房
	                select nvl(sum(t1.sum_od_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join hos_store_dict t3
	                    on t1.check4_id = t3.store_id
	                   and t1.check4_no = t3.store_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.store_code     = prm_check_item;
	
	            elsif v_column_check = 'CHECK5' then --客户
	                select nvl(sum(t1.sum_od_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	              
	                 left join HOS_CUS_DICT t3
	                    on t1.check5_id = t3.cus_id
	                   and t1.check5_no = t3.cus_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.Cus_Code      = prm_check_item;
	
	           elsif v_column_check = 'CHECK6' then --供应商
	                select nvl(sum(t1.sum_od_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join HOS_SUP_DICT t3
	                    on t1.check6_id = t3.sup_id
	                   and t1.check6_no = t3.sup_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.sup_code       = prm_check_item;
	
	             elsif v_column_check = 'CHECK7' then --资金来源
	                select nvl(sum(t1.sum_od_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join HOS_SOURCE t3
	                    on t1.check7_id = t3.source_id
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.source_code    = prm_check_item;
	
	             elsif v_column_check = 'CHECK8' then --单位
	                select nvl(sum(t1.sum_od_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join V_HOS_DICT t3
	                    on t1.check8_id = t3.hos_id
	                   and t1.group_id  = t3.group_id
	                   and t3.is_stop   = 0
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.hos_code       = prm_check_item
	                   and t3.is_stop        = 0;
	           else    --自定义 ZCHECK1
	             v_sql :='select nvl(sum(t1.sum_od_w), 0)
	                        from acc_leder_check t1	                      
	                       left join ACC_CHECK_ITEM t3
	                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                         and t1.group_id  = t3.group_id
	                         and t1.hos_id    = t3.hos_id
	                         and t1.copy_code = t3.copy_code
	                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                         and t1.acc_month      = ''00''
	                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	                ;
	                execute immediate v_sql into n_init_money;
	              end if;
	         end if;
	
	
	         if v_column_check = 'CHECK1' then  --部门
	           
	                 select nvl(sum(t1.debit_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join hos_dept_dict t4
	                     on t1.check1_id  = t4.dept_id
	                    and t1.check1_no  = t4.dept_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.dept_code   = prm_check_item;
	           
	
	         elsif v_column_check = 'CHECK2' then --职工
	
	                 select nvl(sum(t1.DEBIT_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join hos_emp_dict t4
	                     on t1.check2_id  = t4.emp_id
	                    and t1.check2_no  = t4.emp_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.emp_code   = prm_check_item;
	           
	
	         elsif v_column_check = 'CHECK3' then --项目
	
	                 select nvl(sum(t1.DEBIT_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join hos_proj_dict t4
	                     on t1.check3_id  = t4.proj_id
	                    and t1.check3_no  = t4.proj_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.proj_code   = prm_check_item;
	
	            
	          elsif v_column_check = 'CHECK4' then --库房
	             
	                 select nvl(sum(t1.DEBIT_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                
	                   left join hos_store_dict t4
	                     on t1.check4_id  = t4.store_id
	                    and t1.check4_no  = t4.store_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.store_code   = prm_check_item;
	
	            
	          elsif v_column_check = 'CHECK5' then --客户
	             
	                 select nvl(sum(t1.DEBIT_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join HOS_CUS_DICT t4
	                     on t1.check5_id  = t4.cus_id
	                    and t1.check5_no  = t4.cus_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.cus_code   = prm_check_item;
	
	            
	         elsif v_column_check = 'CHECK6' then --供应商
	            
	                 select nvl(sum(t1.DEBIT_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join HOS_SUP_DICT t4
	                     on t1.check6_id  = t4.sup_id
	                    and t1.check6_no  = t4.sup_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.sup_code   = prm_check_item;
	
	           
	           elsif v_column_check = 'CHECK7' then --资金来源
	            
	                 select nvl(sum(t1.DEBIT_w), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                
	                   left join HOS_SOURCE t4
	                     on t1.check7_id  = t4.source_id
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.source_code   = prm_check_item;
	
	            
	           elsif v_column_check = 'CHECK8' then --单位
	            
	                 select nvl(sum(t1.DEBIT_w), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join V_HOS_DICT t4
	                     on t1.check8_id  = t4.hos_id
	                    and t1.group_id   = t4.group_id
	                    and t4.is_stop    = 0
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.hos_code   = prm_check_item
	                  and t4.is_stop    = 0;
	
	            
	         else    --自定义 ZCHECK1
	
	                 v_sql :='select  nvl(sum(t1.DEBIT_w), 0)
	                            from acc_vouch_check t1
	                            left join acc_vouch t2
	                             on t1.vouch_id  = t2.vouch_id
	                            and t1.group_id  = t2.group_id
	                            and t1.hos_id    = t2.hos_id
	                            and t1.copy_code = t2.copy_code
	                            and t1.acc_year  = t2.acc_year	                         
	                          left join ACC_CHECK_ITEM t4
	                           on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
	                           and t1.group_id  = t4.group_id
	                           and t1.hos_id    = t4.hos_id
	                           and t1.copy_code = t4.copy_code
	                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                         where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                           and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                           and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                           and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                           and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
	                           and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                           and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	                          ;
	                 execute immediate v_sql into n_period_money;
	            
	          end if;
	          n_ret := n_init_money + n_period_money;
	      end if;
	    end if;
	
	    return n_ret;
	
	  EXCEPTION
	      WHEN NO_DATA_FOUND THEN
	         return 0;
	      WHEN OTHERS THEN
	         return 0;
	  END RF_ACC_BNLJ_CK;		
	
	]]></sql>
	
	
	<sql id="rf_acc_bnld_ck" type="fun" desc="取辅助核算本年累计贷方发生额"><![CDATA[
		/*-------------------------------------------------------------------------
	   || 函数名称 ：RF_ACC_BNLD_CK
	   || 功能描述 ：取辅助核算本年累计贷方发生额
	   || 参数描述 ：参数标识          名称             输入/输出    类型
	   ||            -------------------------------------------------------------
	   ||            prm_group_id       集团             IN           NUMBER
	   ||            prm_hos_id         医院             IN           NUMBER
	   ||            prm_copy_code      账套             IN           VARCHAR2
	   ||            prm_acc_year       年度             IN           VARCHAR2
	   ||            prm_acc_month      月份             IN           VARCHAR2
	   ||            prm_subj_code      会计科目         IN           VARCHAR2
	   ||            prm_check_type     核算类           IN           VARCHAR2
	   ||            prm_check_item     核算项           IN           VARCHAR2
	   ||            prm_cur            币种:RMB/USB     IN           VARCHAR2   
	   ||            prm_con_acc        是否包含未记账   IN           NUMBER
	   ||
	   || 返 回 值 ：                   辅助项本年累计贷方发生额       OUT          NUMBER
	   ||
	   || 作    者 ：           完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：           修改日期：
	   ||-------------------------------------------------------------------------*/
	  CREATE OR REPLACE FUNCTION RF_ACC_BNLD_CK( prm_group_id       IN    NUMBER        --集团
	                                            ,prm_hos_id         IN    NUMBER        --医院
	                                            ,prm_copy_code      IN    VARCHAR2      --帐套
	                                            ,prm_acc_year       IN    VARCHAR2      --年度
	                                            ,prm_acc_month      IN    VARCHAR2      --月份
	                                            ,prm_subj_code      IN    VARCHAR2      --科目编码
	                                            ,prm_check_type     IN    VARCHAR2      --核算类
	                                            ,prm_check_item     IN    VARCHAR2      --核算项
	                                            ,prm_cur            IN    VARCHAR2      --币种  RMB/USB
	                                            ,prm_con_acc        IN    NUMBER        --是否包括未记账 0:不包含未记账  1:包含未记账
	                                            ) RETURN NUMBER
	  IS
	    n_init_money      NUMBER(19,6);  --初始余额
	    n_period_money    NUMBER(19,6);  --累计发生额
	    n_count           integer:= 0 ;
	    n_ret             NUMBER(19,6);
	
	    v_CHECK_TYPE_ID   ACC_CHECK_TYPE.Check_Type_Id%type;
	    v_column_check    ACC_CHECK_TYPE.Column_Check%type;
	    v_sql             varchar2(4000);
	
	
	  BEGIN
	    --初始化变量
	    n_init_money   :=  0 ;
	    n_period_money :=  0 ;
	    n_ret          :=  0 ;   
	    v_CHECK_TYPE_ID := 0       ;
	    v_column_check  := 'CHECK1';
	    v_sql           := ''      ;
	
	
	    --检查辅助核算类表是否存在数据
	    SELECT count(1)
	      into n_count
	      FROM ACC_CHECK_TYPE
	     WHERE group_id        = prm_group_id
	       AND hos_id          = prm_hos_id
	       AND copy_code       = prm_copy_code
	       AND check_type_name = prm_check_type
	       AND  is_stop        = 0;
	
	    if n_count = 0 then
	       return 0;
	    else
	       n_count := 0 ;
	    end if;
	
	    --获取核算类对应的列
	    SELECT CHECK_TYPE_ID,Column_Check
	      into v_CHECK_TYPE_ID,v_column_check
	      FROM ACC_CHECK_TYPE
	     WHERE group_id        = prm_group_id
	       AND hos_id          = prm_hos_id
	       AND copy_code       = prm_copy_code
	       AND check_type_name = prm_check_type
	       AND  is_stop        = 0
	      ;
	
	    if prm_con_acc = 0 then      --从帐表中获取年初累计
	      if prm_cur = 'RMB' then    --币种为RMB
	          if v_column_check = 'CHECK1' then  --部门
	              select nvl(sum(t1.sum_oc), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_dept_dict t3
	                  on t1.check1_id = t3.dept_id
	                 and t1.CHECK1_NO = t3.dept_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.dept_code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK2' then --职工
	              select nvl(sum(t1.sum_oc), 0)
	                into n_ret
	                from acc_leder_check t1	            
	               left join hos_emp_dict t3
	                  on t1.check2_id = t3.emp_id
	                 and t1.check1_no = t3.emp_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.emp_code       = prm_check_item;
	
	         elsif v_column_check = 'CHECK3' then --项目
	              select nvl(sum(t1.sum_oc), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_proj_dict t3
	                  on t1.check3_id = t3.proj_id
	                 and t1.check3_no = t3.proj_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.proj_code      = prm_check_item;
	
	          elsif v_column_check = 'CHECK4' then --库房
	              select nvl(sum(t1.sum_oc), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_store_dict t3
	                  on t1.check4_id = t3.store_id
	                 and t1.check4_no = t3.store_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.store_code     = prm_check_item;
	
	          elsif v_column_check = 'CHECK5' then --客户
	              select nvl(sum(t1.sum_oc), 0)
	                into n_ret
	                from acc_leder_check t1	             
	               left join HOS_CUS_DICT t3
	                  on t1.check5_id = t3.cus_id
	                 and t1.check5_no = t3.cus_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.Cus_Code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK6' then --供应商
	              select nvl(sum(t1.sum_oc), 0)
	                into n_ret
	                from acc_leder_check t1	             
	               left join HOS_SUP_DICT t3
	                  on t1.check6_id = t3.sup_id
	                 and t1.check6_no = t3.sup_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.sup_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK7' then --资金来源
	              select nvl(sum(t1.sum_oc), 0)
	                into n_ret
	                from acc_leder_check t1	            
	               left join HOS_SOURCE t3
	                  on t1.check7_id = t3.source_id
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.source_code    = prm_check_item;
	
	           elsif v_column_check = 'CHECK8' then --单位
	              select nvl(sum(t1.sum_oc), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join V_HOS_DICT t3
	                  on t1.check8_id = t3.hos_id
	                 and t1.group_id  = t3.group_id
	           and t3.is_stop   = 0
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.hos_code       = prm_check_item
	         and t3.is_stop        = 0;
	         else    --自定义 ZCHECK1
	           v_sql :='select nvl(sum(t1.sum_oc), 0)
	                      from acc_leder_check t1	                    
	                     left join ACC_CHECK_ITEM t3
	                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                       and t1.group_id  = t3.group_id
	                       and t1.hos_id    = t3.hos_id
	                       and t1.copy_code = t3.copy_code
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                       and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
	                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	              ;
	              execute immediate v_sql into n_ret;
	         end if;
	      else  --币种为外币
	          if v_column_check = 'CHECK1' then  --部门
	              select nvl(sum(t1.sum_oc_w), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_dept_dict t3
	                  on t1.check1_id = t3.dept_id
	                 and t1.CHECK1_NO = t3.dept_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.dept_code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK2' then --职工
	              select nvl(sum(t1.sum_oc_w), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join hos_emp_dict t3
	                  on t1.check2_id = t3.emp_id
	                 and t1.check1_no = t3.emp_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.emp_code       = prm_check_item;
	
	         elsif v_column_check = 'CHECK3' then --项目
	              select nvl(sum(t1.sum_oc_w), 0)
	                into n_ret
	                from acc_leder_check t1	             
	               left join hos_proj_dict t3
	                  on t1.check3_id = t3.proj_id
	                 and t1.check3_no = t3.proj_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.proj_code      = prm_check_item;
	
	          elsif v_column_check = 'CHECK4' then --库房
	              select nvl(sum(t1.sum_oc_w), 0)
	                into n_ret
	                from acc_leder_check t1	            
	               left join hos_store_dict t3
	                  on t1.check4_id = t3.store_id
	                 and t1.check4_no = t3.store_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.store_code     = prm_check_item;
	
	          elsif v_column_check = 'CHECK5' then --客户
	              select nvl(sum(t1.sum_oc_w), 0)
	                into n_ret
	                from acc_leder_check t1	             
	               left join HOS_CUS_DICT t3
	                  on t1.check5_id = t3.cus_id
	                 and t1.check5_no = t3.cus_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.Cus_Code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK6' then --供应商
	              select nvl(sum(t1.sum_oc_w), 0)
	                into n_ret
	                from acc_leder_check t1	             
	               left join HOS_SUP_DICT t3
	                  on t1.check6_id = t3.sup_id
	                 and t1.check6_no = t3.sup_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.sup_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK7' then --资金来源
	              select nvl(sum(t1.sum_oc_w), 0)
	                into n_ret
	                from acc_leder_check t1	             
	               left join HOS_SOURCE t3
	                  on t1.check7_id = t3.source_id
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.source_code    = prm_check_item;
	
	           elsif v_column_check = 'CHECK8' then --单位
	              select nvl(sum(t1.sum_oc_w), 0)
	                into n_ret
	                from acc_leder_check t1	              
	               left join V_HOS_DICT t3
	                  on t1.check8_id = t3.hos_id
	                 and t1.group_id  = t3.group_id
	           and t3.is_stop   = 0
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = prm_acc_month
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.hos_code       = prm_check_item
	         and t3.is_stop        = 0;
	         else    --自定义 ZCHECK1
	           v_sql :='select nvl(sum(t1.sum_oc_w), 0)
	                      from acc_leder_check t1	                    
	                     left join ACC_CHECK_ITEM t3
	                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                       and t1.group_id  = t3.group_id
	                       and t1.hos_id    = t3.hos_id
	                       and t1.copy_code = t3.copy_code
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                       and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
	                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	              ;
	              execute immediate v_sql into n_ret;
	         end if;
	      end if;
	    else    --包含未记账，从凭证中获取
	    
	
	      if prm_cur = 'RMB' then    --币种为RMB
	
	         if v_column_check = 'CHECK1' then  --部门
	              select count(1)
	                into n_count
	                from acc_leder_check t1	               
	               left join hos_dept_dict t3
	                  on t1.check1_id = t3.dept_id
	                 and t1.CHECK1_NO = t3.dept_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.dept_code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK2' then --职工
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join hos_emp_dict t3
	                  on t1.check2_id = t3.emp_id
	                 and t1.check1_no = t3.emp_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.emp_code       = prm_check_item;
	
	         elsif v_column_check = 'CHECK3' then --项目
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join hos_proj_dict t3
	                  on t1.check3_id = t3.proj_id
	                 and t1.check3_no = t3.proj_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.proj_code      = prm_check_item;
	
	          elsif v_column_check = 'CHECK4' then --库房
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join hos_store_dict t3
	                  on t1.check4_id = t3.store_id
	                 and t1.check4_no = t3.store_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.store_code     = prm_check_item;
	
	          elsif v_column_check = 'CHECK5' then --客户
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join HOS_CUS_DICT t3
	                  on t1.check5_id = t3.cus_id
	                 and t1.check5_no = t3.cus_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.Cus_Code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK6' then --供应商
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join HOS_SUP_DICT t3
	                  on t1.check6_id = t3.sup_id
	                 and t1.check6_no = t3.sup_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.sup_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK7' then --资金来源
	             select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join HOS_SOURCE t3
	                  on t1.check7_id = t3.source_id
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.source_code    = prm_check_item;
	
	           elsif v_column_check = 'CHECK8' then --单位
	              select count(1)
	                into n_count
	                from acc_leder_check t1	             
	               left join V_HOS_DICT t3
	                  on t1.check8_id = t3.hos_id
	                 and t1.group_id  = t3.group_id
	                 and t3.is_stop   = 0
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.hos_code       = prm_check_item
	                 and t3.is_stop        = 0;
	         else    --自定义 ZCHECK1
	           v_sql :='select count(1)
	                      from acc_leder_check t1	                     
	                     left join ACC_CHECK_ITEM t3
	                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                       and t1.group_id  = t3.group_id
	                       and t1.hos_id    = t3.hos_id
	                       and t1.copy_code = t3.copy_code
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                       and t1.acc_month      = ''00''
	                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	              ;
	              execute immediate v_sql into n_count;
	         end if;
	
	         if n_count > 0 then
	
	           v_sql := '';
	
	           --获取初始账年初余额
	           if v_column_check = 'CHECK1' then  --部门
	                select nvl(sum(t1.sum_oc), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join hos_dept_dict t3
	                    on t1.check1_id = t3.dept_id
	                   and t1.CHECK1_NO = t3.dept_no
	                   and t1.group_id = t3.group_id
	                   and t1.hos_id   = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.dept_code      = prm_check_item;
	
	           elsif v_column_check = 'CHECK2' then --职工
	                select nvl(sum(t1.sum_oc), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_emp_dict t3
	                    on t1.check2_id = t3.emp_id
	                   and t1.check2_no = t3.emp_no
	                   and t1.group_id = t3.group_id
	                   and t1.hos_id   = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.emp_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK3' then --项目
	                select nvl(sum(t1.sum_oc), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_proj_dict t3
	                    on t1.check3_id = t3.proj_id
	                   and t1.check3_no = t3.proj_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.proj_code      = prm_check_item;
	
	            elsif v_column_check = 'CHECK4' then --库房
	                select nvl(sum(t1.sum_oc), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_store_dict t3
	                    on t1.check4_id = t3.store_id
	                   and t1.check4_no = t3.store_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.store_code     = prm_check_item;
	
	            elsif v_column_check = 'CHECK5' then --客户
	                select nvl(sum(t1.sum_oc), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join HOS_CUS_DICT t3
	                    on t1.check5_id = t3.cus_id
	                   and t1.check5_no = t3.cus_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.Cus_Code      = prm_check_item;
	
	           elsif v_column_check = 'CHECK6' then --供应商
	                select nvl(sum(t1.sum_oc), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join HOS_SUP_DICT t3
	                    on t1.check6_id = t3.sup_id
	                   and t1.check6_no = t3.sup_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.sup_code       = prm_check_item;
	
	             elsif v_column_check = 'CHECK7' then --资金来源
	                select nvl(sum(t1.sum_oc), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join HOS_SOURCE t3
	                    on t1.check7_id = t3.source_id
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.source_code    = prm_check_item;
	
	             elsif v_column_check = 'CHECK8' then --单位
	                select nvl(sum(t1.sum_oc), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join V_HOS_DICT t3
	                    on t1.check8_id = t3.hos_id
	                   and t1.group_id  = t3.group_id
	                   and t3.is_stop   = 0
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.hos_code       = prm_check_item
	                   and t3.is_stop        = 0;
	           else    --自定义 ZCHECK1
	             v_sql :='select nvl(sum(t1.sum_oc), 0)
	                        from acc_leder_check t1	                      
	                       left join ACC_CHECK_ITEM t3
	                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                         and t1.group_id  = t3.group_id
	                         and t1.hos_id    = t3.hos_id
	                         and t1.copy_code = t3.copy_code
	                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                         and t1.acc_month      = ''00''
	                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	                ;
	                execute immediate v_sql into n_init_money;
	              end if;
	         end if;
	
	
	         if v_column_check = 'CHECK1' then  --部门            
	
	                 select nvl(sum(t1.credit), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join hos_dept_dict t4
	                     on t1.check1_id  = t4.dept_id
	                    and t1.check1_no  = t4.dept_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.dept_code   = prm_check_item;
	
	            
	
	         elsif v_column_check = 'CHECK2' then --职工
	              
	
	                 select nvl(sum(t1.credit), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join hos_emp_dict t4
	                     on t1.check2_id  = t4.emp_id
	                    and t1.check2_no  = t4.emp_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.emp_code   = prm_check_item;
	            
	
	         elsif v_column_check = 'CHECK3' then --项目
	
	                 select nvl(sum(t1.credit), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join hos_proj_dict t4
	                     on t1.check3_id  = t4.proj_id
	                    and t1.check3_no  = t4.proj_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.proj_code   = prm_check_item;
	
	            
	          elsif v_column_check = 'CHECK4' then --库房
	             
	                 select nvl(sum(t1.credit), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join hos_store_dict t4
	                     on t1.check4_id  = t4.store_id
	                    and t1.check4_no  = t4.store_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.store_code   = prm_check_item;
	            
	          elsif v_column_check = 'CHECK5' then --客户
	           
	                 select nvl(sum(t1.credit), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join HOS_CUS_DICT t4
	                     on t1.check5_id  = t4.cus_id
	                    and t1.check5_no  = t4.cus_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.cus_code   = prm_check_item;
	
	            
	         elsif v_column_check = 'CHECK6' then --供应商
	          
	                 select nvl(sum(t1.credit), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join HOS_SUP_DICT t4
	                     on t1.check6_id  = t4.sup_id
	                    and t1.check6_no  = t4.sup_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.sup_code   = prm_check_item;
	
	          
	           elsif v_column_check = 'CHECK7' then --资金来源
	           
	                 select nvl(sum(t1.credit), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join HOS_SOURCE t4
	                     on t1.check7_id  = t4.source_id
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.source_code   = prm_check_item;
	            
	           elsif v_column_check = 'CHECK8' then --单位
	            
	                 select nvl(sum(t1.credit), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                   
	                   left join V_HOS_DICT t4
	                     on t1.check8_id  = t4.hos_id
	                    and t1.group_id   = t4.group_id
	                    and t4.is_stop    = 0
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.hos_code   = prm_check_item
	                  and t4.is_stop    = 0;
	
	            
	         else    --自定义 ZCHECK1
	            
	                 v_sql :='select  nvl(sum(t1.credit), 0)
	                            from acc_vouch_check t1
	                            left join acc_vouch t2
	                             on t1.vouch_id  = t2.vouch_id
	                            and t1.group_id  = t2.group_id
	                            and t1.hos_id    = t2.hos_id
	                            and t1.copy_code = t2.copy_code
	                            and t1.acc_year  = t2.acc_year	                          
	                          left join ACC_CHECK_ITEM t4
	                           on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
	                           and t1.group_id  = t4.group_id
	                           and t1.hos_id    = t4.hos_id
	                           and t1.copy_code = t4.copy_code
	                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                         where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                           and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                           and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                           and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                           and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
	                           and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                           and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	                          ;
	                  Dbms_Output.put_line(v_sql);
	                 execute immediate v_sql into n_period_money;
	         
	
	          end if;
	          n_ret := n_init_money + n_period_money;
	
	      else   --外币
	          if v_column_check = 'CHECK1' then  --部门
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join hos_dept_dict t3
	                  on t1.check1_id = t3.dept_id
	                 and t1.CHECK1_NO = t3.dept_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.dept_code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK2' then --职工
	              select count(1)
	                into n_count
	                from acc_leder_check t1	               
	               left join hos_emp_dict t3
	                  on t1.check2_id = t3.emp_id
	                 and t1.check1_no = t3.emp_no
	                 and t1.group_id = t3.group_id
	                 and t1.hos_id   = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.emp_code       = prm_check_item;
	
	         elsif v_column_check = 'CHECK3' then --项目
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join hos_proj_dict t3
	                  on t1.check3_id = t3.proj_id
	                 and t1.check3_no = t3.proj_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.proj_code      = prm_check_item;
	
	          elsif v_column_check = 'CHECK4' then --库房
	              select count(1)
	                into n_count
	                from acc_leder_check t1	               
	               left join hos_store_dict t3
	                  on t1.check4_id = t3.store_id
	                 and t1.check4_no = t3.store_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.store_code     = prm_check_item;
	
	          elsif v_column_check = 'CHECK5' then --客户
	              select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join HOS_CUS_DICT t3
	                  on t1.check5_id = t3.cus_id
	                 and t1.check5_no = t3.cus_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.Cus_Code      = prm_check_item;
	
	         elsif v_column_check = 'CHECK6' then --供应商
	              select count(1)
	                into n_count
	                from acc_leder_check t1	             
	               left join HOS_SUP_DICT t3
	                  on t1.check6_id = t3.sup_id
	                 and t1.check6_no = t3.sup_no
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.sup_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK7' then --资金来源
	             select count(1)
	                into n_count
	                from acc_leder_check t1	              
	               left join HOS_SOURCE t3
	                  on t1.check7_id = t3.source_id
	                 and t1.group_id  = t3.group_id
	                 and t1.hos_id    = t3.hos_id
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.source_code    = prm_check_item;
	
	           elsif v_column_check = 'CHECK8' then --单位
	              select count(1)
	                into n_count
	                from acc_leder_check t1	            
	               left join V_HOS_DICT t3
	                  on t1.check8_id = t3.hos_id
	                 and t1.group_id  = t3.group_id
	                 and t3.is_stop   = 0
	               where t1.group_id       = prm_group_id
	                 and t1.hos_id         = prm_hos_id
	                 and t1.copy_code      = prm_copy_code
	                 and t1.acc_year       = prm_acc_year
	                 and t1.acc_month      = '00'
	                 and t1.subj_code   like prm_subj_code || '%'
	                 and t3.hos_code       = prm_check_item
	                 and t3.is_stop        = 0;
	         else    --自定义 ZCHECK1
	           v_sql :='select count(1)
	                      from acc_leder_check t1	                    
	                     left join ACC_CHECK_ITEM t3
	                        on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                       and t1.group_id  = t3.group_id
	                       and t1.hos_id    = t3.hos_id
	                       and t1.copy_code = t3.copy_code
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                     where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                       and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                       and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                       and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                       and t1.acc_month      = ''00''
	                       and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                       and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                       and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	              ;
	              execute immediate v_sql into n_count;
	         end if;
	
	         if n_count > 0 then
	
	           v_sql := '';
	
	           --获取初始账年初余额
	           if v_column_check = 'CHECK1' then  --部门
	                select nvl(sum(t1.sum_oc_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join hos_dept_dict t3
	                    on t1.check1_id = t3.dept_id
	                   and t1.CHECK1_NO = t3.dept_no
	                   and t1.group_id = t3.group_id
	                   and t1.hos_id   = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.dept_code      = prm_check_item;
	
	           elsif v_column_check = 'CHECK2' then --职工
	                select nvl(sum(t1.sum_oc_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_emp_dict t3
	                    on t1.check2_id = t3.emp_id
	                   and t1.check2_no = t3.emp_no
	                   and t1.group_id = t3.group_id
	                   and t1.hos_id   = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.emp_code       = prm_check_item;
	
	           elsif v_column_check = 'CHECK3' then --项目
	                select nvl(sum(t1.sum_oc_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join hos_proj_dict t3
	                    on t1.check3_id = t3.proj_id
	                   and t1.check3_no = t3.proj_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.proj_code      = prm_check_item;
	
	            elsif v_column_check = 'CHECK4' then --库房
	                select nvl(sum(t1.sum_oc_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join hos_store_dict t3
	                    on t1.check4_id = t3.store_id
	                   and t1.check4_no = t3.store_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.store_code     = prm_check_item;
	
	            elsif v_column_check = 'CHECK5' then --客户
	                select nvl(sum(t1.sum_oc_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join HOS_CUS_DICT t3
	                    on t1.check5_id = t3.cus_id
	                   and t1.check5_no = t3.cus_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.Cus_Code      = prm_check_item;
	
	           elsif v_column_check = 'CHECK6' then --供应商
	                select nvl(sum(t1.sum_oc_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	                
	                 left join HOS_SUP_DICT t3
	                    on t1.check6_id = t3.sup_id
	                   and t1.check6_no = t3.sup_no
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.sup_code       = prm_check_item;
	
	             elsif v_column_check = 'CHECK7' then --资金来源
	                select nvl(sum(t1.sum_oc_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	               
	                 left join HOS_SOURCE t3
	                    on t1.check7_id = t3.source_id
	                   and t1.group_id  = t3.group_id
	                   and t1.hos_id    = t3.hos_id
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.source_code    = prm_check_item;
	
	             elsif v_column_check = 'CHECK8' then --单位
	                select nvl(sum(t1.sum_oc_w), 0)
	                  into n_init_money
	                  from acc_leder_check t1	              
	                 left join V_HOS_DICT t3
	                    on t1.check8_id = t3.hos_id
	                   and t1.group_id  = t3.group_id
	                   and t3.is_stop   = 0
	                 where t1.group_id       = prm_group_id
	                   and t1.hos_id         = prm_hos_id
	                   and t1.copy_code      = prm_copy_code
	                   and t1.acc_year       = prm_acc_year
	                   and t1.acc_month      = '00'
	                   and t1.subj_code   like prm_subj_code || '%'
	                   and t3.hos_code       = prm_check_item
	                   and t3.is_stop        = 0;
	           else    --自定义 ZCHECK1
	             v_sql :='select nvl(sum(t1.sum_oc_w), 0)
	                        from acc_leder_check t1	                     
	                       left join ACC_CHECK_ITEM t3
	                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
	                         and t1.group_id  = t3.group_id
	                         and t1.hos_id    = t3.hos_id
	                         and t1.copy_code = t3.copy_code
	                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                         and t1.acc_month      = ''00''
	                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	                ;
	                execute immediate v_sql into n_init_money;
	              end if;
	         end if;
	
	
	         if v_column_check = 'CHECK1' then  --部门
	           
	                 select nvl(sum(t1.credit_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                   
	                   left join hos_dept_dict t4
	                     on t1.check1_id  = t4.dept_id
	                    and t1.check1_no  = t4.dept_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.dept_code   = prm_check_item;
	           
	
	         elsif v_column_check = 'CHECK2' then --职工
	
	                 select nvl(sum(t1.credit_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join hos_emp_dict t4
	                     on t1.check2_id  = t4.emp_id
	                    and t1.check2_no  = t4.emp_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.emp_code   = prm_check_item;
	           
	
	         elsif v_column_check = 'CHECK3' then --项目
	
	                 select nvl(sum(t1.credit_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join hos_proj_dict t4
	                     on t1.check3_id  = t4.proj_id
	                    and t1.check3_no  = t4.proj_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.proj_code   = prm_check_item;
	
	            
	          elsif v_column_check = 'CHECK4' then --库房
	             
	                 select nvl(sum(t1.credit_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join hos_store_dict t4
	                     on t1.check4_id  = t4.store_id
	                    and t1.check4_no  = t4.store_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.store_code   = prm_check_item;
	
	            
	          elsif v_column_check = 'CHECK5' then --客户
	             
	                 select nvl(sum(t1.credit_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                  
	                   left join HOS_CUS_DICT t4
	                     on t1.check5_id  = t4.cus_id
	                    and t1.check5_no  = t4.cus_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.cus_code   = prm_check_item;
	
	            
	         elsif v_column_check = 'CHECK6' then --供应商
	            
	                 select nvl(sum(t1.credit_w), 0)
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                   
	                   left join HOS_SUP_DICT t4
	                     on t1.check6_id  = t4.sup_id
	                    and t1.check6_no  = t4.sup_no
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.sup_code   = prm_check_item;
	
	           
	           elsif v_column_check = 'CHECK7' then --资金来源
	            
	                 select nvl(sum(t1.credit_w), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                 
	                   left join HOS_SOURCE t4
	                     on t1.check7_id  = t4.source_id
	                    and t1.group_id   = t4.group_id
	                    and t1.hos_id     = t4.hos_id
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.source_code   = prm_check_item;
	
	            
	           elsif v_column_check = 'CHECK8' then --单位
	            
	                 select nvl(sum(t1.credit_w), 0) 
	                   into n_period_money
	                   from acc_vouch_check t1
	                   left join acc_vouch t2
	                     on t1.vouch_id  = t2.vouch_id
	                    and t1.group_id  = t2.group_id
	                    and t1.hos_id    = t2.hos_id
	                    and t1.copy_code = t2.copy_code
	                    and t1.acc_year  = t2.acc_year	                
	                   left join V_HOS_DICT t4
	                     on t1.check8_id  = t4.hos_id
	                    and t1.group_id   = t4.group_id
	                    and t4.is_stop    = 0
	                 where t1.group_id   = prm_group_id
	                  and t1.hos_id      = prm_hos_id
	                  and t1.copy_code   = prm_copy_code
	                  and t1.acc_year    = prm_acc_year
	                  and t2.acc_month   <= prm_acc_month
	                  and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
	                  and t1.subj_code   like prm_subj_code || '%'
	                  and t4.hos_code   = prm_check_item
	                  and t4.is_stop    = 0;
	
	            
	         else    --自定义 ZCHECK1
	
	                 v_sql :='select  nvl(sum(t1.credit_w), 0)
	                            from acc_vouch_check t1
	                            left join acc_vouch t2
	                             on t1.vouch_id  = t2.vouch_id
	                            and t1.group_id  = t2.group_id
	                            and t1.hos_id    = t2.hos_id
	                            and t1.copy_code = t2.copy_code
	                            and t1.acc_year  = t2.acc_year	                          
	                          left join ACC_CHECK_ITEM t4
	                           on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
	                           and t1.group_id  = t4.group_id
	                           and t1.hos_id    = t4.hos_id
	                           and t1.copy_code = t4.copy_code
	                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
	                         where t1.group_id       =   '|| to_char(prm_group_id)    || '
	                           and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
	                           and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
	                           and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
	                           and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
	                           and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
	                           and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
	                           and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
	                          ;
	                 execute immediate v_sql into n_period_money;
	            
	          end if;
	          n_ret := n_init_money + n_period_money;
	      end if;
	    end if;
	
	    return n_ret;
	
	  EXCEPTION
	      WHEN NO_DATA_FOUND THEN
	         return 0;
	      WHEN OTHERS THEN
	         return 0;
	  END RF_ACC_BNLD_CK;
	
	]]></sql>
	
	
		<sql id="rf_acc_bqj_ck" type="fun" desc="取辅助核算本期借方发生额"><![CDATA[
	    /*-------------------------------------------------------------------------
	   || 功能描述 ：取辅助核算本期借方发生额
	   || 参数描述 ：参数标识          名称             输入/输出    类型
	   ||            -------------------------------------------------------------
	   ||            prm_group_id       集团             IN           NUMBER
	   ||            prm_hos_id         医院             IN           NUMBER
	   ||            prm_copy_code      账套             IN           VARCHAR2
	   ||            prm_acc_year       年度             IN           VARCHAR2
	   ||            prm_acc_month      月份             IN           VARCHAR2
	   ||            prm_subj_code      会计科目         IN           VARCHAR2
	   ||            prm_check_type     核算类           IN           VARCHAR2
	   ||            prm_check_item     核算项           IN           VARCHAR2
	   ||            prm_cur            币种:RMB/USB     IN           VARCHAR2   
	   ||            prm_con_acc        是否包含未记账   IN           NUMBER
	   ||
	   || 返 回 值 ：                   取辅助核算本期借方发生额       OUT          NUMBER
	   ||
	   || 作    者 ：           完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：           修改日期：
	   ||-------------------------------------------------------------------------*/
  		CREATE OR REPLACE FUNCTION RF_ACC_BQJ_CK( prm_group_id       IN    NUMBER        --集团
                                              ,prm_hos_id         IN    NUMBER        --医院
                                              ,prm_copy_code      IN    VARCHAR2      --帐套
                                              ,prm_acc_year       IN    VARCHAR2      --年度
                                              ,prm_acc_month      IN    VARCHAR2      --月份
                                              ,prm_subj_code      IN    VARCHAR2      --科目编码
                                              ,prm_check_type     IN    VARCHAR2      --核算类
                                              ,prm_check_item     IN    VARCHAR2      --核算项
                                              ,prm_cur            IN    VARCHAR2      --币种  RMB/USB
                                              ,prm_con_acc        IN    NUMBER        --是否包括未记账 0:不包含未记账  1:包含未记账
                                              ) RETURN NUMBER
    IS
      n_init_money      NUMBER(19,6);  --初始余额
      n_period_money    NUMBER(19,6);  --累计发生额
      n_count           integer:= 0 ;
      n_ret             NUMBER(19,6);
  
      v_CHECK_TYPE_ID   ACC_CHECK_TYPE.Check_Type_Id%type;
      v_column_check    ACC_CHECK_TYPE.Column_Check%type;
      v_sql             varchar2(4000);
  
  
    BEGIN
      --初始化变量     
      n_ret          :=  0 ;   
      v_CHECK_TYPE_ID := 0       ;
      v_column_check  := 'CHECK1';
      v_sql           := ''      ;
  
  
      --检查辅助核算类表是否存在数据
      SELECT count(1)
        into n_count
        FROM ACC_CHECK_TYPE
       WHERE group_id        = prm_group_id
         AND hos_id          = prm_hos_id
         AND copy_code       = prm_copy_code
         AND check_type_name = prm_check_type
         AND  is_stop        = 0;
  
      if n_count = 0 then
         return 0;
      else
         n_count := 0 ;
      end if;
  
      --获取核算类对应的列
      SELECT CHECK_TYPE_ID,Column_Check
        into v_CHECK_TYPE_ID,v_column_check
        FROM ACC_CHECK_TYPE
       WHERE group_id        = prm_group_id
         AND hos_id          = prm_hos_id
         AND copy_code       = prm_copy_code
         AND check_type_name = prm_check_type
         AND  is_stop        = 0
        ;
  
      if prm_con_acc = 0 then      --从帐表中获取本期借方
        if prm_cur = 'RMB' then    --币种为RMB
            if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;
  
           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check1_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;
  
           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;
  
            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;
  
            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;
  
           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1                 
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;
  
             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;
  
             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
				   and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.this_od), 0)
                        from acc_leder_check t1                      
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_ret;
           end if;
        else  --币种为外币
            if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;
  
           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check1_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;
  
           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;
  
            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;
  
            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;
  
           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;
  
             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;
  
             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
             and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.this_od_w), 0)
                        from acc_leder_check t1                      
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_ret;
           end if;
        end if;
      else    --包含未记账，从凭证中获取
      
  
        if prm_cur = 'RMB' then    --币种为RMB
  
           if v_column_check = 'CHECK1' then  --部门            
  
                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join hos_dept_dict t4
                       on t1.check1_id  = t4.dept_id
                      and t1.check1_no  = t4.dept_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.dept_code   = prm_check_item;
  
              
  
           elsif v_column_check = 'CHECK2' then --职工
                
  
                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join hos_emp_dict t4
                       on t1.check2_id  = t4.emp_id
                      and t1.check2_no  = t4.emp_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.emp_code   = prm_check_item;
              
  
           elsif v_column_check = 'CHECK3' then --项目
  
                   select nvl(sum(t1.DEBIT), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join hos_proj_dict t4
                       on t1.check3_id  = t4.proj_id
                      and t1.check3_no  = t4.proj_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.proj_code   = prm_check_item;
  
              
            elsif v_column_check = 'CHECK4' then --库房
               
                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                  
                     left join hos_store_dict t4
                       on t1.check4_id  = t4.store_id
                      and t1.check4_no  = t4.store_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.store_code   = prm_check_item;
              
            elsif v_column_check = 'CHECK5' then --客户
             
                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join HOS_CUS_DICT t4
                       on t1.check5_id  = t4.cus_id
                      and t1.check5_no  = t4.cus_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.cus_code   = prm_check_item;
  
              
           elsif v_column_check = 'CHECK6' then --供应商
            
                   select nvl(sum(t1.DEBIT), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join HOS_SUP_DICT t4
                       on t1.check6_id  = t4.sup_id
                      and t1.check6_no  = t4.sup_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.sup_code   = prm_check_item;
  
            
             elsif v_column_check = 'CHECK7' then --资金来源
             
                   select nvl(sum(t1.DEBIT), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join HOS_SOURCE t4
                       on t1.check7_id  = t4.source_id
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.source_code   = prm_check_item;
              
             elsif v_column_check = 'CHECK8' then --单位
              
                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join V_HOS_DICT t4
                       on t1.check8_id  = t4.hos_id
                      and t1.group_id   = t4.group_id
                      and t4.is_stop    = 0
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.hos_code   = prm_check_item
                    and t4.is_stop    = 0;
  
              
           else    --自定义 ZCHECK1
              
                   v_sql :='select  nvl(sum(t1.DEBIT), 0)
                              from acc_vouch_check t1
                              left join acc_vouch t2
                               on t1.vouch_id  = t2.vouch_id
                              and t1.group_id  = t2.group_id
                              and t1.hos_id    = t2.hos_id
                              and t1.copy_code = t2.copy_code
                              and t1.acc_year  = t2.acc_year                           
                            left join ACC_CHECK_ITEM t4
                             on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                             and t1.group_id  = t4.group_id
                             and t1.hos_id    = t4.hos_id
                             and t1.copy_code = t4.copy_code
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                           where t1.group_id       =   '|| to_char(prm_group_id)    || '
                             and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                             and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                             and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                             and t2.acc_month     = '''|| to_char(prm_acc_month)   || '''
                             and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                             and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                            ;
                    Dbms_Output.put_line(v_sql);
                   execute immediate v_sql into n_ret;
           
  
            end if;           
  
        else   --外币
            
  
           if v_column_check = 'CHECK1' then  --部门
             
                   select nvl(sum(t1.debit_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join hos_dept_dict t4
                       on t1.check1_id  = t4.dept_id
                      and t1.check1_no  = t4.dept_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.dept_code   = prm_check_item;
             
  
           elsif v_column_check = 'CHECK2' then --职工
  
                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join hos_emp_dict t4
                       on t1.check2_id  = t4.emp_id
                      and t1.check2_no  = t4.emp_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.emp_code   = prm_check_item;
             
  
           elsif v_column_check = 'CHECK3' then --项目
  
                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join hos_proj_dict t4
                       on t1.check3_id  = t4.proj_id
                      and t1.check3_no  = t4.proj_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.proj_code   = prm_check_item;
  
              
            elsif v_column_check = 'CHECK4' then --库房
               
                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join hos_store_dict t4
                       on t1.check4_id  = t4.store_id
                      and t1.check4_no  = t4.store_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.store_code   = prm_check_item;
  
              
            elsif v_column_check = 'CHECK5' then --客户
               
                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join HOS_CUS_DICT t4
                       on t1.check5_id  = t4.cus_id
                      and t1.check5_no  = t4.cus_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.cus_code   = prm_check_item;
  
              
           elsif v_column_check = 'CHECK6' then --供应商
              
                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join HOS_SUP_DICT t4
                       on t1.check6_id  = t4.sup_id
                      and t1.check6_no  = t4.sup_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.sup_code   = prm_check_item;
  
             
             elsif v_column_check = 'CHECK7' then --资金来源
              
                   select nvl(sum(t1.DEBIT_w), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join HOS_SOURCE t4
                       on t1.check7_id  = t4.source_id
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.source_code   = prm_check_item;
  
              
             elsif v_column_check = 'CHECK8' then --单位
              
                   select nvl(sum(t1.DEBIT_w), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join V_HOS_DICT t4
                       on t1.check8_id  = t4.hos_id
                      and t1.group_id   = t4.group_id
                      and t4.is_stop    = 0
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.hos_code   = prm_check_item
                    and t4.is_stop    = 0;
  
              
           else    --自定义 ZCHECK1
  
                   v_sql :='select  nvl(sum(t1.DEBIT_w), 0)
                              from acc_vouch_check t1
                              left join acc_vouch t2
                               on t1.vouch_id  = t2.vouch_id
                              and t1.group_id  = t2.group_id
                              and t1.hos_id    = t2.hos_id
                              and t1.copy_code = t2.copy_code
                              and t1.acc_year  = t2.acc_year                            
                            left join ACC_CHECK_ITEM t4
                             on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                             and t1.group_id  = t4.group_id
                             and t1.hos_id    = t4.hos_id
                             and t1.copy_code = t4.copy_code
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                           where t1.group_id       =   '|| to_char(prm_group_id)    || '
                             and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                             and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                             and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                             and t2.acc_month     = '''|| to_char(prm_acc_month)   || '''
                             and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                             and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                            ;
                   execute immediate v_sql into n_ret;
              
            end if;
           
        end if;
      end if;
  
      return n_ret;
  
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
           return 0;
        WHEN OTHERS THEN
           return 0;
    END RF_ACC_BQJ_CK;

	]]></sql>
	
	
	
	<sql id="rf_acc_bqd_ck" type="fun" desc="取辅助核算本期贷方发生额"><![CDATA[
	    /*-------------------------------------------------------------------------
	   || 功能描述 ：取辅助核算本期贷方发生额
	   || 参数描述 ：参数标识          名称             输入/输出    类型
	   ||            -------------------------------------------------------------
	   ||            prm_group_id       集团             IN           NUMBER
	   ||            prm_hos_id         医院             IN           NUMBER
	   ||            prm_copy_code      账套             IN           VARCHAR2
	   ||            prm_acc_year       年度             IN           VARCHAR2
	   ||            prm_acc_month      月份             IN           VARCHAR2
	   ||            prm_subj_code      会计科目         IN           VARCHAR2
	   ||            prm_check_type     核算类           IN           VARCHAR2
	   ||            prm_check_item     核算项           IN           VARCHAR2
	   ||            prm_cur            币种:RMB/USB     IN           VARCHAR2   
	   ||            prm_con_acc        是否包含未记账   IN           NUMBER
	   ||
	   || 返 回 值 ：                   取辅助核算本期贷方发生额       OUT          NUMBER
	   ||
	   || 作    者 ：           完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：           修改日期：
	   ||-------------------------------------------------------------------------*/
  		CREATE OR REPLACE FUNCTION RF_ACC_BQD_CK( prm_group_id       IN    NUMBER        --集团
                                              ,prm_hos_id         IN    NUMBER        --医院
                                              ,prm_copy_code      IN    VARCHAR2      --帐套
                                              ,prm_acc_year       IN    VARCHAR2      --年度
                                              ,prm_acc_month      IN    VARCHAR2      --月份
                                              ,prm_subj_code      IN    VARCHAR2      --科目编码
                                              ,prm_check_type     IN    VARCHAR2      --核算类
                                              ,prm_check_item     IN    VARCHAR2      --核算项
                                              ,prm_cur            IN    VARCHAR2      --币种  RMB/USB
                                              ,prm_con_acc        IN    NUMBER        --是否包括未记账 0:不包含未记账  1:包含未记账
                                              ) RETURN NUMBER
    IS
      n_init_money      NUMBER(19,6);  --初始余额
      n_period_money    NUMBER(19,6);  --累计发生额
      n_count           integer:= 0 ;
      n_ret             NUMBER(19,6);
  
      v_CHECK_TYPE_ID   ACC_CHECK_TYPE.Check_Type_Id%type;
      v_column_check    ACC_CHECK_TYPE.Column_Check%type;
      v_sql             varchar2(4000);
  
  
    BEGIN
      --初始化变量     
      n_ret          :=  0 ;   
      v_CHECK_TYPE_ID := 0       ;
      v_column_check  := 'CHECK1';
      v_sql           := ''      ;
  
  
      --检查辅助核算类表是否存在数据
      SELECT count(1)
        into n_count
        FROM ACC_CHECK_TYPE
       WHERE group_id        = prm_group_id
         AND hos_id          = prm_hos_id
         AND copy_code       = prm_copy_code
         AND check_type_name = prm_check_type
         AND  is_stop        = 0;
  
      if n_count = 0 then
         return 0;
      else
         n_count := 0 ;
      end if;
  
      --获取核算类对应的列
      SELECT CHECK_TYPE_ID,Column_Check
        into v_CHECK_TYPE_ID,v_column_check
        FROM ACC_CHECK_TYPE
       WHERE group_id        = prm_group_id
         AND hos_id          = prm_hos_id
         AND copy_code       = prm_copy_code
         AND check_type_name = prm_check_type
         AND  is_stop        = 0
        ;
  
      if prm_con_acc = 0 then      --从帐表中获取本期借方
        if prm_cur = 'RMB' then    --币种为RMB
            if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;
  
           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check1_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;
  
           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;
  
            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;
  
            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;
  
           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;
  
             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;
  
             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1                
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
             and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.this_oc), 0)
                        from acc_leder_check t1                      
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_ret;
           end if;
        else  --币种为外币
            if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1                 
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;
  
           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1                 
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check1_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;
  
           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;
  
            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;
  
            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;
  
           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;
  
             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1              
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;
  
             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1               
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
             and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      = prm_acc_month
                   and t1.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.this_oc_w), 0)
                        from acc_leder_check t1                      
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month      = '''|| to_char(prm_acc_month)   || '''
                         and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_ret;
           end if;
        end if;
      else    --包含未记账，从凭证中获取
      
  
        if prm_cur = 'RMB' then    --币种为RMB
  
           if v_column_check = 'CHECK1' then  --部门            
  
                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join hos_dept_dict t4
                       on t1.check1_id  = t4.dept_id
                      and t1.check1_no  = t4.dept_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.dept_code   = prm_check_item;
  
              
  
           elsif v_column_check = 'CHECK2' then --职工
                
  
                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join hos_emp_dict t4
                       on t1.check2_id  = t4.emp_id
                      and t1.check2_no  = t4.emp_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.emp_code   = prm_check_item;
              
  
           elsif v_column_check = 'CHECK3' then --项目
  
                   select nvl(sum(t1.CREDIT), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join hos_proj_dict t4
                       on t1.check3_id  = t4.proj_id
                      and t1.check3_no  = t4.proj_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.proj_code   = prm_check_item;
  
              
            elsif v_column_check = 'CHECK4' then --库房
               
                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join hos_store_dict t4
                       on t1.check4_id  = t4.store_id
                      and t1.check4_no  = t4.store_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.store_code   = prm_check_item;
              
            elsif v_column_check = 'CHECK5' then --客户
             
                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join HOS_CUS_DICT t4
                       on t1.check5_id  = t4.cus_id
                      and t1.check5_no  = t4.cus_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.cus_code   = prm_check_item;
  
              
           elsif v_column_check = 'CHECK6' then --供应商
            
                   select nvl(sum(t1.CREDIT), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join HOS_SUP_DICT t4
                       on t1.check6_id  = t4.sup_id
                      and t1.check6_no  = t4.sup_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.sup_code   = prm_check_item;
  
            
             elsif v_column_check = 'CHECK7' then --资金来源
             
                   select nvl(sum(t1.CREDIT), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join HOS_SOURCE t4
                       on t1.check7_id  = t4.source_id
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.source_code   = prm_check_item;
              
             elsif v_column_check = 'CHECK8' then --单位
              
                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                  
                     left join V_HOS_DICT t4
                       on t1.check8_id  = t4.hos_id
                      and t1.group_id   = t4.group_id
                      and t4.is_stop    = 0
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.hos_code   = prm_check_item
                    and t4.is_stop    = 0;
  
              
           else    --自定义 ZCHECK1
              
                   v_sql :='select  nvl(sum(t1.CREDIT), 0)
                              from acc_vouch_check t1
                              left join acc_vouch t2
                               on t1.vouch_id  = t2.vouch_id
                              and t1.group_id  = t2.group_id
                              and t1.hos_id    = t2.hos_id
                              and t1.copy_code = t2.copy_code
                              and t1.acc_year  = t2.acc_year                           
                            left join ACC_CHECK_ITEM t4
                             on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                             and t1.group_id  = t4.group_id
                             and t1.hos_id    = t4.hos_id
                             and t1.copy_code = t4.copy_code
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                           where t1.group_id       =   '|| to_char(prm_group_id)    || '
                             and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                             and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                             and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                             and t2.acc_month     = '''|| to_char(prm_acc_month)   || '''
                             and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                             and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                            ;
                    Dbms_Output.put_line(v_sql);
                   execute immediate v_sql into n_ret;
           
  
            end if;           
  
        else   --外币
            
  
           if v_column_check = 'CHECK1' then  --部门
             
                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join hos_dept_dict t4
                       on t1.check1_id  = t4.dept_id
                      and t1.check1_no  = t4.dept_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.dept_code   = prm_check_item;
             
  
           elsif v_column_check = 'CHECK2' then --职工
  
                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join hos_emp_dict t4
                       on t1.check2_id  = t4.emp_id
                      and t1.check2_no  = t4.emp_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.emp_code   = prm_check_item;
             
  
           elsif v_column_check = 'CHECK3' then --项目
  
                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join hos_proj_dict t4
                       on t1.check3_id  = t4.proj_id
                      and t1.check3_no  = t4.proj_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.proj_code   = prm_check_item;
  
              
            elsif v_column_check = 'CHECK4' then --库房
               
                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join hos_store_dict t4
                       on t1.check4_id  = t4.store_id
                      and t1.check4_no  = t4.store_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.store_code   = prm_check_item;
  
              
            elsif v_column_check = 'CHECK5' then --客户
               
                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join HOS_CUS_DICT t4
                       on t1.check5_id  = t4.cus_id
                      and t1.check5_no  = t4.cus_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.cus_code   = prm_check_item;
  
              
           elsif v_column_check = 'CHECK6' then --供应商
              
                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                   
                     left join HOS_SUP_DICT t4
                       on t1.check6_id  = t4.sup_id
                      and t1.check6_no  = t4.sup_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.sup_code   = prm_check_item;
  
             
             elsif v_column_check = 'CHECK7' then --资金来源
              
                   select nvl(sum(t1.CREDIT_W), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join HOS_SOURCE t4
                       on t1.check7_id  = t4.source_id
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.source_code   = prm_check_item;
  
              
             elsif v_column_check = 'CHECK8' then --单位
              
                   select nvl(sum(t1.CREDIT_W), 0) 
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year                    
                     left join V_HOS_DICT t4
                       on t1.check8_id  = t4.hos_id
                      and t1.group_id   = t4.group_id
                      and t4.is_stop    = 0
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   = prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t1.subj_code   like prm_subj_code || '%'
                    and t4.hos_code   = prm_check_item
                    and t4.is_stop    = 0;
  
              
           else    --自定义 ZCHECK1
  
                   v_sql :='select  nvl(sum(t1.CREDIT_W), 0)
                              from acc_vouch_check t1
                              left join acc_vouch t2
                               on t1.vouch_id  = t2.vouch_id
                              and t1.group_id  = t2.group_id
                              and t1.hos_id    = t2.hos_id
                              and t1.copy_code = t2.copy_code
                              and t1.acc_year  = t2.acc_year                            
                            left join ACC_CHECK_ITEM t4
                             on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                             and t1.group_id  = t4.group_id
                             and t1.hos_id    = t4.hos_id
                             and t1.copy_code = t4.copy_code
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                           where t1.group_id       =   '|| to_char(prm_group_id)    || '
                             and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                             and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                             and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                             and t2.acc_month     = '''|| to_char(prm_acc_month)   || '''
                             and t1.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                             and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                            ;
                   execute immediate v_sql into n_ret;
              
            end if;
           
        end if;
      end if;
  
      return n_ret;
  
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
           return 0;
        WHEN OTHERS THEN
           return 0;
    END RF_ACC_BQD_CK;

	]]></sql>
	
	<sql id="rf_acc_bqjlj_ck" type="fun" desc="取辅助核算本期借方累计发生额"><![CDATA[
	/*-------------------------------------------------------------------------
     || 函数名称 ：RF_ACC_BQJLJ_CK
     || 功能描述 ：取辅助核算本期贷方累计发生额
     || 参数描述 ：参数标识          名称             输入/输出    类型
     ||            -------------------------------------------------------------
     ||            prm_group_id       集团             IN           NUMBER
     ||            prm_hos_id         医院             IN           NUMBER
     ||            prm_copy_code      账套             IN           VARCHAR2
     ||            prm_acc_year       年度             IN           VARCHAR2
     ||            prm_acc_month      月份             IN           VARCHAR2
     ||            prm_subj_code      会计科目         IN           VARCHAR2
     ||            prm_check_type     核算类           IN           VARCHAR2
     ||            prm_check_item     核算项           IN           VARCHAR2
     ||            prm_cur            币种:RMB/USB     IN           VARCHAR2   
     ||            prm_con_acc        是否包含未记账   IN           NUMBER
     ||
     || 返 回 值 ：                   取辅助核算本期贷方累计发生额       OUT          NUMBER
     ||
     || 作    者 ：           完成日期 ：
     ||-------------------------------------------------------------------------
     || 修改记录 ：           修改日期：
     ||-------------------------------------------------------------------------*/
	CREATE OR REPLACE FUNCTION RF_ACC_BQJLJ_CK( prm_group_id       IN    NUMBER        --集团
                                              ,prm_hos_id         IN    NUMBER        --医院
                                              ,prm_copy_code      IN    VARCHAR2      --帐套
                                              ,prm_acc_year       IN    VARCHAR2      --年度
                                              ,prm_acc_month      IN    VARCHAR2      --月份
                                              ,prm_subj_code      IN    VARCHAR2      --科目编码
                                              ,prm_check_type     IN    VARCHAR2      --核算类
                                              ,prm_check_item     IN    VARCHAR2      --核算项
                                              ,prm_cur            IN    VARCHAR2      --币种  RMB/USB
                                              ,prm_con_acc        IN    NUMBER        --是否包括未记账 0:不包含未记账  1:包含未记账
                                              ) RETURN NUMBER
    IS
      n_init_money      NUMBER(19,6);  --初始余额
      n_period_money    NUMBER(19,6);  --累计发生额
      n_count           integer:= 0 ;
      n_ret             NUMBER(19,6);

      v_CHECK_TYPE_ID   ACC_CHECK_TYPE.Check_Type_Id%type;
      v_column_check    ACC_CHECK_TYPE.Column_Check%type;
      v_sql             varchar2(4000);


    BEGIN
      --初始化变量
      n_ret          :=  0 ;
      v_CHECK_TYPE_ID := 0       ;
      v_column_check  := 'CHECK1';
      v_sql           := ''      ;


      --检查辅助核算类表是否存在数据
      SELECT count(1)
        into n_count
        FROM ACC_CHECK_TYPE
       WHERE group_id        = prm_group_id
         AND hos_id          = prm_hos_id
         AND copy_code       = prm_copy_code
         AND check_type_name = prm_check_type
         AND  is_stop        = 0;

      if n_count = 0 then
         return 0;
      else
         n_count := 0 ;
      end if;

      --获取核算类对应的列
      SELECT CHECK_TYPE_ID,Column_Check
        into v_CHECK_TYPE_ID,v_column_check
        FROM ACC_CHECK_TYPE
       WHERE group_id        = prm_group_id
         AND hos_id          = prm_hos_id
         AND copy_code       = prm_copy_code
         AND check_type_name = prm_check_type
         AND  is_stop        = 0
        ;

      if prm_con_acc = 0 then      --从帐表中获取本期借方
        if prm_cur = 'RMB' then    --币种为RMB
            if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;

           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check1_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;

           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;

            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;

            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;

           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;

             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;

             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.this_od), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
             and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month    <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.this_od), 0)
                        from acc_leder_check t1
                       left join acc_subj t2
                          on t1.group_id  = t2.group_id
                         and t1.hos_id    = t2.hos_id
                         and t1.copy_code = t2.copy_code
                         and t1.acc_year  = t2.acc_year
                         and t1.subj_code   = t2.subj_code
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month     < = '''|| to_char(prm_acc_month)   || '''
                         and t2.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_ret;
           end if;
        else  --币种为外币
            if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;

           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check1_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month    <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;

           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;

            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;

            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;

           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;

             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;

             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.this_od_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
             and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month      <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.this_od_w), 0)
                        from acc_leder_check t1
                       left join acc_subj t2
                          on t1.group_id  = t2.group_id
                         and t1.hos_id    = t2.hos_id
                         and t1.copy_code = t2.copy_code
                         and t1.acc_year  = t2.acc_year
                         and t1.subj_code   = t2.subj_code
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month     < = '''|| to_char(prm_acc_month)   || '''
                         and t2.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_ret;
           end if;
        end if;
      else    --包含未记账，从凭证中获取


        if prm_cur = 'RMB' then    --币种为RMB

           if v_column_check = 'CHECK1' then  --部门

                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_dept_dict t4
                       on t1.check1_id  = t4.dept_id
                      and t1.check1_no  = t4.dept_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.dept_code   = prm_check_item;



           elsif v_column_check = 'CHECK2' then --职工


                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_emp_dict t4
                       on t1.check2_id  = t4.emp_id
                      and t1.check2_no  = t4.emp_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.emp_code   = prm_check_item;


           elsif v_column_check = 'CHECK3' then --项目

                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_proj_dict t4
                       on t1.check3_id  = t4.proj_id
                      and t1.check3_no  = t4.proj_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.proj_code   = prm_check_item;


            elsif v_column_check = 'CHECK4' then --库房

                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_store_dict t4
                       on t1.check4_id  = t4.store_id
                      and t1.check4_no  = t4.store_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.store_code   = prm_check_item;

            elsif v_column_check = 'CHECK5' then --客户

                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_CUS_DICT t4
                       on t1.check5_id  = t4.cus_id
                      and t1.check5_no  = t4.cus_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.cus_code   = prm_check_item;


           elsif v_column_check = 'CHECK6' then --供应商

                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_SUP_DICT t4
                       on t1.check6_id  = t4.sup_id
                      and t1.check6_no  = t4.sup_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.sup_code   = prm_check_item;


             elsif v_column_check = 'CHECK7' then --资金来源

                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_SOURCE t4
                       on t1.check7_id  = t4.source_id
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.source_code   = prm_check_item;

             elsif v_column_check = 'CHECK8' then --单位

                   select nvl(sum(t1.DEBIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join V_HOS_DICT t4
                       on t1.check8_id  = t4.hos_id
                      and t1.group_id   = t4.group_id
                      and t4.is_stop    = 0
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.hos_code   = prm_check_item
                    and t4.is_stop    = 0;


           else    --自定义 ZCHECK1

                   v_sql :='select  nvl(sum(t1.DEBIT), 0)
                              from acc_vouch_check t1
                              left join acc_vouch t2
                               on t1.vouch_id  = t2.vouch_id
                              and t1.group_id  = t2.group_id
                              and t1.hos_id    = t2.hos_id
                              and t1.copy_code = t2.copy_code
                              and t1.acc_year  = t2.acc_year
                             left join acc_subj t3
                               on t1.group_id  = t3.group_id
                              and t1.hos_id    = t3.hos_id
                              and t1.copy_code = t3.copy_code
                              and t1.acc_year  = t3.acc_year
                              and t1.subj_code   = t3.subj_code
                            left join ACC_CHECK_ITEM t4
                             on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                             and t1.group_id  = t4.group_id
                             and t1.hos_id    = t4.hos_id
                             and t1.copy_code = t4.copy_code
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                           where t1.group_id       =   '|| to_char(prm_group_id)    || '
                             and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                             and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                             and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                             and t2.acc_month    < = '''|| to_char(prm_acc_month)   || '''
                             and t3.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                             and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                            ;
                    Dbms_Output.put_line(v_sql);
                   execute immediate v_sql into n_ret;


            end if;

        else   --外币


           if v_column_check = 'CHECK1' then  --部门

                   select nvl(sum(t1.debit_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_dept_dict t4
                       on t1.check1_id  = t4.dept_id
                      and t1.check1_no  = t4.dept_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.dept_code   = prm_check_item;


           elsif v_column_check = 'CHECK2' then --职工

                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_emp_dict t4
                       on t1.check2_id  = t4.emp_id
                      and t1.check2_no  = t4.emp_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.emp_code   = prm_check_item;


           elsif v_column_check = 'CHECK3' then --项目

                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_proj_dict t4
                       on t1.check3_id  = t4.proj_id
                      and t1.check3_no  = t4.proj_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.proj_code   = prm_check_item;


            elsif v_column_check = 'CHECK4' then --库房

                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_store_dict t4
                       on t1.check4_id  = t4.store_id
                      and t1.check4_no  = t4.store_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.store_code   = prm_check_item;


            elsif v_column_check = 'CHECK5' then --客户

                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_CUS_DICT t4
                       on t1.check5_id  = t4.cus_id
                      and t1.check5_no  = t4.cus_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.cus_code   = prm_check_item;


           elsif v_column_check = 'CHECK6' then --供应商

                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_SUP_DICT t4
                       on t1.check6_id  = t4.sup_id
                      and t1.check6_no  = t4.sup_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.sup_code   = prm_check_item;


             elsif v_column_check = 'CHECK7' then --资金来源

                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_SOURCE t4
                       on t1.check7_id  = t4.source_id
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.source_code   = prm_check_item;


             elsif v_column_check = 'CHECK8' then --单位

                   select nvl(sum(t1.DEBIT_w), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join V_HOS_DICT t4
                       on t1.check8_id  = t4.hos_id
                      and t1.group_id   = t4.group_id
                      and t4.is_stop    = 0
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month   <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.hos_code   = prm_check_item
                    and t4.is_stop    = 0;


           else    --自定义 ZCHECK1

                   v_sql :='select  nvl(sum(t1.DEBIT_w), 0)
                              from acc_vouch_check t1
                              left join acc_vouch t2
                               on t1.vouch_id  = t2.vouch_id
                              and t1.group_id  = t2.group_id
                              and t1.hos_id    = t2.hos_id
                              and t1.copy_code = t2.copy_code
                              and t1.acc_year  = t2.acc_year
                             left join acc_subj t3
                               on t1.group_id  = t3.group_id
                              and t1.hos_id    = t3.hos_id
                              and t1.copy_code = t3.copy_code
                              and t1.acc_year  = t3.acc_year
                              and t1.subj_code   = t3.subj_code
                            left join ACC_CHECK_ITEM t4
                             on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                             and t1.group_id  = t4.group_id
                             and t1.hos_id    = t4.hos_id
                             and t1.copy_code = t4.copy_code
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                           where t1.group_id       =   '|| to_char(prm_group_id)    || '
                             and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                             and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                             and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                             and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                             and t3.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                             and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                            ;
                   execute immediate v_sql into n_ret;

            end if;

        end if;
      end if;

      return n_ret;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
           return 0;
        WHEN OTHERS THEN
           return 0;
    END RF_ACC_BQJLJ_CK;
	
	]]></sql>
	
	
	<sql id="rf_acc_bqdlj_ck" type="fun" desc="取辅助核算本期贷方累计发生额"><![CDATA[
	/*-------------------------------------------------------------------------
     || 函数名称 ：RF_ACC_BQDLJ_CK
     || 功能描述 ：取辅助核算本期贷方累计发生额
     || 参数描述 ：参数标识          名称             输入/输出    类型
     ||            -------------------------------------------------------------
     ||            prm_group_id       集团             IN           NUMBER
     ||            prm_hos_id         医院             IN           NUMBER
     ||            prm_copy_code      账套             IN           VARCHAR2
     ||            prm_acc_year       年度             IN           VARCHAR2
     ||            prm_acc_month      月份             IN           VARCHAR2
     ||            prm_subj_code      会计科目         IN           VARCHAR2
     ||            prm_check_type     核算类           IN           VARCHAR2
     ||            prm_check_item     核算项           IN           VARCHAR2
     ||            prm_cur            币种:RMB/USB     IN           VARCHAR2   
     ||            prm_con_acc        是否包含未记账   IN           NUMBER
     ||
     || 返 回 值 ：                   取辅助核算本期贷方累计发生额       OUT          NUMBER
     ||
     || 作    者 ：           完成日期 ：
     ||-------------------------------------------------------------------------
     || 修改记录 ：           修改日期：
     ||-------------------------------------------------------------------------*/
     CREATE OR REPLACE FUNCTION RF_ACC_BQDLJ_CK( prm_group_id       IN    NUMBER        --集团
                                              ,prm_hos_id         IN    NUMBER        --医院
                                              ,prm_copy_code      IN    VARCHAR2      --帐套
                                              ,prm_acc_year       IN    VARCHAR2      --年度
                                              ,prm_acc_month      IN    VARCHAR2      --月份
                                              ,prm_subj_code      IN    VARCHAR2      --科目编码
                                              ,prm_check_type     IN    VARCHAR2      --核算类
                                              ,prm_check_item     IN    VARCHAR2      --核算项
                                              ,prm_cur            IN    VARCHAR2      --币种  RMB/USB
                                              ,prm_con_acc        IN    NUMBER        --是否包括未记账 0:不包含未记账  1:包含未记账
                                              ) RETURN NUMBER
    IS
      n_init_money      NUMBER(19,6);  --初始余额
      n_period_money    NUMBER(19,6);  --累计发生额
      n_count           integer:= 0 ;
      n_ret             NUMBER(19,6);

      v_CHECK_TYPE_ID   ACC_CHECK_TYPE.Check_Type_Id%type;
      v_column_check    ACC_CHECK_TYPE.Column_Check%type;
      v_sql             varchar2(4000);


    BEGIN
      --初始化变量
      n_ret          :=  0 ;
      v_CHECK_TYPE_ID := 0       ;
      v_column_check  := 'CHECK1';
      v_sql           := ''      ;


      --检查辅助核算类表是否存在数据
      SELECT count(1)
        into n_count
        FROM ACC_CHECK_TYPE
       WHERE group_id        = prm_group_id
         AND hos_id          = prm_hos_id
         AND copy_code       = prm_copy_code
         AND check_type_name = prm_check_type
         AND  is_stop        = 0;

      if n_count = 0 then
         return 0;
      else
         n_count := 0 ;
      end if;

      --获取核算类对应的列
      SELECT CHECK_TYPE_ID,Column_Check
        into v_CHECK_TYPE_ID,v_column_check
        FROM ACC_CHECK_TYPE
       WHERE group_id        = prm_group_id
         AND hos_id          = prm_hos_id
         AND copy_code       = prm_copy_code
         AND check_type_name = prm_check_type
         AND  is_stop        = 0
        ;

      if prm_con_acc = 0 then      --从帐表中获取本期贷方
        if prm_cur = 'RMB' then    --币种为RMB
            if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;

           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check1_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;

           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;

            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;

            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;

           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;

             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;

             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.this_oc), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
             and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.this_oc), 0)
                        from acc_leder_check t1
                       left join acc_subj t2
                          on t1.group_id  = t2.group_id
                         and t1.hos_id    = t2.hos_id
                         and t1.copy_code = t2.copy_code
                         and t1.acc_year  = t2.acc_year
                         and t1.subj_code   = t2.subj_code
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                         and t2.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_ret;
           end if;
        else  --币种为外币
            if v_column_check = 'CHECK1' then  --部门
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_dept_dict t3
                    on t1.check1_id = t3.dept_id
                   and t1.CHECK1_NO = t3.dept_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.dept_code      = prm_check_item;

           elsif v_column_check = 'CHECK2' then --职工
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_emp_dict t3
                    on t1.check2_id = t3.emp_id
                   and t1.check1_no = t3.emp_no
                   and t1.group_id = t3.group_id
                   and t1.hos_id   = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.emp_code       = prm_check_item;

           elsif v_column_check = 'CHECK3' then --项目
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_proj_dict t3
                    on t1.check3_id = t3.proj_id
                   and t1.check3_no = t3.proj_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.proj_code      = prm_check_item;

            elsif v_column_check = 'CHECK4' then --库房
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join hos_store_dict t3
                    on t1.check4_id = t3.store_id
                   and t1.check4_no = t3.store_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.store_code     = prm_check_item;

            elsif v_column_check = 'CHECK5' then --客户
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_CUS_DICT t3
                    on t1.check5_id = t3.cus_id
                   and t1.check5_no = t3.cus_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.Cus_Code      = prm_check_item;

           elsif v_column_check = 'CHECK6' then --供应商
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_SUP_DICT t3
                    on t1.check6_id = t3.sup_id
                   and t1.check6_no = t3.sup_no
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.sup_code       = prm_check_item;

             elsif v_column_check = 'CHECK7' then --资金来源
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join HOS_SOURCE t3
                    on t1.check7_id = t3.source_id
                   and t1.group_id  = t3.group_id
                   and t1.hos_id    = t3.hos_id
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.source_code    = prm_check_item;

             elsif v_column_check = 'CHECK8' then --单位
                select nvl(sum(t1.this_oc_w), 0)
                  into n_ret
                  from acc_leder_check t1
                 left join acc_subj t2
                    on t1.group_id  = t2.group_id
                   and t1.hos_id    = t2.hos_id
                   and t1.copy_code = t2.copy_code
                   and t1.acc_year  = t2.acc_year
                   and t1.subj_code   = t2.subj_code
                 left join V_HOS_DICT t3
                    on t1.check8_id = t3.hos_id
                   and t1.group_id  = t3.group_id
             and t3.is_stop   = 0
                 where t1.group_id       = prm_group_id
                   and t1.hos_id         = prm_hos_id
                   and t1.copy_code      = prm_copy_code
                   and t1.acc_year       = prm_acc_year
                   and t1.acc_month     <= prm_acc_month
                   and t2.subj_code   like prm_subj_code || '%'
                   and t3.hos_code       = prm_check_item
           and t3.is_stop        = 0;
           else    --自定义 ZCHECK1
             v_sql :='select nvl(sum(t1.this_oc_w), 0)
                        from acc_leder_check t1
                       left join acc_subj t2
                          on t1.group_id  = t2.group_id
                         and t1.hos_id    = t2.hos_id
                         and t1.copy_code = t2.copy_code
                         and t1.acc_year  = t2.acc_year
                         and t1.subj_code   = t2.subj_code
                       left join ACC_CHECK_ITEM t3
                          on t1.'||v_column_check ||'= t3.CHECK_ITEM_ID
                         and t1.group_id  = t3.group_id
                         and t1.hos_id    = t3.hos_id
                         and t1.copy_code = t3.copy_code
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                       where t1.group_id       =   '|| to_char(prm_group_id)    || '
                         and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                         and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                         and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                         and t1.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                         and t2.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                         and t3.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                         and t3.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                ;
                execute immediate v_sql into n_ret;
           end if;
        end if;
      else    --包含未记账，从凭证中获取


        if prm_cur = 'RMB' then    --币种为RMB

           if v_column_check = 'CHECK1' then  --部门

                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_dept_dict t4
                       on t1.check1_id  = t4.dept_id
                      and t1.check1_no  = t4.dept_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.dept_code   = prm_check_item;



           elsif v_column_check = 'CHECK2' then --职工


                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_emp_dict t4
                       on t1.check2_id  = t4.emp_id
                      and t1.check2_no  = t4.emp_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.emp_code   = prm_check_item;


           elsif v_column_check = 'CHECK3' then --项目

                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_proj_dict t4
                       on t1.check3_id  = t4.proj_id
                      and t1.check3_no  = t4.proj_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.proj_code   = prm_check_item;


            elsif v_column_check = 'CHECK4' then --库房

                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_store_dict t4
                       on t1.check4_id  = t4.store_id
                      and t1.check4_no  = t4.store_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.store_code   = prm_check_item;

            elsif v_column_check = 'CHECK5' then --客户

                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_CUS_DICT t4
                       on t1.check5_id  = t4.cus_id
                      and t1.check5_no  = t4.cus_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.cus_code   = prm_check_item;


           elsif v_column_check = 'CHECK6' then --供应商

                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_SUP_DICT t4
                       on t1.check6_id  = t4.sup_id
                      and t1.check6_no  = t4.sup_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.sup_code   = prm_check_item;


             elsif v_column_check = 'CHECK7' then --资金来源

                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_SOURCE t4
                       on t1.check7_id  = t4.source_id
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.source_code   = prm_check_item;

             elsif v_column_check = 'CHECK8' then --单位

                   select nvl(sum(t1.CREDIT), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join V_HOS_DICT t4
                       on t1.check8_id  = t4.hos_id
                      and t1.group_id   = t4.group_id
                      and t4.is_stop    = 0
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.hos_code   = prm_check_item
                    and t4.is_stop    = 0;


           else    --自定义 ZCHECK1

                   v_sql :='select  nvl(sum(t1.CREDIT), 0)
                              from acc_vouch_check t1
                              left join acc_vouch t2
                               on t1.vouch_id  = t2.vouch_id
                              and t1.group_id  = t2.group_id
                              and t1.hos_id    = t2.hos_id
                              and t1.copy_code = t2.copy_code
                              and t1.acc_year  = t2.acc_year
                             left join acc_subj t3
                               on t1.group_id  = t3.group_id
                              and t1.hos_id    = t3.hos_id
                              and t1.copy_code = t3.copy_code
                              and t1.acc_year  = t3.acc_year
                              and t1.subj_code   = t3.subj_code
                            left join ACC_CHECK_ITEM t4
                             on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                             and t1.group_id  = t4.group_id
                             and t1.hos_id    = t4.hos_id
                             and t1.copy_code = t4.copy_code
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                           where t1.group_id       =   '|| to_char(prm_group_id)    || '
                             and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                             and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                             and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                             and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                             and t3.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                             and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                            ;
                    Dbms_Output.put_line(v_sql);
                   execute immediate v_sql into n_ret;


            end if;

        else   --外币


           if v_column_check = 'CHECK1' then  --部门

                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_dept_dict t4
                       on t1.check1_id  = t4.dept_id
                      and t1.check1_no  = t4.dept_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.dept_code   = prm_check_item;


           elsif v_column_check = 'CHECK2' then --职工

                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_emp_dict t4
                       on t1.check2_id  = t4.emp_id
                      and t1.check2_no  = t4.emp_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.emp_code   = prm_check_item;


           elsif v_column_check = 'CHECK3' then --项目

                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_proj_dict t4
                       on t1.check3_id  = t4.proj_id
                      and t1.check3_no  = t4.proj_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.proj_code   = prm_check_item;


            elsif v_column_check = 'CHECK4' then --库房

                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join hos_store_dict t4
                       on t1.check4_id  = t4.store_id
                      and t1.check4_no  = t4.store_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.store_code   = prm_check_item;


            elsif v_column_check = 'CHECK5' then --客户

                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_CUS_DICT t4
                       on t1.check5_id  = t4.cus_id
                      and t1.check5_no  = t4.cus_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.cus_code   = prm_check_item;


           elsif v_column_check = 'CHECK6' then --供应商

                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_SUP_DICT t4
                       on t1.check6_id  = t4.sup_id
                      and t1.check6_no  = t4.sup_no
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.sup_code   = prm_check_item;


             elsif v_column_check = 'CHECK7' then --资金来源

                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join HOS_SOURCE t4
                       on t1.check7_id  = t4.source_id
                      and t1.group_id   = t4.group_id
                      and t1.hos_id     = t4.hos_id
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.source_code   = prm_check_item;


             elsif v_column_check = 'CHECK8' then --单位

                   select nvl(sum(t1.CREDIT_W), 0)
                     into n_ret
                     from acc_vouch_check t1
                     left join acc_vouch t2
                       on t1.vouch_id  = t2.vouch_id
                      and t1.group_id  = t2.group_id
                      and t1.hos_id    = t2.hos_id
                      and t1.copy_code = t2.copy_code
                      and t1.acc_year  = t2.acc_year
                     left join acc_subj t3
                       on t1.group_id  = t3.group_id
                      and t1.hos_id    = t3.hos_id
                      and t1.copy_code = t3.copy_code
                      and t1.acc_year  = t3.acc_year
                      and t1.subj_code   = t3.subj_code
                     left join V_HOS_DICT t4
                       on t1.check8_id  = t4.hos_id
                      and t1.group_id   = t4.group_id
                      and t4.is_stop    = 0
                   where t1.group_id   = prm_group_id
                    and t1.hos_id      = prm_hos_id
                    and t1.copy_code   = prm_copy_code
                    and t1.acc_year    = prm_acc_year
                    and t2.acc_month  <= prm_acc_month
                    and t2.STATE       >  0              ---1草稿，0作废，1新建，2出纳签字，3审核，99记账
                    and t3.subj_code   like prm_subj_code || '%'
                    and t4.hos_code   = prm_check_item
                    and t4.is_stop    = 0;


           else    --自定义 ZCHECK1

                   v_sql :='select  nvl(sum(t1.CREDIT_W), 0)
                              from acc_vouch_check t1
                              left join acc_vouch t2
                               on t1.vouch_id  = t2.vouch_id
                              and t1.group_id  = t2.group_id
                              and t1.hos_id    = t2.hos_id
                              and t1.copy_code = t2.copy_code
                              and t1.acc_year  = t2.acc_year
                             left join acc_subj t3
                               on t1.group_id  = t3.group_id
                              and t1.hos_id    = t3.hos_id
                              and t1.copy_code = t3.copy_code
                              and t1.acc_year  = t3.acc_year
                              and t1.subj_code   = t3.subj_code
                            left join ACC_CHECK_ITEM t4
                             on t1.'||v_column_check ||'= t4.CHECK_ITEM_ID
                             and t1.group_id  = t4.group_id
                             and t1.hos_id    = t4.hos_id
                             and t1.copy_code = t4.copy_code
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID) || '
                           where t1.group_id       =   '|| to_char(prm_group_id)    || '
                             and t1.hos_id         =   '|| to_char(prm_hos_id)      || '
                             and t1.copy_code      = '''|| to_char(prm_copy_code)   || '''
                             and t1.acc_year       = '''|| to_char(prm_acc_year)    || '''
                             and t2.acc_month     <= '''|| to_char(prm_acc_month)   || '''
                             and t3.subj_code   like '''|| to_char(prm_subj_code)   || '%''
                             and t4.CHECK_ITEM_CODE= '''|| to_char(prm_check_item)  || '''
                             and t4.CHECK_TYPE_ID  =   '|| to_char(v_CHECK_TYPE_ID)
                            ;
                   execute immediate v_sql into n_ret;

            end if;

        end if;
      end if;

      return n_ret;

    EXCEPTION
        WHEN NO_DATA_FOUND THEN
           return 0;
        WHEN OTHERS THEN
           return 0;
    END RF_ACC_BQDLJ_CK;

	]]></sql>
	
</root>

