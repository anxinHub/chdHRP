<?xml version="1.0" encoding="UTF-8" ?>
<root>
	<sql id="v_cost_para_dept_map" type="view" desc=""><![CDATA[
	create or replace view v_cost_para_dept_map as
select a.group_id,
       a.hos_id,
       a.copy_code,
       a.acc_year,
       a.acc_month,
       a.type_code,
       a.natur_code,
       b.type_code  server_type_code,
       b.natur_code server_natur_code,
       a.dept_id,
       a.dept_no,
       b.dept_id    server_dept_id,
       b.dept_no    server_dept_no,
       c.type_code  para_type_code,
       c.para_value para_code
  from (select t1.group_id,
               t1.hos_id,
               t1.copy_code,
               t1.acc_year,
               t1.acc_month,
               t1.type_code,
               t1.natur_code,
               t1.dept_id,
               t1.dept_no,
               t1.bill_code
          from COST_PARA_DEPT t1
         inner join cost_para_bill t2
            on t1.group_id = t2.group_id
           and t1.hos_id = t2.hos_id
           and t1.copy_code = t2.copy_code
           and t1.acc_year = t2.acc_year
           and t1.acc_month = t2.acc_month
           and t1.bill_code = t2.bill_code
           and t2.cost_type_code = '01') a
 inner join (select t1.group_id,
                    t1.hos_id,
                    t1.copy_code,
                    t1.acc_year,
                    t1.acc_month,
                    t1.type_code,
                    t1.natur_code,
                    t1.dept_id,
                    t1.dept_no,
                    t1.bill_code
               from cost_para_server_dept t1
              inner join cost_para_bill t2
                 on t1.group_id = t2.group_id
                and t1.hos_id = t2.hos_id
                and t1.copy_code = t2.copy_code
                and t1.acc_year = t2.acc_year
                and t1.acc_month = t2.acc_month
                and t1.bill_code = t2.bill_code
                and t2.cost_type_code = '01'

             ) b
    on a.group_id = b.group_id
   and a.hos_id = b.hos_id
   and a.copy_code = b.copy_code
   and a.acc_year = b.acc_year
   and a.acc_month = b.acc_month
   and a.bill_code = b.bill_code

 inner join cost_para_set c
    on c.group_id = a.group_id
   and c.hos_id = a.hos_id
   and c.copy_code = a.copy_code
   and c.acc_year = a.acc_year
   and c.acc_month = a.acc_month
   and a.natur_code = c.natur_code
   and c.natur_code = '11'
union all
select a.group_id,
       a.hos_id,
       a.copy_code,
       a.acc_year,
       a.acc_month,
       a.type_code,
       a.natur_code,
       b.type_code  server_type_code,
       b.natur_code server_natur_code,
       a.dept_id,
       a.dept_no,
       b.dept_id    server_dept_id,
       b.dept_no    server_dept_no,
       c.type_code  para_type_code,
       c.para_value para_code
  from (select t1.group_id,
               t1.hos_id,
               t1.copy_code,
               t1.acc_year,
               t1.acc_month,
               t1.type_code,
               t1.natur_code,
               t1.dept_id,
               t1.dept_no,
               t1.bill_code
          from COST_PARA_DEPT t1
         inner join cost_para_bill t2
            on t1.group_id = t2.group_id
           and t1.hos_id = t2.hos_id
           and t1.copy_code = t2.copy_code
           and t1.acc_year = t2.acc_year
           and t1.acc_month = t2.acc_month
           and t1.bill_code = t2.bill_code
           and t2.cost_type_code = '02') a
  join (select t1.group_id,
               t1.hos_id,
               t1.copy_code,
               t1.acc_year,
               t1.acc_month,
               t1.type_code,
               t1.natur_code,
               t1.dept_id,
               t1.dept_no,
               t1.bill_code
          from cost_para_server_dept t1
         inner join cost_para_bill t2
            on t1.group_id = t2.group_id
           and t1.hos_id = t2.hos_id
           and t1.copy_code = t2.copy_code
           and t1.acc_year = t2.acc_year
           and t1.acc_month = t2.acc_month
           and t1.bill_code = t2.bill_code
           and t2.cost_type_code = '02'

        ) b
    on a.group_id = b.group_id
   and a.hos_id = b.hos_id
   and a.copy_code = b.copy_code
   and a.acc_year = b.acc_year
   and a.acc_month = b.acc_month
   and a.bill_code = b.bill_code
 inner join cost_para_set c
    on c.group_id = a.group_id
   and c.hos_id = a.hos_id
   and c.copy_code = a.copy_code
   and c.acc_year = a.acc_year
   and c.acc_month = a.acc_month
   and a.natur_code = c.natur_code
   and c.natur_code in ('08', '09', '10')

union all
select a.group_id,
       a.hos_id,
       a.copy_code,
       a.acc_year,
       a.acc_month,
       a.type_code,
       a.natur_code,
       b.type_code  server_type_code,
       b.natur_code server_natur_code,
       a.dept_id,
       a.dept_no,
       b.dept_id    server_dept_id,
       b.dept_no    server_dept_no,
       c.type_code  para_type_code,
       c.para_value para_code
  from (select t1.group_id,
               t1.hos_id,
               t1.copy_code,
               t1.acc_year,
               t1.acc_month,
               t1.type_code,
               t1.natur_code,
               t1.dept_id,
               t1.dept_no,
               t1.bill_code
          from COST_PARA_DEPT t1
         inner join cost_para_bill t2
            on t1.group_id = t2.group_id
           and t1.hos_id = t2.hos_id
           and t1.copy_code = t2.copy_code
           and t1.acc_year = t2.acc_year
           and t1.acc_month = t2.acc_month
           and t1.bill_code = t2.bill_code
           and t2.cost_type_code = '03') a
 inner join (select t1.group_id,
                    t1.hos_id,
                    t1.copy_code,
                    t1.acc_year,
                    t1.acc_month,
                    t1.type_code,
                    t1.natur_code,
                    t1.dept_id,
                    t1.dept_no,
                    t1.bill_code
               from cost_para_server_dept t1
              inner join cost_para_bill t2
                 on t1.group_id = t2.group_id
                and t1.hos_id = t2.hos_id
                and t1.copy_code = t2.copy_code
                and t1.acc_year = t2.acc_year
                and t1.acc_month = t2.acc_month
                and t1.bill_code = t2.bill_code
                and t2.cost_type_code = '03'

             ) b
    on a.group_id = b.group_id
   and a.hos_id = b.hos_id
   and a.copy_code = b.copy_code
   and a.acc_year = b.acc_year
   and a.acc_month = b.acc_month
   and a.bill_code = b.bill_code
 inner join cost_para_set c
    on c.group_id = a.group_id
   and c.hos_id = a.hos_id
   and c.copy_code = a.copy_code
   and c.acc_year = a.acc_year
   and c.acc_month = a.acc_month
   and a.natur_code = c.natur_code
   and c.natur_code in ('07', '03', '04', '05')

	]]></sql>
	<sql id="v_cost_para_dept_normal" type="view" desc=""><![CDATA[
	create or replace view v_cost_para_dept_normal as
select a.group_id,
	         a.hos_id,
	         a.copy_code,
	         a.acc_year,
	         a.acc_month,
	         a.dept_id,
	         a.dept_no,
	         a.server_dept_id,
	         a.server_dept_no,
	         a.type_code,
	         a.natur_code,
	         a.para_code,
	         a.para_type_code,
	         num_amount
	    from v_cost_para_dept_map a
	   inner join (
	               --门诊工作量
	               select group_id,
	                       hos_id,
	                       copy_code,
	                       acc_year,
	                       acc_month,
	                       dept_id,
	                       dept_no,
	                       '03' para_code,
	                       sum(nvl(clinic_num, 0)) num_amount
	                 from COST_CLINIC_WORK
	                group by group_id,
	                          hos_id,
	                          copy_code,
	                          acc_year,
	                          acc_month,
	                          dept_id,
	                          dept_no
	               --住院工作量
	               union all
	               select group_id,
	                      hos_id,
	                      copy_code,
	                      acc_year,
	                      acc_month,
	                      dept_id,
	                      dept_no,
	                      '03' para_code,
	                      sum(nvl(bed_use_day_num, 0)) num_amount
	                 from COST_INHOS_WORK
	                group by group_id,
	                         hos_id,
	                         copy_code,
	                         acc_year,
	                         acc_month,
	                         dept_id,
	                         dept_no
	               --人员
	               union all
	               select group_id,
	                      hos_id,
	                      copy_code,
	                      acc_year,
	                      acc_month,
	                      dept_id,
	                      dept_no,
	                      '01' para_code,
	                      sum(nvl(alldept_num, 0)) num_amount
	                 from COST_DEPT_PEOPLE
	                group by group_id,
	                         hos_id,
	                         copy_code,
	                         acc_year,
	                         acc_month,
	                         dept_id,
	                         dept_no
	               --面积
	               union all
	               select group_id,
	                      hos_id,
	                      copy_code,
	                      acc_year,
	                      acc_month,
	                      dept_id,
	                      dept_no,
	                      '02' para_code,
	                      sum(nvl(arear, 0)) num_amount
	                 from COST_DEPT_AREA
	                group by group_id,
	                         hos_id,
	                         copy_code,
	                         acc_year,
	                         acc_month,
	                         dept_id,
	                         dept_no) b
	      on a.group_id = b.group_id
	     and a.hos_id = b.hos_id
	     and a.copy_code = b.copy_code
	     and a.acc_year = b.acc_year
	     and a.acc_month = b.acc_month
	     and a.server_dept_id = b.dept_id
	     and a.para_code = b.para_code

	  union all
	  select c.group_id,
	         c.hos_id,
	         c.copy_code,
	         c.acc_year,
	         c.acc_month,
	         c.dept_id,
	         c.dept_no,
	         c.server_dept_id,
	         c.server_dept_no,
	         c.type_code,
	         c.natur_code,
	         c.para_code,
	         c.para_type_code,
	         num_amount
	    from v_cost_para_dept_map c
	   inner join (
	               --服务量
	               select group_id,
	                       hos_id,
	                       copy_code,
	                       acc_year,
	                       acc_month,
	                       server_dept_id dept_id,
	                       server_dept_no dept_no,
	                       server_by_dept_id server_dept_id,
	                       server_by_dept_no server_dept_no,
	                       '05' para_code,
	                       sum(nvl(server_num, 0)) num_amount
	                 from cost_inner_server
	                group by group_id,
	                          hos_id,
	                          copy_code,
	                          acc_year,
	                          acc_month,
	                          server_dept_id,
	                          server_dept_no,
	                          server_by_dept_id,
	                          server_by_dept_no
	               --收支结余
	               union all
	               select group_id,
	                      hos_id,
	                      copy_code,
	                      acc_year,
	                      acc_month,
	                      exec_dept_id dept_id,
	                      exec_dept_no dept_no,
	                      appl_dept_id server_dept_id,
	                      appl_dept_no server_dept_no,
	                      '06' para_code,
	                      sum(nvl(money, 0)) num_amount
	                 from cost_income
	                group by group_id,
	                         hos_id,
	                         copy_code,
	                         acc_year,
	                         acc_month,
	                         exec_dept_id,
	                         exec_dept_no,
	                         appl_dept_id,
	                         appl_dept_no
	               union all
	               --药房收入
	               select a.group_id,
	                      a.hos_id,
	                      a.copy_code,
	                      a.acc_year,
	                      a.acc_month,
	                      d.dept_id,
	                      d.dept_no,
	                      a.exec_dept_id server_dept_id,
	                      a.exec_dept_no server_dept_no,
	                      '06' para_code,
	                      sum(nvl(money, 0)) num_amount
	                 from cost_income a
	                inner join (select a.group_id,
	                                   a.hos_id,
	                                   a.copy_code,
	                                   a.acc_year,
	                                   a.acc_month,
	                                   a.dept_id,
	                                   a.dept_no,
	                                   a.server_dept_id,
	                                   a.server_dept_no
	                              from v_cost_para_dept_map a
	                             inner join acc_dept_attr b
	                                on a.group_id = b.group_id
	                               and a.hos_id = b.hos_id
	                               and a.dept_id = b.dept_id
	                               and b.natur_code = '03'
	                             inner join acc_dept_attr c
	                                on a.group_id = c.group_id
	                               and a.hos_id = c.hos_id
	                               and a.server_dept_id = c.dept_id
	                               and c.natur_code = '04') d
	                   on a.group_id = d.group_id
	                  and a.hos_id = d.hos_id
	                  and a.copy_code = d.copy_code
	                  and a.acc_year = d.acc_year
	                  and a.acc_month = d.acc_month
	                  and a.exec_dept_id = d.server_dept_id

	                group by a.group_id,
	                         a.hos_id,
	                         a.copy_code,
	                         a.acc_year,
	                         a.acc_month,
	                         a.exec_dept_id,
	                         a.exec_dept_no,
	                         d.dept_id,
	                         d.dept_no) d
	      on c.group_id = d.group_id
	     and c.hos_id = d.hos_id
	     and c.copy_code = d.copy_code
	     and c.acc_year = d.acc_year
	     and c.acc_month = d.acc_month
	     and c.dept_id = d.dept_id
	     and c.dept_no = d.dept_no
	     and c.server_dept_id = d.server_dept_id
	     and c.server_dept_no = d.server_dept_no
	     and c.para_code = d.para_code

	  union all
	  select e.group_id,
	         e.hos_id,
	         e.copy_code,
	         e.acc_year,
	         e.acc_month,
	         e.dept_id,
	         e.dept_no,
	         e.server_dept_id,
	         e.server_dept_no,
	         e.type_code,
	         e.natur_code,
	         e.para_code,
	         e.para_type_code,
	         num_amount
	    from v_cost_para_dept_map e
	   inner join (
	               --自定义
	               select group_id,
	                       hos_id,
	                       copy_code,
	                       acc_year,
	                       acc_month,
	                       dept_id,
	                       dept_no,
	                       para_code,
	                       sum(nvl(para_value, 0)) num_amount
	                 from COST_USER_DEFINED_PARA
	                group by group_id,
	                          hos_id,
	                          copy_code,
	                          acc_year,
	                          acc_month,
	                          dept_id,
	                          dept_no,
	                          para_code) f
	      on e.group_id = f.group_id
	     and e.hos_id = f.hos_id
	     and e.copy_code = f.copy_code
	     and e.acc_year = f.acc_year
	     and e.acc_month = f.acc_month
	     and e.server_dept_id = f.dept_id
	     and e.server_dept_no = f.dept_no
	     and e.para_code = f.para_code
	
	]]></sql>
	<sql id="v_cost_para_dept_no_sp" type="view" desc=""><![CDATA[
	create or replace view v_cost_para_dept_no_sp as
select t1."GROUP_ID",
       t1."HOS_ID",
       t1."COPY_CODE",
       t1."ACC_YEAR",
       t1."ACC_MONTH",
       t1."TYPE_CODE",
       t1."NATUR_CODE",
       t1."DEPT_ID",
       t1."DEPT_NO",
       t1."SERVER_DEPT_ID",
       t1."SERVER_DEPT_NO",
       t1."PARA_TYPE_CODE",
       t1."PARA_CODE"
  from v_cost_para_dept_map t1
 where not exists (select 1
          from v_cost_para_dept_normal t2
         where t2.group_id = t1.group_id
           and t2.hos_id = t1.hos_id
           and t2.copy_code = t1.copy_code
           and t2.acc_year = t1.acc_year
           and t2.acc_month = t1.acc_month
           and t2.dept_id = t1.dept_id
           and t2.dept_no = t1.dept_no
           and t2.server_dept_id = t1.server_dept_id
           and t2.server_dept_no = t1.server_dept_no
           and t2.para_type_code=t1.para_type_code and t2.para_code=t1.para_code)
	
	]]></sql>
	<sql id="v_cost_para_dept_special" type="view" desc=""><![CDATA[
	create or replace view v_cost_para_dept_special as
select a.group_id,
	         a.hos_id,
	         a.copy_code,
	         a.acc_year,
	         a.acc_month,
	         a.dept_id,
	         a.dept_no,
	         a.server_dept_id,
	         a.server_dept_no,
	         a.type_code,
	         a.natur_code,
	         a.para_code,
	         a.para_type_code,
	         num_amount
	    from v_cost_para_dept_no_sp
       a
	   inner join (
	               --门诊工作量
	               select group_id,
	                       hos_id,
	                       copy_code,
	                       acc_year,
	                       acc_month,
	                       dept_id,
	                       dept_no,
	                       '03' para_code,
	                       sum(nvl(clinic_num, 0)) num_amount
	                 from COST_CLINIC_WORK
	                group by group_id,
	                          hos_id,
	                          copy_code,
	                          acc_year,
	                          acc_month,
	                          dept_id,
	                          dept_no
	               --住院工作量
	               union all
	               select group_id,
	                      hos_id,
	                      copy_code,
	                      acc_year,
	                      acc_month,
	                      dept_id,
	                      dept_no,
	                      '03' para_code,
	                      sum(nvl(bed_use_day_num, 0)) num_amount
	                 from COST_INHOS_WORK
	                group by group_id,
	                         hos_id,
	                         copy_code,
	                         acc_year,
	                         acc_month,
	                         dept_id,
	                         dept_no
	               --人员
	               union all
	               select group_id,
	                      hos_id,
	                      copy_code,
	                      acc_year,
	                      acc_month,
	                      dept_id,
	                      dept_no,
	                      '01' para_code,
	                      sum(nvl(alldept_num, 0)) num_amount
	                 from COST_DEPT_PEOPLE
	                group by group_id,
	                         hos_id,
	                         copy_code,
	                         acc_year,
	                         acc_month,
	                         dept_id,
	                         dept_no
	               --面积
	               union all
	               select group_id,
	                      hos_id,
	                      copy_code,
	                      acc_year,
	                      acc_month,
	                      dept_id,
	                      dept_no,
	                      '02' para_code,
	                      sum(nvl(arear, 0)) num_amount
	                 from COST_DEPT_AREA
	                group by group_id,
	                         hos_id,
	                         copy_code,
	                         acc_year,
	                         acc_month,
	                         dept_id,
	                         dept_no
                   union all
                   --服务量
	               select group_id,
	                       hos_id,
	                       copy_code,
	                       acc_year,
	                       acc_month,
	                       server_by_dept_id dept_id,
	                       server_by_dept_no dept_no,
	                       '05' para_code,
	                       sum(nvl(server_num, 0)) num_amount
	                 from cost_inner_server
	                group by group_id,
	                          hos_id,
	                          copy_code,
	                          acc_year,
	                          acc_month,
	                          server_by_dept_id,
	                          server_by_dept_no
	               --收支结余
	               union all
	               select group_id,
	                      hos_id,
	                      copy_code,
	                      acc_year,
	                      acc_month,
	                      appl_dept_id dept_id,
	                      appl_dept_no dept_no,
	                      '06' para_code,
	                      sum(nvl(money, 0)) num_amount
	                 from cost_income
	                group by group_id,
	                         hos_id,
	                         copy_code,
	                         acc_year,
	                         acc_month,
	                         appl_dept_id,
	                         appl_dept_no


                           ) b
	      on a.group_id = b.group_id
	     and a.hos_id = b.hos_id
	     and a.copy_code = b.copy_code
	     and a.acc_year = b.acc_year
	     and a.acc_month = b.acc_month
	     and a.server_dept_id = b.dept_id
	     and a.para_code = b.para_code
	
	]]></sql>
	<sql id="v_cost_para_dept" type="view" desc=""><![CDATA[
	create or replace view v_cost_para_dept as
select group_id,
       hos_id,
       copy_code,
       acc_year,
       acc_month,
       dept_id,
       dept_no,
       server_dept_id,
       server_dept_no,
       type_code,
       natur_code,
       para_code,
       para_type_code,
       num_amount
  from v_cost_para_dept_normal
/*union all
select group_id,
       hos_id,
       copy_code,
       acc_year,
       acc_month,
       dept_id,
       dept_no,
       server_dept_id,
       server_dept_no,
       type_code,
       natur_code,
       para_code,
       para_type_code,
       num_amount
  from v_cost_para_dept_special*/

	  
	]]></sql>
   
	
	
	
	
	<sql id="v_cost_appl_dept_income" type="view" desc=""><![CDATA[
	
	create or replace view v_cost_appl_dept_income as
       select a.group_id,
	       a.hos_id,
	       copy_code,
	       acc_year,
	       acc_month,
         hdd.dept_code,
	       appl_dept_id dept_id,
	       appl_dept_no dept_no,
	       type_code,
	       natur_code,
	       sum(money) income_money
	  from cost_income a
	  left join acc_dept_attr b
	    on a.group_id = b.group_id
	   and a.hos_id = b.hos_id
	   and a.appl_dept_id = b.dept_id
    left join hos_dept_dict hdd
    on hdd.group_id = a.group_id
    and hdd.hos_id = a.hos_id
    and hdd.dept_id = b.dept_id

	 group by a.group_id,
	          a.hos_id,
	          a.copy_code,
	          acc_year,
	          acc_month,
            hdd.dept_code,
	          appl_dept_id,
	          appl_dept_no,
	          type_code,
	          natur_code

	]]></sql>
	
	
	<sql id="v_cost_exec_dept_income" type="view" desc=""><![CDATA[
	
	create or replace view v_cost_exec_dept_income as
	select a.group_id,
	       a.hos_id,
	       copy_code,
	       acc_year,
	       acc_month,
	       exec_dept_id dept_id,
	       exec_dept_no dept_no,
	       type_code,
	       natur_code,
	       sum(money) income_money
	  from cost_income a
	  left join acc_dept_attr b
	    on a.group_id = b.group_id
	   and a.hos_id = b.hos_id
	   and a.exec_dept_id = b.dept_id
	
	 group by a.group_id,
	          a.hos_id,
	          a.copy_code,
	          acc_year,
	          acc_month,
	          exec_dept_id,
	          exec_dept_no,
	          type_code,
	          natur_code
	/*comment on column V_COST_EXEC_DEPT_INCOME.GROUP_ID is '集团';
	comment on column V_COST_EXEC_DEPT_INCOME.HOS_ID is '医院';
	comment on column V_COST_EXEC_DEPT_INCOME.COPY_CODE is '账套';
	comment on column V_COST_EXEC_DEPT_INCOME.ACC_YEAR is '统计年度';
	comment on column V_COST_EXEC_DEPT_INCOME.ACC_MONTH is '统计月份';
	comment on column V_COST_EXEC_DEPT_INCOME.DEPT_ID is '开单科室ID';
	comment on column V_COST_EXEC_DEPT_INCOME.DEPT_NO is '开单科室变更ID';
	comment on column V_COST_EXEC_DEPT_INCOME.TYPE_CODE is '科室类型';
	comment on column V_COST_EXEC_DEPT_INCOME.NATUR_CODE is '科室性质';
	comment on column V_COST_EXEC_DEPT_INCOME.INCOME_MONEY is '收入金额';*/


	
	]]></sql>


	<sql id="v_cost_dept_cost_sum" type="view" desc=""><![CDATA[
	
	create or replace view v_cost_dept_cost_sum as
select group_id,
	       hos_id,
	       copy_code,
	       acc_year,
	       acc_month,
	       dept_id,
	       type_code,
	       natur_code,
	       t9.cost_type_id,
	       cost_type_code,
	       cost_type_name,
	       t1,
	       t2,
	       t3,
	       t4
	  from cost_type_dict t9
	  left join (select t6.group_id,
	                    t6.hos_id,
	                    t6.copy_code,
	                    acc_year,
	                    acc_month,
	                    t6.dept_id,
	                    type_code,
	                    natur_code,
	                    t8.cost_type_id,
	                    sum(t1) t1,
	                    sum(t2) t2,
	                    sum(t3) t3,
	                    sum(t4) t4
	               from (select t1.group_id,
	                            t1.hos_id,
	                            t1.copy_code,
	                            t1.dept_id,
	                            cost_item_id,
	                            acc_year,
	                            acc_month,
	                            sum(dir_amount + DIR_ASS_AMOUNT + DIR_MED_AMOUNT +
	                                INDIR_MED_ASS_AMOUNT) t1,
	                            sum(dir_amount + DIR_ASS_AMOUNT + DIR_MED_AMOUNT +
	                                INDIR_MED_ASS_AMOUNT + DIR_MAN_AMOUNT +
	                                INDIR_ASS_MAN_AMOUNT + INDIR_MED_MAN_AMOUNT +
	                                INDIR_ASS_MED_MAN_AMOUNT) t2,
	                            0 t3,
	                            0 t4
	                       from cost_dept_cost t1
	                      inner join hos_source t2
	                         on t1.group_id = t2.group_id
	                        and t1.hos_id = t2.hos_id
	                        and t1.source_id = t2.source_id
	                      where t2.source_attr = 1
	                      group by t1.group_id,
	                               t1.hos_id,
	                               t1.copy_code,
	                               t1.dept_id,
	                               cost_item_id,
	                               acc_year,
	                               acc_month
	                     union all
	                     select t3.group_id,
	                            t3.hos_id,
	                            t3.copy_code,
	                            t3.dept_id,
	                            cost_item_id,
	                            acc_year,
	                            acc_month,
	                            0,
	                            0,
	                            sum(dir_amount + DIR_ASS_AMOUNT + DIR_MED_AMOUNT +
	                                INDIR_MED_ASS_AMOUNT + DIR_MAN_AMOUNT +
	                                INDIR_ASS_MAN_AMOUNT + INDIR_MED_MAN_AMOUNT +
	                                INDIR_ASS_MED_MAN_AMOUNT) t3,
	                            0
	                       from cost_dept_cost t3
	                      inner join hos_source t4
	                         on t3.group_id = t4.group_id
	                        and t3.hos_id = t4.hos_id
	                        and t3.source_id = t4.source_id
	                      where t4.source_attr in (1, 2)
	                      group by t3.group_id,
	                               t3.hos_id,
	                               t3.copy_code,
	                               t3.dept_id,
	                               cost_item_id,
	                               acc_year,
	                               acc_month
	                     union all
	                     select t5.group_id,
	                            t5.hos_id,
	                            t5.copy_code,
	                            t5.dept_id,
	                            cost_item_id,
	                            acc_year,
	                            acc_month,
	                            0,
	                            0,
	                            0,
	                            sum(dir_amount + DIR_ASS_AMOUNT + DIR_MED_AMOUNT +
	                                INDIR_MED_ASS_AMOUNT + DIR_MAN_AMOUNT +
	                                INDIR_ASS_MAN_AMOUNT + INDIR_MED_MAN_AMOUNT +
	                                INDIR_ASS_MED_MAN_AMOUNT) t4
	                       from cost_dept_cost t5
	                      group by group_id,
	                               hos_id,
	                               copy_code,
	                               dept_id,
	                               cost_item_id,
	                               acc_year,
	                               acc_month) t6
	
	               left join ACC_DEPT_ATTR t7
	                 on t6.group_id = t7.group_id
	                and t6.hos_id = t7.hos_id
	                and t6.dept_id = t7.dept_id
	               left join cost_item_dict_no t8
	                 on t6.group_id = t8.group_id
	                and t6.hos_id = t8.hos_id
	                and t6.copy_code = t8.copy_code
	                and t6.cost_item_id = t8.cost_item_id
	                where t7.type_code='01'
	              group by t6.group_id,
	                       t6.hos_id,
	                       t6.copy_code,
	                       t6.acc_year,
	                       t6.acc_month,
	                       t6.dept_id,
	                       type_code,
	                       natur_code,
	                       t8.cost_type_id) t10
	    on t9.cost_type_id = t10.cost_type_id
	

	]]></sql>

	<sql id="v_cost_charge_kind_arrt" type="view" desc=""><![CDATA[
	
	create or replace view v_cost_charge_kind_arrt as
	select t1.group_id,
	       t1.hos_id,
	       t1.copy_code,
	       income_item_id_in,
	       t2.income_item_code income_item_in_code,
	       t2.income_item_name income_item_in_name,
	       income_item_id_out,
	       t3.income_item_code income_item_out_code,
	       t3.income_item_name income_item_out_name,
	       charge_kind_id,
	       charge_kind_code,
	       charge_kind_name,
	       t1.income_type_id,
	       t4.income_type_code,
	       t4.income_type_name,
	       t1.spell_code,
	       t1.wbx_code
	  from cost_charge_kind_arrt t1
	  left join cost_income_item_arrt t2
	    on t1.group_id = t2.group_id
	   and t1.hos_id = t2.hos_id
	   and t1.copy_code = t2.copy_code
	   and t1.income_item_id_in = t2.income_item_id
	   left join cost_income_item_arrt t3
	    on t1.group_id = t3.group_id
	   and t1.hos_id = t3.hos_id
	   and t1.copy_code = t3.copy_code
	   and t1.income_item_id_out = t3.income_item_id
	   left join cost_income_type t4 on t4.income_type_id=t1.income_type_id
	
	/*comment on column v_cost_charge_kind_arrt.GROUP_ID is '集团';
	comment on column v_cost_charge_kind_arrt.HOS_ID is '医院';
	comment on column v_cost_charge_kind_arrt.COPY_CODE is '账套';
	comment on column v_cost_charge_kind_arrt.income_item_id_in is '门诊收入项目ID';
	comment on column v_cost_charge_kind_arrt.income_item_id_out is '住院收入项目ID';
	comment on column v_cost_charge_kind_arrt.charge_kind_id is '收费类型ID';
	comment on column v_cost_charge_kind_arrt.charge_kind_code is '收费类型编码';
	comment on column v_cost_charge_kind_arrt.charge_kind_name is '收费类型名称';
	comment on column v_cost_charge_kind_arrt.income_type_id is '收入类型ID';
	comment on column v_cost_charge_kind_arrt.spell_code is '拼音码';
	comment on column v_cost_charge_kind_arrt.wbx_code is '五笔码';
	comment on column v_cost_charge_kind_arrt.income_item_in_code is '门诊收入项目编码';
	comment on column v_cost_charge_kind_arrt.income_item_in_name is '门诊收入项目名称';
	comment on column v_cost_charge_kind_arrt.income_item_out_code is '住院收入项目编码';
	comment on column v_cost_charge_kind_arrt.income_item_out_name is '住院收入项目名称';
	comment on column v_cost_charge_kind_arrt.income_type_code is '收入类型编码';
	comment on column v_cost_charge_kind_arrt.income_type_name is '收入类型名称';*/
	
	]]></sql>

	<sql id="v_cost_dept_cost_detail" type="view" desc=""><![CDATA[
	create or replace view v_cost_dept_cost_detail as
select group_id,
       hos_id,
       copy_code,
       acc_year,
       acc_month,
       dept_id,
       type_code,
       natur_code,
       t9.cost_type_id,
       t10.cost_item_id,
       cost_type_code,
       cost_type_name,
       cost_item_code,
       cost_item_name,
       t1,
       t2,
       t3,
       t4
  from cost_type_dict t9
  left join (select t6.group_id,
                    t6.hos_id,
                    t6.copy_code,
                    acc_year,
                    acc_month,
                    t6.dept_id,
                    type_code,
                    natur_code,
                    t8.cost_type_id,
                    t8.cost_item_id,
                    t8.cost_item_code,
                    t8.cost_item_name,
                    sum(t1) t1,
                    sum(t2) t2,
                    sum(t3) t3,
                    sum(t4) t4
               from (select t1.group_id,
                            t1.hos_id,
                            t1.copy_code,
                            t1.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            sum(dir_amount + DIR_ASS_AMOUNT + DIR_MED_AMOUNT +
                                INDIR_MED_ASS_AMOUNT) t1,
                            0 t2,
                            0 t3,
                            0 t4
                       from cost_dept_cost t1
                      inner join hos_source t2
                         on t1.group_id = t2.group_id
                        and t1.hos_id = t2.hos_id
                        and t1.source_id = t2.source_id
                        left join acc_dept_attr t3 on t1.group_id = t3.group_id
                        and t1.hos_id = t3.hos_id and t1.dept_id=t3.dept_id
                      where t2.source_attr = 1 and t3.type_code in('01','02')
                      group by t1.group_id,
                               t1.hos_id,
                               t1.copy_code,
                               t1.dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month
                     union all
                     select t1.group_id,
                            t1.hos_id,
                            t1.copy_code,
                            t1.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            0,
                            sum(dir_amount + DIR_ASS_AMOUNT + DIR_MED_AMOUNT +
                                INDIR_MED_ASS_AMOUNT + DIR_MAN_AMOUNT +
                                INDIR_ASS_MAN_AMOUNT + INDIR_MED_MAN_AMOUNT +
                                INDIR_ASS_MED_MAN_AMOUNT) t2,
                            0 t3,
                            0 t4
                       from cost_dept_cost t1
                      inner join hos_source t2
                         on t1.group_id = t2.group_id
                        and t1.hos_id = t2.hos_id
                        and t1.source_id = t2.source_id
                      where t2.source_attr = 1
                      group by t1.group_id,
                               t1.hos_id,
                               t1.copy_code,
                               t1.dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month
                     union all
                     select t3.group_id,
                            t3.hos_id,
                            t3.copy_code,
                            t3.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            0,
                            0,
                            sum(dir_amount + DIR_ASS_AMOUNT + DIR_MED_AMOUNT +
                                INDIR_MED_ASS_AMOUNT + DIR_MAN_AMOUNT +
                                INDIR_ASS_MAN_AMOUNT + INDIR_MED_MAN_AMOUNT +
                                INDIR_ASS_MED_MAN_AMOUNT) t3,
                            0
                       from cost_dept_cost t3
                      inner join hos_source t4
                         on t3.group_id = t4.group_id
                        and t3.hos_id = t4.hos_id
                        and t3.source_id = t4.source_id
                      where t4.source_attr in (1, 2)
                      group by t3.group_id,
                               t3.hos_id,
                               t3.copy_code,
                               t3.dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month
                     union all
                     select t5.group_id,
                            t5.hos_id,
                            t5.copy_code,
                            t5.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            0,
                            0,
                            0,
                            sum(dir_amount + DIR_ASS_AMOUNT + DIR_MED_AMOUNT +
                                INDIR_MED_ASS_AMOUNT + DIR_MAN_AMOUNT +
                                INDIR_ASS_MAN_AMOUNT + INDIR_MED_MAN_AMOUNT +
                                INDIR_ASS_MED_MAN_AMOUNT) t4
                       from cost_dept_cost t5
                      group by group_id,
                               hos_id,
                               copy_code,
                               dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month) t6

               left join ACC_DEPT_ATTR t7
                 on t6.group_id = t7.group_id
                and t6.hos_id = t7.hos_id
                and t6.dept_id = t7.dept_id
               left join cost_item_dict_no t8
                 on t6.group_id = t8.group_id
                and t6.hos_id = t8.hos_id
                and t6.copy_code = t8.copy_code
                and t6.cost_item_id = t8.cost_item_id
                where t7.type_code='01'
              group by t6.group_id,
                       t6.hos_id,
                       t6.copy_code,
                       t6.acc_year,
                       t6.acc_month,
                       t6.dept_id,
                       type_code,
                       natur_code,
                       t8.cost_type_id,
                       t8.cost_item_id,
                       t8.cost_item_code,
                       t8.cost_item_name) t10
    on t9.cost_type_id = t10.cost_type_id
	
	]]></sql>
<sql id="v_cost_dept_cost_detail_temp" type="view" desc=""><![CDATA[
	create or replace view v_cost_dept_cost_detail_temp as
select group_id,
       hos_id,
       copy_code,
       acc_year,
       acc_month,
       dept_id,
       type_code,
       natur_code,
       t9.cost_type_id,
			 t10.nature_id,
       t10.cost_item_id,
       cost_type_code,
       cost_type_name,
       cost_item_code,
       cost_item_name,
       t,
       t1,
       t2,
       t3,
       t4
  from cost_type_dict t9
  left join (select t6.group_id,
                    t6.hos_id,
                    t6.copy_code,
                    acc_year,
                    acc_month,
                    t6.dept_id,
                    type_code,
                    natur_code,
                    t8.cost_type_id,
										t8.nature_id,
                    t8.cost_item_id,
                    t8.cost_item_code,
                    t8.cost_item_name,
                    sum(t)  t,
                    sum(t1) t1,
                    sum(t2) t2,
                    sum(t3) t3,
                    sum(t4) t4
               from (select t1.group_id,
                            t1.hos_id,
                            t1.copy_code,
                            t1.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            sum(dir_amount) t,
                            0 t1,
                            0 t2,
                            0 t3,
                            0 t4
                       from cost_dept_cost t1
                      inner join hos_source t2
                         on t1.group_id = t2.group_id
                        and t1.hos_id = t2.hos_id
                        and t1.source_id = t2.source_id
                        left join acc_dept_attr t3 on t1.group_id = t3.group_id
                        and t1.hos_id = t3.hos_id and t1.dept_id=t3.dept_id
                      where t2.source_attr = 1 and t3.type_code in('01','02')
                      group by t1.group_id,
                               t1.hos_id,
                               t1.copy_code,
                               t1.dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month
                     union all
                     select t1.group_id,
                            t1.hos_id,
                            t1.copy_code,
                            t1.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            0 t,
                            sum(dir_amount + dir_ass_amount + dir_med_amount +
                                indir_med_ass_amount) t1,
                            0 t2,
                            0 t3,
                            0 t4
                       from cost_dept_cost t1
                      inner join hos_source t2
                         on t1.group_id = t2.group_id
                        and t1.hos_id = t2.hos_id
                        and t1.source_id = t2.source_id
                        left join acc_dept_attr t3 on t1.group_id = t3.group_id
                        and t1.hos_id = t3.hos_id and t1.dept_id=t3.dept_id
                      where t2.source_attr = 1 and t3.type_code in('01','02')
                      group by t1.group_id,
                               t1.hos_id,
                               t1.copy_code,
                               t1.dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month
                     union all
                     select t1.group_id,
                            t1.hos_id,
                            t1.copy_code,
                            t1.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            0,
                            0,
                            sum(dir_amount + dir_ass_amount + dir_med_amount +
                                indir_med_ass_amount + dir_man_amount +
                                indir_ass_man_amount + indir_med_man_amount +
                                indir_ass_med_man_amount) t2,
                            0 t3,
                            0 t4
                       from cost_dept_cost t1
                      inner join hos_source t2
                         on t1.group_id = t2.group_id
                        and t1.hos_id = t2.hos_id
                        and t1.source_id = t2.source_id
                      where t2.source_attr = 1
                      group by t1.group_id,
                               t1.hos_id,
                               t1.copy_code,
                               t1.dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month
                     union all
                     select t3.group_id,
                            t3.hos_id,
                            t3.copy_code,
                            t3.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            0,
                            0,
                            0,
                            sum(dir_amount + dir_ass_amount + dir_med_amount +
                                indir_med_ass_amount + dir_man_amount +
                                indir_ass_man_amount + indir_med_man_amount +
                                indir_ass_med_man_amount) t3,
                            0
                       from cost_dept_cost t3
                      inner join hos_source t4
                         on t3.group_id = t4.group_id
                        and t3.hos_id = t4.hos_id
                        and t3.source_id = t4.source_id
                      where t4.source_attr in (1, 2)
                      group by t3.group_id,
                               t3.hos_id,
                               t3.copy_code,
                               t3.dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month
                     union all
                     select t5.group_id,
                            t5.hos_id,
                            t5.copy_code,
                            t5.dept_id,
                            cost_item_id,
                            acc_year,
                            acc_month,
                            0,
                            0,
                            0,
                            0,
                            sum(dir_amount + dir_ass_amount + dir_med_amount +
                                indir_med_ass_amount + dir_man_amount +
                                indir_ass_man_amount + indir_med_man_amount +
                                indir_ass_med_man_amount) t4
                       from cost_dept_cost t5
                      group by group_id,
                               hos_id,
                               copy_code,
                               dept_id,
                               cost_item_id,
                               acc_year,
                               acc_month) t6
               left join acc_dept_attr t7
                 on t6.group_id = t7.group_id
                and t6.hos_id = t7.hos_id
                and t6.dept_id = t7.dept_id
               left join cost_item_dict_no t8
                 on t6.group_id = t8.group_id
                and t6.hos_id = t8.hos_id
                and t6.copy_code = t8.copy_code
                and t6.cost_item_id = t8.cost_item_id
              group by t6.group_id,
                       t6.hos_id,
                       t6.copy_code,
                       t6.acc_year,
                       t6.acc_month,
                       t6.dept_id,
                       type_code,
                       natur_code,
                       t8.cost_type_id,
											 t8.nature_id,
                       t8.cost_item_id,
                       t8.cost_item_code,
                       t8.cost_item_name) t10
    on t9.cost_type_id = t10.cost_type_id
	
	]]></sql>


</root>

