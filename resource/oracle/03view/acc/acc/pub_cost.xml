<?xml version="1.0" encoding="UTF-8" ?>
<root>

 <sql id="V_ACC_PUB_COST" type="view" desc="公用费用"><![CDATA[
	CREATE OR REPLACE VIEW V_ACC_PUB_COST AS
    SELECT 
    A.GROUP_ID,A.HOS_ID,A.COPY_CODE,
    A.YEAR_MONTH||'-'||A.PROJ_CODE BUSINESS_ID,
    A.YEAR_MONTH||'-'||A.PROJ_CODE BUSINESS_NO,
    A.PROJ_CODE SUB_TYPE_ID,
    T.DICT_NAME PROJ_NAME,
    A.YEAR_MONTH BUSI_DATE,
    D.DICT_NAME FT_PARA,
    A.FT_MY AMOUNT_MONEY,
    A.NOTE 
    FROM ACC_PUB_COST A
    LEFT JOIN HOS_DICT_TYPE T ON A.GROUP_ID=T.GROUP_ID AND A.HOS_ID=T.HOS_ID AND A.COPY_CODE=T.COPY_CODE 
    AND T.TABLE_CODE='01005' AND A.PROJ_CODE=T.DICT_CODE 
    LEFT JOIN INIT_ACC_DICT D ON D.TABLE_CODE='ACC_FT_PAPER' AND A.FT_PARA=D.DICT_CODE
    WHERE A.STATE=2
   	]]></sql>

  <sql id="V_ACC_PUB_COST_DETAIL" type="view" desc="公用费用明细"><![CDATA[
	CREATE OR REPLACE VIEW V_ACC_PUB_COST_DETAIL AS
    SELECT 
    A.GROUP_ID,A.HOS_ID,A.COPY_CODE,
    A.YEAR_MONTH||'-'||A.PROJ_CODE BUSINESS_ID,
    A.YEAR_MONTH||'-'||A.PROJ_CODE BUSINESS_NO,
    A.PROJ_CODE SUB_TYPE_ID,
    T.DICT_NAME PROJ_NAME,
    A.YEAR_MONTH BUSI_DATE,
    A.FT_PARA,
    B.DEPT_ID,
    B.DEPT_NO,
    D.DEPT_NAME,
    CASE B.DATA_TYPE WHEN 1 THEN '计算' ELSE '导入' END DATA_TYPE,
    B.FT_MY AMOUNT_MONEY,
    B.FT_BL,
    A.STATE,
    DT.OUT_CODE,
    A.NOTE 
    FROM ACC_PUB_COST A
    INNER JOIN ACC_PUB_COST_DETAIL B 
    ON A.GROUP_ID=B.GROUP_ID AND A.HOS_ID=B.HOS_ID AND A.COPY_CODE=B.COPY_CODE 
    AND A.PROJ_CODE=B.PROJ_CODE AND A.YEAR_MONTH=B.YEAR_MONTH
    LEFT JOIN HOS_DEPT_DICT D 
    ON D.GROUP_ID=B.GROUP_ID AND D.HOS_ID=B.HOS_ID AND D.DEPT_ID=B.DEPT_ID AND D.DEPT_NO=B.DEPT_NO
    LEFT JOIN HOS_DICT_TYPE T ON A.GROUP_ID=T.GROUP_ID AND A.HOS_ID=T.HOS_ID AND A.COPY_CODE=T.COPY_CODE 
    AND T.TABLE_CODE='01005' AND A.PROJ_CODE=T.DICT_CODE 
    LEFT JOIN ACC_DEPT_ATTR DT ON D.GROUP_ID=DT.GROUP_ID AND D.HOS_ID=DT.HOS_ID AND D.DEPT_ID=DT.DEPT_ID
    WHERE A.STATE=2
   	]]></sql>
   	
</root>

