<?xml version="1.0" encoding="UTF-8" ?>
<root>

	<sql id="PKG_TMP_TRANS" type="proc"><![CDATA[
		CREATE OR REPLACE PACKAGE PKG_TMP_TRANS AS

	   /*-------------------------------------------------------------------------*/
	   /* 变量声明区                                                              */
	   /*-------------------------------------------------------------------------*/
	   def_OK                    CONSTANT NUMBER      := 0;            -- 成功
	   def_ERR                   CONSTANT NUMBER      := -1 ;          -- 系统错误
	   def_WARNING               CONSTANT NUMBER      := 100;          -- 系统警告

	   --定义type_tmp_acc_subj结构体
	   TYPE type_rec_tmp_acc_subj IS RECORD(
			 subj_code          TMP_ACC_SUBJ_OLD.Subj_Code%type
			,subj_name          TMP_ACC_SUBJ_OLD.Subj_Name%type
			,subj_name_all      TMP_ACC_SUBJ_OLD.Subj_Name_All%type
			,SUBJ_TYPE_CODE     TMP_ACC_SUBJ_OLD.SUBJ_TYPE_CODE%type
			,SUBJ_NATURE_CODE   TMP_ACC_SUBJ_OLD.SUBJ_NATURE_CODE%type
			,SUBJ_DIRE          TMP_ACC_SUBJ_OLD.Subj_Dire%type
			,SUBJ_LEVEL         TMP_ACC_SUBJ_OLD.Subj_Level%type
			,IS_CASH            TMP_ACC_SUBJ_OLD.Is_Cash%type
			,IS_LAST            TMP_ACC_SUBJ_OLD.Is_Last%type
			,IS_CHECK           TMP_ACC_SUBJ_OLD.Is_Check%type
			,CHECK1             TMP_ACC_SUBJ_OLD.Check1%type
			,CHECK2             TMP_ACC_SUBJ_OLD.Check2%type
			,CHECK3             TMP_ACC_SUBJ_OLD.Check3%type
			,CHECK4             TMP_ACC_SUBJ_OLD.Check4%type
			,NOTE               TMP_ACC_SUBJ_OLD.Note%type
		);

	   --构建type_tab_item_cal结构体二维表
	   TYPE type_tab_tmp_acc_subj IS TABLE OF type_rec_tmp_acc_subj INDEX BY BINARY_INTEGER;
	   
	   
		--定义type_tmp_acc_subj结构体
	   TYPE type_rec_tmp_acc_subj_map IS RECORD(
			 subj_code_OLD      TMP_ACC_SUBJ_map.Subj_Code_Old%type
			,subj_name_OLD      TMP_ACC_SUBJ_map.Subj_Name_Old%type
			,subj_name_all_old  TMP_ACC_SUBJ_map.Subj_Name_All_Old%type
			,subj_code_NEW      TMP_ACC_SUBJ_map.Subj_Code_New%type
			,subj_name_NEW      TMP_ACC_SUBJ_map.subj_name_NEW%type
			,subj_name_all_new  TMP_ACC_SUBJ_map.Subj_Name_All_New%type
			,is_last            TMP_ACC_SUBJ_OLD.Is_Last%type         
		);
	  
	   --构建type_tab_item_cal结构体二维表
	   TYPE type_tab_tmp_acc_subj_map IS TABLE OF type_rec_tmp_acc_subj_map INDEX BY BINARY_INTEGER;
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：初始化所有hsh表
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_InitTab( prm_AppCode    Out Number
							  ,prm_ErrTxt     Out Varchar2
							 );
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：科目衔接转换
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_subj_code           IN     Varchar2       -- 会计科目
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Load_Subj(  prm_subj_code  IN  Varchar2
								 ,prm_AppCode    Out Number
								 ,prm_ErrTxt     Out Varchar2
								);
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：新会计科目入栈
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Write_Subj( prm_AppCode    Out Number
								 ,prm_ErrTxt     Out Varchar2
								);
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：新会计科目入栈
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Tab_Subj(  prm_AppCode    Out Number
									   ,prm_ErrTxt     Out Varchar2
									 );      
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：科目衔接转换
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Trans_Subj( prm_AppCode    Out Number
								 ,prm_ErrTxt     Out Varchar2
								);
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：prc_Insert_Tab_Budg
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Tab_Budg(  prm_AppCode    Out Number
									   ,prm_ErrTxt     Out Varchar2
									 );    
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：prc_UpdateSubjInfoSigle
	   || 功能描述 ：根据传入的科目编码更新科目全称、拼音码、五笔码
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode        业务处理标志     OUT          Number
	   ||            prm_ErrTxt         返回信息         OUT          Varchar2
	   ||
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
	   PROCEDURE prc_UpdateSubjInfoALL( prm_AppCode           Out  Number         --执行代码
										,prm_ErrTxt            Out  Varchar2       --错误信息
									   );   
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：检查整理旧科目
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_CheckSubjOld(  prm_AppCode    Out Number
									,prm_ErrTxt     Out Varchar2
								  );
								  
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：prc_UpdateSubjNameALL
	   || 功能描述 ：根据传入的科目编码更新科目全称
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode        业务处理标志     OUT          Number
	   ||            prm_ErrTxt         返回信息         OUT          Varchar2
	   ||
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
	   PROCEDURE prc_UpdateSubjNameALL( prm_AppCode           Out  Number         --执行代码
										,prm_ErrTxt            Out  Varchar2       --错误信息
									   );
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：更新科目映射表
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Tran_Map(  prm_AppCode    Out Number
									   ,prm_ErrTxt     Out Varchar2
									 );  
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：根据映射关系表，转换科目余额
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Ledger(  prm_AppCode    Out Number
									 ,prm_ErrTxt     Out Varchar2
								   );
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：根据映射关系表，转换科目辅助账余额
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Ledger_Check(  prm_AppCode    Out Number
										   ,prm_ErrTxt     Out Varchar2
										 );                                                                                                                                                                                                                                                                                               

	END PKG_TMP_TRANS;

	]]></sql>

	<sql id="PKG_TMP_TRANS_BODY" type="proc"><![CDATA[
		create or replace package body PKG_TMP_TRANS AS

	   /*-------------------------------------------------------------------------*/
	   /* 私有全局常量声明                                                        */
	   /*-------------------------------------------------------------------------*/
	   g_tab_tmp_acc_subj_old       type_tab_tmp_acc_subj;     --旧科目数据栈
	   g_tab_tmp_acc_subj_new       type_tab_tmp_acc_subj;     --新科目数据栈
	   g_tab_tmp_acc_subj_map       type_tab_tmp_acc_subj_map; --新旧科目

	   /*-------------------------------------------------------------------------*/
	   /* 私有函数方法声明                                                        */
	   /*-------------------------------------------------------------------------*/
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：初始化所有hsh表
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_InitTab( prm_AppCode    Out Number
							  ,prm_ErrTxt     Out Varchar2
							 )

		Is
		BEGIN
		  prm_AppCode := def_OK         ;
		  g_tab_tmp_acc_subj_old.delete ;
		  g_tab_tmp_acc_subj_new.delete ;
		  g_tab_tmp_acc_subj_map.delete ;
		  
		EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '初始化失败！'||SQLERRM;
		END prc_InitTab;
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：检查整理旧科目
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_CheckSubjOld(  prm_AppCode    Out Number
									,prm_ErrTxt     Out Varchar2
								  )

		Is
		  n_exist_flag        number(18);
		  
		BEGIN
		  prm_AppCode := def_OK  ;
		  n_exist_flag:= 0       ;
		  
		  --将所有的空格全部替换
		  update tmp_acc_subj_old
			set  subj_name = trim(replace(subj_name,'　',''))
			;
				
		  --更新科目级次
		  update tmp_acc_subj_old t
			set  t.subj_level = length(t.subj_code)/2 -1  
			;

		  --更新是否末级为否
		  update tmp_acc_subj_old t
			 set t.is_last = '否'   
			; 
				
		  --更新会计科目
		  declare
			n_count        integer;  
		  begin
			n_count := 0 ;
			for rec in ( select t.subj_code                     
						   from tmp_acc_subj_old t         
						   order by t.subj_code
						) loop 
							
				  select count(1) 
					into n_count
					from tmp_acc_subj_old t
				   where t.subj_code like rec.subj_code||'%' 
					;  
				  if n_count <= 1 then       
					  update tmp_acc_subj_old t    
						 set t.is_last = '是'
					   where t.subj_code = rec.subj_code                
						 ;
				   end if;      
			end loop;   
		  end; 
		  
		  --检测是否存在科目编码或科目名称为空的情况
		  select count(1) 
			into n_exist_flag
			from tmp_acc_subj_old t
		   where nvl(t.subj_code,'') = ''
			 or  nvl(t.subj_name,'') = ''
			 ;  
		  if n_exist_flag <> 0 then 
			 prm_AppCode := def_WARNING;
			 prm_ErrTxt := '原科目中存在科目编码或科目名称为空的数据！'||SQLERRM;
		  end if;  
		  
		  --更新科目类别
		  begin 
			update tmp_acc_subj_old t 
			   set t.subj_type_code = '资产'
			 where t.subj_code like '1%' 
			   and subj_type_code != '资产'
			   ;
			
			update tmp_acc_subj_old t 
			   set t.subj_dire = '借'
			 where t.subj_code like '1%' 
			   and t.subj_code not like '1602%'
			   and t.subj_code not like '1702%'
			   and t.subj_code not like '1221%'
			   and t.subj_dire != '借'           
			   ;   
			
			update tmp_acc_subj_old t 
			   set t.subj_dire = '贷'
			 where (  t.subj_code like '1602%'
				   or t.subj_code like '1702%'
				   or t.subj_code  like '1221%'
				   )
			   and t.subj_dire != '贷'           
			   ; 
				  
			update tmp_acc_subj_old t 
			   set t.subj_type_code = '负债'
			 where t.subj_code like '2%' 
			   and subj_type_code != '负债'
			   ;  
			
			update tmp_acc_subj_old t 
			   set t.subj_dire = '贷'
			 where t.subj_code like '2%' 
			   and t.subj_dire != '贷'           
			   ;     
			update tmp_acc_subj_old t 
			   set t.subj_type_code = '净资产'
			 where t.subj_code like '3%' 
			   and subj_type_code != '净资产'
			   ; 
				
			update tmp_acc_subj_old t 
			   set t.subj_dire = '贷'
			 where t.subj_code like '3%' 
			   and t.subj_dire != '贷'           
			   ;     
			
			update tmp_acc_subj_old t 
			   set t.subj_type_code = '收入'
			 where t.subj_code like '4%' 
			   and subj_type_code != '收入'
			   ; 
			
			update tmp_acc_subj_old t 
			   set t.subj_dire = '贷'
			 where t.subj_code like '4%' 
			   and t.subj_dire != '贷'           
			   ;    
			   
			update tmp_acc_subj_old t 
			   set t.subj_type_code = '费用'
			 where t.subj_code like '5%' 
			   and subj_type_code != '费用'
			   ;  
			
			update tmp_acc_subj_old t 
			   set t.subj_dire = '借'
			 where t.subj_code like '5%' 
			   and t.subj_dire != '借'           
			   ;  
						  
			EXCEPTION
			  WHEN NO_DATA_FOUND THEN
				NULL;          
			  WHEN OTHERS THEN
			   prm_AppCode := def_ERR;
			   prm_ErrTxt := '更新科目类别及科目方向时失败!'||SQLERRM;
			   return;   
		  end ;      
			   
		EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '更新原科目表失败！'||SQLERRM;
		END prc_CheckSubjOld;
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：prc_UpdateSubjNameALL
	   || 功能描述 ：根据传入的科目编码更新科目全称
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode        业务处理标志     OUT          Number
	   ||            prm_ErrTxt         返回信息         OUT          Varchar2
	   ||
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
	   PROCEDURE prc_UpdateSubjNameALL( prm_AppCode           Out  Number         --执行代码
										,prm_ErrTxt            Out  Varchar2       --错误信息
									   )
	   IS
		 /*------变量定义---------------*/
		  v_subj_code             tmp_acc_subj_new.subj_code%type;
		  v_subj_name             tmp_acc_subj_new.subj_name%type;
		  v_super_code            tmp_acc_subj_new.subj_code%type;
		  v_level                 tmp_acc_subj_new.subj_level%type;   --层次
		  v_super_subj_name_all   tmp_acc_subj_new.subj_name_all%type;
		
		  --定义科目游标
		  CURSOR cur_acc_subj  (prm_subj_level        IN   integer        --层级
							   )
		   IS
			SELECT subj_code
				 , subj_name
				 , case when subj_level = 1 then 'TOP'
						else substr(subj_code,1,subj_level * 2) 
					end as super_code      
			  FROM tmp_acc_subj_old
			 WHERE SUBJ_LEVEL = prm_subj_level
			 ORDER BY subj_code;
	   BEGIN

		  prm_AppCode := def_OK;

		 --如果是第一层，则直接更新
		 update tmp_acc_subj_old
		   set subj_name_all = subj_name
		 where SUBJ_LEVEL  = 1;

		 select max(SUBJ_LEVEL)
		   into v_level
		   from tmp_acc_subj_old
		  ;

		 for i in 2..v_level loop
			 open cur_acc_subj( i );
			   LOOP
				  FETCH cur_acc_subj INTO v_subj_code,v_subj_name,v_super_code;    --提取游标

				  IF cur_acc_subj%NOTFOUND THEN
					 if cur_acc_subj%isopen then
						CLOSE cur_acc_subj;
					 end if;
					 goto next_i;
				  END IF;

				  if UPPER(v_super_code) = 'TOP' then
					  update tmp_acc_subj_old
						 set subj_name_all = subj_name
					   where subj_code  = v_subj_code;
				  else
					  select subj_name_all
						into v_super_subj_name_all
						from tmp_acc_subj_old
					   where subj_code = v_super_code;

					  update tmp_acc_subj_old
						 set subj_name_all = v_super_subj_name_all || '-' || subj_name                        
					   where subj_code  = v_subj_code;
				  end if;
			end loop;
			<<next_i>>
			   null;
			if cur_acc_subj%isopen then
			   CLOSE cur_acc_subj;
			end if;
		 end loop;
	   EXCEPTION
		  WHEN NO_DATA_FOUND then
			 NULL;
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '更新原科目全称时失败！'||SQLERRM;
	   END prc_UpdateSubjNameALL;
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：科目衔接转换
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_subj_code           IN     Varchar2       -- 会计科目
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Load_Subj(  prm_subj_code  IN  Varchar2
								 ,prm_AppCode    Out Number
								 ,prm_ErrTxt     Out Varchar2
								)

		Is
		 --定义计算公式游标
		 CURSOR cur_Tmp_acc_subj  ( prm_subj_code        IN   VARCHAR2       --开始年度
								   )
		   IS
		   select subj_code
				 ,nvl(subj_name,'')
				 ,nvl(SUBJ_NAME_ALL,'')
				 ,nvl(SUBJ_TYPE_CODE,'')
				 ,nvl(SUBJ_NATURE_CODE,'')
				 ,nvl(SUBJ_DIRE,'')
				 ,nvl(SUBJ_LEVEL,'')
				 ,nvl(IS_CASH,'')
				 ,nvl(IS_LAST,'')
				 ,nvl(IS_CHECK,'')
				 ,nvl(CHECK1,'')
				 ,nvl(CHECK2,'')
				 ,nvl(CHECK3,'')
				 ,nvl(CHECK4,'')
				 ,nvl(NOTE,'')
			from TMP_ACC_SUBJ_OLD t
		   where t.subj_code like prm_subj_code||'%'
		   order by subj_code ;

		 --定义变量
		 v_subj_code          TMP_ACC_SUBJ_OLD.Subj_Code%type;
		 v_subj_name          TMP_ACC_SUBJ_OLD.Subj_Name%type;
		 v_subj_name_all      TMP_ACC_SUBJ_OLD.Subj_Name_All%type;
		 v_SUBJ_TYPE_CODE     TMP_ACC_SUBJ_OLD.SUBJ_TYPE_CODE%type;
		 v_SUBJ_NATURE_CODE   TMP_ACC_SUBJ_OLD.SUBJ_NATURE_CODE%type;
		 v_SUBJ_DIRE          TMP_ACC_SUBJ_OLD.Subj_Dire%type;
		 v_SUBJ_LEVEL         TMP_ACC_SUBJ_OLD.Subj_Level%type;
		 v_IS_CASH            TMP_ACC_SUBJ_OLD.Is_Cash%type;
		 v_IS_LAST            TMP_ACC_SUBJ_OLD.Is_Last%type;
		 v_IS_CHECK           TMP_ACC_SUBJ_OLD.Is_Check%type;
		 v_CHECK1             TMP_ACC_SUBJ_OLD.Check1%type;
		 v_CHECK2             TMP_ACC_SUBJ_OLD.Check2%type;
		 v_CHECK3             TMP_ACC_SUBJ_OLD.Check3%type;
		 v_CHECK4             TMP_ACC_SUBJ_OLD.Check4%type;
		 v_NOTE               TMP_ACC_SUBJ_OLD.Note%type;

		 v_i                  integer;
		BEGIN
		  prm_AppCode := def_OK      ;
		  v_i         := 1           ;
		  --打开游标
		  open cur_Tmp_acc_subj(  prm_subj_code );
		  LOOP
			  --提取游标
			  FETCH cur_Tmp_acc_subj
			   INTO v_subj_code
				   ,v_subj_name
				   ,v_subj_name_all
				   ,v_SUBJ_TYPE_CODE
				   ,v_SUBJ_NATURE_CODE
				   ,v_SUBJ_DIRE
				   ,v_SUBJ_LEVEL
				   ,v_IS_CASH
				   ,v_IS_LAST
				   ,v_IS_CHECK
				   ,v_CHECK1
				   ,v_CHECK2
				   ,v_CHECK3
				   ,v_CHECK4
				   ,v_NOTE
				   ;

			  IF cur_Tmp_acc_subj%NOTFOUND THEN
				 if cur_Tmp_acc_subj%isopen then
					CLOSE cur_Tmp_acc_subj;
				 end if;
				 EXIT;
			  END IF;

			  --装载Hsh表
			  g_tab_tmp_acc_subj_old(v_i).subj_code           := v_subj_code        ;
			  g_tab_tmp_acc_subj_old(v_i).subj_name           := v_subj_name        ;
			  g_tab_tmp_acc_subj_old(v_i).subj_name_all       := v_subj_name        ;
			  g_tab_tmp_acc_subj_old(v_i).SUBJ_TYPE_CODE      := v_SUBJ_TYPE_CODE   ;
			  g_tab_tmp_acc_subj_old(v_i).SUBJ_NATURE_CODE    := v_SUBJ_NATURE_CODE ;
			  g_tab_tmp_acc_subj_old(v_i).SUBJ_DIRE           := v_SUBJ_DIRE        ;
			  g_tab_tmp_acc_subj_old(v_i).SUBJ_LEVEL          := v_SUBJ_LEVEL       ;
			  g_tab_tmp_acc_subj_old(v_i).IS_CASH             := v_IS_CASH          ;
			  g_tab_tmp_acc_subj_old(v_i).IS_LAST             := v_IS_LAST          ;
			  g_tab_tmp_acc_subj_old(v_i).IS_CHECK            := v_IS_CHECK         ;
			  g_tab_tmp_acc_subj_old(v_i).CHECK1              := v_CHECK1           ;
			  g_tab_tmp_acc_subj_old(v_i).CHECK2              := v_CHECK2           ;
			  g_tab_tmp_acc_subj_old(v_i).CHECK3              := v_CHECK3           ;
			  g_tab_tmp_acc_subj_old(v_i).CHECK4              := v_CHECK4           ;
			  g_tab_tmp_acc_subj_old(v_i).NOTE                := v_NOTE             ;
			  
			  if substr(v_subj_code,1,1) in ('1','2','3') then  
				 g_tab_tmp_acc_subj_map(v_i).subj_code_OLD       := v_subj_code        ;
				 g_tab_tmp_acc_subj_map(v_i).subj_name_OLD       := v_subj_name        ;
				 g_tab_tmp_acc_subj_map(v_i).subj_name_all_old   := v_subj_name_all    ;
				 g_tab_tmp_acc_subj_map(v_i).subj_code_NEW       := v_subj_code        ;
				 g_tab_tmp_acc_subj_map(v_i).subj_name_NEW       := v_subj_name        ;
				 g_tab_tmp_acc_subj_map(v_i).subj_name_all_new   := v_subj_name_all    ;
				 g_tab_tmp_acc_subj_map(v_i).is_last             := v_IS_LAST          ;
			  end if;  
				
			  v_i := v_i + 1 ;
		 END LOOP;

		 if cur_Tmp_acc_subj%isopen then
			CLOSE cur_Tmp_acc_subj;
		 end if;

		EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '加载旧科目数据栈失败！'||SQLERRM;
		END prc_Load_Subj;

	   /*-------------------------------------------------------------------------
	   || 过程名称 ：对原会计科目进行加工处理
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Treat_Subj( prm_AppCode    Out Number
								 ,prm_ErrTxt     Out Varchar2
								)

		Is
		  C4602                 integer;
		  C460201               integer;
		  C4603                 integer;
		  C460301               integer;
		  C4604                 integer;
		  C460401               integer;
		  C4605                 integer;
		  C460501               integer;
		  C4609                 integer;
		  C460901               integer;
		  C5301                 integer;
		  C530101               integer;
		  C5901                 integer;
		  C590101               integer;
		  tmp_subj_2101         varchar2(100);
		BEGIN
		  prm_AppCode := def_OK      ;
		  C4602       := 1           ;
		  C460201     := 1           ;
		  C4603       := 1           ;
		  C460301     := 1           ;
		  C4604       := 1           ;
		  C460401     := 1           ;
		  C4605       := 1           ;
		  C460501     := 1           ;
		  C4609       := 1           ;
		  C460901     := 1           ;
		  C5301       := 1           ;
		  C530101     := 1           ;
		  C5901       := 1           ;
		  C590101     := 1           ;
		  tmp_subj_2101 := ''        ;
		  
		  for i in 1..g_tab_tmp_acc_subj_old.count() loop
			  --1、现金、银行科目平移
				   /**********  空处理   ***************/
			  --2、零余额账户用款额度，由1003改为1011
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1003%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '1011' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5); 
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '1011' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;            
			  end if;          
			  --3、零余额账户用款额度，由1004改为1021
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1004%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '1021' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '1021' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  --4、短期投资1101，财政应返还额度1201科目平移
				/**********  空处理   ***************/
				
			  --5、应收在院病人医疗款，由1211更改为121201  
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1211%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '121201' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '121201' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  --6、应收在院病人医疗款，由1212更改为121202
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1212%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '121202' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '121202' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --7、其他应收款[需要拆分为应收股利、应收利息、其他应收款、在途物品几个科目]，需要手工调整
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1215%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '1218' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%股权%' then 
					g_tab_tmp_acc_subj_map(i).subj_code_new := '1215';
					g_tab_tmp_acc_subj_map(i).subj_name_new := '应收股利';
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '应收股利';
				 elsif g_tab_tmp_acc_subj_old(i).subj_name like '%利息%' then  
					g_tab_tmp_acc_subj_map(i).subj_code_new := '1216';
					g_tab_tmp_acc_subj_map(i).subj_name_new := '应收利息';
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '应收利息';
				 elsif g_tab_tmp_acc_subj_old(i).subj_name like '%在途%' then 
					g_tab_tmp_acc_subj_map(i).subj_name_new := '在途物品';
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '在途物品';
					g_tab_tmp_acc_subj_map(i).subj_code_new := '1301';  
				 else   
					g_tab_tmp_acc_subj_map(i).subj_code_new := '1218' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5); 
				 end if;             
				 continue;
			  end if;
			  
			  --8、坏账准备1221,更改为1219
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1221%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '1219' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '121901' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --9、预付账款1231,更改为1214
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1231%' then
				 if g_tab_tmp_acc_subj_old(i).subj_code = '1231' then
					g_tab_tmp_acc_subj_old(i).subj_name := '在途物品';
					g_tab_tmp_acc_subj_old(i).subj_name_all := '在途物品';
					g_tab_tmp_acc_subj_map(i).subj_name_new := '在途物品';
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '在途物品';
				 end if;
				 
				 if g_tab_tmp_acc_subj_old(i).subj_code = '1231' then               
					g_tab_tmp_acc_subj_old(i).subj_code := '1301' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
					g_tab_tmp_acc_subj_map(i).subj_code_new := '1301' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 else
					g_tab_tmp_acc_subj_old(i).subj_code := '1214' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5); 
					g_tab_tmp_acc_subj_map(i).subj_code_new := '1214' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);               
				 end if;   
				 continue;
			  end if;
			  
			   --10、库存物资1301,更改为1302
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1301%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '1302' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '1302' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --11、在加工物资1302,更改为1303
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1302%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '1303' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '1303' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --如果1501，将一级科目删除
			  if g_tab_tmp_acc_subj_old(i).subj_code = '1501' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := 'delete';
				 g_tab_tmp_acc_subj_map(i).subj_code_new := 'delete';
				 continue;
			  end if;
			  
			  --12、长期股权投资150101,更改为1501
			  if g_tab_tmp_acc_subj_old(i).subj_code like '150101%' then 
				 if g_tab_tmp_acc_subj_old(i).subj_code = '150101' then
					g_tab_tmp_acc_subj_old(i).subj_name := '长期股权投资';
					g_tab_tmp_acc_subj_old(i).subj_name_all := '长期股权投资';
					
					g_tab_tmp_acc_subj_map(i).subj_name_new := '长期股权投资';
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '长期股权投资';
					
				 end if;
				 g_tab_tmp_acc_subj_old(i).subj_code := '1501' || substr(g_tab_tmp_acc_subj_old(i).subj_code,7);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '1501' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,7);    
				 g_tab_tmp_acc_subj_old(i).SUBJ_LEVEL := g_tab_tmp_acc_subj_old(i).SUBJ_LEVEL - 1;
				 continue;
			  end if;
			  
			  --16、长期债权投资150102,更改为1502
			  if g_tab_tmp_acc_subj_old(i).subj_code like '150102%' then 
				 if g_tab_tmp_acc_subj_old(i).subj_code = '150102' then
					g_tab_tmp_acc_subj_old(i).subj_name := '长期债权投资';
					g_tab_tmp_acc_subj_old(i).subj_name_all := '长期债权投资';
				 end if;
				 g_tab_tmp_acc_subj_old(i).subj_code := '1502' || substr(g_tab_tmp_acc_subj_old(i).subj_code,7);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '1502' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,7);
				 g_tab_tmp_acc_subj_old(i).SUBJ_LEVEL := g_tab_tmp_acc_subj_old(i).SUBJ_LEVEL - 1;
				 continue;
			  end if;
			  
			  --16、累计折旧1602,更改为固定资产累计折旧
			  if g_tab_tmp_acc_subj_old(i).subj_code = '1602' then 
				 g_tab_tmp_acc_subj_old(i).subj_name := '固定资产累计折旧';
				 g_tab_tmp_acc_subj_old(i).subj_name_all := '固定资产累计折旧';
				 
				 g_tab_tmp_acc_subj_map(i).subj_name_new := '固定资产累计折旧';
				 g_tab_tmp_acc_subj_map(i).subj_name_all_new := '固定资产累计折旧';
				 continue;
			  end if;
			  
			   --17、在建工程1611,更改为1613
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1611%' then              
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%物资%' then
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
					g_tab_tmp_acc_subj_map(i).subj_code_new := '1611';
					g_tab_tmp_acc_subj_map(i).subj_name_new := '工程物资';
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '工程物资';
				 else 
					g_tab_tmp_acc_subj_old(i).subj_code := '1613' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);   
					g_tab_tmp_acc_subj_map(i).subj_code_new := '1613' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 end if;             
				 continue;
			  end if;
			  
			  --18、固定资产清理 1621 ，余额转入到待处理财产损溢科目
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1621%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '190202';
				 g_tab_tmp_acc_subj_map(i).subj_name_new := '待处理非流动资产损溢';
				 g_tab_tmp_acc_subj_map(i).subj_name_all_new := '待处理非流动资产损溢';
				 continue;
			  end if;
			  
			  --19、累计摊销1702 ，更改为无形资产累计摊销
			  if g_tab_tmp_acc_subj_old(i).subj_code = '1702' then 
				 g_tab_tmp_acc_subj_old(i).subj_name := '无形资产累计摊销' ;
				 g_tab_tmp_acc_subj_old(i).subj_name_all := '无形资产累计摊销' ;
				 g_tab_tmp_acc_subj_map(i).subj_name_new := '无形资产累计摊销' ;
				 g_tab_tmp_acc_subj_map(i).subj_name_all_new := '无形资产累计摊销' ;
				 continue;
			  end if;
			  
			  --20、长期待摊费用1801，更改为1901
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1801%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '1901' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '1901' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --21、长期待摊费用1801，更改为1901
			  if g_tab_tmp_acc_subj_old(i).subj_code like '1901%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '1902' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '1902' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --22、应缴款项2101,更改为2013
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2101%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '2103' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '2103' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --23、应付票据2201,更改为2301
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2201%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '2301' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '2301' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --24、应付账款2202,更改为2302
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2202%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '2302' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '2302' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --25、预收医疗款2203,更改为230501
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2203%' then 
				/* if g_tab_tmp_acc_subj_old(i).subj_code = '2203' then 
					g_tab_tmp_acc_subj_old(i).subj_name := '预收账款';
					g_tab_tmp_acc_subj_old(i).subj_name_all := '预收账款';
				 end if;*/
				 g_tab_tmp_acc_subj_old(i).subj_code := '230501' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5); 
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '230501' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 g_tab_tmp_acc_subj_old(i).SUBJ_LEVEL :=   g_tab_tmp_acc_subj_old(i).SUBJ_LEVEL + 1 ;          
				 continue;
			  end if;
			  
			  --25、应付职工薪酬2204,更改为220101
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2204%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '220101' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '220101' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --26、应付福利费2205,转入"累计盈余-新旧转换盈余"
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2205%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '300104' ;
				 g_tab_tmp_acc_subj_map(i).subj_name_new := '新旧转换盈余' ;
				 g_tab_tmp_acc_subj_map(i).subj_name_all_new := '新旧转换盈余' ;
				 continue;
			  end if;
			  
			  --27、应付社会保障费2206,更改为220102
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2206%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '220102' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '220102' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 continue;
			  end if;
			  
			  --28、应付社会保障费2207,更改为2102
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2207%' then 
				 if g_tab_tmp_acc_subj_old(i).subj_code = '2207' then 
					g_tab_tmp_acc_subj_old(i).subj_name := '其他应交税费';
					g_tab_tmp_acc_subj_old(i).subj_name_all := '其他应交税费';
					
					g_tab_tmp_acc_subj_map(i).subj_name_new := '其他应交税费';
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '其他应交税费';
				 end if;
				 g_tab_tmp_acc_subj_old(i).subj_code := '2102' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5); 
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '2102' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				  
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%增值税%' then 
					tmp_subj_2101 := g_tab_tmp_acc_subj_old(i).subj_code;
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
					g_tab_tmp_acc_subj_map(i).subj_code_new := '2101' ;
					g_tab_tmp_acc_subj_map(i).subj_name_new := '应交增值税' ;
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '应交增值税' ;
				 end if;  
				 if g_tab_tmp_acc_subj_old(i).subj_code like tmp_subj_2101||'%'  and g_tab_tmp_acc_subj_old(i).subj_code <> tmp_subj_2101 then
					g_tab_tmp_acc_subj_old(i).subj_code := '2101' || substr(g_tab_tmp_acc_subj_old(i).subj_code,length(tmp_subj_2101)+1,5);
					g_tab_tmp_acc_subj_map(i).subj_code_new := '2101' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,length(tmp_subj_2101)+1,5);
				 end if;                  
				 continue;
			  end if;
			  
			  --29、其他应付款2209，更改为2307
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2209%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '2307' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '2307' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%利息%' then
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
					g_tab_tmp_acc_subj_map(i).subj_code_new := '2304' ;
					g_tab_tmp_acc_subj_map(i).subj_name_new := '应付利息' ;
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '应付利息' ;
				 end if; 
				 continue;
			  end if;
			  
			  --30、预提费用2301，更改为2401
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2301%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '2401' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '2401' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%利息%' then
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
					g_tab_tmp_acc_subj_map(i).subj_code_new := '2304' ;
					g_tab_tmp_acc_subj_map(i).subj_name_new := '应付利息' ;
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '应付利息' ;
				 end if; 
				 continue;
			  end if;
			  
			  --31、长期借款2401，更改为2501
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2401%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '2501' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '2501' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%利息%' then
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
					g_tab_tmp_acc_subj_map(i).subj_code_new := '2304' ;
					g_tab_tmp_acc_subj_map(i).subj_name_new := '应付利息' ;
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '应付利息' ;
				 end if; 
				 continue;
			  end if;
			  
			  --31、长期应付款2402，更改为2502
			  if g_tab_tmp_acc_subj_old(i).subj_code like '2402%' then 
				 g_tab_tmp_acc_subj_old(i).subj_code := '2502' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '2502' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%利息%' then
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
					g_tab_tmp_acc_subj_map(i).subj_code_new := '2304' ;
					g_tab_tmp_acc_subj_map(i).subj_name_new := '应付利息' ;
					g_tab_tmp_acc_subj_map(i).subj_name_all_new := '应付利息' ;
				 end if; 
				 continue;
			  end if;
			  
			  --32、事业基金3001，更改名称累计盈余
			  if g_tab_tmp_acc_subj_old(i).subj_code like '3001%' then
				 g_tab_tmp_acc_subj_old(i).subj_name := '累计盈余' ;
				 g_tab_tmp_acc_subj_old(i).subj_name_all := '累计盈余' ;
				 
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '300102'   ;
				 g_tab_tmp_acc_subj_map(i).subj_name_new := '医疗盈余' ;
				 g_tab_tmp_acc_subj_map(i).subj_name_all_new := '医疗盈余' ;
				 
				 if length(g_tab_tmp_acc_subj_old(i).subj_code) > 4 then 
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
					g_tab_tmp_acc_subj_map(i).subj_code_new := 'delete' ;
				 end if;
				 continue;
			  end if;   
			  
			  --33、待冲基金3201，删除
			  if g_tab_tmp_acc_subj_old(i).subj_code = '3201' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := 'delete' ;
				 g_tab_tmp_acc_subj_map(i).subj_code_new := 'delete' ;
				 continue;
			  end if;
			  
			  --34、待冲基金3201，更改30010102
			  if g_tab_tmp_acc_subj_old(i).subj_code like '320101%' then  
				 /**************政府会计制度：取消待冲基金**********************/
				 --g_tab_tmp_acc_subj_old(i).subj_code := '30010102' || substr(g_tab_tmp_acc_subj_old(i).subj_code,7);
				 g_tab_tmp_acc_subj_old(i).subj_code := 'delete';
				 --g_tab_tmp_acc_subj_map(i).subj_code_new := '30010102' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,7);
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '30010102' ;
				 continue;
			  end if;
			  
			  --35、待冲基金3201，更改30010302
			  if g_tab_tmp_acc_subj_old(i).subj_code like'320102%' then  
				 --g_tab_tmp_acc_subj_old(i).subj_code := '30010302' || substr(g_tab_tmp_acc_subj_old(i).subj_code,7);
				 g_tab_tmp_acc_subj_old(i).subj_code := 'delete';
				 --g_tab_tmp_acc_subj_map(i).subj_code_new := '30010302' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,7);
				 g_tab_tmp_acc_subj_map(i).subj_code_new :='30010302';
				 continue;
			  end if;
			  
			  --36、财政补助结转（余）3301，更改为30010101
			  if g_tab_tmp_acc_subj_old(i).subj_code like '3301%' then  
				 if length(g_tab_tmp_acc_subj_old(i).subj_code) = 4 then
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete'; 
					continue ;
				 end if;  
				 
				 g_tab_tmp_acc_subj_old(i).subj_code := '3001' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_old(i).subj_name := replace(g_tab_tmp_acc_subj_old(i).subj_name,'结转（余）','盈余');
				 g_tab_tmp_acc_subj_old(i).subj_name := replace(g_tab_tmp_acc_subj_old(i).subj_name,'结转','盈余');
				 g_tab_tmp_acc_subj_old(i).subj_name_all := replace(g_tab_tmp_acc_subj_old(i).subj_name_all,'结转（余）','盈余');
				 g_tab_tmp_acc_subj_old(i).subj_name_all := replace(g_tab_tmp_acc_subj_old(i).subj_name_all,'结转','盈余');
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '3001' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%结余%' then
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete'; 
				 end if;               
				 continue;
			  end if;
			  
			  --37、财政补助结转（余）3302，更改为30010301
			  if g_tab_tmp_acc_subj_old(i).subj_code like '3302%' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := '300103' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_old(i).subj_name := replace(g_tab_tmp_acc_subj_old(i).subj_name,'结转（余）','盈余');
				 g_tab_tmp_acc_subj_old(i).subj_name := replace(g_tab_tmp_acc_subj_old(i).subj_name,'结转','盈余');
				 g_tab_tmp_acc_subj_old(i).subj_name_all := replace(g_tab_tmp_acc_subj_old(i).subj_name_all,'结转（余）','盈余');
				 g_tab_tmp_acc_subj_old(i).subj_name_all := replace(g_tab_tmp_acc_subj_old(i).subj_name_all,'结转','盈余');
				 g_tab_tmp_acc_subj_map(i).subj_code_new := '300103' || substr(g_tab_tmp_acc_subj_map(i).subj_code_new,5);             
				 continue;
			  end if;
			  
			  --38、本期结余3401,更改为3301，并更改名字为本期盈余
			  if g_tab_tmp_acc_subj_old(i).subj_code like '3401%' then 
         
         if g_tab_tmp_acc_subj_old(i).subj_code = '3401' then 
            g_tab_tmp_acc_subj_old(i).subj_code := '3301' ;
					  g_tab_tmp_acc_subj_old(i).subj_name := '本期盈余' ;
					  g_tab_tmp_acc_subj_old(i).subj_name_all := '本期盈余' ;
            continue;
				 end if;   
         
         if length(g_tab_tmp_acc_subj_old(i).subj_code ) > 4 then  
				    g_tab_tmp_acc_subj_old(i).subj_code := '330102' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
         end if;  
				 
				 --由于本科目年末无余额，不需要转换
				 g_tab_tmp_acc_subj_map(i).subj_code_new := 'delete' ;
				 continue;
			  end if;
			  
			  --39、结余分配3501，更改为3302,并更改名字为本年盈余分配
			  if g_tab_tmp_acc_subj_old(i).subj_code like '3501%' then 
				
				 --由于本科目年末无余额，不需要转换
				 g_tab_tmp_acc_subj_map(i).subj_code_new := 'delete' ;
				 
				 if length(g_tab_tmp_acc_subj_old(i).subj_code)>4 then
					g_tab_tmp_acc_subj_old(i).subj_code := '3302' || substr('00'||to_char(to_number(substr(g_tab_tmp_acc_subj_old(i).subj_code,5))- 1),-2);
				 else
					g_tab_tmp_acc_subj_old(i).subj_code := '3302';
				 end if;     
				 if g_tab_tmp_acc_subj_old(i).subj_code = '3302' then  
					g_tab_tmp_acc_subj_old(i).subj_name := '本期盈余分配' ;
					g_tab_tmp_acc_subj_old(i).subj_name_all := '本期盈余分配' ;            
				 end if; 
				 
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%弥补亏损%' then 
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete';
				 end if;  
				 
				 
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%事业基金%' then
					g_tab_tmp_acc_subj_old(i).subj_name := replace(g_tab_tmp_acc_subj_old(i).subj_name,'事业基金','累计盈余');
					g_tab_tmp_acc_subj_old(i).subj_name_all := replace(g_tab_tmp_acc_subj_old(i).subj_name_all,'事业基金','累计盈余');
				 end if;
				 continue;
			  end if;
			  
			  --40、医疗收入4001，更改为4101
			  if g_tab_tmp_acc_subj_old(i).subj_code like '4001%' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := '410101' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_old(i).subj_level := g_tab_tmp_acc_subj_old(i).subj_level + 1 ;
				  
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%结算差额%' then 
					g_tab_tmp_acc_subj_old(i).subj_code := 'delete';              
				 end if;
				 continue;
			  end if;
			  
			  --41、财政补助收入4101，更改为4001
			  if g_tab_tmp_acc_subj_old(i).subj_code like '4101%' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := '4001' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 
				 if g_tab_tmp_acc_subj_old(i).subj_code = '4001' then
					g_tab_tmp_acc_subj_old(i).subj_name := '财政拨款收入';
					g_tab_tmp_acc_subj_old(i).subj_name_all := '财政拨款收入';
				 end if;
				 continue;
			  end if;  
			  
			  --42、科教收入4201,更改为410102
			  if g_tab_tmp_acc_subj_old(i).subj_code like '4201%' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := '410102' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_old(i).subj_level := g_tab_tmp_acc_subj_old(i).subj_level + 1 ;
				 continue;
			  end if;
			  
			  --43、其他收入4301，如果为投资收益，更改为4602,捐赠收入，更改为4603，
			  --                  如果为利息收入，更改为4604，租金收入,更改为4605，其余均为其他收入
			  if g_tab_tmp_acc_subj_old(i).subj_code like '4301%' then  
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%投资%' then 
					if (length(g_tab_tmp_acc_subj_old(i).subj_code) = 6 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '4602' || substr('00'||to_char(C4602),-2);
					   C4602 := C4602 + 1;
					   C460201 := 1;
					else
					   g_tab_tmp_acc_subj_old(i).subj_code := '4602' || substr('00'||to_char(C4602-1),-2) || substr('00'||to_char(C460201),-2);
					   C460201 := C460201 + 1;  
					end if; 
					continue;                
				 end if;
				 
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%捐赠%' then 
					if (length(g_tab_tmp_acc_subj_old(i).subj_code) = 6 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '4603' || substr('00'||to_char(C4603),-2);
					   C4603 := C4603 + 1;
					   C460301 := 1;
					else
					   g_tab_tmp_acc_subj_old(i).subj_code := '4603' || substr('00'||to_char(C4603-1),-2) || substr('00'||to_char(C460301),-2);
					   C460301 := C460301 + 1;  
					end if;  
					continue;               
				 end if;
				 
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%利息%' then 
					if (length(g_tab_tmp_acc_subj_old(i).subj_code) = 6 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '4604' || substr('00'||to_char(C4604),-2);
					   C4604 := C4604 + 1;
					   C460401 := 1;
					else
					   g_tab_tmp_acc_subj_old(i).subj_code := '4604' || substr('00'||to_char(C4604-1),-2) || substr('00'||to_char(C460401),-2);
					   C460401 := C460401 + 1;  
					end if; 
					continue;                
				 end if; 
				 
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%租%' then 
					if (length(g_tab_tmp_acc_subj_old(i).subj_code) = 6 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '4605' || substr('00'||to_char(C4605),-2);
					   C4605 := C4605 + 1;
					   C460501 := 1;
					else
					   g_tab_tmp_acc_subj_old(i).subj_code := '4605' || substr('00'||to_char(C4605-1),-2) || substr('00'||to_char(C460501),-2);
					   C460501 := C460501 + 1;  
					end if;    
					continue;             
				 end if;
				 
				 if g_tab_tmp_acc_subj_old(i).subj_code like '4301%' then 
					if (length(g_tab_tmp_acc_subj_old(i).subj_code) = 4 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '4609' ;
					elsif (length(g_tab_tmp_acc_subj_old(i).subj_code) = 6 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '4609' || substr('00'||to_char(C4609),-2);
					   C4609 := C4609 + 1;
					   C460901 := 1;
					else
					   g_tab_tmp_acc_subj_old(i).subj_code := '4609' || substr('00'||to_char(C4609-1),-2) || substr('00'||to_char(C460901),-2);
					   C460901 := C460901 + 1;  
					end if; 
					continue;                
				 end if;
			  end if;  
			  
			  --医疗业务成本 5001,更改为500101
			  if g_tab_tmp_acc_subj_old(i).subj_code like '5001%' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := '500101' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_old(i).subj_level := g_tab_tmp_acc_subj_old(i).subj_level + 1 ;
				 continue; 
			  end if;
			  
			  --财政项目支出5101,更改为500102
			  if g_tab_tmp_acc_subj_old(i).subj_code like '5101%' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := '50010202' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_old(i).subj_level := g_tab_tmp_acc_subj_old(i).subj_level + 1 ;
				 continue; 
			  end if;
			  
			  --科教项目支出5201,更改为500103
			  if g_tab_tmp_acc_subj_old(i).subj_code like '5201%' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := '500103' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_old(i).subj_level := g_tab_tmp_acc_subj_old(i).subj_level + 1 ;
				 continue; 
			  end if;
			  
			  --管理费用 5301,更改为510101
			  if g_tab_tmp_acc_subj_old(i).subj_code like '5301%' then  
				 g_tab_tmp_acc_subj_old(i).subj_code := '510101' || substr(g_tab_tmp_acc_subj_old(i).subj_code,5);
				 g_tab_tmp_acc_subj_old(i).subj_level := g_tab_tmp_acc_subj_old(i).subj_level + 1 ;
				 continue; 
			  end if;
			  
			  --其他费用5302,如果资产处置费用更改5301，其他更改为5901
			  if g_tab_tmp_acc_subj_old(i).subj_code like '5302%' then 
				 if g_tab_tmp_acc_subj_old(i).subj_name like '%处置%' then 
					if (length(g_tab_tmp_acc_subj_old(i).subj_code) = 6 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '5301' || substr('00'||to_char(C5301),-2);
					   C5301 := C5301 + 1;
					   C530101 := 1;
					else
					   g_tab_tmp_acc_subj_old(i).subj_code := '5301' || substr('00'||to_char(C5301-1),-2) || substr('00'||to_char(C530101),-2);
					   C530101 := C530101 + 1;  
					end if; 
					continue;                
				 end if;
				 
				 if g_tab_tmp_acc_subj_old(i).subj_code like '5302%' then 
					if (length(g_tab_tmp_acc_subj_old(i).subj_code) = 4 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '5901' ;
					elsif (length(g_tab_tmp_acc_subj_old(i).subj_code) = 6 ) then
					   g_tab_tmp_acc_subj_old(i).subj_code := '5901' || substr('00'||to_char(C5901),-2);
					   C5901 := C5901 + 1;
					   C590101 := 1;
					else
					   g_tab_tmp_acc_subj_old(i).subj_code := '5901' || substr('00'||to_char(C5901-1),-2) || substr('00'||to_char(C590101),-2);
					   C590101 := C590101 + 1;  
					end if; 
					continue;                
				 end if;
			  end if;   
		  end loop;
		  

		EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '科目衔接转换失败！'||SQLERRM;
		END prc_Treat_Subj;
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：新会计科目入栈
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Write_Subj( prm_AppCode    Out Number
								 ,prm_ErrTxt     Out Varchar2
								)

		Is
		  v_i                  integer;     
		  v_new_1212           integer;    
		  v_new_1218           integer;  
		  v_old_1221_count     integer;   
		  v_new_1613           integer;   
		  v_new_1901           integer; 
		  v_new_2103           integer;  
		  v_new_2305           integer;  
		  v_new_2502           integer;   
		  v_new_3001           integer;
		  v_new_230501         integer;
		  v_new_230502         integer;
		  v_new_3201           integer;
		  v_new_3301           integer;
		BEGIN
		  prm_AppCode := def_OK       ;
		  v_new_1212  := 0            ;
		  v_new_1218  := 0            ;
		  v_old_1221_count  := 0      ;
		  v_new_1613 := 0             ;
		  v_new_1901 := 0             ;
		  v_new_2103 := 0             ;
		  v_new_2305 := 0             ;
		  v_new_2502 := 0             ;
		  v_new_3001 := 0             ;
		  v_new_230501 := 0           ;
		  v_new_230502 := 0           ;
		  v_new_3201  := 0            ;
		  v_new_3301  := 0            ;
		  
		  v_i         := g_tab_tmp_acc_subj_new.count() + 1 ;
		  
		  for i in 1..g_tab_tmp_acc_subj_old.count() loop
			 --处理应收账款
			 if g_tab_tmp_acc_subj_old(i).subj_code like '1212%'  then
			   
				select count(1)
				  into v_new_1212
				  from tmp_acc_subj_new t
				 where t.subj_code like '1212%' 
				 ;
				
				if v_new_1212 = 0 then  
				   for j in 1..g_tab_tmp_acc_subj_new.count() loop
					  if substr(g_tab_tmp_acc_subj_new(j).subj_code,1,4) = '1212' then 
						 v_new_1212 := 1 ;
						 exit;
					  end if;
				   end loop;
				end if;
				 
				if  v_new_1212 = 0 then 
					--新增应收票据科目
					g_tab_tmp_acc_subj_new(v_i).subj_code         := '1211'           ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name         := '应收票据'       ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应收票据'       ;  
					g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '往来'           ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
					g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
					g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
					v_i := v_i + 1;
					
					--新增应收账款科目
					g_tab_tmp_acc_subj_new(v_i).subj_code         := '1212'           ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name         := '应收账款'       ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应收账款'       ;  
					g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '往来'           ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
					g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
					g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;
					v_i := v_i + 1;
				end if;    
			 end if;
			 --当发现其他应收账款时，补：1214预付账款、1215应收股利、1216、应收利息
			 if g_tab_tmp_acc_subj_old(i).subj_code like '1218%'  and v_new_1218 = 0 then
				--新增预付账款科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1214'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '预付账款'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '预付账款'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '往来'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增应收股利科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1215'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '应收股利'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应收股利'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '往来'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增应收利息科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1216'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '应收利息'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应收利息'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '往来'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				v_new_1218 := 1 ;
			 end if;
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code = 'delete' then
				continue;
			 end if;
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code like '1613' and v_new_1613 = 0 then
				--新增应收利息科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1611'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '工程物资'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '工程物资'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				v_new_1613 := 1 ;
			 end if;  
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code like '1901' and v_new_1901 = 0 then 
				--新增研发支出科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1703'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '研发支出'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '研发支出'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增研发支出-研究支出科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '170301'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '研究支出'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '研究支出'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增研发支出-开发支出科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '170302'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '开发支出'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '开发支出'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增公共基础设施科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1801'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '公共基础设施'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '公共基础设施'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增公共基础设施累计折旧（摊销）科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1802'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '公共基础设施累计折旧（摊销）'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '公共基础设施累计折旧（摊销）'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增政府储备物资科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1811'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '政府储备物资'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '政府储备物资'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增文物文化资产科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1821'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '文物文化资产'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '文物文化资产'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增保障性住房科目
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1831'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '保障性住房'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '保障性住房'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增保障性住房累计折旧
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1832'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '保障性住房累计折旧'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '保障性住房累计折旧'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				
				--新增受托代理资产
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '1891'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '受托代理资产'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '受托代理资产'   ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;
				v_new_1901 := 1;
			 end if;
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code like '2103%' and v_new_2103 = 0 then
				
				--新增应交增值税
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '2101'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '应交增值税'     ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应交增值税'     ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '负债'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;    
				
				--新增应付职工薪酬
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '2201'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '应付职工薪酬'     ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应付职工薪酬'     ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '负债'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;    
							
				v_new_2103 := 1 ;
			 end if;  
			 
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code like '2305%' and v_new_2305 = 0 then
				
				--新增应付政府补贴款
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '2303'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '应付政府补贴款' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应付政府补贴款' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '负债'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;    
				
				--新增应付利息
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '2304'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '应付利息'     ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应付利息'     ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '负债'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;    
							
				v_new_2305 := 1 ;
			 end if;  
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code like '230501%' and v_new_230501 = 0 then
				--新增预收账款
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '2305'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '预收账款'     ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '预收账款'     ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '负债'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				v_new_230501 := 1 ;
			 end if;
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code like '3301%' and v_new_3201 = 0 then
				--新增权益法调整
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '3201'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '权益法调整'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '权益法调整'   ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				v_new_3201 := 1 ;
			 end if;
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code = '3302' then
				--新增无偿调拨净资产
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '3401'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '无偿调拨净资产'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '无偿调拨净资产'   ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
				--新增以前年度盈余调整
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '3501'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '以前年度盈余调整'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '以前年度盈余调整'   ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
			 end if;
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code = '410101' then
				--新增事业收入
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4101'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '事业收入'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '事业收入'   ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;        
				
				--新增结算差额
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '41010103'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '结算差额'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '结算差额'   ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 3              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;  
				
				--新增门诊结算差额
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4101010301'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '门诊结算差额' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '门诊结算差额' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 4              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1; 
				
				 --新增住院结算差额
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4101010302'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '住院结算差额' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '住院结算差额' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 4              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1; 
			 end if; 
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code = '4609' then
				--新增上级补助收入
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4201'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '上级补助收入' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '上级补助收入' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1; 
				
				--新增附属单位上缴收入
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4301'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '附属单位上缴收入' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '附属单位上缴收入' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1; 
				
				--新增经营收入
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4401'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '经营收入' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '经营收入' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1; 
				
				--新增非同级财政拨款收入
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4601'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '非同级财政拨款收入' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '非同级财政拨款收入' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1; 
				
				--新增投资收益
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4602'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '投资收益' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '投资收益' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1; 
				
				--新增捐赠收入
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4603'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '捐赠收入' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '捐赠收入' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
				--新增利息收入
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4604'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '利息收入' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '利息收入' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
				--新增租金收入
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '4605'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '租金收入' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '租金收入' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '收入'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
			 end if;  
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code = '500101' then
				--新增业务活动费用
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '5001'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '业务活动费用' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '业务活动费用' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '费用'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
			 end if;
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code = '510101' then
				--新增单位管理费用
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '5101'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '单位管理费用' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '单位管理费用' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '费用'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
			 end if;   
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code = '5901' then
				--新增经营费用
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '5201'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '经营费用' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '经营费用' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '费用'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
				--新增资产处置费用
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '5301'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '资产处置费用' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '资产处置费用' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '费用'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
				--新增上缴上级费用
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '5401'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '上缴上级费用' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '上缴上级费用' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '费用'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
				--新增对附属单位补助费用
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '5501'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '对附属单位补助费用' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '对附属单位补助费用' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '费用'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
				 --新增所得税费用
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '5801'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '所得税费用' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '所得税费用' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '费用'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '借'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				
			 end if;
			 
			 g_tab_tmp_acc_subj_new(v_i).subj_code         := g_tab_tmp_acc_subj_old(i).subj_code       ; 
			 g_tab_tmp_acc_subj_new(v_i).subj_name         := g_tab_tmp_acc_subj_old(i).subj_name       ; 
			 g_tab_tmp_acc_subj_new(v_i).subj_name_all     := g_tab_tmp_acc_subj_old(i).subj_name_all   ; 
			 g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := g_tab_tmp_acc_subj_old(i).SUBJ_TYPE_CODE  ; 
			 g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := g_tab_tmp_acc_subj_old(i).SUBJ_NATURE_CODE; 
			 g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := g_tab_tmp_acc_subj_old(i).SUBJ_DIRE       ; 
			 g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := g_tab_tmp_acc_subj_old(i).SUBJ_LEVEL      ; 
			 g_tab_tmp_acc_subj_new(v_i).IS_CASH           := g_tab_tmp_acc_subj_old(i).IS_CASH         ; 
			 g_tab_tmp_acc_subj_new(v_i).IS_LAST           := g_tab_tmp_acc_subj_old(i).IS_LAST         ; 
			 g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := g_tab_tmp_acc_subj_old(i).IS_CHECK        ; 
			 g_tab_tmp_acc_subj_new(v_i).CHECK1            := g_tab_tmp_acc_subj_old(i).CHECK1          ; 
			 g_tab_tmp_acc_subj_new(v_i).CHECK2            := g_tab_tmp_acc_subj_old(i).CHECK2          ;
			 g_tab_tmp_acc_subj_new(v_i).CHECK3            := g_tab_tmp_acc_subj_old(i).CHECK3          ;
			 g_tab_tmp_acc_subj_new(v_i).CHECK4            := g_tab_tmp_acc_subj_old(i).CHECK4          ;
			 g_tab_tmp_acc_subj_new(v_i).NOTE              := g_tab_tmp_acc_subj_old(i).NOTE            ;
			 v_i := v_i + 1;
			 
			 --当原科目坏账准备仅一个科目时，增加121901应收账款坏账准备、121902其他应收款坏账准备子科目
			 if g_tab_tmp_acc_subj_old(i).subj_code like '1219%'  then
				select count(1) 
				  into v_old_1221_count
				  from tmp_acc_subj_old t
				 where t.subj_code like '1221%' 
				 ;
				 if v_old_1221_count = 1 then
					--新增坏账准备-应收账款坏账准备
					g_tab_tmp_acc_subj_new(v_i).subj_code         := '121901'         ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name         := '应收账款坏账准备'       ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '应收账款坏账准备'       ;  
					g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2                ; 
					g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
					g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
					v_i := v_i + 1;
					
					--新增坏账准备-其他应收款坏账准备
					g_tab_tmp_acc_subj_new(v_i).subj_code         := '121902'         ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name         := '其他应收款坏账准备'       ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '其他应收款坏账准备'       ;  
					g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'           ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2                ; 
					g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
					g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
					g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
					g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
					v_i := v_i + 1;
					
				 end if;
			 end if;  
			 
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code like '2502%' and v_new_2502 = 0 then
				
				--新增预计负债
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '2601'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '预计负债'     ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '预计负债'     ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '负债'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
					
				--新增受托代理负债
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '2901'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '受托代理负债' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '受托代理负债' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '资产'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 1              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				v_new_2502 := 1 ;  
			 end if;  
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code = '3001' and v_new_3001 = 0 then
				
				/*--新增累计盈余-财政项目盈余
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '300101'           ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '财政项目盈余' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '财政项目盈余' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;    */
				
				--新增累计盈余-医疗盈余
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '300102'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '医疗盈余'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '医疗盈余'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;    
				
				/*--新增累计盈余-科教盈余
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '300103'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '科教盈余'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '科教盈余'       ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1;    
				*/
				--新增累计盈余-新旧转换盈余
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '300104'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '新旧转换盈余'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '新旧转换盈余'   ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'             ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2                ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'             ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''               ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''               ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'           ;            
				v_i := v_i + 1; 
							
				v_new_3001 := 1 ;
			 end if;
			 
			 if g_tab_tmp_acc_subj_old(i).subj_code like '230501%' and v_new_230502 = 0 then
				--新增其他预收账款
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '230502'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '其他预收账款' ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '其他预收账款' ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '负债'         ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
				v_new_230502 := 1 ;
			 end if;
			 
			  if g_tab_tmp_acc_subj_old(i).subj_code like '3301%' and v_new_3301 = 0 then
			   /* --新增本期盈余
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '330101'         ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '财政补助盈余'   ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '财政补助盈余'   ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;*/
				
				for rec in (select '330101' || substr(t.subj_code,7) as subj_code
								  ,t.subj_name
								  ,t.subj_name_all
								  ,t.subj_type_code
								  ,t.subj_nature_code
								  ,t.subj_dire
								  ,t.subj_level
								  ,t.is_cash
								  ,t.is_last
								  ,t.is_check
								  ,t.check1 
								  ,t.check2
								  ,t.check3
								  ,t.check4
								  ,t.note
							  from tmp_acc_subj_new t
							 where t.subj_code like '300101%' 
							   and length(t.subj_code) >= 6
						   ) loop     
					--追加本期盈余中财政项目盈余
					g_tab_tmp_acc_subj_new(v_i).subj_code         := rec.subj_code         ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name         := rec.subj_name         ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name_all     := rec.subj_name_all     ;  
					g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := rec.subj_type_code    ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := rec.subj_nature_code  ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := rec.subj_dire         ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := rec.subj_level-1      ; 
					g_tab_tmp_acc_subj_new(v_i).IS_CASH           := rec.is_cash           ;
					g_tab_tmp_acc_subj_new(v_i).IS_LAST           := rec.is_last           ;
					g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := rec.is_check          ;
					g_tab_tmp_acc_subj_new(v_i).CHECK1            := rec.check1            ; 
					g_tab_tmp_acc_subj_new(v_i).CHECK2            := rec.check2            ;
					g_tab_tmp_acc_subj_new(v_i).CHECK3            := rec.check3            ;
					g_tab_tmp_acc_subj_new(v_i).CHECK4            := rec.check4            ;
					g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'                ;            
					v_i := v_i + 1;
			  end loop;      
				
				--新增本期盈余-医疗盈余
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '330102'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '医疗盈余'     ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '医疗盈余'     ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '是'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;
			   
			   /* --新增本期盈余-科教盈余
				g_tab_tmp_acc_subj_new(v_i).subj_code         := '330103'       ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name         := '科教盈余'     ; 
				g_tab_tmp_acc_subj_new(v_i).subj_name_all     := '科教盈余'     ;  
				g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := '净资产'       ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := '一般科目'     ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := '贷'           ;
				g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := 2              ; 
				g_tab_tmp_acc_subj_new(v_i).IS_CASH           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_LAST           := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := '否'           ;
				g_tab_tmp_acc_subj_new(v_i).CHECK1            := ''             ; 
				g_tab_tmp_acc_subj_new(v_i).CHECK2            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK3            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).CHECK4            := ''             ;
				g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'         ;            
				v_i := v_i + 1;*/
				
				for rec_sub in (select '330103' || substr(t.subj_code,7) as subj_code
									  ,t.subj_name
									  ,t.subj_name_all
									  ,t.subj_type_code
									  ,t.subj_nature_code
									  ,t.subj_dire
									  ,t.subj_level
									  ,t.is_cash
									  ,t.is_last
									  ,t.is_check
									  ,t.check1 
									  ,t.check2
									  ,t.check3
									  ,t.check4
									  ,t.note
								  from tmp_acc_subj_new t
								 where t.subj_code like '300103%' 
								   and length(t.subj_code) >= 6
						   ) loop     
					--新增本期盈余中科教盈余
					g_tab_tmp_acc_subj_new(v_i).subj_code         := rec_sub.subj_code         ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name         := rec_sub.subj_name         ; 
					g_tab_tmp_acc_subj_new(v_i).subj_name_all     := rec_sub.subj_name_all     ;  
					g_tab_tmp_acc_subj_new(v_i).SUBJ_TYPE_CODE    := rec_sub.subj_type_code    ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_NATURE_CODE  := rec_sub.subj_nature_code  ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_DIRE         := rec_sub.subj_dire         ;
					g_tab_tmp_acc_subj_new(v_i).SUBJ_LEVEL        := rec_sub.subj_level-1      ; 
					g_tab_tmp_acc_subj_new(v_i).IS_CASH           := rec_sub.is_cash           ;
					g_tab_tmp_acc_subj_new(v_i).IS_LAST           := rec_sub.is_last           ;
					g_tab_tmp_acc_subj_new(v_i).IS_CHECK          := rec_sub.is_check          ;
					g_tab_tmp_acc_subj_new(v_i).CHECK1            := rec_sub.check1            ; 
					g_tab_tmp_acc_subj_new(v_i).CHECK2            := rec_sub.check2            ;
					g_tab_tmp_acc_subj_new(v_i).CHECK3            := rec_sub.check3            ;
					g_tab_tmp_acc_subj_new(v_i).CHECK4            := rec_sub.check4            ;
					g_tab_tmp_acc_subj_new(v_i).NOTE              := '新增'                ;            
					v_i := v_i + 1;
			  end loop;   
				v_new_3301 := 1 ;
			 end if;
			 
		  end loop;

		EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '新科目入栈失败！'||SQLERRM;
		END prc_Write_Subj;
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：更新新制度的会计科目表
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Tab_Subj(  prm_AppCode    Out Number
									   ,prm_ErrTxt     Out Varchar2
									 )
		Is
				
		BEGIN
		  prm_AppCode := def_OK       ;
		  
		  for i in 1..g_tab_tmp_acc_subj_new.count() loop
			  insert 
				into tmp_acc_subj_new(
					 subj_code
					,subj_name
					,subj_name_all
					,SUBJ_TYPE_CODE
					,SUBJ_NATURE_CODE
					,SUBJ_DIRE
					,SUBJ_LEVEL
					,IS_CASH
					,IS_LAST
					,IS_CHECK
					,CHECK1
					,CHECK2
					,CHECK3
					,CHECK4
					,NOTE
				)
			   values(g_tab_tmp_acc_subj_new(i).subj_code        
					 ,g_tab_tmp_acc_subj_new(i).subj_name        
					 ,g_tab_tmp_acc_subj_new(i).subj_name_all    
					 ,g_tab_tmp_acc_subj_new(i).SUBJ_TYPE_CODE   
					 ,g_tab_tmp_acc_subj_new(i).SUBJ_NATURE_CODE 
					 ,g_tab_tmp_acc_subj_new(i).SUBJ_DIRE        
					 ,g_tab_tmp_acc_subj_new(i).SUBJ_LEVEL       
					 ,g_tab_tmp_acc_subj_new(i).IS_CASH          
					 ,g_tab_tmp_acc_subj_new(i).IS_LAST          
					 ,g_tab_tmp_acc_subj_new(i).IS_CHECK         
					 ,g_tab_tmp_acc_subj_new(i).CHECK1           
					 ,g_tab_tmp_acc_subj_new(i).CHECK2           
					 ,g_tab_tmp_acc_subj_new(i).CHECK3           
					 ,g_tab_tmp_acc_subj_new(i).CHECK4           
					 ,g_tab_tmp_acc_subj_new(i).NOTE                    
			   );            
		  end loop;   
		  
		  
		  for j in 1..g_tab_tmp_acc_subj_map.count() loop
			if g_tab_tmp_acc_subj_map(j).subj_code_new <> 'delete' then 
				insert 
				  into tmp_acc_subj_map(
					   subj_code_old
					  ,subj_name_old
					  ,subj_name_all_old
					  ,subj_code_new
					  ,subj_name_new
					  ,subj_name_all_new
					  ,IS_LAST               
				  )
				 values(g_tab_tmp_acc_subj_map(j).subj_code_old        
					   ,g_tab_tmp_acc_subj_map(j).subj_name_old        
					   ,g_tab_tmp_acc_subj_map(j).subj_name_all_old    
					   ,g_tab_tmp_acc_subj_map(j).subj_code_new   
					   ,g_tab_tmp_acc_subj_map(j).subj_name_new
					   ,g_tab_tmp_acc_subj_map(j).subj_name_all_new 
					   ,g_tab_tmp_acc_subj_map(j).IS_LAST          
				 );  
			 end if;              
		  end loop;   
		  
		  EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '科目表中存在非原制度要求科目导致插入科目表时失败！'||SQLERRM;
		END prc_Insert_Tab_Subj;  
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：prc_Insert_Tab_Budg
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Tab_Budg(  prm_AppCode    Out Number
									   ,prm_ErrTxt     Out Varchar2
									 )
		Is
				
		BEGIN
		  prm_AppCode := def_OK       ;
		  
		  --增加应付职工薪酬-应付福利费
		  insert 
			into tmp_acc_subj_new(
				 SUBJ_CODE        ,
				 SUBJ_NAME        ,
				 SUBJ_NAME_ALL    ,
				 SUBJ_TYPE_CODE   ,
				 SUBJ_NATURE_CODE ,
				 SUBJ_DIRE        ,
				 SUBJ_LEVEL       ,
				 IS_CASH          ,
				 IS_LAST          ,
				 IS_CHECK         ,
				 CHECK1           ,
				 CHECK2           ,
				 CHECK3           ,
				 CHECK4           ,
				 NOTE             
				 )
		   select '220103'||substr(SUBJ_CODE,7) ,
				   replace(SUBJ_NAME,'薪酬','福利费') as SUBJ_NAME,
				   replace(SUBJ_NAME_ALL,'薪酬','福利费') as SUBJ_NAME_ALL,      
				   SUBJ_TYPE_CODE   ,
				   SUBJ_NATURE_CODE ,
					SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			  from tmp_acc_subj_new t
			 where t.subj_code like '220101%'
			 order by t.subj_code   
			;            
		  
		  --增加财政补助支出(基本支出）
		  insert 
			into tmp_acc_subj_new(
				 SUBJ_CODE        ,
				 SUBJ_NAME        ,
				 SUBJ_NAME_ALL    ,
				 SUBJ_TYPE_CODE   ,
				 SUBJ_NATURE_CODE ,
				 SUBJ_DIRE        ,
				 SUBJ_LEVEL       ,
				 IS_CASH          ,
				 IS_LAST          ,
				 IS_CHECK         ,
				 CHECK1           ,
				 CHECK2           ,
				 CHECK3           ,
				 CHECK4           ,
				 NOTE             
				 )
		   select  '500102' ,
				   '财政补助支出',
				   '财政补助支出',      
				   '费用' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借'   as subj_dire        ,
				   '1'    as SUBJ_LEVEL       ,
				   ''   as IS_CASH          ,
				   '否'   as IS_LAST          ,
				   '否'   as IS_CHECK         ,
				   ''     as CHECK1           ,
				   ''     as CHECK2           ,
				   ''     as CHECK3           ,
				   ''     as CHECK4           ,
				   ''     as NOTE             
			 from dual t         
		  union all        
			select '50010201'||substr(SUBJ_CODE,7) ,
				   case when SUBJ_NAME = '基本支出' then '财政基本补助支出' else SUBJ_NAME end as SUBJ_NAME,
				   case when SUBJ_NAME_ALL = '基本支出' then '财政基本补助支出' else SUBJ_NAME_ALL end as SUBJ_NAME_ALL,      
				   '费用' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借'   as SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '400101%' 
			;
		 
		  --向5101单位管理费用加入财政补助支出、科教项目支出
		  insert 
			into tmp_acc_subj_new(
				 SUBJ_CODE        ,
				 SUBJ_NAME        ,
				 SUBJ_NAME_ALL    ,
				 SUBJ_TYPE_CODE   ,
				 SUBJ_NATURE_CODE ,
				 SUBJ_DIRE        ,
				 SUBJ_LEVEL       ,
				 IS_CASH          ,
				 IS_LAST          ,
				 IS_CHECK         ,
				 CHECK1           ,
				 CHECK2           ,
				 CHECK3           ,
				 CHECK4           ,
				 NOTE             
				 )
		   select '5101'||substr(SUBJ_CODE,5) ,
				   SUBJ_NAME,
				   SUBJ_NAME_ALL,      
				   SUBJ_TYPE_CODE   ,
				   SUBJ_NATURE_CODE ,
					SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			  from tmp_acc_subj_new t
			 where t.subj_code like '500102%'
				or t.subj_code like '500103%'
			 order by t.subj_code   
			;      
		  --批量插入 预算收入
		  insert 
			into tmp_acc_subj_new(
				 SUBJ_CODE        ,
				 SUBJ_NAME        ,
				 SUBJ_NAME_ALL    ,
				 SUBJ_TYPE_CODE   ,
				 SUBJ_NATURE_CODE ,
				 SUBJ_DIRE        ,
				 SUBJ_LEVEL       ,
				 IS_CASH          ,
				 IS_LAST          ,
				 IS_CHECK         ,
				 CHECK1           ,
				 CHECK2           ,
				 CHECK3           ,
				 CHECK4           ,
				 NOTE             
				 )
			select '6001'||substr(SUBJ_CODE,5) ,
				   substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2),
				   substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2),      
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '4001%' 
		 union all             
		   select '6101'||substr(SUBJ_CODE,5) ,
				   case when substr(SUBJ_NAME,-2) = '收入' 
						then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
						else SUBJ_NAME ||'预算收入'
				   end as SUBJ_NAME,
				   case when substr(SUBJ_NAME_ALL,-2) = '收入' 
						then substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2)
						else SUBJ_NAME_ALL ||'预算收入'
				   end as SUBJ_NAME_ALL,
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '4101%' 
			  and SUBJ_LEVEL <= 3
			  and t.subj_code not like '41010103%' 
		  union all
		   select '6201'||substr(SUBJ_CODE,5) ,
				   case when substr(SUBJ_NAME,-2) = '收入' 
						then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
						else SUBJ_NAME||'预算收入'
				   end as SUBJ_NAME,
				   substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2),      
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '4201%' 
		  union all
			select '6301'||substr(SUBJ_CODE,5) ,
				   case when substr(SUBJ_NAME,-2) = '收入' 
						then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
						else SUBJ_NAME||'预算收入'
				   end as SUBJ_NAME,
				   substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2),      
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '4301%' 
		  union all
		   select '6401'||substr(SUBJ_CODE,5) ,
				   case when substr(SUBJ_NAME,-2) = '收入' 
						then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
						else SUBJ_NAME||'预算收入'
				   end as SUBJ_NAME,
				   substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2),      
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '4401%' 
		  union all
		   select  '6501' ,
				   '债务预算收入' as SUBJ_NAME,
				   '债务预算收入' as SUBJ_NAME_ALL,      
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '贷' as SUBJ_DIRE        ,
				   '1' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			 from dual t 
		  union all
		   select '6601'||substr(SUBJ_CODE,5) ,
				   case when substr(SUBJ_NAME,-2) = '收入' 
						then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
						else SUBJ_NAME||'预算收入'
				   end as SUBJ_NAME,
				   substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2),      
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '4601%'    
		  union all
		   select '6602'||substr(SUBJ_CODE,5) ,
				   substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2),
				   substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2),       
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '4602%'  
		  union all
		   select '6609'||substr(SUBJ_CODE,5) ,
				   case when substr(SUBJ_NAME,-2) = '收入' 
						then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
						else SUBJ_NAME||'预算收入'
				   end as SUBJ_NAME,
				   case when substr(SUBJ_NAME_ALL,-2) = '收入' 
						then substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2)
						else SUBJ_NAME_ALL||'预算收入'
				   end as SUBJ_NAME_ALL,
				   '预算收入' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_old t 
			where t.subj_code like '4301%' 
			  and t.subj_level = 1          
			;
			
		  
		  --批量插入 预算支出
		  insert 
			into tmp_acc_subj_new(
				 SUBJ_CODE        ,
				 SUBJ_NAME        ,
				 SUBJ_NAME_ALL    ,
				 SUBJ_TYPE_CODE   ,
				 SUBJ_NATURE_CODE ,
				 SUBJ_DIRE        ,
				 SUBJ_LEVEL       ,
				 IS_CASH          ,
				 IS_LAST          ,
				 IS_CHECK         ,
				 CHECK1           ,
				 CHECK2           ,
				 CHECK3           ,
				 CHECK4           ,
				 NOTE             
				 )
			select  '7101' ,
				   '行政支出' as SUBJ_NAME,
				   '行政支出' as SUBJ_NAME_ALL,      
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '1' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			 from dual t 
		   union all       
			select  '7201' ,
				   '事业支出' as SUBJ_NAME,
				   '事业支出' as SUBJ_NAME_ALL,      
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '1' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '否' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			 from dual t 
		   union all    
			 select '720101'||substr(SUBJ_CODE,5) ,
				 case when substr(SUBJ_NAME,-2) in( '支出' ,'成本','费用'）
							  then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
					  when substr(SUBJ_NAME,-1) in( '费'）
							  then substr(SUBJ_NAME,1,length(SUBJ_NAME)-1)||'预算'||substr(SUBJ_NAME,-1)          
							  else SUBJ_NAME||'预算支出'
						 end as SUBJ_NAME,
						 case when substr(SUBJ_NAME_ALL,-2) in( '支出' ,'成本','费用'） 
							  then substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2)
							  when substr(SUBJ_NAME,-1) in( '费'）
							  then substr(SUBJ_NAME,1,length(SUBJ_NAME)-1)||'预算'||substr(SUBJ_NAME,-1)   
							  else SUBJ_NAME_ALL||'预算支出'
						 end as SUBJ_NAME_ALL,     
				 '预算支出' as SUBJ_TYPE_CODE   ,
				 '一般科目' as SUBJ_NATURE_CODE ,
				 SUBJ_DIRE        ,
				 to_char(to_number(SUBJ_LEVEL)+1)       ,
				 IS_CASH          ,
				 IS_LAST          ,
				 IS_CHECK         ,
				 CHECK1           ,
				 CHECK2           ,
				 CHECK3           ,
				 CHECK4           ,
				 NOTE             
		   from tmp_acc_subj_new t 
		  where (    t.subj_code like '5001%'
				 and SUBJ_LEVEL < 4 
				 and t.subj_code not like '500101%' 
				 )
			 or (    t.subj_code like '500101%' 
				 and SUBJ_LEVEL < 3
				 )
		 union all
		  select '720102'||substr(SUBJ_CODE,5) ,
				   case when substr(SUBJ_NAME,-2) in( '支出' ,'成本','费用'）
								then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
						when substr(SUBJ_NAME,-1) in( '费'）
								then substr(SUBJ_NAME,1,length(SUBJ_NAME)-1)||'预算'||substr(SUBJ_NAME,-1)          
								else SUBJ_NAME||'预算支出'
						   end as SUBJ_NAME,
				   case when substr(SUBJ_NAME_ALL,-2) in( '支出' ,'成本','费用'） 
						then substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2)
						when substr(SUBJ_NAME,-1) in( '费'）
						then substr(SUBJ_NAME,1,length(SUBJ_NAME)-1)||'预算'||substr(SUBJ_NAME,-1)   
						else SUBJ_NAME_ALL||'预算支出'
				   end as SUBJ_NAME_ALL,     
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   to_char(to_number(SUBJ_LEVEL)+1)       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where (    t.subj_code like '5101%'
				   and SUBJ_LEVEL < 4 
				   and t.subj_code not like '510101%' 
				   )
			   or (    t.subj_code like '510101%' 
				   and SUBJ_LEVEL < 3
				  )          
		  union all
			select '7301'||substr(SUBJ_CODE,5) ,
				   replace(SUBJ_NAME,'费用','支出'）,
				   replace(SUBJ_NAME_ALL,'费用','支出'）,     
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '5201%'  
		  union all  
		   select '7401'||substr(SUBJ_CODE,5) ,
				   replace(SUBJ_NAME,'费用','支出'）,
				   replace(SUBJ_NAME_ALL,'费用','支出'）,     
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '5401%'  
		  union all  
		   select '7501'||substr(SUBJ_CODE,5) ,
				   replace(SUBJ_NAME,'费用','支出'）,
				   replace(SUBJ_NAME_ALL,'费用','支出'）,     
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '5501%'  
		   union all       
			select  '7601' ,
				   '投资支出' as SUBJ_NAME,
				   '投资支出' as SUBJ_NAME_ALL,      
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '1' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			 from dual t
		   union all       
			select  '7701' ,
				   '债务还本支出' as SUBJ_NAME,
				   '债务还本支出' as SUBJ_NAME_ALL,      
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '1' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			 from dual t   
		  union all   
		   select '7901'||substr(SUBJ_CODE,5) ,
				   case when substr(SUBJ_NAME,-2) in( '支出' ,'成本','费用'）
								then substr(SUBJ_NAME,1,length(SUBJ_NAME)-2)||'预算'||substr(SUBJ_NAME,-2)
						when substr(SUBJ_NAME,-1) in( '费'）
								then substr(SUBJ_NAME,1,length(SUBJ_NAME)-1)||'预算'||substr(SUBJ_NAME,-1)          
								else SUBJ_NAME||'预算支出'
						   end as SUBJ_NAME,
				   case when substr(SUBJ_NAME_ALL,-2) in( '支出' ,'成本','费用'） 
						then substr(SUBJ_NAME_ALL,1,length(SUBJ_NAME_ALL)-2)||'预算'||substr(SUBJ_NAME_ALL,-2)
						when substr(SUBJ_NAME,-1) in( '费'）
						then substr(SUBJ_NAME,1,length(SUBJ_NAME)-1)||'预算'||substr(SUBJ_NAME,-1)   
						else SUBJ_NAME_ALL||'预算支出'
				   end as SUBJ_NAME_ALL,     
				   '预算支出' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   SUBJ_DIRE        ,
				   SUBJ_LEVEL       ,
				   IS_CASH          ,
				   IS_LAST          ,
				   IS_CHECK         ,
				   CHECK1           ,
				   CHECK2           ,
				   CHECK3           ,
				   CHECK4           ,
				   NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '5901%'
			  and t.subj_level = 1  
			;
			
			--批量插入 预算结余类
		  insert 
			into tmp_acc_subj_new(
				 SUBJ_CODE        ,
				 SUBJ_NAME        ,
				 SUBJ_NAME_ALL    ,
				 SUBJ_TYPE_CODE   ,
				 SUBJ_NATURE_CODE ,
				 SUBJ_DIRE        ,
				 SUBJ_LEVEL       ,
				 IS_CASH          ,
				 IS_LAST          ,
				 IS_CHECK         ,
				 CHECK1           ,
				 CHECK2           ,
				 CHECK3           ,
				 CHECK4           ,
				 NOTE             
				 )
			select  '8001'  as subj_code,
				   '资金结存' as SUBJ_NAME,
				   '资金结存' as SUBJ_NAME_ALL,      
				   '预算结余' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE      ,
				   '1' as SUBJ_LEVEL      ,
				   '否' as IS_CASH        ,
				   '否' as IS_LAST        ,
				   '否' as IS_CHECK       ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			 from dual t   
		  union all
			select  '800101'  as subj_code,
				   '零余额账户用款额度' as SUBJ_NAME,
				   '零余额账户用款额度' as SUBJ_NAME_ALL,      
				   '预算结余' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '2' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			 from dual t  
		   union all
			select  '800102'  as subj_code,
				   '货币资金' as SUBJ_NAME,
				   '货币资金' as SUBJ_NAME_ALL,      
				   '预算结余' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '2' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			 from dual t 
		   union all
			select  '800103'  as subj_code,
				   '财政应返还额度' as SUBJ_NAME,
				   '财政应返还额度' as SUBJ_NAME_ALL,      
				   '预算结余' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '2' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '否' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			   from dual t
		   union all
			 select '80010301'  as subj_code,
				   '财政直接支付' as SUBJ_NAME,
				   '财政直接支付' as SUBJ_NAME_ALL,      
				   '预算结余' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '3' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			  from dual t 
		   union all
			 select '80010302'  as subj_code,
				   '财政授权支付' as SUBJ_NAME,
				   '财政授权支付' as SUBJ_NAME_ALL,      
				   '预算结余' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '借' as SUBJ_DIRE        ,
				   '3' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			  from dual t 
		   union all
			 select '8101'||substr(SUBJ_CODE,7) ,
					 replace(replace(SUBJ_NAME,'补助','拨款'）,'盈余','结转'),
					 replace(replace(SUBJ_NAME_ALL,'补助','拨款'）,'盈余','结转'),       
					 '预算结余' as SUBJ_TYPE_CODE   ,
					 '一般科目' as SUBJ_NATURE_CODE ,
					 SUBJ_DIRE        ,
					 case when length('8101'||substr(SUBJ_CODE,11)) = 4  then '1' 
						  when length('8101'||substr(SUBJ_CODE,11)) = 6  then '2'
						 else '3'
					   end as SUBJ_LEVEL ,
					 IS_CASH          ,
					 IS_LAST          ,
					 IS_CHECK         ,
					 CHECK1           ,
					 CHECK2           ,
					 CHECK3           ,
					 CHECK4           ,
					 NOTE             
			   from tmp_acc_subj_new t 
			  where t.subj_code like '300101%'  
		   union all
			 select '8102'||substr(SUBJ_CODE,7) ,
					 replace(replace(SUBJ_NAME,'补助','拨款'）,'盈余','结余'),
					 replace(replace(SUBJ_NAME_ALL,'补助','拨款'）,'盈余','结余'),    
					 '预算结余' as SUBJ_TYPE_CODE   ,
					 '一般科目' as SUBJ_NATURE_CODE ,
					 SUBJ_DIRE        ,
					 case when length('8102'||substr(SUBJ_CODE,11)) = 4  then '1' 
						  when length('8102'||substr(SUBJ_CODE,11)) = 6  then '2'
						 else '3'
					   end as SUBJ_LEVEL ,
					 IS_CASH          ,
					 IS_LAST          ,
					 IS_CHECK         ,
					 CHECK1           ,
					 CHECK2           ,
					 CHECK3           ,
					 CHECK4           ,
					 NOTE             
			   from tmp_acc_subj_new t 
			  where t.subj_code like '300101%' 
		   union all
			 select case when substr(SUBJ_CODE,5,2) = '02' then  '8201'||'01'||substr(SUBJ_CODE,7) 
						  when substr(SUBJ_CODE,5,2) = '03' then  '8201'||'02'||substr(SUBJ_CODE,7) 
						  else '8201'||substr(SUBJ_CODE,5)     
					 end as SUBJ_CODE,    
					 case when length('8201'||substr(SUBJ_CODE,5)) = 4 then '非财政拨款结转'
						 else replace(replace( SUBJ_NAME,'盈余','结转'),'结转（余）','结转')
					 end as SUBJ_NAME,  
					 case when length('8201'||substr(SUBJ_CODE,5)) = 4 then '非财政拨款结转'
						 else replace(replace( SUBJ_NAME_all,'盈余','结转'),'结转（余）','结转')
					 end as SUBJ_NAME_all,      
					 '预算结余' as SUBJ_TYPE_CODE   ,
					 '一般科目' as SUBJ_NATURE_CODE ,
					 SUBJ_DIRE        ,
					 SUBJ_LEVEL       ,
					 IS_CASH          ,
					 IS_LAST          ,
					 IS_CHECK         ,
					 CHECK1           ,
					 CHECK2           ,
					 CHECK3           ,
					 CHECK4           ,
					 NOTE             
			   from tmp_acc_subj_new t 
			  where t.subj_code like '3301%' 
			   and  t.subj_code not like '330101%'
		   union all
			 select case when substr(SUBJ_CODE,5,2) = '02' then  '8202'||'01'||substr(SUBJ_CODE,7) 
						  when substr(SUBJ_CODE,5,2) = '03' then  '8202'||'02'||substr(SUBJ_CODE,7) 
						  else '8202'||substr(SUBJ_CODE,5)     
					 end as SUBJ_CODE,    
					 case when length('8202'||substr(SUBJ_CODE,5)) = 4 then '非财政拨款结余'
						 else replace(replace( SUBJ_NAME,'盈余','结余'),'结转（余）','结余')
					 end as SUBJ_NAME,  
					 case when length('8202'||substr(SUBJ_CODE,5)) = 4 then '非财政拨款结余'
						 else replace(replace( SUBJ_NAME_all,'盈余','结余'),'结转（余）','结余')
					 end as SUBJ_NAME_all,      
					 '预算结余' as SUBJ_TYPE_CODE   ,
					 '一般科目' as SUBJ_NATURE_CODE ,
					 SUBJ_DIRE        ,
					 SUBJ_LEVEL       ,
					 IS_CASH          ,
					 IS_LAST          ,
					 IS_CHECK         ,
					 CHECK1           ,
					 CHECK2           ,
					 CHECK3           ,
					 CHECK4           ,
					 NOTE             
			   from tmp_acc_subj_new t 
			  where t.subj_code like '3301%' 
			   and  t.subj_code not like '330101%'    
		   union all
			  select '8301'||substr(SUBJ_CODE,5) as SUBJ_CODE,    
					 replace( SUBJ_NAME,'基金','结余') as SUBJ_NAME,  
					 replace( SUBJ_NAME_ALL,'基金','结余') as SUBJ_NAME_all,      
					 '预算结余' as SUBJ_TYPE_CODE   ,
					 '一般科目' as SUBJ_NATURE_CODE ,
					 SUBJ_DIRE        ,
					 SUBJ_LEVEL       ,
					 IS_CASH          ,
					 IS_LAST          ,
					 IS_CHECK         ,
					 CHECK1           ,
					 CHECK2           ,
					 CHECK3           ,
					 CHECK4           ,
					 NOTE             
			   from tmp_acc_subj_new t 
			  where t.subj_code like '3101%' 
				and t.subj_code not like '310102' 
		   union all
			 select '8401'  as subj_code,
				   '经营结余' as SUBJ_NAME,
				   '经营结余' as SUBJ_NAME_ALL,      
				   '预算结余' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '贷' as SUBJ_DIRE        ,
				   '1' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			  from dual t   
		   union all
			 select '8501'  as subj_code,
				   '其他结余' as SUBJ_NAME,
				   '其他结余' as SUBJ_NAME_ALL,      
				   '预算结余' as SUBJ_TYPE_CODE   ,
				   '一般科目' as SUBJ_NATURE_CODE ,
				   '贷' as SUBJ_DIRE        ,
				   '1' as SUBJ_LEVEL       ,
				   '否' as IS_CASH          ,
				   '是' as IS_LAST          ,
				   '否' as IS_CHECK         ,
				   '' as CHECK1           ,
				   '' as CHECK2           ,
				   '' as CHECK3           ,
				   '' as CHECK4           ,
				   '新增' as NOTE             
			  from dual t   
		   union all   
			 select case when substr(SUBJ_CODE,5,2) = '02' then  '8701'||substr(SUBJ_CODE,5) 
						 when substr(SUBJ_CODE,5,2) = '03' then  '8701'||substr(SUBJ_CODE,5) 
						 else '8701'||substr(SUBJ_CODE,5)     
					end as SUBJ_CODE,    
					case when length('8701'||substr(SUBJ_CODE,5)) = 4 then '非财政拨款结余分配'
						else replace( SUBJ_NAME,'累计盈余','非财政拨款结余')
					end as SUBJ_NAME,  
					case when length('8701'||substr(SUBJ_CODE,5)) = 4 then '非财政拨款结余分配'
						else replace( SUBJ_NAME_all,'累计盈余','非财政拨款结余')
					end as SUBJ_NAME_all,      
					'预算结余' as SUBJ_TYPE_CODE   ,
					'一般科目' as SUBJ_NATURE_CODE ,
					SUBJ_DIRE        ,
					SUBJ_LEVEL       ,
					IS_CASH          ,
					IS_LAST          ,
					IS_CHECK         ,
					CHECK1           ,
					CHECK2           ,
					CHECK3           ,
					CHECK4           ,
					NOTE             
			 from tmp_acc_subj_new t 
			where t.subj_code like '3302%'          
			  ;    
		   
		   
			--将所有的空格全部替换
			update tmp_acc_subj_new
			  set  subj_name = trim(replace(subj_name,'　',''))
			  ;
				
			--更新科目级次
			update tmp_acc_subj_new t
			  set  t.subj_level = length(t.subj_code)/2 -1  
			  ;

			--更新是否末级为否
			update tmp_acc_subj_new t
			   set t.is_last = '否'   
			  ; 
				
			--更新会计科目
			declare
			  n_count        integer;  
			begin
			  n_count := 0 ;
			  for rec in ( select t.subj_code                     
							 from tmp_acc_subj_new t         
							 order by t.subj_code
						  ) loop 
							
					select count(1) 
					  into n_count
					  from tmp_acc_subj_new t
					 where t.subj_code like rec.subj_code||'%' 
					  ;  
					if n_count <= 1 then       
						update tmp_acc_subj_new t    
						   set t.is_last = '是'
						 where t.subj_code = rec.subj_code                
						   ;
					 end if;      
			  end loop;   
			end; 
			
			--插入预算会计科目对应关系
			insert 
			  into tmp_acc_subj_map(
				   SUBJ_CODE_OLD
				  ,SUBJ_NAME_OLD
				  ,Subj_Name_All_Old
				  ,SUBJ_CODE_NEW
				  ,SUBJ_NAME_NEW
				  ,SUBJ_NAME_ALL_NEW
				  ,IS_LAST
				  )
			  select t.subj_code_old,
					 t.subj_name_old,
					 t.subj_name_all_old,
					 case when t.subj_code_old like '1003%' then '800101'
						  when t.subj_code_old like '1201%' then '800103'||substr(t.subj_code_old,5) 
						  else  '800102' end as subj_code_new,
					 t.subj_name_new,
					 t.subj_name_all_new,
					 t.is_last
				from tmp_acc_subj_map t
			   where t.subj_code_old like '10%' or t.subj_code_old like '1201%'              
			 union all
			  select SUBJ_CODE_old
					,SUBJ_NAME_old
					,subj_name_all_old
					,'8102'||substr(SUBJ_CODE_new,-2)  as SUBJ_CODE_new
					,replace(SUBJ_NAME_new,'补助','拨款'） as SUBJ_NAME_new
					,replace(SUBJ_NAME_ALL_new,'补助','拨款'） as SUBJ_NAME_ALL_new
					,IS_LAST          
				from tmp_acc_subj_map t
			   where t.subj_code_new like '300101%'   
			 /*union all     
			  select SUBJ_CODE_old
					,SUBJ_NAME_old
					,subj_name_all_old
					,'8102'||substr(SUBJ_CODE_new,11)  as SUBJ_CODE_new
					,replace(SUBJ_NAME_new,'补助','拨款'） as SUBJ_NAME_new
					,replace(SUBJ_NAME_ALL_new,'补助','拨款'） as SUBJ_NAME_ALL_new
					,IS_LAST          
				from tmp_acc_subj_map t
			   where t.subj_code_new like '3001010102%'   */ 
			 union all  
			  select t.subj_code_old,
					 t.subj_name_old,
					 t.subj_name_all_old,
					 case when t.subj_code_new like '300102%' then '820201'
						  when t.subj_code_new like '300104%' then '820201'
						  else  '820202' || substr(t.subj_code_new ,7) end as subj_code_new,
					 case when t.subj_code_new like '300104%' then '医疗结余' 
						  else replace(t.subj_name_new,'盈余','结余') end as subj_name_new,
					 t.subj_name_all_new,
					 t.is_last
				from tmp_acc_subj_map t
			   where t.subj_code_new like '300102%'
				  or t.subj_code_new like '30010301%'
				  or t.subj_code_new like '30010302%'
				  or t.subj_code_new like '300104%'
			union all      
			 select t.subj_code_old
				   ,t.subj_name_old
				   ,t.subj_name_all_old
				   ,'8301'||substr(t.subj_code_new,5) as subj_code_new
				   ,replace(t.subj_name_new,'基金','结余')
				   ,t.subj_name_all_new
				   ,t.is_last
			  from tmp_acc_subj_map t
			 where t.subj_code_old like '3101%'
			   and t.subj_code_old not like '310102%'     
			  ;            
		  EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '科目表中存在非原制度要求科目导致插入科目表时失败！'||SQLERRM;
		END prc_Insert_Tab_Budg; 
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：prc_UpdateSubjInfoSigle
	   || 功能描述 ：根据传入的科目编码更新科目全称、拼音码、五笔码
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode        业务处理标志     OUT          Number
	   ||            prm_ErrTxt         返回信息         OUT          Varchar2
	   ||
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
	   PROCEDURE prc_UpdateSubjInfoALL( prm_AppCode           Out  Number         --执行代码
										,prm_ErrTxt            Out  Varchar2       --错误信息
									   )
	   IS
		 /*------变量定义---------------*/
		  v_subj_code             tmp_acc_subj_new.subj_code%type;
		  v_subj_name             tmp_acc_subj_new.subj_name%type;
		  v_super_code            tmp_acc_subj_new.subj_code%type;
		  v_spell_code            tmp_acc_subj_new.spell_code%type;
		  v_wbx_code              tmp_acc_subj_new.wbx_code%type;
		  v_level                 tmp_acc_subj_new.subj_level%type;   --层次
		  v_super_subj_name_all   tmp_acc_subj_new.subj_name_all%type;
		  v_super_spell_code      tmp_acc_subj_new.spell_code%type;
		  v_super_wbx_code        tmp_acc_subj_new.wbx_code%type;
		  v_super_spell_sub       tmp_acc_subj_new.spell_code%type;
		  v_super_wbx_sub         tmp_acc_subj_new.wbx_code%type;
		  v_count                 integer    := 0 ;
		  v_pos                   number(18) := 2 ;
		  --定义科目游标
		  CURSOR cur_acc_subj  (prm_subj_level        IN   integer        --层级
							   )
		   IS
			SELECT subj_code
				 , subj_name
				 , case when subj_level = 1 then 'TOP'
						else substr(subj_code,1,subj_level * 2) 
					end as super_code      
			  FROM tmp_acc_subj_new
			 WHERE SUBJ_LEVEL = prm_subj_level
			 ORDER BY subj_code;
	   BEGIN

		  prm_AppCode := def_OK;

		 --如果是第一层，则直接更新
		 update tmp_acc_subj_new
		   set subj_name_all = subj_name
			  ,spell_code = '{'||pkg_comm.fun_GetSpellCode(subj_name)
			  ,wbx_code   = '{'||pkg_comm.fun_GetWbxCode(subj_name)
		 where SUBJ_LEVEL  = 1;

		 select max(SUBJ_LEVEL)
		   into v_level
		   from tmp_acc_subj_new
		  ;

		 for i in 2..v_level loop
			 open cur_acc_subj( i );
			   LOOP
				  FETCH cur_acc_subj INTO v_subj_code,v_subj_name,v_super_code;    --提取游标

				  IF cur_acc_subj%NOTFOUND THEN
					 if cur_acc_subj%isopen then
						CLOSE cur_acc_subj;
					 end if;
					 goto next_i;
				  END IF;

				  if UPPER(v_super_code) = 'TOP' then
					  update tmp_acc_subj_new
						 set subj_name_all = subj_name
							,spell_code = '{'||pkg_comm.fun_GetSpellCode(subj_name)
							,wbx_code   = '{'||pkg_comm.fun_GetWbxCode(subj_name)
					   where subj_code  = v_subj_code;
				  else
					  select subj_name_all, spell_code, wbx_code
						into v_super_subj_name_all,
							 v_super_spell_code,
							 v_super_wbx_code
						from tmp_acc_subj_new
					   where subj_code = v_super_code;

					   if i = 2 then
							v_spell_code := v_spell_code || v_super_spell_code || pkg_comm.fun_GetSpellCode(v_subj_name);
							v_wbx_code   := v_wbx_code || v_super_wbx_code || pkg_comm.fun_GetWbxCode(v_subj_name);
					   else
						   --获取字符串工资项总数
						   v_count := pkg_comm.fun_cal_num(v_super_spell_code,'{');

						   while (v_count > 0 )  LOOP

							  --拆分拼音码字符串
							  pkg_comm.prc_SplitChar( v_super_spell_code ||'{'   ,
											'{'                         ,
											v_pos                       ,
											v_super_spell_sub           ,
											prm_AppCode                 ,
											prm_ErrTxt
											);

							  --拆分拼音码字符串失败
							  if prm_AppCode = -1 then
								 if cur_acc_subj%isopen then
									CLOSE cur_acc_subj;
								 end if;
								 return;
							  end if;


							  --拆分五笔码字符串
							  pkg_comm.prc_SplitChar( v_super_wbx_code||'{'  ,
											'{'                     ,
											v_pos                   ,
											v_super_wbx_sub         ,
											prm_AppCode             ,
											prm_ErrTxt
											);

							  --拆分字符串失败
							  if prm_AppCode = -1 then
								 if cur_acc_subj%isopen then
									CLOSE cur_acc_subj;
								 end if;
								 return;
							  end if;

							  v_spell_code := v_spell_code || '{'||v_super_spell_sub || pkg_comm.fun_GetSpellCode(v_subj_name);
							  v_wbx_code := v_wbx_code || '{'||v_super_wbx_sub || pkg_comm.fun_GetWbxCode(v_subj_name);

							  v_pos   :=  v_pos   + 1;
							  v_count :=  v_count - 1;
							  v_super_spell_sub := '';
							  v_super_wbx_sub   := '';

						  end loop;
						  v_count :=  0 ;
						  v_pos   :=  2 ;

					   end if;

					  update tmp_acc_subj_new
						 set subj_name_all = v_super_subj_name_all || '-' || subj_name
							,spell_code = '{'||pkg_comm.fun_GetSpellCode(subj_name)||v_spell_code
							,wbx_code   = '{'||pkg_comm.fun_GetWbxCode(subj_name)  ||v_wbx_code
					   where subj_code  = v_subj_code;

					  v_spell_code := '';
					  v_wbx_code   := '';
				  end if;
			end loop;
			<<next_i>>
			   null;
			if cur_acc_subj%isopen then
			   CLOSE cur_acc_subj;
			end if;
		 end loop;
	   EXCEPTION
		  WHEN NO_DATA_FOUND then
			 NULL;
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '更新科目全称及拼音码时失败！'||SQLERRM;
	   END prc_UpdateSubjInfoALL;
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：科目衔接转换
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Trans_Subj( prm_AppCode    Out Number
								 ,prm_ErrTxt     Out Varchar2
								)

		Is
		  n_del_flag     number(18);
		BEGIN
		  prm_AppCode := def_OK      ;
		  n_del_flag  := 0           ;
		  
		  --1、重新更新原科目级次、是否末级等信息
		  prc_CheckSubjOld( prm_AppCode
						   ,prm_ErrTxt
						  );

		  if prm_AppCode = def_ERR then
			 return;
		  end if;
		  
		  --2、更新原科目的科目全称
		  prc_UpdateSubjNameALL( prm_AppCode
								,prm_ErrTxt
								);
		  if prm_AppCode = def_ERR then
			 return;
		  end if; 
		  
		  --3、清空新科目表及映射关系表
		  select count(1) 
			into n_del_flag
			from tmp_acc_subj_new
			;
			
		  if n_del_flag > 0 then    
			 delete from tmp_acc_subj_new;
		  end if;   
		  
		  n_del_flag := 0;
		  
		  select count(1) 
			into n_del_flag
			from tmp_acc_subj_map
			;
		  if  n_del_flag > 0 then  
			  delete from tmp_acc_subj_map;
		  end if;    
							   
		  --4、新旧财务科目转换
		  for rec in (select t.subj_code 
						from tmp_acc_subj_old t 
					   where length(t.subj_code) = 4                      
					   order by t.subj_code 
					  ) loop
		  
			  --(1)、初始化数据栈
			  prc_InitTab( prm_AppCode
						  ,prm_ErrTxt
						 );

			  if prm_AppCode = def_ERR then
				 return;
			  end if;
			  
			  --(2)、加载旧会计科目
			  prc_Load_Subj( rec.subj_code
							,prm_AppCode   
							,prm_ErrTxt     
							);
			  if prm_AppCode = def_ERR then
				 return;
			  end if;
							
							
			  --(3)、按照新旧制度衔接进行加工处理
			  prc_Treat_Subj(prm_AppCode    
							,prm_ErrTxt     
							);
			  if prm_AppCode = def_ERR then
				 return;
			  end if;        
			  
			  --(4)、新会计科目入栈
			  prc_Write_Subj(prm_AppCode    
							,prm_ErrTxt     
							);
			  if prm_AppCode = def_ERR then
				 return;
			  end if; 
				   
			  --(5)、更新新制度的会计科目表 
			  prc_Insert_Tab_Subj(prm_AppCode
								 ,prm_ErrTxt      
								 );    
			  if prm_AppCode = def_ERR then
				 return;
			  end if;  
		  end loop; 
		  
		  --5、更新预算收入、预算支出、预算结余科目表，同时更新是否末级及科目级次
		  prc_Insert_Tab_Budg( prm_AppCode
							  ,prm_ErrTxt      
							  );    
		  if prm_AppCode = def_ERR then
			 return;
		  end if;   
		  
		  --6、更新科目全称、拼音码、五笔码
		  prc_UpdateSubjInfoALL( prm_AppCode
							  ,prm_ErrTxt      
							  );    
		  if prm_AppCode = def_ERR then
			 return;
		  end if;   
		  
		  update tmp_acc_subj_map t
			 set t.subj_name_new = (select t2.subj_name from tmp_acc_subj_new t2 where t2.subj_code = t.subj_code_new)
				,t.subj_name_all_new = (select t2.subj_name_all from tmp_acc_subj_new t2 where t2.subj_code = t.subj_code_new)
				,t.is_last = (select t2.is_last from tmp_acc_subj_new t2 where t2.subj_code = t.subj_code_new);
				
		  delete from tmp_acc_subj_map t
		   where t.subj_code_old in
				 (select t1.subj_code
					from tmp_acc_subj_old t1
				   where t1.is_last = '否');               
				   
		EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '科目衔接转换失败！'||SQLERRM;
		END prc_Trans_Subj;
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：更新科目映射表
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Tran_Map(  prm_AppCode    Out Number
									   ,prm_ErrTxt     Out Varchar2
									 )
		Is
		  n_del_flag     number(18);
		BEGIN
		  prm_AppCode := def_OK         ;
		  
		  select count(1)
			into n_del_flag
			from TMP_ACC_TRAN_MAP;
		  if n_del_flag > 0 then
			 delete from TMP_ACC_TRAN_MAP;
		  end if;
		  
		  insert 
			into TMP_ACC_TRAN_MAP(
				 SUBJ_CODE_OLD     ,
				 SUBJ_NAME_OLD     ,
				 SUBJ_NAME_ALL_OLD ,
				 SUBJ_CODE_NEW     ,
				 SUBJ_NAME_NEW     ,  
				 SUBJ_NAME_ALL_NEW ,  
				 SUBJ_CODE_NEW_B   ,
				 SUBJ_NAME_NEW_B   ,
				 SUBJ_NAME_ALL_NEW_B 
			)
		  select t1.subj_code_old,
				 t1.subj_name_old,
				 t1.subj_name_all_old,
				 t1.subj_code_new,
				 t2.subj_name as SUBJ_NAME_NEW,
				 t2.subj_name_all as SUBJ_NAME_ALL_NEW,
				 t1.subj_code_new_b,
				 t3.subj_name as SUBJ_NAME_NEW_B,
				 t3.subj_name_all as SUBJ_NAME_ALL_NEW_B
			from (select t.subj_code_old,
						 t.subj_name_old,
						 t.subj_name_all_old,
						 min(t.subj_code_new) as subj_code_new,
						 case
						   when substr(max(t.subj_code_new), 1, 1) < '6' then
							''
						   else
							max(t.subj_code_new)
						 end as subj_code_new_b
					from tmp_acc_subj_map t
				   group by t.subj_code_old, t.subj_name_old, t.subj_name_all_old) t1
			left join tmp_acc_subj_new t2
			  on t1.subj_code_new = t2.subj_code
			left join tmp_acc_subj_new t3
			  on t1.subj_code_new_b = t3.subj_code
		   order by t1.subj_code_old
		  ;
		EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '更新科目映射表失败！'||SQLERRM;
		END prc_Insert_Tran_Map;                        
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：根据映射关系表，转换科目余额
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Ledger(  prm_AppCode    Out Number
									   ,prm_ErrTxt     Out Varchar2
									 )
		Is
		  n_exist_flag   number(18);      
		BEGIN
		  prm_AppCode  := def_OK       ;
		  n_exist_flag := 0            ;
		  
		  select count(1)
			into n_exist_flag
			from tmp_acc_ledger_new
			;
		  if n_exist_flag > 0 then     
			 delete 
			   from tmp_acc_ledger_new;
		  end if;  
		  
		  insert 
			into tmp_acc_ledger_new(
				 subj_code,
				 subj_name,
				 bal_od,
				 bal_oc,
				 this_od,
				 this_oc,
				 sum_od,
				 sum_oc,
				 end_od,
				 end_oc
				 )
			select t1.subj_code_new,
				   t1.subj_name_new,
				   case when sum(nvl(t.bal_od,0)) = 0 then null else sum(nvl(t.bal_od,0)) end as bal_od,
				   case when sum(nvl(t.bal_oc,0)) = 0 then null else sum(nvl(t.bal_oc,0)) end as bal_oc,
				   case when sum(nvl(t.this_od,0))= 0 then null else sum(nvl(t.this_od,0))end as this_od,
				   case when sum(nvl(t.this_oc,0))= 0 then null else sum(nvl(t.this_oc,0))end as this_oc,
				   case when sum(nvl(t.sum_od,0)) = 0 then null else sum(nvl(t.sum_od,0)) end as sum_od,
				   case when sum(nvl(t.sum_oc,0)) = 0 then null else sum(nvl(t.sum_oc,0)) end as sum_oc,
				   case when sum(nvl(t.end_od,0)) = 0 then null else sum(nvl(t.end_od,0)) end as end_od,
				   case when sum(nvl(t.end_oc,0)) = 0 then null else sum(nvl(t.end_oc,0)) end as end_oc         
			  from tmp_acc_ledger_old t
			 inner join tmp_acc_tran_map t1
				on t.subj_code = t1.subj_code_old
			 inner join tmp_acc_subj_old t2
				on t.subj_code = t2.subj_code
			   and t2.is_last = '是'
			 group by t1.subj_code_new, t1.subj_name_new  
			 order by t1.subj_code_new 
			 ;
			 
		  insert 
			into tmp_acc_ledger_new(
				 subj_code,
				 subj_name,
				 bal_od,
				 bal_oc,
				 this_od,
				 this_oc,
				 sum_od,
				 sum_oc,
				 end_od,
				 end_oc
				 )
			select t1.subj_code_new_b,
				   t1.subj_name_new_b,
				   case when sum(nvl(t.bal_od,0)) = 0 then null else sum(nvl(t.bal_od,0)) end as bal_od,
				   case when sum(nvl(t.bal_oc,0)) = 0 then null else sum(nvl(t.bal_oc,0)) end as bal_oc,
				   case when sum(nvl(t.this_od,0))= 0 then null else sum(nvl(t.this_od,0))end as this_od,
				   case when sum(nvl(t.this_oc,0))= 0 then null else sum(nvl(t.this_oc,0))end as this_oc,
				   case when sum(nvl(t.sum_od,0)) = 0 then null else sum(nvl(t.sum_od,0)) end as sum_od,
				   case when sum(nvl(t.sum_oc,0)) = 0 then null else sum(nvl(t.sum_oc,0)) end as sum_oc,
				   case when sum(nvl(t.end_od,0)) = 0 then null else sum(nvl(t.end_od,0)) end as end_od,
				   case when sum(nvl(t.end_oc,0)) = 0 then null else sum(nvl(t.end_oc,0)) end as end_oc         
			  from tmp_acc_ledger_old t
			 inner join tmp_acc_tran_map t1
				on t.subj_code = t1.subj_code_old and nvl(t1.subj_code_new_b,'空') <> '空'   
			 inner join tmp_acc_subj_old t2
				on t.subj_code = t2.subj_code
			   and t2.is_last = '是'
			 group by t1.subj_code_new_b, t1.subj_name_new_b  
			 order by t1.subj_code_new_b 
			 ;
		  EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '转换科目余额时失败！'||SQLERRM;
		END prc_Insert_Ledger;  
		
	   /*-------------------------------------------------------------------------
	   || 过程名称 ：根据映射关系表，转换科目辅助账余额
	   || 参数描述 ：参数标识           名称        输入/输出  类型
	   ||            -------------------------------------------------------------
	   ||            prm_AppCode             OUT    Number,        -- 业务处理标志
	   ||            prm_ErrTxt              OUT    Varchar2       -- 返回信息
	   || 作    者 ：               完成日期 ：
	   ||-------------------------------------------------------------------------
	   || 修改记录 ：
	   ||-------------------------------------------------------------------------*/
		Procedure prc_Insert_Ledger_Check(  prm_AppCode    Out Number
										   ,prm_ErrTxt     Out Varchar2
										 )
		Is
		  n_exist_flag   number(18);      
		BEGIN
		  prm_AppCode  := def_OK       ;
		  n_exist_flag := 0            ;
		  
		  select count(1)
			into n_exist_flag
			from tmp_acc_ledger_check_old
			;
		  
		  if n_exist_flag = 0 then
			 prm_AppCode := def_WARNING;
			 prm_ErrTxt := '没有需要转换的科目辅助账！'||SQLERRM;
			 return; 
		  end if;   
		  
		  n_exist_flag := 0 ;
		  
		  select count(1)
			into n_exist_flag
			from tmp_acc_ledger_check_new
			;
		  if n_exist_flag > 0 then     
			 delete 
			   from tmp_acc_ledger_check_new;
		  end if;  
		  
		  insert 
			into tmp_acc_ledger_check_new(
				 subj_code,
				 subj_name,
				 bal_od,
				 bal_oc,
				 this_od,
				 this_oc,
				 sum_od,
				 sum_oc,
				 end_od,
				 end_oc,
				 check_type1,
				 check_code1,
				 check_name1,
				 check_type2,
				 check_code2,
				 check_name2,
				 check_type3,
				 check_code3,
				 check_name3,
				 check_type4,
				 check_code4,
				 check_name4
				 )
			select t1.subj_code_new,
				   t1.subj_name_new,
				   sum(t.bal_od) as bal_od,
				   sum(t.bal_oc) as bal_oc,
				   sum(t.this_od) as this_od,
				   sum(t.this_oc) as this_oc,
				   sum(t.sum_od) as sum_od,
				   sum(t.sum_oc) as sum_oc,
				   sum(t.end_od) as end_od,
				   sum(t.end_oc) as end_oc,
				   t.check_type1,
				   t.check_code1,
				   t.check_name1,
				   t.check_type2,
				   t.check_code2,
				   t.check_name2,
				   t.check_type3,
				   t.check_code3,
				   t.check_name3,
				   t.check_type4,
				   t.check_code4,
				   t.check_name4
			  from tmp_acc_ledger_check_old t
			 inner join tmp_acc_tran_map t1
				on t.subj_code = t1.subj_code_old
			 inner join tmp_acc_subj_old t2
				on t.subj_code = t2.subj_code
			   and t2.is_last = '是'
			 group by t1.subj_code_new,
					  t1.subj_name_new,
					  t.check_type1,
					  t.check_code1,
					  t.check_name1,
					  t.check_type2,
					  t.check_code2,
					  t.check_name2,
					  t.check_type3,
					  t.check_code3,
					  t.check_name3,
					  t.check_type4,
					  t.check_code4,
					  t.check_name4
			 order by t1.subj_code_new
			 ;
		  
		   begin 
			  insert 
				into tmp_acc_ledger_check_new(
					 subj_code,
					 subj_name,
					 bal_od,
					 bal_oc,
					 this_od,
					 this_oc,
					 sum_od,
					 sum_oc,
					 end_od,
					 end_oc,
					 check_type1,
					 check_code1,
					 check_name1,
					 check_type2,
					 check_code2,
					 check_name2,
					 check_type3,
					 check_code3,
					 check_name3,
					 check_type4,
					 check_code4,
					 check_name4
					 )
				select t1.subj_code_new_b,
					   t1.subj_name_new_b,
					   sum(t.bal_od) as bal_od,
					   sum(t.bal_oc) as bal_oc,
					   sum(t.this_od) as this_od,
					   sum(t.this_oc) as this_oc,
					   sum(t.sum_od) as sum_od,
					   sum(t.sum_oc) as sum_oc,
					   sum(t.end_od) as end_od,
					   sum(t.end_oc) as end_oc,
					   t.check_type1,
					   t.check_code1,
					   t.check_name1,
					   t.check_type2,
					   t.check_code2,
					   t.check_name2,
					   t.check_type3,
					   t.check_code3,
					   t.check_name3,
					   t.check_type4,
					   t.check_code4,
					   t.check_name4
				  from tmp_acc_ledger_check_old t
				 inner join tmp_acc_tran_map t1
					on t.subj_code = t1.subj_code_old and nvl(t1.subj_code_new_b,'空') <> '空'   
				 inner join tmp_acc_subj_old t2
					on t.subj_code = t2.subj_code
				   and t2.is_last = '是'
				 group by t1.subj_code_new_b,
						  t1.subj_name_new_b,
						  t.check_type1,
						  t.check_code1,
						  t.check_name1,
						  t.check_type2,
						  t.check_code2,
						  t.check_name2,
						  t.check_type3,
						  t.check_code3,
						  t.check_name3,
						  t.check_type4,
						  t.check_code4,
						  t.check_name4
				 order by t1.subj_code_new_b
				 ;
			EXCEPTION
			  WHEN OTHERS THEN
				NULL;     
			END ;   
		 EXCEPTION
		  WHEN OTHERS THEN
			 prm_AppCode := def_ERR;
			 prm_ErrTxt := '转换科目辅助账余额时失败！'||SQLERRM;
		END prc_Insert_Ledger_Check;                             
	end PKG_TMP_TRANS;
	]]></sql>
</root>

