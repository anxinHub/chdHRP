<?xml version="1.0" encoding="UTF-8" ?>
<root>

	<sql id="ass_bill_confirm_check" type="proc"><![CDATA[
		CREATE OR REPLACE PROCEDURE ASS_BILL_CONFIRM_CHECK(prm_group_id  IN NUMBER --集团
                                                  ,
                                                   prm_hos_id    IN NUMBER --医院
                                                  ,
                                                   prm_copy_code IN VARCHAR2 --账套
                                                  ,
                                                   prm_acc_year  IN VARCHAR2 --年度
                                                  ,
                                                   prm_acc_month IN VARCHAR2 --月份
                                                  ,
                                                   prm_AppCode   Out Number --执行代码
                                                  ,
                                                   prm_ErrTxt    Out VARCHAR2 --错误信息
                                                   ) IS
  def_OK      CONSTANT NUMBER := 0; -- 成功
  def_ERR     CONSTANT NUMBER := -1; -- 系统错误
  def_WARNING CONSTANT NUMBER := 100; -- 系统警告
  def_CONFIRM_STATE CONSTANT NUMBER := 2; -- 确认状态

  v_count NUMBER; --查找是否存在

BEGIN
  --初始化变量
  prm_AppCode := def_OK;
  prm_ErrTxt  := '单据确认检查通过!';

  v_count := 0;

  --采购入库
  select count(1)
       into v_count
       from ASS_IN_MAIN_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑采购入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_MAIN_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备采购入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_MAIN_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备采购入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_MAIN_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产采购入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_MAIN_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产采购入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_MAIN_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地采购入库存在当月未确认的单据!';
    return;
  end if;

  --采购退库
  select count(1)
       into v_count
       from ASS_BACK_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑采购退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备采购退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备采购退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产采购退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产采购退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地采购退库存在当月未确认的单据!';
    return;
  end if;

  --其它入库
  select count(1)
       into v_count
       from ASS_IN_REST_MAIN_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑其它入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_REST_MAIN_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备其它入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_REST_MAIN_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备其它入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_REST_MAIN_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产其它入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_REST_MAIN_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产其它入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_IN_REST_MAIN_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地其它入库存在当月未确认的单据!';
    return;
  end if;

  --其它退库
  select count(1)
       into v_count
       from ASS_BACK_REST_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑其它退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_REST_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备其它退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_REST_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备其它退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_REST_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产其它退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_REST_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产其它退库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_BACK_REST_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地其它退库存在当月未确认的单据!';
    return;
  end if;

  --调剂入库
  select count(1)
       into v_count
       from ASS_ALLOT_IN_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑调剂入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_IN_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备调剂入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_IN_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备调剂入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_IN_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产调剂入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_IN_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产调剂入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_IN_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地调剂入库存在当月未确认的单据!';
    return;
  end if;

  --调剂出库
  select count(1)
       into v_count
       from ASS_ALLOT_OUT_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑调剂出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_OUT_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备调剂出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_OUT_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备调剂出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_OUT_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产调剂出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_OUT_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产调剂出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_ALLOT_OUT_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地调剂出库存在当月未确认的单据!';
    return;
  end if;

  --调拨入库
  select count(1)
       into v_count
       from ASS_SELL_IN_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑调拨入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_IN_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备调拨入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_IN_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备调拨入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_IN_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产调拨入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_IN_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产调拨入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_IN_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地调拨入库存在当月未确认的单据!';
    return;
  end if;

  --调拨出库
  select count(1)
       into v_count
       from ASS_SELL_OUT_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑调拨出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_OUT_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备调拨出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_OUT_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备调拨出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_OUT_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产调拨出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_OUT_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产调拨出库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_SELL_OUT_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地调拨出库存在当月未确认的单据!';
    return;
  end if;

  --盘盈申报
  select count(1)
       into v_count
       from ASS_CHECK_AP_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑盘盈申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHECK_AP_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备盘盈申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHECK_AP_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备盘盈申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHECK_AP_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产盘盈申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHECK_AP_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产盘盈申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHECK_AP_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地盘盈申报存在当月未确认的单据!';
    return;
  end if;

  --盘盈入库
  select count(1)
       into v_count
       from ASS_CHK_IN_MAIN_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑盘盈入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_IN_MAIN_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备盘盈入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_IN_MAIN_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备盘盈入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_IN_MAIN_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产盘盈入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_IN_MAIN_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产盘盈入库存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_IN_MAIN_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地盘盈入库存在当月未确认的单据!';
    return;
  end if;

  --盘亏申报
  select count(1)
       into v_count
       from ASS_CHK_A_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑盘亏申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_A_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备盘亏申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_A_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备盘亏申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_A_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产盘亏申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_A_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产盘亏申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_A_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地盘亏申报存在当月未确认的单据!';
    return;
  end if;

  --盘亏记录
  select count(1)
       into v_count
       from ASS_CHK_R_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑盘亏记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_R_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备盘亏记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_R_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备盘亏记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_R_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产盘亏记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHK_R_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产盘亏记录存在当月未确认的单据!';
    return;
  end if;

  --原值变动
  select count(1)
       into v_count
       from ASS_CHANGE_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑原值变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHANGE_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备原值变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHANGE_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备原值变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHANGE_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产原值变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHANGE_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产原值变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_CHANGE_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地原值变动存在当月未确认的单据!';
    return;
  end if;

  --累计折旧变动
  select count(1)
       into v_count
       from ASS_DEPRE_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑累计折旧变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DEPRE_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备累计折旧变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DEPRE_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备累计折旧变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DEPRE_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产累计折旧变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DEPRE_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产累计折旧变动存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DEPRE_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地累计折旧变动存在当月未确认的单据!';
    return;
  end if;

  --资产改造申报
  select count(1)
       into v_count
       from ASS_REMOULD_A_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑改造申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_A_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备改造申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_A_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备改造申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_A_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产改造申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_A_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产改造申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_A_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地改造申报存在当月未确认的单据!';
    return;
  end if;

  --资产改造记录
  select count(1)
       into v_count
       from ASS_REMOULD_R_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑改造记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_R_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备改造记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_R_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备改造记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_R_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产改造记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_R_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产改造记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_R_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地改造记录存在当月未确认的单据!';
    return;
  end if;

  --资产竣工记录
  select count(1)
       into v_count
       from ASS_REMOULD_F_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑竣工记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_F_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备竣工记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_F_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备竣工记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_F_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产竣工记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_F_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产竣工记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_REMOULD_F_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地竣工记录存在当月未确认的单据!';
    return;
  end if;

  --资产处置申报
  select count(1)
       into v_count
       from ASS_DISPOSAL_A_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑处置申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_A_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备处置申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_A_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备处置申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_A_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产处置申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_A_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产处置申报存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_A_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地处置申报存在当月未确认的单据!';
    return;
  end if;

  --资产处置记录
  select count(1)
       into v_count
       from ASS_DISPOSAL_R_HOUSE t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '房屋及建筑处置记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_R_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备处置记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_R_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备处置记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_R_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它固定资产处置记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_R_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其它无形资产处置记录存在当月未确认的单据!';
    return;
  end if;

  select count(1)
       into v_count
       from ASS_DISPOSAL_R_LAND t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '土地处置记录存在当月未确认的单据!';
    return;
  end if;


  select count(1)
       into v_count
       from ASS_OUT_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备移库(库到科)存在当月未确认的单据!';
    return;
  end if;
  
   select count(1)
       into v_count
       from ASS_OUT_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备移库(库到科)存在当月未确认的单据!';
    return;
  end if;
  
   select count(1)
       into v_count
       from ASS_OUT_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其他固定资产设备移库(库到科)存在当月未确认的单据!';
    return;
  end if;
  
  select count(1)
       into v_count
       from ASS_OUT_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '无形资产设备移库(库到科)存在当月未确认的单据!';
    return;
  end if;
  
  select count(1)
       into v_count
       from ASS_TRAN_STORE_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备移库(库到库)存在当月未确认的单据!';
    return;
  end if;
 
 select count(1)
       into v_count
       from ASS_TRAN_STORE_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备移库(库到库)存在当月未确认的单据!';
    return;
  end if; 
  
  select count(1)
       into v_count
       from ASS_TRAN_STORE_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其他固定资产设备移库(库到库)存在当月未确认的单据!';
    return;
  end if; 
  
  select count(1)
       into v_count
       from ASS_TRAN_STORE_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '无形资产设备移库(库到库)存在当月未确认的单据!';
    return;
  end if; 
  
  select count(1)
       into v_count
       from ASS_TRAN_DEPT_SPECIAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '专用设备移库(科到科)存在当月未确认的单据!';
    return;
  end if; 
  
  select count(1)
       into v_count
       from ASS_TRAN_DEPT_GENERAL t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '一般设备移库(科到科)存在当月未确认的单据!';
    return;
  end if; 
  
   select count(1)
       into v_count
       from ASS_TRAN_DEPT_OTHER t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '其他固定资产设备移库(科到科)存在当月未确认的单据!';
    return;
  end if; 
  
  select count(1)
       into v_count
       from ASS_TRAN_DEPT_INASSETS t1
      where t1.group_id     =  prm_group_id
        and t1.hos_id       =  prm_hos_id
        and t1.copy_code    =  prm_copy_code
        and nvl(t1.state,0) <> def_CONFIRM_STATE
        and to_char(t1.create_date,'yyyyMM') = prm_acc_year||''||prm_acc_month;

  if v_count > 0 then
    prm_AppCode := def_WARNING;
    prm_ErrTxt := '无形资产设备移库(科到科)存在当月未确认的单据!';
    return;
  end if; 
  
  
EXCEPTION
  WHEN OTHERS THEN
    prm_AppCode := def_ERR;
    prm_ErrTxt  := '单据确认检查失败！' || SQLERRM;

END ASS_BILL_CONFIRM_CHECK;
  
	]]></sql>

</root>

