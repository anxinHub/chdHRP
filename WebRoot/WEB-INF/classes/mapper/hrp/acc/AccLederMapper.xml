<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.acc.dao.AccLederMapper">
 
	<resultMap id="accLeder" type="com.chd.hrp.acc.entity.AccLeder">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="subj_code" column="subj_code" />
		<result property="subj_name_all" column="subj_name_all" />
		<result property="bal_os" column="bal_os" />
		<result property="this_od" column="this_od" />
		<result property="this_oc" column="this_oc" />
		<result property="sum_od" column="sum_od" />
		<result property="sum_oc" column="sum_oc" />
		<result property="end_os" column="end_os" />
		<result property="bal_os_w" column="bal_os_w" />
		<result property="this_od_w" column="this_od_w" />
		<result property="this_oc_w" column="this_oc_w" />
		<result property="sum_od_w" column="sum_od_w" />
		<result property="sum_oc_w" column="sum_oc_w" />
		<result property="end_os_w" column="end_os_w" />
		<result property="subj_name" column="subj_name" />
		<result property="subj_dire" column="subj_dire" />
		<result property="cur_code" column="cur_code" />
		<result property="is_check" column="is_check" />
		<result property="is_last" column="is_last" />
		<result property="start_month" column="start_month" />
		<result property="check_type_name1" column="check_type_name1" />
		<result property="check_type_name2" column="check_type_name2" />
		<result property="check_type_name3" column="check_type_name3" />
		<result property="check_type_name4" column="check_type_name4" />
		<result property="column_check1" column="column_check1" />
		<result property="column_check2" column="column_check2" />
		<result property="column_check3" column="column_check3" />
		<result property="column_check4" column="column_check4" />
		<result property="column_item1" column="column_item1" />
		<result property="column_item2" column="column_item2" />
		<result property="column_item3" column="column_item3" />
		<result property="column_item4" column="column_item4" />
		<result property="check1" column="check1" />
		<result property="check2" column="check2" />
		<result property="check3" column="check3" />
		<result property="check4" column="check4" />
		<result property="check_type_id1" column="check_type_id1" />
		<result property="check_type_id2" column="check_type_id2" />
		<result property="check_type_id3" column="check_type_id3" />
		<result property="check_type_id4" column="check_type_id4" />
		<result property="credit" column="credit" />
		<result property="debit" column="debit" />
		
	</resultMap>
	
	<resultMap id="accLeder1" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="subj_id" column="subj_id" />
		<result property="subj_code" column="subj_code" />
		<result property="subj_name_all" column="subj_name_all" />
		<result property="bal_os" column="bal_os" />
		<result property="this_od" column="this_od" />
		<result property="this_oc" column="this_oc" />
		<result property="sum_od" column="sum_od" />
		<result property="sum_oc" column="sum_oc" />
		<result property="end_os" column="end_os" />
		<result property="bal_os_w" column="bal_os_w" />
		<result property="this_od_w" column="this_od_w" />
		<result property="this_oc_w" column="this_oc_w" />
		<result property="sum_od_w" column="sum_od_w" />
		<result property="sum_oc_w" column="sum_oc_w" />
		<result property="end_os_w" column="end_os_w" />
		<result property="subj_name" column="subj_name" />
		<result property="subj_dire" column="subj_dire" />
		<result property="cur_code" column="cur_code" />
		<result property="is_check" column="is_check" />
		<result property="is_last" column="is_last" />
		<result property="start_month" column="start_month" />
		<result property="check_type_name1" column="check_type_name1" />
		<result property="check_type_name2" column="check_type_name2" />
		<result property="check_type_name3" column="check_type_name3" />
		<result property="check_type_name4" column="check_type_name4" />
		<result property="column_check1" column="column_check1" />
		<result property="column_check2" column="column_check2" />
		<result property="column_check3" column="column_check3" />
		<result property="column_check4" column="column_check4" />
		<result property="column_item1" column="column_item1" />
		<result property="column_item2" column="column_item2" />
		<result property="column_item3" column="column_item3" />
		<result property="column_item4" column="column_item4" />
		<result property="check1" column="check1" />
		<result property="check2" column="check2" />
		<result property="check3" column="check3" />
		<result property="check4" column="check4" />
		<result property="credit" column="credit" />
		<result property="debit" column="debit" />
		
	</resultMap>
	
	<resultMap id="paraMap" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="sum_od" column="sum_od" />
		<result property="sum_oc" column="sum_oc" />
		<result property="end_os" column="end_os" />
		<result property="bal_os" column="bal_os" />
		
		
		<result property="check1" column="check1" />
		<result property="check2" column="check2" />
		<result property="check3" column="check3" />
		<result property="check4" column="check4" />
		<result property="value1" column="value1" />
		<result property="value2" column="value2" />
		<result property="value3" column="value3" />
		<result property="value4" column="value4" />
		
	</resultMap>
	
	<resultMap type="java.util.Map" id="map">
		<result property="id" column="id" />
		<result property="text" column="text" />
		<result property="emp_code" column="emp_code" />
		<result property="emp_name" column="emp_name" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="proj_code" column="proj_code" />
		<result property="proj_name" column="proj_name" />
		<result property="store_code" column="store_code" />
		<result property="store_name" column="store_name" />
		<result property="cus_code" column="cus_code" />
		<result property="cus_name" column="cus_name" />
		<result property="sup_code" column="sup_code" />
		<result property="sup_name" column="sup_name" />
		<result property="source_code" column="source_code" />
		<result property="source_name" column="source_name" />
		<result property="hos_code" column="hos_code" />
		<result property="hos_name" column="hos_name" />
		<result property="check_item_code" column="check_item_code" />
		<result property="check_item_name" column="check_item_name" />
	</resultMap>

	<insert id="addAccLeder" parameterType="java.util.Map">
	begin
		insert into ACC_LEDER(
			group_id,
			hos_id,
			copy_code,
			acc_year,
			acc_month,
			subj_code,
			bal_os,
			this_od,
			this_oc,
			${sqls}
			end_os,
			bal_os_w,
			this_od_w,
			this_oc_w,
			sum_od_w,
			sum_oc_w,
			end_os_w
		)VALUES (
			#{group_id},
			#{hos_id},
			#{copy_code},
			#{acc_year},
			'00',
			#{subj_code},
			#{bal_os},
			0,
			0,
			<if test="sum_od != null and sum_od !='' and sum_oc != null and sum_oc !=''">
			#{sum_oc},#{sum_od},
			</if>
			#{end_os},
			0,
			0,
			0,
			0,
			0,
			0
		);
		
		insert into ACC_LEDER(
			group_id,
			hos_id,
			copy_code,
			acc_year,
			acc_month,
			subj_code,
			bal_os,
			this_od,
			this_oc,
			${sqls}
			end_os,
			bal_os_w,
			this_od_w,
			this_oc_w,
			sum_od_w,
			sum_oc_w,
			end_os_w
		)VALUES (
			#{group_id},
			#{hos_id},
			#{copy_code},
			#{acc_year},
			'01',
			#{subj_code},
			#{bal_os},
			0,
			0,
			<if test="sum_od != null and sum_od !='' and sum_oc != null and sum_oc !=''">
			#{sum_oc},#{sum_od},
			</if>
			#{end_os},
			0,
			0,
			0,
			0,
			0,
			0
		);
	end;	
		
	</insert>
	
	
	<insert id="addBatchAccLeder" parameterType="java.util.List">
		insert into ACC_LEDER(
			group_id,
			hos_id,
			copy_code,
			acc_year,
			acc_month,
			subj_code,
			bal_os,
			this_od,
			this_oc,
			sum_oc,
			sum_od,
			end_os,
			bal_os_w,
			this_od_w,
			this_oc_w,
			sum_od_w,
			sum_oc_w,
			end_os_w
		)
		<foreach collection="list" item="item" index="index" separator=" union all " >
        select 		
			#{item.group_id},
			#{item.hos_id},
			#{item.copy_code},
			#{item.acc_year},
			'00',
			#{item.subj_code},
			#{item.bal_os},
			0,
			0,
			#{item.sum_oc},
			#{item.sum_od},
			#{item.end_os},
			0,
			0,
			0,
			0,
			0,
			0	 
		 from dual 
		</foreach>
		
	</insert>
	
	<delete id="deleteAccLeder" parameterType="java.util.Map">
        DELETE FROM ACC_LEDER 
        	WHERE group_id = #{group_id}   
        		and hos_id = #{hos_id}   
        		and copy_code = #{copy_code}
        		and acc_year = #{acc_year} 
        		and subj_code in(${subj_code}) 
        		AND ACC_MONTH in ('00','01')
    </delete>
    
    
    <delete id="deleteAccLederJz" parameterType="java.util.Map">
        DELETE FROM ACC_LEDER 
        WHERE group_id = #{group_id}   
        	and hos_id = #{hos_id}   
        	and copy_code = #{copy_code}
	        and acc_year = #{acc_year} 
	        and acc_month = #{acc_month} 
    </delete>
    
    <delete id="deleteBatchAccLeder" parameterType="java.util.List">
       DELETE FROM ACC_LEDER  
       where 
    	<foreach collection="list" index="index" item="item" open="(" separator="or" close=")">
    			group_id = #{item.group_id}   
    		and hos_id = #{item.hos_id}   
    		and copy_code = #{item.copy_code}
	        and acc_year = #{item.acc_year}
	        and acc_month = #{item.acc_month}
	        and subj_code =#{item.subj_code}
    	</foreach>
    </delete>
	
	<update id="updateBatchAccLederAccounting" parameterType="java.util.List">
		<foreach collection="list" item="item" index="index" open="begin" close="end;" separator=";">
			UPDATE acc_leder 
			SET this_od = #{this_od} , this_oc = #{this_oc}
			WHERE group_id = #{group_id}
				and hos_id = #{hos_id}
				and copy_code = #{copy_code}
				and acc_year = #{acc_year}
				and acc_month = #{acc_month}
				and subj_code = #{subj_code}
		</foreach>
	</update>

	<update id="updateBatchAccLeder" parameterType="java.util.Map">
		<foreach collection="itemList" item="item" index="index" open="begin" close=";end;" separator=";">
			UPDATE acc_leder 
			SET bal_os =bal_os+#{item.bal_os} , 
			end_os =end_os+#{item.end_os}
			<if test ="item.sum_oc != null and item.sum_oc !=''">
				, sum_oc = #{item.sum_oc}
			</if>
			<if test ="item.sum_od != null and item.sum_od !=''">
				, sum_od = #{item.sum_od}
			</if>
			WHERE
					group_id = #{item.group_id}
				and hos_id = #{item.hos_id}
				and copy_code = #{item.copy_code}
				and acc_year = #{item.acc_year}
				and acc_month = '00'
				and subj_code = #{item.subj_code}
		</foreach>
	</update>
	
	<update id="updateAccLeder" parameterType="java.util.Map">
		UPDATE acc_leder SET bal_os =#{bal_os} ,
			end_os =#{end_os} , 
			sum_oc = #{sum_oc}, 
			sum_od = #{sum_od}
		WHERE
				group_id = #{group_id}
			and hos_id = #{hos_id}
			and copy_code = #{copy_code}
			and acc_year = #{acc_year}
			and acc_month = '00'
			and subj_code = #{subj_code}
	</update>

	<select id="queryAccLederByCode" resultType="com.chd.hrp.acc.entity.AccLeder" parameterType="java.util.Map">
		SELECT
			asubj.group_id,
			asubj.hos_id,
			asubj.copy_code,
			asubj.acc_year,
			al.acc_month,
			asubj.subj_code,
			al.bal_os,
			al.this_od,
			al.this_oc,
			al.sum_od,
			al.sum_oc,
			al.end_os,
			asubj.subj_name,
			asubj.cur_code,
			asubj.subj_dire,
			asubj.is_check
		FROM ACC_LEDER al 
		left join acc_subj asubj on al.group_id = asubj.group_id and al.hos_id = asubj.hos_id
			and al.copy_code = asubj.copy_code and al.acc_year = asubj.acc_year
			and al.subj_code = asubj.subj_code AND al.acc_month = '00' and asubj.is_stop = 0 
			and asubj.is_last = 1
		<where>
			<if test ="group_id != null and group_id !=''" >
				and asubj.group_id = #{group_id}
			</if>
			<if test ="hos_id != null and hos_id !=''" >
				and asubj.hos_id = #{hos_id}
			</if>
			<if test ="copy_code != null and copy_code !=''">
				and asubj.copy_code = #{copy_code}
			</if>
			<if test ="acc_year != null and acc_year !=''">
				and asubj.acc_year = #{acc_year}
			</if>
			<if test ="subj_code != null and subj_code !=''">
				and asubj.subj_code = #{subj_code}
			</if>
		</where>
	</select>
	
	<select id="queryAccLederBySubjCode" resultMap="accLeder" parameterType="java.util.Map">
		SELECT
			group_id,
			hos_id,
			copy_code,
			acc_year,
			acc_month,
			subj_code,
			bal_os,
			this_od,
			this_oc,
			sum_od,
			sum_oc,
			end_os,
			bal_os_w,
			this_od_w,
			this_oc_w,
			sum_od_w,
			sum_oc_w,
			end_os_w
		FROM acc_leder
		<where>
			<if test ="group_id != null and group_id !=''" >
				and group_id = #{group_id}
			</if>
			<if test ="hos_id != null and hos_id !=''" >
				and hos_id = #{hos_id}
			</if>
			<if test ="copy_code != null and copy_code !=''">
				and copy_code = #{copy_code}
			</if>
			<if test ="acc_year != null and acc_year !=''">
				and acc_year = #{acc_year}
			</if>
			<if test ="acc_month != null and acc_month !=''">
				and acc_month = #{acc_month}
			</if>
			<if test ="year_month != null and year_month !=''">
				and acc_month != '00'
			</if>
			<if test ="subj_code != null and subj_code !=''">
				and subj_code in (${subj_code}) 
			</if>
		</where>
	</select>
	
	<select id="queryAccLeder" parameterType="java.util.Map" resultMap="accLeder1">

		SELECT a.group_id,a.hos_id,a.copy_code,a.acc_year,a.subj_code,a.subj_name,a.subj_name_all,a.subj_level,
			a.subj_dire, a.is_last,a.cur_code, SUM(bal_os) AS bal_os, SUM(sum_od) AS sum_od, SUM(sum_oc) AS sum_oc, SUM(end_os) AS end_os
		FROM (
			SELECT  b1.subj_code, SUM(bal_os) AS bal_os, SUM(sum_od) AS sum_od, SUM(sum_oc) AS sum_oc
		      	, SUM(end_os) AS end_os
		    FROM acc_subj b1 
		    ${is_bal_show} JOIN acc_leder b2 ON b1.group_id = b2.group_id
			    AND b1.hos_id = b2.hos_id
			    AND b1.copy_code = b2.copy_code
			    AND b1.acc_year = b2.acc_year
			    AND b1.subj_code = b2.subj_code 
			    and b2.acc_month='00'
		  	<where>
			  	<if test="group_id != null and group_id != ''">
	            	AND b1.group_id = #{group_id}
	          	</if>
	          	<if test="hos_id != null and hos_id != ''">
	            	AND b1.hos_id = #{hos_id}
	          	</if>
	          	<if test="copy_code != null and copy_code != ''">
	            	AND b1.copy_code = #{copy_code}
	          	</if>
	          	<if test="acc_year != null and acc_year != ''">
	            	AND b1.acc_year = #{acc_year}
	          	</if>
	          	<if test="subj_code != null and subj_code != ''">
	           	 	AND b1.subj_code like '${subj_code}%'
	          	</if>
	          	<if test="is_check != null and is_check != ''">
	            	AND b1.is_check = #{is_check}
	          	</if>
	          		and b1.is_stop = 0
		  	</where>
		  	GROUP BY b1.subj_code
		) b
		LEFT JOIN acc_subj a ON b.subj_code LIKE (a.subj_code || '%') and a.is_stop = 0
		<where>
		  	<if test="group_id != null and group_id != ''">
            	AND a.group_id = #{group_id}
          	</if>
          	<if test="hos_id != null and hos_id != ''">
            	AND a.hos_id = #{hos_id}
          	</if>
          	<if test="copy_code != null and copy_code != ''">
            	AND a.copy_code = #{copy_code}
          	</if>
          	<if test="acc_year != null and acc_year != ''">
           	 	AND a.acc_year = #{acc_year}
          	</if>
          	<if test="subj_code != null and subj_code != ''">
            	AND a.subj_code like '${subj_code}%'
          	</if>
          	<if test="is_check != null and is_check != ''">
            	AND a.is_check = #{is_check}
          	</if>
		  </where>
		 GROUP BY a.group_id,a.hos_id,a.copy_code,a.acc_year,a.subj_code,a.subj_name_all,a.subj_name,a.subj_level,a.subj_dire, a.is_last，a.cur_code
	 	order by a.subj_code asc
	</select>
	
	<select id="queryDeptDict" resultMap="map">
		SELECT
			dept_id||'.'||dept_no dept_code,
			dept_code||' '||dept_name dept_name
		FROM HOS_DEPT_DICT
		<where>
				is_stop = 0 
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="is_last != null  and is_last != ''">
				and is_last = #{is_last}
			</if>
			<if test="is_stop != null  and is_stop != ''">
				and is_stop = #{is_stop}
			</if>
			<if test=" key != null  and  key != ''">
				and (
					dept_code like '%${key}%' or
					dept_name like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by dept_id
	</select>
	
	<select id="queryEmp" resultMap="map">
		SELECT
			emp_id||'.'||emp_no emp_code,
			emp_code||' '||emp_name emp_name
		FROM HOS_EMP_DICT
		<where>
				is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and dept_id = #{dept_id}
			</if>
			<if test="key != null and key != ''">
				and (
					emp_code like '%${key}%' or
					emp_name like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by emp_code
	</select>
	
	<select id="queryProjDictDict" resultMap="map">
		SELECT
			proj_id||'.'||proj_no proj_code,
			proj_code||' '||proj_name proj_name
		FROM HOS_PROJ_DICT
		<where>
				is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
					proj_code like '%${key}%' or
					proj_name like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by proj_code
	</select>
	
	<select id="queryStoreDictDict" resultMap="map">
		SELECT
			store_id||'.'||store_no store_code,
			store_code||' '||store_name store_name
		FROM HOS_STORE_DICT
		<where>
				is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
					store_code like '%${key}%' or
					store_name like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by store_code
	</select>
	
	<select id="querySupDictDict" resultMap="map">
		SELECT
			sup_id||'.'||sup_no sup_code,
			sup_code||' '||sup_name sup_name
		FROM HOS_SUP_DICT
		<where>
				is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
					sup_code like '%${key}%' or
					sup_name like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by sup_code
	</select>
	
	<select id="queryCusDict" resultMap="map">
		SELECT
			cus_id||'.'||cus_no cus_code,
			cus_code||' '||cus_name cus_name
		FROM HOS_CUS_DICT
		<where>
				is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key != ''">
				and (
					cus_id like '%${key}%' or
					cus_name like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by cus_id
	</select>
	
	<select id="querySourceDict" resultMap="map">
		SELECT
		<!-- source_code||'.'|| -->SOURCE_ID source_code,
			source_code||' '||source_name source_name
		FROM HOS_SOURCE
		<where>
				is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key  != ''">
				and (
					source_code like '%${key}%' or
					source_name like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by source_code
	</select>
	
	<select id="queryHosInfo" resultMap="map">
		SELECT
			hos_id hos_code,
			HOS_CODE||' '||HOS_NAME hos_name
		FROM v_hos_dict
		<where>
				is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = (${hos_id})
			</if>
			<if test="key != null and key != ''">
				and (
					HOS_CODE like '%${key}%' or
					HOS_NAME like '%${key}%'
				)
			</if>
		</where>
		order by HOS_CODE
	</select>
	
	<select id="queryCheckItem" resultMap="map">
		SELECT
			CHECK_ITEM_ID check_item_code,
			CHECK_ITEM_CODE||' '||CHECK_ITEM_NAME check_item_name
		FROM ACC_CHECK_ITEM
		<where>
				is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="check_type_id != null  and check_type_id != ''">
				and check_type_id in (${check_type_id})
			</if>
			<if test="key != null and key != ''">
				and (
					CHECK_ITEM_CODE like '%${key}%' or
					CHECK_ITEM_NAME like '%${key}%' or
					spell_code like '%${key}%' or
					wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by CHECK_ITEM_CODE
	</select>
	
	<select id="queryModByModCode" parameterType="java.util.Map" resultMap="accLeder">

		SELECT start_month
		FROM sys_mod_start
		WHERE
			mod_code ='01'
		and group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}

	</select>
	
	<select id="queryGridTitle"  parameterType="java.util.Map" resultMap="accLeder">
		SELECT 
		 	t1.check_type_name AS check_type_name1,
		 	t1.check_type_id AS check_type_id1,  
		 	t1.column_name AS column_check1, 
		 	t1.column_code AS check1,
		 	t1.column_check AS column_item1,
		 	t2.check_type_name AS check_type_name2, 
		 	t2.check_type_id AS check_type_id2,  
		 	t2.column_name AS column_check2,
		 	t2.column_code AS check2, 
		 	t2.column_check AS column_item2,
			t3.check_type_name AS check_type_name3, 
			t3.check_type_id AS check_type_id3,  
			t3.column_name AS column_check3, 
			t3.column_code AS check3,
			t3.column_check AS column_item3,
			t4.check_type_name AS check_type_name4, 
			t4.check_type_id AS check_type_id4,  
			t4.column_name AS column_check4,
			t4.column_code AS check4,
			t4.column_check AS column_item4
		from  acc_subj asubj
		LEFT JOIN acc_check_type t1 ON asubj.check1 = t1.check_type_id and asubj.group_id = t1.group_id 
			and asubj.hos_id = t1.hos_id and asubj.copy_code = t1.copy_code
		LEFT JOIN acc_check_type t2 ON asubj.check2 = t2.check_type_id and asubj.group_id = t2.group_id 
			and asubj.hos_id = t2.hos_id and asubj.copy_code = t2.copy_code
		LEFT JOIN acc_check_type t3 ON asubj.check3 = t3.check_type_id and asubj.group_id = t3.group_id 
			and asubj.hos_id = t3.hos_id and asubj.copy_code = t3.copy_code
		LEFT JOIN acc_check_type t4 ON asubj.check4 = t4.check_type_id and asubj.group_id = t4.group_id 
			and asubj.hos_id = t4.hos_id and asubj.copy_code = t4.copy_code
		<where>
			asubj.is_stop = 0  and asubj.is_last= 1
			<if test="group_id != null  and group_id != ''">
				and asubj.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and asubj.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and asubj.copy_code = #{copy_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and asubj.acc_year = #{acc_year}
			</if>
			<if test="subj_code != null  and subj_code != ''">
				and asubj.subj_code = #{subj_code}
			</if>
			and asubj.is_stop = 0
		</where>
	
	</select>
	
	<!-- 查询核算项表 及字段信息  -->
	<select id="queryCheckItemTable"  parameterType="java.util.Map"	resultType="java.util.Map">
		select ( 
			select check_table 
            from acc_check_type  a 
            left join acc_subj b  on  a.group_id = b.group_id  
            	and a.hos_id = b.hos_id  and a.copy_code = b.copy_code and a.check_type_id = b.check1
            where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.subj_code = ${subj_code}
            and b.acc_year= #{acc_year}
        ) as table1 ,
        (   select column_id 
            from acc_check_type  a 
            left join acc_subj b on  a.group_id = b.group_id  
            	and a.hos_id = b.hos_id  and a.copy_code = b.copy_code and a.check_type_id = b.check1
            where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code} 
        ) as column_id1 ,
        ( 
          select column_no 
          from acc_check_type  a 
          left join acc_subj b on  a.group_id = b.group_id  
          		and a.hos_id = b.hos_id  and a.copy_code = b.copy_code and a.check_type_id = b.check1
          where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
          and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code} 
        ) as column_no1 ,
        ( 
        	select check1  from   acc_subj b  
        	where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code} 
        ) as check_type_id1,
        ( 
        	select column_code 
          	from acc_check_type  a 
          	left join acc_subj b  on  a.group_id = b.group_id  and a.hos_id = b.hos_id 
          		and a.copy_code = b.copy_code  and a.check_type_id = b.check1
         	where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
         	and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code} 
        ) as column_code1 ,
        ( select column_name 
          from acc_check_type  a 
          left join acc_subj b  on  a.group_id = b.group_id and a.hos_id = b.hos_id 
            and a.copy_code = b.copy_code and a.check_type_id = b.check1
          where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
          and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code} 
        ) as column_name1 ,
        ( 
        	select column_check 
            from acc_check_type  a 
            left join acc_subj b  on  a.group_id = b.group_id  and a.hos_id = b.hos_id 
                and a.copy_code = b.copy_code  and a.check_type_id = b.check1
            where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code} 
        ) as column_check1 ,
        ( select check_table 
          from acc_check_type  a 
          left join acc_subj b  on  a.group_id = b.group_id  
          	and a.hos_id = b.hos_id  and a.copy_code = b.copy_code 
            and a.check_type_id = b.check2
          where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
          	and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code} 
        ) as table2 ,
        ( select column_id 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check2
                      where b.group_id=#{group_id}
			            and b.hos_id= #{hos_id}
			            and b.copy_code = #{copy_code}
                     	and b.acc_year= #{acc_year}
			            and b.subj_code = ${subj_code} 
                   ) as column_id2 ,
                ( select column_no 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check2
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_no2 ,
                   ( select check2 
                    from   acc_subj b 
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as check_type_id2 ,
                ( select column_code 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check2
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
			and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_code2 ,
                ( select column_name 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check2
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
			and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_name2 ,
                ( select column_check 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check2
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
			and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_check2 ,
          ( select check_table 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check3
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as table3,
                ( select column_id 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check3
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
       		and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_id3 ,
                ( select column_no 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check3
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_no3 ,
                   ( select check3 
                    from   acc_subj b 
                     where b.group_id=#{group_id}
		            and b.hos_id= #{hos_id}
		            and b.copy_code = #{copy_code}
		            and b.acc_year= #{acc_year}
		            and b.subj_code = ${subj_code} 
		            
                   ) as check_type_id3 ,
                 ( select column_code 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check3
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.subj_code = ${subj_code}
                     and b.acc_year= #{acc_year}
                   ) as column_code3 ,
                ( select column_name 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check3
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_name3 ,
                ( select column_check 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check3
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_check3 ,
           ( select check_table 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check4
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as table4 ,
                ( select column_id 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check4
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_id4 ,
                ( select column_no 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check4
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_no4 ,
                   ( select check4 
                    from   acc_subj b 
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as check_type_id4 ,
               ( select column_code 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check4
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_code4 ,
                ( select column_name 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check4
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_name4 ,
                ( select column_check 
                    from acc_check_type  a 
                    left join acc_subj b 
                    on  a.group_id = b.group_id  
                        and a.hos_id = b.hos_id 
                        and a.copy_code = b.copy_code 
                        and a.check_type_id = b.check4
                     where b.group_id=#{group_id}
            and b.hos_id= #{hos_id}
            and b.copy_code = #{copy_code}
            and b.acc_year= #{acc_year}
            and b.subj_code = ${subj_code}
                   ) as column_check4          
                   from dual
	</select>
	
	<select id="queryAccLederCheckList"  parameterType="java.util.Map" 	resultMap="paraMap">
		SELECT alc.group_id, alc.hos_id, alc.copy_code, alc.acc_year ,alc.bal_os,alc.sum_od,alc.sum_oc,alc.end_os
			<if test=" COLUMN_NAME1 != null and COLUMN_NAME1 != '' and  COLUMN_NO1 != ''">
			,a.${COLUMN_ID1} ||'.'|| a.${COLUMN_NO1} as value1
			,a.${COLUMN_CODE1} ||' '|| a.${COLUMN_NAME1} as check1
			</if>
			<if test=" COLUMN_NAME1 != null and COLUMN_NAME1 != '' and  COLUMN_NO1 == ''">
			,a.${COLUMN_ID1}  as value1
			,a.${COLUMN_CODE1} ||' '|| a.${COLUMN_NAME1} as check1
			</if>
			<if test=" COLUMN_NAME2 != null and COLUMN_NAME2 != '' and COLUMN_NO2 != '' ">
			,b.${COLUMN_ID2} ||'.'|| b.${COLUMN_NO2} as value2
			, b.${COLUMN_CODE2} ||' '|| b.${COLUMN_NAME2} as check2
			</if>
			<if test=" COLUMN_NAME2 != null and COLUMN_NAME2 != '' and COLUMN_NO2 == '' ">
			,b.${COLUMN_ID2}  as value2
			, b.${COLUMN_CODE2} ||' '|| b.${COLUMN_NAME2} as check2
			</if>
			<if test=" COLUMN_NAME3 != null and COLUMN_NAME3 != '' and COLUMN_NO3 != '' ">
			,c.${COLUMN_ID3} ||'.'|| c.${COLUMN_NO3} as value3
			, c.${COLUMN_CODE3} ||' '||  c.${COLUMN_NAME3} as check3
			</if>
			<if test=" COLUMN_NAME3 != null and COLUMN_NAME3 != '' and  COLUMN_NO3 == '' ">
			,c.${COLUMN_ID3}  as value3
			, c.${COLUMN_CODE3} ||' '||  c.${COLUMN_NAME3} as check3
			</if>
			<if test=" COLUMN_NAME4 != null and COLUMN_NAME4 != '' and COLUMN_NO4 != '' ">
			,d.${COLUMN_ID4} ||'.'|| d.${COLUMN_NO4} as value4
			, d.${COLUMN_CODE4} ||' '|| d.${COLUMN_NAME4} as check4
			</if>
			<if test=" COLUMN_NAME4 != null and COLUMN_NAME4 != '' and  COLUMN_NO4 == '' ">
			,d.${COLUMN_ID4} as value4
			, d.${COLUMN_CODE4} ||' '|| d.${COLUMN_NAME4} as check4
			</if>
		FROM acc_leder_check alc 
		<if test="TABLE1 != NULL and TABLE1 != '' ">
			left join  ${TABLE1}   a
			on  alc.group_id = a.group_id 
				and alc.hos_id = a.hos_id
			<if test=" TABLE1 =='ACC_CHECK_ITEM' ">
				and alc.copy_code = a.copy_code
			</if>
    			and  alc.${COLUMN_CHECK1} = a.${COLUMN_ID1}
    		<if test=" TABLE1 !='ACC_CHECK_ITEM' and COLUMN_NO1 != '' and COLUMN_CHECK1_NO != ''">
				and  alc.${COLUMN_CHECK1_NO} = a.${COLUMN_NO1}
			</if>
		</if>
		<if test="TABLE2 != NULL and TABLE1 != '' ">
			left join  ${TABLE2}   b on   alc.group_id = b.group_id 
			and alc.hos_id = b.hos_id
    		<if test=" TABLE2 == 'ACC_CHECK_ITEM' ">
			and alc.copy_code = b.copy_code
			</if>
    		and  alc.${COLUMN_CHECK2} = b.${COLUMN_ID2}
    		<if test=" TABLE2 !='ACC_CHECK_ITEM' and COLUMN_NO2 != '' and COLUMN_CHECK2_NO != ''">
			and  alc.${COLUMN_CHECK2_NO} = b.${COLUMN_NO2}
			</if>
		</if>
		<if test="TABLE3 != NULL and TABLE3 != '' ">
			left join  ${TABLE3}   c on   alc.group_id = c.group_id 
			and alc.hos_id = c.hos_id
    		<if test=" TABLE3 =='ACC_CHECK_ITEM' ">
			and alc.copy_code = c.copy_code
			</if>
    		and  alc.${COLUMN_CHECK3} = c.${COLUMN_ID3}
    		<if test=" TABLE3 !='ACC_CHECK_ITEM' and COLUMN_NO3 != '' and COLUMN_CHECK3_NO != ''">
			and  alc.${COLUMN_CHECK3_NO} = c.${COLUMN_NO3}
			</if>
		</if>
		<if test="TABLE4 != NULL and TABLE4 != '' ">
			left join  ${TABLE4}   d
		on  
			alc.group_id = d.group_id 
			and alc.hos_id = d.hos_id
    		<if test=" TABLE4 =='ACC_CHECK_ITEM' ">
			and alc.copy_code = d.copy_code
			</if> 
    		and  alc.${COLUMN_CHECK4} = d.${COLUMN_ID4}
    		<if test=" TABLE4 !='ACC_CHECK_ITEM' and COLUMN_NO4 != '' and COLUMN_CHECK4_NO != ''">
			and  alc.${COLUMN_CHECK4_NO} = d.${COLUMN_NO4}
			</if>
		</if>
	<where>
		 alc.acc_month='00'
		<if test="group_id != null  and group_id != ''">
			and alc.group_id = #{group_id}
		</if>
		<if test="hos_id != null  and hos_id != ''">
			and alc.hos_id = #{hos_id}
		</if>
		<if test="copy_code != null  and copy_code != ''">
			and alc.copy_code = #{copy_code}
		</if>
		<if test="subj_code != null  and subj_code != ''">
			and alc.subj_code = #{subj_code}
		</if>
		<if test="acc_year != null  and acc_year != ''">
			and alc.acc_year = #{acc_year}
		</if>
	</where>
	
	</select>
	
	<!-- 辅助核算明细打印用 -->
	<select id="queryAccLederCheckListPrint" parameterType="java.util.Map" resultMap="paraMap">
		SELECT alc.group_id, alc.hos_id, alc.copy_code, alc.acc_year, alc.bal_os, alc.sum_od, alc.sum_oc, alc.end_os
			   <if test=" COLUMN_NAME1 != null and COLUMN_NAME1 != '' and  COLUMN_NO1 != ''">
<!-- 			   , a.${COLUMN_ID1} ||'.'|| a.${COLUMN_NO1} as value1 -->
			       , a.${COLUMN_CODE1} ||' '|| a.${COLUMN_NAME1} as value1
			   </if>
			   <if test=" COLUMN_NAME1 != null and COLUMN_NAME1 != '' and  COLUMN_NO1 == ''">
<!-- 			   , a.${COLUMN_ID1}  as value1 -->
			       , a.${COLUMN_CODE1} ||' '|| a.${COLUMN_NAME1} as value1
			   </if>
			   <if test=" COLUMN_NAME2 != null and COLUMN_NAME2 != '' and COLUMN_NO2 != '' ">
<!-- 			   , b.${COLUMN_ID2} ||'.'|| b.${COLUMN_NO2} as value2 -->
			       , b.${COLUMN_CODE2} ||' '|| b.${COLUMN_NAME2} as value2
			   </if>
			   <if test=" COLUMN_NAME2 != null and COLUMN_NAME2 != '' and COLUMN_NO2 == '' ">
<!-- 			   , b.${COLUMN_ID2}  as value2 -->
			       , b.${COLUMN_CODE2} ||' '|| b.${COLUMN_NAME2} as value2
			   </if>
			   <if test=" COLUMN_NAME3 != null and COLUMN_NAME3 != '' and COLUMN_NO3 != '' ">
<!-- 			   , c.${COLUMN_ID3} ||'.'|| c.${COLUMN_NO3} as value3 -->
			       , c.${COLUMN_CODE3} ||' '||  c.${COLUMN_NAME3} as value3
			   </if>
			   <if test=" COLUMN_NAME3 != null and COLUMN_NAME3 != '' and  COLUMN_NO3 == '' ">
<!-- 			   , c.${COLUMN_ID3}  as value3 -->
			       , c.${COLUMN_CODE3} ||' '||  c.${COLUMN_NAME3} as value3
			   </if>
			   <if test=" COLUMN_NAME4 != null and COLUMN_NAME4 != '' and COLUMN_NO4 != '' ">
<!-- 			   , d.${COLUMN_ID4} ||'.'|| d.${COLUMN_NO4} as value4 -->
			       , d.${COLUMN_CODE4} ||' '|| d.${COLUMN_NAME4} as value4
			   </if>
			   <if test=" COLUMN_NAME4 != null and COLUMN_NAME4 != '' and  COLUMN_NO4 == '' ">
<!-- 			   , d.${COLUMN_ID4} as value4 -->
			       , d.${COLUMN_CODE4} ||' '|| d.${COLUMN_NAME4} as value4
			   </if>
		FROM acc_leder_check alc 
		<if test="TABLE1 != NULL and TABLE1 != '' ">
			left join ${TABLE1} a
			       on alc.group_id = a.group_id 
				  and alc.hos_id = a.hos_id
    			  and alc.${COLUMN_CHECK1} = a.${COLUMN_ID1}
			      <if test=" TABLE1 =='ACC_CHECK_ITEM' ">
				     and alc.copy_code = a.copy_code
			      </if>
    		      <if test=" TABLE1 !='ACC_CHECK_ITEM' and COLUMN_NO1 != '' and COLUMN_CHECK1_NO != ''">
				      and alc.${COLUMN_CHECK1_NO} = a.${COLUMN_NO1}
			      </if>
		</if>
		<if test="TABLE2 != NULL and TABLE1 != '' ">
			left join ${TABLE2} b 
			       on alc.group_id = b.group_id 
			      and alc.hos_id = b.hos_id
    		      and alc.${COLUMN_CHECK2} = b.${COLUMN_ID2}
    		      <if test=" TABLE2 == 'ACC_CHECK_ITEM' ">
			          and alc.copy_code = b.copy_code
			      </if>
    		      <if test=" TABLE2 !='ACC_CHECK_ITEM' and COLUMN_NO2 != '' and COLUMN_CHECK2_NO != ''">
			          and  alc.${COLUMN_CHECK2_NO} = b.${COLUMN_NO2}
			      </if>
		</if>
		<if test="TABLE3 != NULL and TABLE3 != '' ">
			left join ${TABLE3} c 
			       on alc.group_id = c.group_id 
			      and alc.hos_id = c.hos_id
    		      and alc.${COLUMN_CHECK3} = c.${COLUMN_ID3}
    		      <if test=" TABLE3 =='ACC_CHECK_ITEM' ">
			          and alc.copy_code = c.copy_code
			      </if>
    		      <if test=" TABLE3 !='ACC_CHECK_ITEM' and COLUMN_NO3 != '' and COLUMN_CHECK3_NO != ''">
			          and alc.${COLUMN_CHECK3_NO} = c.${COLUMN_NO3}
			      </if>
		</if>
		<if test="TABLE4 != NULL and TABLE4 != '' ">
			left join ${TABLE4} d
		           on alc.group_id = d.group_id 
			      and alc.hos_id = d.hos_id
    		      and alc.${COLUMN_CHECK4} = d.${COLUMN_ID4}
    		      <if test=" TABLE4 =='ACC_CHECK_ITEM' ">
			          and alc.copy_code = d.copy_code
			      </if> 
    		      <if test=" TABLE4 !='ACC_CHECK_ITEM' and COLUMN_NO4 != '' and COLUMN_CHECK4_NO != ''">
			          and alc.${COLUMN_CHECK4_NO} = d.${COLUMN_NO4}
			      </if>
		</if>
		<where>
			alc.acc_month='00'
			<if test="group_id != null  and group_id != ''">
				and alc.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and alc.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and alc.copy_code = #{copy_code}
			</if>
			<if test="subj_code != null  and subj_code != ''">
				and alc.subj_code = #{subj_code}
			</if>
			<if test="acc_year != null  and acc_year != ''">
				and alc.acc_year = #{acc_year}
			</if>
		</where>
	</select>
	
	<select id="queryAccLederIndex"  parameterType="java.util.Map" resultMap="accLeder">
		select a.group_id,a.hos_id,a.copy_code,
			a.subj_code,to_char(a.subj_name) as subj_name,a.subj_type_code,
			sum(debit) debit, sum(credit) credit
		from (
			select b2.subj_code,
				sum(case when b2.subj_dire=0 then b1.bal_os+sum_od-sum_oc else 0 end  ) as debit, 
				sum(case when b2.subj_dire=1 then b1.bal_os-sum_od+sum_oc else 0 end ) as credit
			from acc_leder b1
			left join acc_subj b2 on b1.group_id=b2.group_id
				and b1.hos_id=b2.hos_id
				and b1.copy_code=b2.copy_code
				and b1.subj_code=b2.subj_code
		    	and b1.acc_year=b2.acc_year
		    	and b2.is_stop=0
			<where>
			 		b1.acc_month='00'
				and b1.group_id = #{group_id}
				and b1.hos_id = #{hos_id}
				and b1.copy_code = #{copy_code}
				and b1.acc_year = #{acc_year}
				<if test="subj_type_code != null  and subj_type_code != ''">
					and b2.subj_type_code = #{subj_type_code}
				</if>
			</where>
			group by b2.subj_code
		) b 
		left join  acc_subj a on b.subj_code like a.subj_code||'%' and a.is_stop = 0
		<where>
				a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			and a.acc_year = #{acc_year}
			<if test="subj_level != null  and subj_level != ''">
				and a.subj_level   &lt;= #{subj_level}
			</if>
		</where>
		group by a.group_id,a.hos_id,a.copy_code,a.subj_code,a.subj_name,a.subj_type_code
		union all
		select b1.group_id,b1.hos_id,b1.copy_code,'' as subj_code,to_char(b3.subj_type_name) as subj_name,
	 		b2.subj_type_code,
			sum(case when b2.subj_dire=0 then b1.bal_os+sum_od-sum_oc else 0 end  ) as debit, 
			sum(case when b2.subj_dire=1 then b1.bal_os-sum_od+sum_oc else 0 end ) as credit
	 	from acc_leder b1
		left join acc_subj b2 on b1.group_id=b2.group_id
			and b1.hos_id=b2.hos_id
			and b1.copy_code=b2.copy_code
			and b1.subj_code=b2.subj_code
			and b1.acc_year=b2.acc_year
			and b2.is_stop = 0
		left join acc_subj_type b3 on b1.group_id=b3.group_id
			and b1.hos_id=b3.hos_id
			and b1.copy_code=b3.copy_code
			and b2.subj_type_code=b3.subj_type_code
		<where>
	 			b1.acc_month='00'
			and b1.group_id = #{group_id}
			and b1.hos_id = #{hos_id}
			and b1.copy_code = #{copy_code}
			and b1.acc_year = #{acc_year}
			<if test="subj_type_code != null  and subj_type_code != ''">
				and b2.subj_type_code = #{subj_type_code}
			</if>
		</where>
		group by b1.group_id,b1.hos_id,b1.copy_code,b3.subj_type_name ,b2.subj_type_code
	 	union all
	 	select b1.group_id,b1.hos_id,b1.copy_code,'' as subj_code,to_char('合计') as subj_name,
	 		'09' as subj_type_code,
			sum(case when b2.subj_dire=0 then b1.bal_os+sum_od-sum_oc else 0 end  ) as debit, 
			sum(case when b2.subj_dire=1 then b1.bal_os-sum_od+sum_oc else 0 end ) as credit
	 	from acc_leder b1
		left join acc_subj b2 on  b1.group_id=b2.group_id
			and b1.hos_id=b2.hos_id
			and b1.copy_code=b2.copy_code
			and b1.subj_code=b2.subj_code
			and b1.acc_year=b2.acc_year
		left join acc_subj_type b3 on b1.group_id=b3.group_id
			and b1.hos_id=b3.hos_id
			and b1.copy_code=b3.copy_code
			and b2.subj_type_code=b3.subj_type_code
		<where>
	 			b1.acc_month='00'
			and b1.group_id = #{group_id}
			and b1.hos_id = #{hos_id}
			and b1.copy_code = #{copy_code}
			and b1.acc_year = #{acc_year}
			<if test="subj_type_code != null  and subj_type_code != ''">
				and b2.subj_type_code = #{subj_type_code}
			</if>
		</where>
		group by b1.group_id,b1.hos_id,b1.copy_code
	 	order by subj_type_code,subj_code
	</select>
	
	<!-- 	打印用 -->
	<select id="queryAccLederIndex1"  parameterType="java.util.Map" resultMap="accLeder1">
		select a.group_id,a.hos_id,a.copy_code,a.subj_code,to_char(a.subj_name) as subj_name,a.subj_type_code,
			sum(debit) debit, sum(credit) credit
		from (
			select b2.subj_code,
				sum(case when b2.subj_dire=0 then b1.bal_os+sum_od-sum_oc else 0 end  ) as debit, 
				sum(case when b2.subj_dire=1 then b1.bal_os-sum_od+sum_oc else 0 end ) as credit
	 		from acc_leder b1
			left join acc_subj b2 on b1.group_id=b2.group_id
				and b1.hos_id=b2.hos_id
				and b1.copy_code=b2.copy_code
				and b1.subj_code=b2.subj_code
			    and b1.acc_year=b2.acc_year
			    and b2.is_stop = 0
			<where>
	 				b1.acc_month='00'
				and b1.group_id = #{group_id}
				and b1.hos_id = #{hos_id}
				and b1.copy_code = #{copy_code}
				<if test="acc_year != null  and acc_year != ''">
					and b1.acc_year = #{acc_year}
				</if>
				<if test="subj_type_code != null  and subj_type_code != ''">
					and b2.subj_type_code = #{subj_type_code}
				</if>
			</where>
			group by b2.subj_code
		) b 
		left join  acc_subj a on  b.subj_code like a.subj_code||'%' and a.is_stop = 0
		<where>
				 a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="acc_year != null  and acc_year != ''">
				and a.acc_year = #{acc_year}
			</if>
			<if test="subj_level != null  and subj_level != ''">
				and a.subj_level   &lt;= #{subj_level}
			</if>
		</where>
		group by a.group_id,a.hos_id,a.copy_code,a.subj_code,a.subj_name,a.subj_type_code
		union all
		select b1.group_id,b1.hos_id,b1.copy_code,'' as subj_code,to_char(b3.subj_type_name) as subj_name,
	 		b2.subj_type_code,
			sum(case when b2.subj_dire=0 then b1.bal_os+sum_od-sum_oc else 0 end  ) as debit, 
			sum(case when b2.subj_dire=1 then b1.bal_os-sum_od+sum_oc else 0 end ) as credit
	 	from acc_leder b1
		left join acc_subj b2 on b1.group_id=b2.group_id
			and b1.hos_id=b2.hos_id
			and b1.copy_code=b2.copy_code
			and b1.subj_code=b2.subj_code
			and b1.acc_year=b2.acc_year
			and b2.is_stop = 0
		left join acc_subj_type b3 on b1.group_id=b3.group_id
			and b1.hos_id=b3.hos_id
			and b1.copy_code=b3.copy_code
			and b2.subj_type_code=b3.subj_type_code
		<where>
	 			b1.acc_month='00'
			and b1.group_id = #{group_id}
			and b1.hos_id = #{hos_id}
			and b1.copy_code = #{copy_code}
			<if test="acc_year != null  and acc_year != ''">
				and b1.acc_year = #{acc_year}
			</if>
			<if test="subj_type_code != null  and subj_type_code != ''">
				and b2.subj_type_code = #{subj_type_code}
			</if>
		</where>
		group by b1.group_id,b1.hos_id,b1.copy_code,b3.subj_type_name , b2.subj_type_code
	 	union all
	 	select b1.group_id,b1.hos_id,b1.copy_code,'' as subj_code,to_char('合计') as subj_name,
	 		'09' as subj_type_code,
			sum(case when b2.subj_dire=0 then b1.bal_os+sum_od-sum_oc else 0 end  ) as debit, 
			sum(case when b2.subj_dire=1 then b1.bal_os-sum_od+sum_oc else 0 end ) as credit
	 	from acc_leder b1
		left join acc_subj b2 on b1.group_id=b2.group_id
			and b1.hos_id=b2.hos_id
			and b1.copy_code=b2.copy_code
			and b1.subj_code=b2.subj_code
			and b1.acc_year=b2.acc_year
		left join acc_subj_type b3 on b1.group_id=b3.group_id
			and b1.hos_id=b3.hos_id
			and b1.copy_code=b3.copy_code
			and b2.subj_type_code=b3.subj_type_code
		<where>
	 			b1.acc_month='00'
			and b1.group_id = #{group_id}
			and b1.hos_id = #{hos_id}
			and b1.copy_code = #{copy_code}
			<if test="acc_year != null  and acc_year != ''">
				and b1.acc_year = #{acc_year}
			</if>
			<if test="subj_type_code != null  and subj_type_code != ''">
				and b2.subj_type_code = #{subj_type_code}
			</if>
		</where>
		group by b1.group_id,b1.hos_id,b1.copy_code
	 	order by subj_type_code,subj_code
	</select>
	
	<select id="queryAccCheckItemList" resultType="java.util.Map" parameterType="java.util.Map">
      
       SELECT
	    act1.check_type_name check1_name,
	    act1.column_check column1_check,
	    act1.check_table check1_table,
	    act1.column_id column1_id,
	    act1.column_no column1_no,
      	act1.column_code column1_code,
	    act1.column_name column1_name,
	    act1.check_type_id check1_type_id,
	    act2.check_type_name check2_name,
	    act2.column_check column2_check,
	    act2.check_table check2_table,
	    act2.column_id column2_id,
	    act2.column_no column2_no,
      	act2.column_code column2_code,
	    act2.column_name column2_name,
	    act2.check_type_id check2_type_id,
	    act3.check_type_name check3_name,
	    act3.column_check column3_check,
	    act3.check_table check3_table,
        act3.column_id column3_id,
        act3.column_no column3_no,
        act3.column_code column3_code,
        act3.column_name column3_name,
        act3.check_type_id check3_type_id,
        act4.check_type_name check4_name,
        act4.column_check column4_check,
        act4.check_table check4_table,
        act4.column_id column4_id,
        act4.column_no column4_no,
        act4.column_code column4_code,
        act4.column_name column4_name,
        act4.check_type_id check4_type_id
	    FROM ACC_SUBJ asubj
	    left join ACC_CHECK_TYPE act1 on asubj.GROUP_ID = act1.GROUP_ID AND asubj.HOS_ID = act1.HOS_ID AND asubj.COPY_CODE = act1.COPY_CODE AND asubj.check1 = act1.CHECK_TYPE_ID
	    left join ACC_CHECK_TYPE act2 on asubj.GROUP_ID = act2.GROUP_ID AND asubj.HOS_ID = act2.HOS_ID AND asubj.COPY_CODE = act2.COPY_CODE AND asubj.check2 = act2.CHECK_TYPE_ID
	    left join ACC_CHECK_TYPE act3 on asubj.GROUP_ID = act3.GROUP_ID AND asubj.HOS_ID = act3.HOS_ID AND asubj.COPY_CODE = act3.COPY_CODE AND asubj.check3 = act3.CHECK_TYPE_ID
	    left join ACC_CHECK_TYPE act4 on asubj.GROUP_ID = act4.GROUP_ID AND asubj.HOS_ID = act4.HOS_ID AND asubj.COPY_CODE = act4.COPY_CODE AND asubj.check4 = act4.CHECK_TYPE_ID      	
        <where>                    
			<if test="subj_code != null and subj_code != ''">
            	AND asubj.subj_code = #{subj_code}
            </if>
			<if test="group_id != null and group_id != ''">
                    AND asubj.group_id = #{group_id}
            </if>
			    <if test="hos_id != null and hos_id != ''">
                    AND asubj.hos_id = #{hos_id}
               </if>
			    <if test="copy_code != null and copy_code != ''">
                    AND asubj.copy_code = #{copy_code}
               </if>
			    <if test="acc_year != null and acc_year != ''">
                    AND asubj.acc_year = #{acc_year}
               </if>
               and asubj.is_stop = 0
        </where>   
		order by asubj.subj_code asc
    </select>
    
    <select id="queryAccCheckItem" resultType="java.util.Map" parameterType="java.util.Map">
       SELECT
       		<if test="column_id != null and column_id != ''">
              	${column_id}
       		</if>
	       <if test="column_no != null and column_no != ''">
	           ,${column_no}
	       </if>
	    FROM ${query_table}
	     <where>     
	     		and is_stop=0               
            AND group_id = #{group_id}
            AND hos_id = #{hos_id}
            <if test="column_code_value != null and column_code_value != '' or column_name_value != null and column_name_value != ''">
                and ${column_code} = #{column_code_value}
            </if>
            <if test="check_item_id != null and check_item_id != ''">
                AND ${check_item_id} = #{check_item_id}
            </if>
            <if test="check_type_id != null and check_type_id != ''">
                AND check_type_id = #{check_type_id}
            </if>
        </where>   
		order by ${column_id} asc
    </select>
    
    <select id="verifyAccLederIndex1" resultType="java.util.Map" parameterType="java.util.Map">
		select 
			a.group_id,
			a.hos_id,
			a.copy_code,
			a.acc_year,
			sum(case when b.subj_type_code='01' then ( case when b.subj_dire=0 then a.end_os else -1*a.end_os end) else 0 end) ass_money,  
			sum(case when b.subj_type_code='02' then ( case when b.subj_dire=1 then a.end_os else -1*a.end_os end) else 0 end) debt_money, 
			sum(case when b.subj_type_code='03' then (case when b.subj_dire=1 then a.end_os else -1*a.end_os end) else 0 end)  netass_money
 		from acc_leder a
		left join acc_subj b  on a.group_id=b.group_id
			and a.hos_id=b.hos_id
			and a.copy_code=b.copy_code
			and a.acc_year=b.acc_year
			and a.subj_code=b.subj_code
		<where>
		   	 	a.acc_month='00'
            AND a.group_id = #{group_id}
            AND a.hos_id = #{hos_id}
            AND a.copy_code = #{copy_code}
        	<if test="acc_year != null and acc_year != ''">
            	AND a.acc_year = #{acc_year}
        	</if>
		</where>
		group by a.group_id,a.hos_id, a.copy_code,a.acc_year
	 </select>
	 
	 
	 <select id="verifyAccLederIndex2" resultType="java.util.Map" parameterType="java.util.Map">
		select a.group_id,
			a.hos_id,
			a.copy_code,
			a.acc_year,
			SUM(CASE WHEN b.subj_dire = 0 THEN a.end_os ELSE 0 END) AS debit_money ,
	        SUM(CASE WHEN b.subj_dire = 1 THEN a.end_os ELSE 0 END) AS credit_money
        from acc_leder a
		left join acc_subj b on a.group_id=b.group_id
			and a.hos_id=b.hos_id
			and a.copy_code=b.copy_code
			and a.acc_year=b.acc_year
			and a.subj_code=b.subj_code
		<where>
		    	a.acc_month='00'
            AND a.group_id = #{group_id}
            AND a.hos_id = #{hos_id}
            AND a.copy_code = #{copy_code}
        	<if test="acc_year != null and acc_year != ''">
            	AND a.acc_year = #{acc_year}
        	</if>
		</where>
		group by a.group_id,a.hos_id,
		a.copy_code,a.acc_year
	 </select>
	 
	 
	  <select id="verifyAccLederIndex3" resultType="java.util.Map" parameterType="java.util.Map">
		select a.group_id,a.hos_id,a.copy_code,a.acc_year,a.subj_code,a.subj_name,
			nvl(b.leder_money,0) leder_money,nvl(c.leder_check_money,0) leder_check_money
		from  acc_subj a
		left join  (
			select a1.group_id,a1.hos_id,a1.copy_code,a1.acc_year,
				a2.subj_code,case when sum(a1.end_os)='' then 0 else sum(a1.end_os) end leder_money 
			from acc_leder a1
			left join acc_subj a2 on a1.group_id=a2.group_id
				and a1.hos_id=a2.hos_id
				and a1.copy_code=a2.copy_code
				and a1.acc_year=a2.acc_year
				and a1.subj_code =a2.subj_code
				and a2.is_stop = 0
			<where>
					a2.is_check=1 
				and a1.acc_month='00'
                AND a1.group_id = #{group_id}
                AND a1.hos_id = #{hos_id}
                AND a1.copy_code = #{copy_code}
          		<if test="acc_year != null and acc_year != ''">
                   AND a1.acc_year = #{acc_year}
         		</if>
			</where> 
			group by a1.group_id,a1.hos_id,a1.copy_code,a1.acc_year,a2.subj_code
		) b on a.group_id=b.group_id
			and a.hos_id=b.hos_id
			and a.copy_code= b.copy_code
			and a.acc_year=b.acc_year
			and a.subj_code=b.subj_code
		left join  (
			select  b1.group_id,b1.hos_id,b1.copy_code,b1.acc_year,b1.subj_code,
				sum(b1.end_os) leder_check_money
 			from acc_leder_check b1
 			<where>
		 			b1.acc_month='00'
            	AND b1.group_id = #{group_id}
                AND b1.hos_id = #{hos_id}
                AND b1.copy_code = #{copy_code}
          		<if test="acc_year != null and acc_year != ''">
                   AND b1.acc_year = #{acc_year}
         		</if>
				And b1.subj_code in ( select subj_code 
				                        from acc_subj 
									   where group_id = #{group_id}
									     and hos_id = #{hos_id}
										 and copy_code =  #{copy_code}
										 <if test="acc_year != null and acc_year != ''">
											AND b1.acc_year = #{acc_year}
										 </if>
										 and is_check = 1
				)
			</where>
			group by b1.group_id,b1.hos_id,b1.copy_code,b1.acc_year,b1.subj_code
		) c on a.group_id=c.group_id
			and a.hos_id=c.hos_id
			and a.copy_code= c.copy_code
			and a.acc_year=c.acc_year
			and a.subj_code=c.subj_code
       <where>
		 		nvl(b.leder_money,0)-nvl(c.leder_check_money,0) !=0
         	AND a.group_id = #{group_id}
            AND a.hos_id = #{hos_id}
            AND a.copy_code = #{copy_code}
          	<if test="acc_year != null and acc_year != ''">
            	AND a.acc_year = #{acc_year}
         	</if>
		</where>
	 </select>
	 
	 <select id="queryAccLaderByImp" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT count(*)
		FROM ACC_LEDER al 
		where al.acc_month != '00'
		 	 and al.subj_code =#{subj_code}
			 and al.group_id =#{group_id}
			 and al.hos_id = #{hos_id}
			 and al.copy_code =#{copy_code}
			 and al.acc_year = #{acc_year}
	 </select>
	 
	 
	 <insert id="addBatchAccLederByCheck" parameterType="java.util.List">
		insert into ACC_LEDER(
			group_id,
			hos_id,
			copy_code,
			acc_year,
			acc_month,
			subj_code,
			bal_os,
			this_od,
			this_oc,
			sum_oc,
			sum_od,
			end_os,
			bal_os_w,
			this_od_w,
			this_oc_w,
			sum_od_w,
			sum_oc_w,
			end_os_w
		)
		select a.group_id,a.hos_id,a.copy_code,a.acc_year,a.acc_month,a.subj_code,
			sum(nvl(a.bal_os,0)),sum(nvl(a.this_od,0)),sum(nvl(a.this_oc,0)),
			sum(nvl(a.sum_oc,0)),sum(nvl(a.sum_od,0)),
        	sum(nvl(a.end_os,0)),sum(nvl(a.bal_os_w,0)),sum(nvl(a.this_od_w,0)),sum(nvl(a.this_oc_w,0)),
        	sum(nvl(a.sum_od_w,0)),sum(nvl(a.sum_oc_w,0)),sum(nvl(a.end_os_w,0)) 
        from acc_leder_check a
        where a.group_id =#{group_id} and a.hos_id =#{hos_id} 
        	and a.copy_code = #{copy_code}
        	and a.acc_year= #{acc_year} and a.subj_code = #{subj_code} 
        	and a.acc_month='00'
		group by a.group_id,a.hos_id,a.copy_code,a.acc_year,a.acc_month,a.subj_code
	</insert>
	
	
	<insert id="addAccLederByCopy" parameterType="java.util.Map">
		insert into acc_leder (
			group_id,
		    hos_id,
		    copy_code,
		    acc_year,
		    acc_month,
		    subj_code,
		    bal_os,
		    this_od,
		    this_oc,
		   sum_od,
		   sum_oc,
		   end_os,
		   bal_os_w,
		   this_od_w,
		   this_oc_w,
		   sum_od_w,
		   sum_oc_w,
		   end_os_w) 
		  select al.group_id,
		         al.hos_id,
		         al.copy_code,
		         al.acc_year,
		         al.acc_month,
		         #{subj_code},
		         al.bal_os,
		         al.this_od,
		         al.this_oc,
		         al.sum_od,
		         al.sum_oc,
		         al.end_os,
		         al.bal_os_w,
		         al.this_od_w,
		         al.this_oc_w,
		         al.sum_od_w,
		         al.sum_oc_w,
		         al.end_os_w
		    from acc_leder al
		   where al.group_id = #{group_id}
		  	 and al.hos_id = #{hos_id}
		     and al.copy_code = #{copy_code}
		     and al.acc_year = #{acc_year}
		     and al.subj_code = #{super_subj_code}
	
	</insert>
	
	<delete id="deleteAccLederByCopy" parameterType="java.util.Map">
        DELETE FROM ACC_LEDER 
        WHERE group_id = #{group_id}   
        	and hos_id = #{hos_id}   
        	and copy_code = #{copy_code}
	        and acc_year = #{acc_year} 
	        and subj_code = #{super_subj_code}
    </delete>
    
    
    <select id="queryAccLederByAccYear" resultType="java.util.Map" parameterType="java.util.Map">
    	select * from acc_leder  where group_id = #{group_id} and hos_id= #{hos_id} and copy_code = #{copy_code} and acc_year = #{acc_year}
    </select>
    <select id="queryAccSubjByYear" resultType="java.util.Map" parameterType="java.util.Map">
    	select * from acc_subj  where group_id = #{group_id} and hos_id= #{hos_id} and copy_code = #{copy_code} and acc_year = #{acc_year} 
    	<if test="subj_code !='' and subj_code != null">
    		and subj_code = #{subj_code}
    	</if>
    	and is_last = 1
    </select>
    <select id="queryAccCurByYear" resultType="java.util.Map" parameterType="java.util.Map">
		select * from acc_cur where group_id = #{group_id} and hos_id= #{hos_id} and copy_code = #{copy_code} and acc_year = #{acc_year}
    </select>
    
    <insert id="addAccLederBatch" parameterType="java.util.List" >
    begin
    	insert into acc_leder
			  (group_id,
			   hos_id,
			   copy_code,
			   acc_year,
			   acc_month,
			   bal_os,
			   this_od,
			   this_oc,
			   sum_od,
			   sum_oc,
			   end_os,
			   bal_os_w,
			   this_od_w,
			   this_oc_w,
			   sum_od_w,
			   sum_oc_w,
			   end_os_w,
			   subj_code)
			<foreach collection="list" index="index" item="item" separator="union all">
			select
			   #{item.group_id},
			   #{item.hos_id},
			   #{item.copy_code},
			   #{item.acc_year},
			  '00',
			   #{item.bal_os},
			   #{item.this_od},
			   #{item.this_oc},
			   #{item.sum_od},
			   #{item.sum_oc},
			   #{item.end_os},
			   #{item.bal_os_w},
			   #{item.this_od_w},
			   #{item.this_oc_w},
			   #{item.sum_od_w},
			   #{item.sum_oc_w},
			   #{item.end_os_w},
			   #{item.subj_code}
			   from dual
			</foreach>;
			insert into acc_leder
			  (group_id,
			   hos_id,
			   copy_code,
			   acc_year,
			   acc_month,
			   bal_os,
			   this_od,
			   this_oc,
			   sum_od,
			   sum_oc,
			   end_os,
			   bal_os_w,
			   this_od_w,
			   this_oc_w,
			   sum_od_w,
			   sum_oc_w,
			   end_os_w,
			   subj_code)
			<foreach collection="list" index="index" item="item" separator="union all">
			select
			   #{item.group_id},
			   #{item.hos_id},
			   #{item.copy_code},
			   #{item.acc_year},
			   '01',
			   #{item.bal_os},
			   #{item.this_od},
			   #{item.this_oc},
			   #{item.sum_od},
			   #{item.sum_oc},
			   #{item.end_os},
			   #{item.bal_os_w},
			   #{item.this_od_w},
			   #{item.this_oc_w},
			   #{item.sum_od_w},
			   #{item.sum_oc_w},
			   #{item.end_os_w},
			   #{item.subj_code}
			   from dual
			</foreach>;
		end;
    </insert>
    
    <select id="queryTableName" resultType="java.util.Map" parameterType="java.util.Map">
    	select * from acc_check_type where group_id = #{group_id} and hos_id =  #{hos_id} and copy_code =  #{copy_code} and check_type_id=#{check_type_id} and  column_check=#{column_item}
    </select>
    <select id="queryCheckData" resultType="java.util.Map" parameterType="java.util.Map">
    	select * from ${CHECK_TABLE}   where group_id = #{group_id} and hos_id =  #{hos_id}  and is_stop = 0 
    	<if test="CHECK_TABLE !=null and CHECK_TABLE =='ACC_CHECK_ITEM'">
    		and check_type_id = #{check_type_id}
    	</if>
    </select>
    <select id="queryAccLederCheckBySubjCode" resultType="java.util.Map" parameterType="java.util.Map">
    	select ${column1} as key ,${column2} bal_os,end_os,sum_od,sum_oc from acc_leder_check  where group_id = #{group_id} and hos_id =  #{hos_id} and copy_code =  #{copy_code} and acc_year=#{acc_year} and subj_code = #{subj_code}
    </select>
    <select id="querySysModStart" resultType="java.util.Map" parameterType="java.util.Map">
    	select group_id, hos_id, copy_code, mod_code, start_year as acc_year, start_month as acc_month, create_user, create_date from sys_mod_start   where group_id = #{group_id} and hos_id =  #{hos_id} and copy_code =  #{copy_code} and mod_code = '01'
    </select>
    <select id="queryAccLederCheckByYear" resultType="java.util.Map" parameterType="java.util.Map">
    	select * from acc_leder_check   where group_id = #{group_id} and hos_id =  #{hos_id} and copy_code =  #{copy_code} and acc_year=#{acc_year} and acc_month != '00' and subj_code = #{subj_code}
    </select>
    
    <!-- 查询凭证是否为记账 -->
    <select id="querySubjLederCheckCount" resultType="java.lang.Integer">
	select 
		count(1)
	from 
		acc_vouch a inner join acc_vouch_detail b on 
			a.vouch_id=b.vouch_id and b.subj_code = #{subj_code,jdbcType=VARCHAR}
			and a.group_id = b.group_id
			and a.hos_id = b.hos_id
			and a.copy_code = b.copy_code
			and a.acc_year = b.acc_year
	where 
		a.group_id = #{group_id,jdbcType=INTEGER}
		and a.hos_id = #{hos_id,jdbcType=INTEGER}
		and a.copy_code = #{copy_code,jdbcType=VARCHAR}
		and a.acc_year = #{acc_year,jdbcType=INTEGER}
		and a.state = '99'
    </select>
    
</mapper>