<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.budg.dao.business.budgeworkcheck.BudgWorkCheckMapper">
	
	<resultMap id="budgWorkCheck" type="com.chd.hrp.budg.entity.BudgWorkCheck">
	<result property="group_id" column="group_id"/>
	<result property="hos_id" column="hos_id"/>
	<result property="copy_code" column="copy_code"/>
	<result property="budg_year" column="budg_year"/>
	<result property="check_code" column="check_code"/>
	<result property="check_type" column="check_type"/>
	<result property="remark" column="remark"/>
	<result property="maker" column="maker"/>
	<result property="make_data" column="make_data"/>
	<result property="checker" column="checker"/>
	<result property="check_data" column="check_data"/>
	<result property="issue_data" column="issue_data"/>
	<result property="bc_state" column="bc_state"/>
    <result property="hos_name" column="hos_name"/>
	
	</resultMap>
		
	<resultMap id="budgWorkCheckMap" type="java.util.Map">
	<result property="group_id" column="group_id"/>
	<result property="hos_id" column="hos_id"/>
	<result property="copy_code" column="copy_code"/>
	<result property="budg_year" column="budg_year"/>
	<result property="check_code" column="check_code"/>
	<result property="check_type" column="check_type"/>
	<result property="remark" column="remark"/>
	<result property="maker" column="maker"/>
	<result property="maker_name" column="maker_name"/>
	<result property="make_data" column="make_data"/>
	<result property="checker" column="checker"/>
	<result property="check_name" column="check_name"/>
	<result property="check_data" column="check_data"/>
	<result property="issue_data" column="issue_data"/>
	<result property="bc_state" column="bc_state"/>
	<result property="table_code" column="table_code"/>
	<result property="table_name" column="table_name"/>
    <result property="prefixe" column="prefixe"/>
    <result property="year" column="year"/>
    <result property="month" column="month"/>
	<result property="max_no" column="max_no"/>
	<result property="seq_no" column="seq_no"/>
	<result property="day" column="day"/>
   <result property="dept_name" column="dept_name"/>
   <result property="dept_id" column="dept_id"/>
   <result property="index_code" column="index_code"/>
   <result property="last_year_workload" column="last_year_workload"/>
   <result property="grow_rate" column="grow_rate"/>
   <result property="count_value" column="count_value"/>
   <result property="budg_value" column="budg_value"/>
   <result property="adj_file" column="adj_file"/>
	</resultMap>
	
	<!-- 查询业务数据用Map -->
	<resultMap id="dateMap" type="java.util.Map">
	<result property="group_id" column="group_id"/>
	<result property="hos_id" column="hos_id"/>
	<result property="copy_code" column="copy_code"/>
    <result property="year" column="year"/>
    <result property="index_code" column="index_code"/>
    <result property="index_name" column="index_name"/>
    <result property="dept_id" column="dept_id"/>
    <result property="dept_code" column="dept_code"/>
   	<result property="dept_name" column="dept_name"/>
    <result property="month1" column="month1"/>
    <result property="month2" column="month2"/>
    <result property="month3" column="month3"/>
    <result property="month4" column="month4"/>
    <result property="month5" column="month5"/>
    <result property="month6" column="month6"/>
    <result property="month7" column="month7"/>
    <result property="month8" column="month8"/>
    <result property="month9" column="month9"/>
    <result property="month10" column="month10"/>
    <result property="month11" column="month11"/>
    <result property="month12" column="month12"/>
    <result property="year_sum" column="year_sum"/>
    
    <result property="month1Pre" column="month1Pre"/>
    <result property="month2Pre" column="month2Pre"/>
    <result property="month3Pre" column="month3Pre"/>
    <result property="month4Pre" column="month4Pre"/>
    <result property="month5Pre" column="month5Pre"/>
    <result property="month6Pre" column="month6Pre"/>
    <result property="month7Pre" column="month7Pre"/>
    <result property="month8Pre" column="month8Pre"/>
    <result property="month9Pre" column="month9Pre"/>
    <result property="month10Pre" column="month10Pre"/>
    <result property="month11Pre" column="month11Pre"/>
    <result property="month12Pre" column="month12Pre"/>
    <result property="year_sumPre" column="year_sumPre"/>
    
    <result property="hos_suggest" column="hos_suggest"/>
    <result property="dept_suggest" column="dept_suggest"/>
    
	</resultMap>
	
	<insert id="add" useGeneratedKeys="true" >
	
		INSERT INTO BUDG_WORK_CHECK (
			group_id
			,
			hos_id
			,
			copy_code
			,
			budg_year
			,
			check_code
			,
			check_type
			,
			remark
			,
			maker
			,
			make_data
			,
			checker
			,
			check_data
			,
			issue_data
			,
			bc_state
		) VALUES (
			#{group_id,jdbcType=INTEGER}
			,
			#{hos_id,jdbcType=INTEGER}
			,
			#{copy_code,jdbcType=VARCHAR}
			,
			#{budg_year,jdbcType=VARCHAR}
			,
			#{check_code,jdbcType=VARCHAR}
			,
			#{check_type,jdbcType=VARCHAR}
			,
			#{remark,jdbcType=VARCHAR}
			,
			#{maker,jdbcType=INTEGER}
			,
			#{make_data,jdbcType=DATE}
			,
			#{checker,jdbcType=INTEGER}
			,
			#{check_data,jdbcType=DATE}
			,
			#{issue_data,jdbcType=DATE}
			,
			#{bc_state,jdbcType=VARCHAR}
		
		)
	
	</insert>
	<insert id="addBatch" parameterType="java.util.List" >
	
		INSERT INTO BUDG_WORK_CHECK (
			group_id
			,
			hos_id
			,
			copy_code
			,
			budg_year
			,
			check_code
			,
			check_type
			,
			remark
			,
			maker
			,
			make_data
			,
			checker
			,
			check_data
			,
			issue_data
			,
			bc_state
		
		) select t.* from(
		<foreach collection="list" item="item" index="index" separator=" union all " >
			select 		
				#{item.group_id,jdbcType=INTEGER}
				,
				#{item.hos_id,jdbcType=INTEGER}
				,
				#{item.copy_code,jdbcType=VARCHAR}
				,
				#{item.budg_year,jdbcType=VARCHAR}
				,
				#{item.check_code,jdbcType=VARCHAR}
				,
				#{item.check_type,jdbcType=VARCHAR}
				,
				#{item.remark,jdbcType=VARCHAR}
				,
				#{item.maker,jdbcType=INTEGER}
				,
				#{item.make_data,jdbcType=DATE}
				,
				#{item.checker,jdbcType=INTEGER}
				,
				#{item.check_data,jdbcType=DATE}
				,
				#{item.issue_data,jdbcType=DATE}
				,
				#{item.bc_state,jdbcType=VARCHAR}
			
		    from dual
		</foreach>
		)t
	</insert>
	
	<update id="update" parameterType="java.util.Map">
	
		UPDATE budg_work_check  set
			check_type = #{check_type,jdbcType=VARCHAR}
			,
			remark = #{remark,jdbcType=VARCHAR}
		where                    
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND budg_year = #{budg_year,jdbcType=VARCHAR}
			AND check_code = #{check_code,jdbcType=VARCHAR}
	</update>
	
	<!-- 发送 、 召回 状态修改 -->
	<update id="updateBc_state" parameterType="java.util.List">
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
			UPDATE budg_work_check set
				bc_state = #{item.bc_state,jdbcType=VARCHAR} 
			where                     
				group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND budg_year = #{item.budg_year,jdbcType=VARCHAR}
				AND check_code = #{item.check_code,jdbcType=VARCHAR}
		</foreach>
	</update>
	<!-- 审核、消审 -->
	<update id="auditOrUnAudit" parameterType="java.util.List">
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
			UPDATE budg_work_check set
				bc_state = #{item.bc_state,jdbcType=VARCHAR} ,
				checker = #{item.checker,jdbcType=INTEGER},
				check_data = #{item.check_data,jdbcType=DATE}
			where                     
				group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND budg_year = #{item.budg_year,jdbcType=VARCHAR}
				AND check_code = #{item.check_code,jdbcType=VARCHAR}
		</foreach>
	</update>
	
	<!-- 预算下达 、 取消预算下达  -->
	<update id="cancelIssueOrIssue" parameterType="java.util.List">
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
			UPDATE budg_work_check set
				bc_state = #{item.bc_state,jdbcType=VARCHAR} ,
				issue_data = #{item.issue_data,jdbcType=DATE}
			where                     
				group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND budg_year = #{item.budg_year,jdbcType=VARCHAR}
				AND check_code = #{item.check_code,jdbcType=VARCHAR}
		</foreach>
	</update>
	
	<update id="updateBatch" parameterType="java.util.List">
	
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
			UPDATE budg_work_check 
			<trim prefix="SET"  suffixOverrides=","> 
			<if test="item.check_type != null and item.check_type != ''">
			check_type = #{item.check_type,jdbcType=VARCHAR}
			,
			</if>
			<if test="item.remark != null and item.remark != ''">
			remark = #{item.remark,jdbcType=VARCHAR}
			,
			</if>
			<if test="item.maker != null and item.maker != ''">
			maker = #{item.maker,jdbcType=INTEGER}
			,
			</if>
			<if test="item.make_data != null and item.make_data != ''">
			make_data = #{item.make_data,jdbcType=DATE}
			,
			</if>
			<if test="item.checker != null and item.checker != ''">
			checker = #{item.checker,jdbcType=INTEGER}
			,
			</if>
			<if test="item.check_data != null and item.check_data != ''">
			check_data = #{item.check_data,jdbcType=DATE}
			,
			</if>
			<if test="item.issue_data != null and item.issue_data != ''">
			issue_data = #{item.issue_data,jdbcType=DATE}
			,
			</if>
			<if test="item.bc_state != null and item.bc_state != ''">
			bc_state = #{item.bc_state,jdbcType=VARCHAR}
			,
			</if>
			</trim>
			<where>                     
			<if test="item.group_id != null and item.group_id != ''">
			AND group_id = #{item.group_id,jdbcType=INTEGER}
			</if>  
			<if test="item.hos_id != null and item.hos_id != ''">
			AND hos_id = #{item.hos_id,jdbcType=INTEGER}
			</if>  
			<if test="item.copy_code != null and item.copy_code != ''">
			AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
			</if>  
			<if test="item.budg_year != null and item.budg_year != ''">
			AND budg_year = #{item.budg_year,jdbcType=VARCHAR}
			</if>  
			<if test="item.check_code != null and item.check_code != ''">
			AND check_code = #{item.check_code,jdbcType=VARCHAR}
			</if>  
			<if test="item.check_type != null and item.check_type != ''">
			AND check_type = #{item.check_type,jdbcType=VARCHAR}
			</if>  
			<if test="item.remark != null and item.remark != ''">
			AND remark = #{item.remark,jdbcType=VARCHAR}
			</if>  
			<if test="item.maker != null and item.maker != ''">
			AND maker = #{item.maker,jdbcType=INTEGER}
			</if>  
			<if test="item.make_data != null and item.make_data != ''">
			AND make_data = #{item.make_data,jdbcType=DATE}
			</if>  
			<if test="item.checker != null and item.checker != ''">
			AND checker = #{item.checker,jdbcType=INTEGER}
			</if>  
			<if test="item.check_data != null and item.check_data != ''">
			AND check_data = #{item.check_data,jdbcType=DATE}
			</if>  
			<if test="item.issue_data != null and item.issue_data != ''">
			AND issue_data = #{item.issue_data,jdbcType=DATE}
			</if>  
			<if test="item.bc_state != null and item.bc_state != ''">
			AND bc_state = #{item.bc_state,jdbcType=VARCHAR}
			</if>  
			</where>  			
		</foreach>
	</update>
	
	<delete id="delete" parameterType="java.util.Map">
	
		DELETE FROM budg_work_check 
		where                    
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND budg_year = #{budg_year,jdbcType=VARCHAR}
			AND check_code = #{check_code,jdbcType=VARCHAR}
		
	</delete>
	<delete id="deleteBatch" parameterType="java.util.List">
		DELETE FROM budg_work_check 
		<where>
			<foreach collection="list" index="index" item="item" open="(" separator="or" close=")">
			     group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				<if test="item.budg_year != null and item.budg_year != ''">
				AND budg_year = #{item.budg_year,jdbcType=VARCHAR}
				</if>
				<if test="item.check_code != null and item.check_code != ''">
				AND check_code = #{item.check_code,jdbcType=VARCHAR}
				</if>
			</foreach>
	    </where>  
	</delete>
	<select id="query" parameterType="java.util.Map" resultMap="budgWorkCheckMap" >
	
		select a.group_id, a.hos_id, a.copy_code, a.budg_year, a.check_code
		, a.check_type, a.remark, a.maker, b.user_name as maker_name, a.make_data
		, a.checker, c.user_name as check_name, a.check_data, a.issue_data, a.bc_state
		from budg_work_check a
		left join SYS_USER b on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.maker = b.user_id
		and b.is_stop = 0 
		left join SYS_USER c on a.group_id = c.group_id
		and a.hos_id = c.hos_id
		and a.checker = c.user_id
		and c.is_stop = 0 
		where                     
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="budg_year != null and budg_year != ''">
			AND a.budg_year = #{budg_year,jdbcType=VARCHAR}
			</if>
			<if test="check_code != null and check_code != ''">
			AND a.check_code = #{check_code,jdbcType=VARCHAR}
			</if>
			<if test="check_type != null and check_type != ''">
			AND a.check_type = #{check_type,jdbcType=VARCHAR}
			</if>
			<if test="bc_state != null and bc_state != ''">
			AND a.bc_state = #{bc_state,jdbcType=VARCHAR}
			</if>
			
			<if test="is_state != null and is_state != '' ">
				AND a.bc_state not in (#{is_state,jdbcType=VARCHAR})
			</if>
		order by a.check_code asc
	</select>
	<select id="queryByCode" resultMap="budgWorkCheckMap"  parameterType="java.util.Map" >
	
		select a.group_id, a.hos_id, a.copy_code, a.budg_year, a.check_code
		, a.check_type, a.remark, a.maker, b.user_name as maker_name, a.make_data
		, a.checker, c.user_name as check_name, a.check_data, a.issue_data, a.bc_state
		from budg_work_check a
		left join SYS_USER b on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.maker = b.user_id
		and b.is_stop = 0 
		left join SYS_USER c on a.group_id = c.group_id
		and a.hos_id = c.hos_id
		and a.checker = c.user_id
		and c.is_stop = 0 
		WHERE 
			a.group_id = #{group_id,jdbcType=INTEGER}   
			and a.hos_id = #{hos_id,jdbcType=INTEGER}   
			and a.copy_code = #{copy_code,jdbcType=VARCHAR}   
			and a.budg_year = #{budg_year,jdbcType=VARCHAR} 
			and a.check_code = #{check_code,jdbcType=VARCHAR} 
	</select>
	<select id="queryByUniqueness" resultMap="budgWorkCheck"  parameterType="java.util.Map" >
	
		SELECT 
		group_id,
		hos_id,
		copy_code,
		budg_year,
		check_code,
		check_type,
		remark,
		maker,
		make_data,
		checker,
		check_data,
		issue_data,
		bc_state
		FROM BUDG_WORK_CHECK 
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="budg_year != null and budg_year != ''">
		AND budg_year = #{budg_year,jdbcType=VARCHAR}
		</if>
		<if test="check_code != null and check_code != ''">
		AND check_code = #{check_code,jdbcType=VARCHAR}
		</if>
		
		</where>   
		order by group_id asc
	</select>
	<select id="queryExists" resultMap="budgWorkCheck"  parameterType="java.util.Map" >
	
		SELECT 
			group_id,
			hos_id,
			copy_code,
			budg_year,
			check_code,
			check_type,
			remark,
			maker,
			make_data,
			checker,
			check_data,
			issue_data,
			bc_state
		FROM BUDG_WORK_CHECK 
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="budg_year != null and budg_year != ''">
		AND budg_year = #{budg_year,jdbcType=VARCHAR}
		</if>
		<if test="check_code != null and check_code != ''">
		AND check_code = #{check_code,jdbcType=VARCHAR}
		</if>
		</where>   
		order by group_id asc
	</select>
	
	<select id="queryCheckCode"  resultType="java.lang.String" parameterType="java.util.Map">
	select check_code from budg_work_check 
     <where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		</where>
	</select> 
	<select id="queryIsExists" resultType="java.lang.Integer" parameterType="java.util.Map">
	select count(0) from BUDG_NO_MANAGE
		<where>
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="year != null and year != '' ">
				AND year = #{year,jdbcType=VARCHAR}
			</if>
			<if test="month != null and month != '' ">
				AND month = #{month,jdbcType=VARCHAR}
			</if>
			<if test="table_code != null and table_code != ''">
				AND table_code = #{table_code,jdbcType=VARCHAR}
			</if>
			<if test="prefixe != null and prefixe != ''">
				AND prefixe = #{prefixe,jdbcType=VARCHAR}
			</if>
		</where> 
	</select>
	
	<!-- 查询员工所对应的科室-->
	<select id="queryDeptNameByUserId" resultType="java.lang.String" parameterType="java.util.Map">
		select dept_name, maker
         from hos_emp a
         left join hos_dept b
         on a.dept_id = b.dept_id
         left join budg_work_check c
         on c.group_id = b.group_id
         and c.maker = a.emp_id
         left join acc_dept_attr d
         on a.emp_id = d.emp_id
         and a.dept_id = d.dept_id
		<where>
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
            and c.maker = a.emp_id
            and a.dept_id=b.dept_id
           and a.dept_id=d.dept_id 
		</where> 
	</select>
	<!-- 查询员工所对应的科室-->
	<select id="queryDeptInformation" resultType="java.lang.String" parameterType="java.util.Map">
		select b.dept_name ,c.hos_name,a.budg_year,a.maker,a.make_data,a.check_code,a.check_data,a.issue_data,a.bc_state from budg_work_check a
        left join hos_info_dict  c on c.group_id=a.group_id and c.hos_id=a.hos_id 
		<where>
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND c.maker=a.emp_id   
		</where> 
	</select>
	<!--查询医院明细 -->
	<select id="queryBudgWorkCheckYear" resultMap="budgWorkCheckMap" parameterType="java.util.Map">
		select index_code,year,last_year_workload,grow_rate from  budg_work_dept_year
		<where>
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="index_code != null and index_code != '' ">
				AND index_code = #{index_code,jdbcType=VARCHAR}
			</if>
			<if test="year != null and year != '' ">
				AND year= #{year,jdbcType=VARCHAR}
			</if>
			<if test="last_year_workload != null and last_year_workload != ''">
				AND last_year_workload= #{last_year_workload,jdbcType= NUMERIC }
			</if>
			<if test="grow_rate != null and grow_rate != ''">
				AND grow_rate  = #{grow_rate,jdbcType= NUMERIC }
			</if>
		</where> 
	</select>
	<!--查询医院明细   初始审核  未下达-->
	<select id="queryBudgWorkHosMonth" resultMap="dateMap" parameterType="java.util.Map">
		 select 
		 	a.group_id ,
		 	a.hos_id ,
		 	a.copy_code ,
		 	a.year ,
		 	a.index_code , 
		 	bid.index_name , 
		 	sum(case when a.month='01' then  nvl(a.budg_value,0) else 0 end ) as month1,
     		sum(case when a.month='02' then  nvl(a.budg_value,0) else 0 end ) as month2,
     		sum(case when a.month='03' then  nvl(a.budg_value,0) else 0 end ) as month3,
     		sum(case when a.month='04' then  nvl(a.budg_value,0) else 0 end ) as month4,
     		sum(case when a.month='05' then  nvl(a.budg_value,0) else 0 end ) as month5,
     		sum(case when a.month='06' then  nvl(a.budg_value,0) else 0 end ) as month6,
     		sum(case when a.month='07' then  nvl(a.budg_value,0) else 0 end ) as month7,
     		sum(case when a.month='08' then  nvl(a.budg_value,0) else 0 end ) as month8,
     		sum(case when a.month='09' then  nvl(a.budg_value,0) else 0 end ) as month9,
     		sum(case when a.month='10' then  nvl(a.budg_value,0) else 0 end ) as month10,
     		sum(case when a.month='11' then  nvl(a.budg_value,0) else 0 end ) as month11,
     		sum(case when a.month='12' then  nvl(a.budg_value,0) else 0 end ) as month12 ,
     		b.budg_value year_sum 
     		
     	from  BUDG_WORK_HOS_MONTH a
     	
     	left join BUDG_WORK_HOS_YEAR b
     		on
     			a.group_id = b.group_id
     			and a.hos_id = b.hos_id
     			and a.copy_code = b.copy_code
     			and a.year = b.year
     			and a.index_code = b.index_code
     	Left join budg_index_dict bid
     		on	
     			a.group_id = bid.group_id
     			and a.hos_id = bid.hos_id
     			and a.copy_code = bid.copy_code
     			and a.index_code = bid.index_code
     			and bid.is_stop = 0
		where
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.year= #{year,jdbcType=VARCHAR}
		group by a.group_id , a.hos_id , a.copy_code , a.year , a.index_code , bid.index_name ,b.budg_value      
		order by a.index_code
	</select>
	
	<!--查询医院明细   调整审核 未下达-->
	<select id="queryBudgWorkHosMonthAdjust" resultMap="dateMap" parameterType="java.util.Map">
		select
			a.group_id ,
		 	a.hos_id ,
		 	a.copy_code ,
		 	a.year ,
		 	a.index_code , 
		 	bid.index_name , 
			sum(case when a.month='01' then nvl(a.budg_value,0) else 0 end ) as month1,
     		sum(case when a.month='02' then nvl(a.budg_value,0) else 0 end ) as month2,
     		sum(case when a.month='03' then nvl(a.budg_value,0) else 0 end ) as month3,
     		sum(case when a.month='04' then nvl(a.budg_value,0) else 0 end ) as month4,
     		sum(case when a.month='05' then nvl(a.budg_value,0) else 0 end ) as month5,
     		sum(case when a.month='06' then nvl(a.budg_value,0) else 0 end ) as month6,
     		sum(case when a.month='07' then nvl(a.budg_value,0) else 0 end ) as month7,
     		sum(case when a.month='08' then nvl(a.budg_value,0) else 0 end ) as month8,
     		sum(case when a.month='09' then nvl(a.budg_value,0) else 0 end ) as month9,
     		sum(case when a.month='10' then nvl(a.budg_value,0) else 0 end ) as month10,
     		sum(case when a.month='11' then nvl(a.budg_value,0) else 0 end ) as month11,
     		sum(case when a.month='12' then nvl(a.budg_value,0) else 0 end ) as month12  ,
			bwhy.budg_value year_sum ,
			
			sum(case when b.month='01' then nvl(b.budg_value,0) else 0 end ) as month1Pre,
     		sum(case when b.month='02' then nvl(b.budg_value,0) else 0 end ) as month2Pre,
     		sum(case when b.month='03' then nvl(b.budg_value,0) else 0 end ) as month3Pre,
     		sum(case when b.month='04' then nvl(b.budg_value,0) else 0 end ) as month4Pre,
     		sum(case when b.month='05' then nvl(b.budg_value,0) else 0 end ) as month5Pre,
     		sum(case when b.month='06' then nvl(b.budg_value,0) else 0 end ) as month6Pre,
     		sum(case when b.month='07' then nvl(b.budg_value,0) else 0 end ) as month7Pre,
     		sum(case when b.month='08' then nvl(b.budg_value,0) else 0 end ) as month8Pre,
     		sum(case when b.month='09' then nvl(b.budg_value,0) else 0 end ) as month9Pre,
     		sum(case when b.month='10' then nvl(b.budg_value,0) else 0 end ) as month10Pre,
     		sum(case when b.month='11' then nvl(b.budg_value,0) else 0 end ) as month11Pre,
     		sum(case when b.month='12' then nvl(b.budg_value,0) else 0 end ) as month12Pre  ,
			c.budg_value year_sumPre
		from  BUDG_WORK_HOS_month a  
		Left join BUDG_WORK_HOS_YEAR bwhy
     		on	
     			a.group_id = bwhy.group_id
     			and a.hos_id = bwhy.hos_id
     			and a.copy_code = bwhy.copy_code
     			and a.index_code = bwhy.index_code
     			and a.year = bwhy.year
		Left join budg_index_dict bid
     		on	
     			a.group_id = bid.group_id
     			and a.hos_id = bid.hos_id
     			and a.copy_code = bid.copy_code
     			and a.index_code = bid.index_code
     			and bid.is_stop = 0
     	Left join BUDG_WORK_HOS_MONTH_COPY b
     		on	
     			a.group_id = b.group_id
     			and a.hos_id = b.hos_id
     			and a.copy_code = b.copy_code
     			and a.year = b.year
     			and a.index_code = b.index_code
     			and a.month = b.month 
     			
     	Left join BUDG_WORK_HOS_YEAR_COPY c
     		on	
     			b.group_id = c.group_id
     			and b.hos_id = c.hos_id
     			and b.copy_code = c.copy_code
     			and b.year = c.year
     			and b.index_code = c.index_code
     			and b.check_code = c.check_code
 		where
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.year= #{year,jdbcType=VARCHAR}
			and b.check_code = (select max(check_code) 
								from budg_work_check
								where group_id = ${group_id} 
								and hos_id = ${hos_id} 
								and copy_code = ${copy_code} 
								and budg_year = ${year}
								and check_code &lt; #{check_code,jdbcType=VARCHAR}
								)
 		group by a.group_id , a.hos_id , a.copy_code , a.year , a.index_code , bid.index_name ,bwhy.budg_value , c.budg_value
		order by a.index_code
	</select>
	
	<!--查询科室明细 初始审核 未下达 -->
	<select id="queryBudgWorkDeptMonth" resultMap="dateMap" parameterType="java.util.Map">
		select 
			a.group_id ,
			a.hos_id ,
			a.copy_code ,
			a.year ,
			a.dept_id ,
			hdd.dept_code ,
			hdd.dept_name ,
			a.index_code , 
			bid.index_name , 
			sum(case when a.month='01' then nvl(a.budg_value,0) else 0 end ) as month1,
     		sum(case when a.month='02' then nvl(a.budg_value,0) else 0 end ) as month2,
     		sum(case when a.month='03' then nvl(a.budg_value,0) else 0 end ) as month3,
     		sum(case when a.month='04' then nvl(a.budg_value,0) else 0 end ) as month4,
     		sum(case when a.month='05' then nvl(a.budg_value,0) else 0 end ) as month5,
     		sum(case when a.month='06' then nvl(a.budg_value,0) else 0 end ) as month6,
     		sum(case when a.month='07' then nvl(a.budg_value,0) else 0 end ) as month7,
     		sum(case when a.month='08' then nvl(a.budg_value,0) else 0 end ) as month8,
     		sum(case when a.month='09' then nvl(a.budg_value,0) else 0 end ) as month9,
     		sum(case when a.month='10' then nvl(a.budg_value,0) else 0 end ) as month10,
     		sum(case when a.month='11' then nvl(a.budg_value,0) else 0 end ) as month11,
     		sum(case when a.month='12' then nvl(a.budg_value,0) else 0 end ) as month12  ,
     		bwdy.budg_value year_sum 
     	from  BUDG_WORK_DEPT_month a
     	Left join BUDG_WORK_DEPT_YEAR bwdy
     		on	
     			a.group_id = bwdy.group_id
     			and a.hos_id = bwdy.hos_id
     			and a.copy_code = bwdy.copy_code
     			and a.year = bwdy.year
     			and a.index_code = bwdy.index_code
     			and a.dept_id = bwdy.dept_id
     	Left join hos_dept_dict hdd
     		on	
     			a.group_id = hdd.group_id
     			and a.hos_id = hdd.hos_id
     			and a.dept_id = hdd.dept_id
     			and hdd.is_stop = 0
     	Left join budg_index_dict bid
     		on	
     			a.group_id = bid.group_id
     			and a.hos_id = bid.hos_id
     			and a.copy_code = bid.copy_code
     			and a.index_code = bid.index_code
     			and bid.is_stop = 0
		where
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.year= #{year,jdbcType=VARCHAR}
		 group by a.group_id , a.hos_id , a.copy_code , a.year , a.dept_id ,hdd.dept_code ,hdd.dept_name ,	
		 		a.index_code , bid.index_name , bwdy.budg_value 
		 order by a.index_code , a.dept_id
	</select>
	
	<!--查询科室明细  调整审核 未下达-->
	<select id="queryBudgWorkCheckDeptMonthAdjust" resultMap="dateMap" parameterType="java.util.Map">
		
			select 
	    		a.group_id ,
				a.hos_id ,
				a.copy_code ,
				a.year ,
				a.dept_id ,
				hdd.dept_code ,
				hdd.dept_name ,
				a.index_code , 
				bid.index_name ,
				sum(case when a.month='01' then nvl(a.budg_value,0) else 0 end ) as month1,
	     		sum(case when a.month='02' then nvl(a.budg_value,0) else 0 end ) as month2,
	     		sum(case when a.month='03' then nvl(a.budg_value,0) else 0 end ) as month3,
	     		sum(case when a.month='04' then nvl(a.budg_value,0) else 0 end ) as month4,
	     		sum(case when a.month='05' then nvl(a.budg_value,0) else 0 end ) as month5,
	     		sum(case when a.month='06' then nvl(a.budg_value,0) else 0 end ) as month6,
	     		sum(case when a.month='07' then nvl(a.budg_value,0) else 0 end ) as month7,
	     		sum(case when a.month='08' then nvl(a.budg_value,0) else 0 end ) as month8,
	     		sum(case when a.month='09' then nvl(a.budg_value,0) else 0 end ) as month9,
	     		sum(case when a.month='10' then nvl(a.budg_value,0) else 0 end ) as month10,
	     		sum(case when a.month='11' then nvl(a.budg_value,0) else 0 end ) as month11,
	     		sum(case when a.month='12' then nvl(a.budg_value,0) else 0 end ) as month12  ,
	     		bwdy.budg_value year_sum ,
	     	
	     		sum(case when b.month='01' then nvl(b.budg_value,0) else 0 end ) as month1Pre,
	     		sum(case when b.month='02' then nvl(b.budg_value,0) else 0 end ) as month2Pre,
	     		sum(case when b.month='03' then nvl(b.budg_value,0) else 0 end ) as month3Pre,
	     		sum(case when b.month='04' then nvl(b.budg_value,0) else 0 end ) as month4Pre,
	     		sum(case when b.month='05' then nvl(b.budg_value,0) else 0 end ) as month5Pre,
	     		sum(case when b.month='06' then nvl(b.budg_value,0) else 0 end ) as month6Pre,
	     		sum(case when b.month='07' then nvl(b.budg_value,0) else 0 end ) as month7Pre,
	     		sum(case when b.month='08' then nvl(b.budg_value,0) else 0 end ) as month8Pre,
	     		sum(case when b.month='09' then nvl(b.budg_value,0) else 0 end ) as month9Pre,
	     		sum(case when b.month='10' then nvl(b.budg_value,0) else 0 end ) as month10Pre,
	     		sum(case when b.month='11' then nvl(b.budg_value,0) else 0 end ) as month11Pre,
	     		sum(case when b.month='12' then nvl(b.budg_value,0) else 0 end ) as month12Pre  ,
				c.budg_value year_sumPre
	     	from  BUDG_WORK_DEPT_month a
	     	Left join BUDG_WORK_DEPT_YEAR bwdy
	     		ON
	     			a.group_id = bwdy.group_id
	     			and a.hos_id = bwdy.hos_id
	     			and a.copy_code = bwdy.copy_code
	     			and a.year = bwdy.year
	     			and a.index_code = bwdy.index_code
	     			and a.dept_id = bwdy.dept_id
	     	Left join BUDG_WORK_DEPT_MONTH_COPY b
	     		on 
		     		a.group_id = b.group_id
	     			and a.hos_id = b.hos_id
	     			and a.copy_code = b.copy_code
	     			and a.year = b.year
	     			and a.index_code = b.index_code
	     			and a.month = b.month 
	     			and a.dept_id = b.dept_id
	     	Left join BUDG_WORK_DEPT_YEAR_COPY c
	     		on	
	     			b.group_id = c.group_id
	     			and b.hos_id = c.hos_id
	     			and b.copy_code = c.copy_code
	     			and b.year = c.year
	     			and b.index_code = c.index_code
	     			and b.dept_id = c.dept_id
	     			and b.check_code = c.check_code
	     	Left join hos_dept_dict hdd
	     		on	
	     			a.group_id = hdd.group_id
	     			and a.hos_id = hdd.hos_id
	     			and a.dept_id = hdd.dept_id
	     			and hdd.is_stop = 0
	     	Left join budg_index_dict bid
	     		on	
	     			a.group_id = bid.group_id
	     			and a.hos_id = bid.hos_id
	     			and a.copy_code = bid.copy_code
	     			and a.index_code = bid.index_code
	     			and bid.is_stop = 0
			where
				a.group_id = #{group_id,jdbcType=INTEGER}
				AND a.hos_id = #{hos_id,jdbcType=INTEGER}
				AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
				AND a.year= #{year,jdbcType=VARCHAR}
				and b.check_code = (select max(check_code) 
								from budg_work_check
								where group_id = ${group_id} 
								and hos_id = ${hos_id} 
								and copy_code = ${copy_code} 
								and budg_year = ${year}
								and check_code &lt; #{check_code,jdbcType=VARCHAR}
								)
			 group by a.group_id , a.hos_id , a.copy_code , a.year , a.dept_id ,hdd.dept_code ,hdd.dept_name ,
			 	a.index_code , bid.index_name ,bwdy.budg_value ,c.budg_value
			 order by a.index_code , a.dept_id
	</select>
	
	<!--查询医院明细   初始审核 已下达-->
	<select id="queryBudgWorkHosMonthCopy" resultMap="dateMap" parameterType="java.util.Map">
		 select 
		 	a.group_id ,
		 	a.hos_id ,
		 	a.copy_code ,
		 	a.year ,
		 	a.index_code , 
		 	bid.index_name , 
		 	sum(case when a.month='01' then  nvl(a.budg_value,0) else 0 end ) as month1,
     		sum(case when a.month='02' then  nvl(a.budg_value,0) else 0 end ) as month2,
     		sum(case when a.month='03' then  nvl(a.budg_value,0) else 0 end ) as month3,
     		sum(case when a.month='04' then  nvl(a.budg_value,0) else 0 end ) as month4,
     		sum(case when a.month='05' then  nvl(a.budg_value,0) else 0 end ) as month5,
     		sum(case when a.month='06' then  nvl(a.budg_value,0) else 0 end ) as month6,
     		sum(case when a.month='07' then  nvl(a.budg_value,0) else 0 end ) as month7,
     		sum(case when a.month='08' then  nvl(a.budg_value,0) else 0 end ) as month8,
     		sum(case when a.month='09' then  nvl(a.budg_value,0) else 0 end ) as month9,
     		sum(case when a.month='10' then  nvl(a.budg_value,0) else 0 end ) as month10,
     		sum(case when a.month='11' then  nvl(a.budg_value,0) else 0 end ) as month11,
     		sum(case when a.month='12' then  nvl(a.budg_value,0) else 0 end ) as month12 ,
     		b.budg_value year_sum 
     	from  BUDG_WORK_HOS_MONTH_COPY a
     	Left join BUDG_WORK_HOS_YEAR_COPY b
     		on	
     			a.group_id = b.group_id
     			and a.hos_id = b.hos_id
     			and a.copy_code = b.copy_code
     			and a.year = b.year
     			and a.index_code = b.index_code
     			and a.check_code = b.check_code
     	Left join budg_index_dict bid
     		on	
     			a.group_id = bid.group_id
     			and a.hos_id = bid.hos_id
     			and a.copy_code = bid.copy_code
     			and a.index_code = bid.index_code
     			and bid.is_stop = 0
		where
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.year= #{year,jdbcType=VARCHAR}
			AND a.check_code= #{check_code,jdbcType=VARCHAR}
			<if test="index_code != null and index_code != '' ">
			and a.index_code = #{index_code,jdbcType=VARCHAR}
			</if>
		group by a.group_id , a.hos_id , a.copy_code , a.year , a.index_code , 
				bid.index_name ,b.budg_value 
		order by a.index_code
	</select>
	
	<!--查询医院明细   调整审核 已下达-->
	<select id="queryBudgWorkHosMonthAdjustCopy" resultMap="dateMap" parameterType="java.util.Map">
		select
			a.group_id ,
		 	a.hos_id ,
		 	a.copy_code ,
		 	a.year ,
		 	a.index_code , 
		 	bid.index_name , 
			sum(case when a.month='01' then nvl(a.budg_value,0) else 0 end ) as month1,
     		sum(case when a.month='02' then nvl(a.budg_value,0) else 0 end ) as month2,
     		sum(case when a.month='03' then nvl(a.budg_value,0) else 0 end ) as month3,
     		sum(case when a.month='04' then nvl(a.budg_value,0) else 0 end ) as month4,
     		sum(case when a.month='05' then nvl(a.budg_value,0) else 0 end ) as month5,
     		sum(case when a.month='06' then nvl(a.budg_value,0) else 0 end ) as month6,
     		sum(case when a.month='07' then nvl(a.budg_value,0) else 0 end ) as month7,
     		sum(case when a.month='08' then nvl(a.budg_value,0) else 0 end ) as month8,
     		sum(case when a.month='09' then nvl(a.budg_value,0) else 0 end ) as month9,
     		sum(case when a.month='10' then nvl(a.budg_value,0) else 0 end ) as month10,
     		sum(case when a.month='11' then nvl(a.budg_value,0) else 0 end ) as month11,
     		sum(case when a.month='12' then nvl(a.budg_value,0) else 0 end ) as month12  ,
			bwhy.budg_value year_sum ,
			
			sum(case when b.month='01' then nvl(b.budg_value,0) else 0 end ) as month1Pre,
     		sum(case when b.month='02' then nvl(b.budg_value,0) else 0 end ) as month2Pre,
     		sum(case when b.month='03' then nvl(b.budg_value,0) else 0 end ) as month3Pre,
     		sum(case when b.month='04' then nvl(b.budg_value,0) else 0 end ) as month4Pre,
     		sum(case when b.month='05' then nvl(b.budg_value,0) else 0 end ) as month5Pre,
     		sum(case when b.month='06' then nvl(b.budg_value,0) else 0 end ) as month6Pre,
     		sum(case when b.month='07' then nvl(b.budg_value,0) else 0 end ) as month7Pre,
     		sum(case when b.month='08' then nvl(b.budg_value,0) else 0 end ) as month8Pre,
     		sum(case when b.month='09' then nvl(b.budg_value,0) else 0 end ) as month9Pre,
     		sum(case when b.month='10' then nvl(b.budg_value,0) else 0 end ) as month10Pre,
     		sum(case when b.month='11' then nvl(b.budg_value,0) else 0 end ) as month11Pre,
     		sum(case when b.month='12' then nvl(b.budg_value,0) else 0 end ) as month12Pre  ,
			c.budg_value year_sumPre
		from  BUDG_WORK_HOS_MONTH_COPY a  
		Left join BUDG_WORK_HOS_YEAR_COPY bwhy
     		on	
     			a.group_id = bwhy.group_id
     			and a.hos_id = bwhy.hos_id
     			and a.copy_code = bwhy.copy_code
     			and a.year = bwhy.year
     			and a.index_code = bwhy.index_code
     			and a.check_code = bwhy.check_code
     			
		Left join budg_index_dict bid
     		on	
     			a.group_id = bid.group_id
     			and a.hos_id = bid.hos_id
     			and a.copy_code = bid.copy_code
     			and a.index_code = bid.index_code
     			and bid.is_stop = 0
     	Left join BUDG_WORK_HOS_MONTH_COPY b
     		on	
     			a.group_id = b.group_id
     			and a.hos_id = b.hos_id
     			and a.copy_code = b.copy_code
     			and a.year = b.year
     			and a.index_code = b.index_code
     			and a.month = b.month 
     	Left join BUDG_WORK_HOS_YEAR_COPY c
     		on	
     			b.group_id = c.group_id
     			and b.hos_id = c.hos_id
     			and b.copy_code = c.copy_code
     			and b.year = c.year
     			and b.index_code = c.index_code
     			and b.check_code = c.check_code
 		where
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.year= #{year,jdbcType=VARCHAR}
			AND a.check_code= #{check_code,jdbcType=VARCHAR}
			and b.check_code = (select max(check_code) 
								from budg_work_check
								where group_id = ${group_id} 
								and hos_id = ${hos_id} 
								and copy_code = ${copy_code} 
								and budg_year = ${year}
								and check_code &lt; #{check_code,jdbcType=VARCHAR}
								)
 		group by a.group_id , a.hos_id , a.copy_code , a.year , a.index_code , bid.index_name ,
 				bwhy.budg_value , c.budg_value
		order by a.index_code
	</select>
	
	<!--查询科室明细 初始审核 已下达-->
	<select id="queryBudgWorkDeptMonthCopy" resultMap="dateMap" parameterType="java.util.Map">
		select 
			a.group_id ,
			a.hos_id ,
			a.copy_code ,
			a.year ,
			a.dept_id ,
			hdd.dept_code ,
			hdd.dept_name ,
			a.index_code , 
			bid.index_name , 
			sum(case when a.month='01' then nvl(a.budg_value,0) else 0 end ) as month1,
     		sum(case when a.month='02' then nvl(a.budg_value,0) else 0 end ) as month2,
     		sum(case when a.month='03' then nvl(a.budg_value,0) else 0 end ) as month3,
     		sum(case when a.month='04' then nvl(a.budg_value,0) else 0 end ) as month4,
     		sum(case when a.month='05' then nvl(a.budg_value,0) else 0 end ) as month5,
     		sum(case when a.month='06' then nvl(a.budg_value,0) else 0 end ) as month6,
     		sum(case when a.month='07' then nvl(a.budg_value,0) else 0 end ) as month7,
     		sum(case when a.month='08' then nvl(a.budg_value,0) else 0 end ) as month8,
     		sum(case when a.month='09' then nvl(a.budg_value,0) else 0 end ) as month9,
     		sum(case when a.month='10' then nvl(a.budg_value,0) else 0 end ) as month10,
     		sum(case when a.month='11' then nvl(a.budg_value,0) else 0 end ) as month11,
     		sum(case when a.month='12' then nvl(a.budg_value,0) else 0 end ) as month12  ,
     		bwdy.budg_value  year_sum
     	from  BUDG_WORK_DEPT_MONTH_COPY a
     	Left join BUDG_WORK_DEPT_YEAR_COPY bwdy
	     		ON
	     			a.group_id = bwdy.group_id
	     			and a.hos_id = bwdy.hos_id
	     			and a.copy_code = bwdy.copy_code
	     			and a.year = bwdy.year
	     			and a.index_code = bwdy.index_code
	     			and a.dept_id = bwdy.dept_id
	     			and a.check_code = bwdy.check_code
     	Left join hos_dept_dict hdd
     		on	
     			a.group_id = hdd.group_id
     			and a.hos_id = hdd.hos_id
     			and a.dept_id = hdd.dept_id
     			and hdd.is_stop = 0
     	Left join budg_index_dict bid
     		on	
     			a.group_id = bid.group_id
     			and a.hos_id = bid.hos_id
     			and a.copy_code = bid.copy_code
     			and a.index_code = bid.index_code
     			and bid.is_stop = 0
		where
			a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			AND a.year= #{year,jdbcType=VARCHAR}
			AND a.check_code = #{check_code,jdbcType=VARCHAR}
			<if test="index_code != null and index_code != '' ">
			and a.index_code = #{index_code,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != '' ">
			and a.dept_id = #{dept_id,jdbcType=INTEGER}
			</if>
		 group by a.group_id , a.hos_id , a.copy_code , a.year , a.dept_id ,hdd.dept_code ,
		 		hdd.dept_name ,	a.index_code , bid.index_name ,bwdy.budg_value 
		 order by a.index_code , a.dept_id
	</select>
	
	<!--查询科室明细  调整审核 已下达-->
	<select id="queryBudgWorkCheckDeptMonthAdjustCopy" resultMap="dateMap" parameterType="java.util.Map">
		
			select 
	    		a.group_id ,
				a.hos_id ,
				a.copy_code ,
				a.year ,
				a.dept_id ,
				hdd.dept_code ,
				hdd.dept_name ,
				a.index_code , 
				bid.index_name ,
				sum(case when a.month='01' then nvl(a.budg_value,0) else 0 end ) as month1,
	     		sum(case when a.month='02' then nvl(a.budg_value,0) else 0 end ) as month2,
	     		sum(case when a.month='03' then nvl(a.budg_value,0) else 0 end ) as month3,
	     		sum(case when a.month='04' then nvl(a.budg_value,0) else 0 end ) as month4,
	     		sum(case when a.month='05' then nvl(a.budg_value,0) else 0 end ) as month5,
	     		sum(case when a.month='06' then nvl(a.budg_value,0) else 0 end ) as month6,
	     		sum(case when a.month='07' then nvl(a.budg_value,0) else 0 end ) as month7,
	     		sum(case when a.month='08' then nvl(a.budg_value,0) else 0 end ) as month8,
	     		sum(case when a.month='09' then nvl(a.budg_value,0) else 0 end ) as month9,
	     		sum(case when a.month='10' then nvl(a.budg_value,0) else 0 end ) as month10,
	     		sum(case when a.month='11' then nvl(a.budg_value,0) else 0 end ) as month11,
	     		sum(case when a.month='12' then nvl(a.budg_value,0) else 0 end ) as month12  ,
	     		bwdy.budg_value year_sum ,
	     	
	     		sum(case when b.month='01' then nvl(b.budg_value,0) else 0 end ) as month1Pre,
	     		sum(case when b.month='02' then nvl(b.budg_value,0) else 0 end ) as month2Pre,
	     		sum(case when b.month='03' then nvl(b.budg_value,0) else 0 end ) as month3Pre,
	     		sum(case when b.month='04' then nvl(b.budg_value,0) else 0 end ) as month4Pre,
	     		sum(case when b.month='05' then nvl(b.budg_value,0) else 0 end ) as month5Pre,
	     		sum(case when b.month='06' then nvl(b.budg_value,0) else 0 end ) as month6Pre,
	     		sum(case when b.month='07' then nvl(b.budg_value,0) else 0 end ) as month7Pre,
	     		sum(case when b.month='08' then nvl(b.budg_value,0) else 0 end ) as month8Pre,
	     		sum(case when b.month='09' then nvl(b.budg_value,0) else 0 end ) as month9Pre,
	     		sum(case when b.month='10' then nvl(b.budg_value,0) else 0 end ) as month10Pre,
	     		sum(case when b.month='11' then nvl(b.budg_value,0) else 0 end ) as month11Pre,
	     		sum(case when b.month='12' then nvl(b.budg_value,0) else 0 end ) as month12Pre  ,
				c.budg_value year_sumPre
	     	from  BUDG_WORK_DEPT_MONTH_COPY a
	     	Left join BUDG_WORK_DEPT_YEAR_COPY bwdy
	     		ON
	     			a.group_id = bwdy.group_id
	     			and a.hos_id = bwdy.hos_id
	     			and a.copy_code = bwdy.copy_code
	     			and a.year = bwdy.year
	     			and a.index_code = bwdy.index_code
	     			and a.dept_id = bwdy.dept_id
	     			and a.check_code = bwdy.check_code
	     	Left join BUDG_WORK_DEPT_MONTH_COPY b
	     		on 
		     		a.group_id = b.group_id
	     			and a.hos_id = b.hos_id
	     			and a.copy_code = b.copy_code
	     			and a.year = b.year
	     			and a.index_code = b.index_code
	     			and a.month = b.month 
	     			and a.dept_id = b.dept_id
	     	Left join BUDG_WORK_DEPT_YEAR_COPY c
	     		on	
	     			b.group_id = c.group_id
	     			and b.hos_id = c.hos_id
	     			and b.copy_code = c.copy_code
	     			and b.year = c.year
	     			and b.index_code = c.index_code
	     			and b.dept_id = c.dept_id
	     			and b.check_code = c.check_code
	     	Left join hos_dept_dict hdd
	     		on	
	     			a.group_id = hdd.group_id
	     			and a.hos_id = hdd.hos_id
	     			and a.dept_id = hdd.dept_id
	     			and hdd.is_stop = 0
	     	Left join budg_index_dict bid
	     		on	
	     			a.group_id = bid.group_id
	     			and a.hos_id = bid.hos_id
	     			and a.copy_code = bid.copy_code
	     			and a.index_code = bid.index_code
	     			and bid.is_stop = 0
			where
				a.group_id = #{group_id,jdbcType=INTEGER}
				AND a.hos_id = #{hos_id,jdbcType=INTEGER}
				AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
				AND a.year= #{year,jdbcType=VARCHAR}
				AND a.check_code= #{check_code,jdbcType=VARCHAR}
				and b.check_code = (select max(check_code) 
								from budg_work_check
								where group_id = ${group_id} 
								and hos_id = ${hos_id} 
								and copy_code = ${copy_code} 
								and budg_year = ${year}
								and check_code &lt; #{check_code,jdbcType=VARCHAR}
								)
			 group by a.group_id , a.hos_id , a.copy_code , a.year , a.dept_id ,hdd.dept_code ,hdd.dept_name ,
			 	a.index_code , bid.index_name ,bwdy.budg_value ,c.budg_value
			 order by a.index_code , a.dept_id
	</select>
	
	<!--查询科室明细年 -->
	<select id="queryBudgWorkCheckDeptYear" resultMap="budgWorkCheckMap" parameterType="java.util.Map">
		select index_code,year,last_year_workload,grow_rate from budg_work_dept_year
		<where>
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="index_code != null and index_code != '' ">
				AND index_code = #{index_code,jdbcType=VARCHAR}
			</if>
			<if test="year != null and year != '' ">
				AND year= #{year,jdbcType=VARCHAR}
			</if>
			<if test="last_year_workload != null and last_year_workload != ''">
				AND last_year_workload= #{last_year_workload,jdbcType= NUMERIC }
			</if>
			<if test="grow_rate != null and grow_rate != ''">
				AND grow_rate  = #{grow_rate,jdbcType= NUMERIC }
			</if>
		</where> 
	</select>
	
	<!--查询医院明细年 调整页面-->
	<select id="queryBudgWorkCheckYearAdjust" resultMap="budgWorkCheckMap" parameterType="java.util.Map">
		select index_code,budg_value,count_value, last_year_workload,grow_rate from BUDG_WORK_HOS_YEAR 
		<where>
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="index_code != null and index_code != '' ">
				AND index_code = #{index_code,jdbcType=VARCHAR}
			</if>
			<if test="budg_value != null and budg_value != '' ">
				AND budg_value= #{budg_value,jdbcType=NUMERIC}
			</if>
			<if test="last_year_workload != null and last_year_workload != ''">
				AND last_year_workload= #{last_year_workload,jdbcType= NUMERIC }
			</if>
			<if test="grow_rate != null and grow_rate != ''">
				AND grow_rate  = #{grow_rate,jdbcType= NUMERIC }
			</if>
		</where> 
        order by index_code
	</select>
	
	<!--查询科室明细年 调整页面-->
	<select id="queryBudgWorkCheckDeptYearAdjust" resultMap="budgWorkCheckMap" parameterType="java.util.Map">
		select index_code,budg_value,count_value, last_year_workload,grow_rate from BUDG_WORK_DEPT_year
		<where>
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="index_code != null and index_code != '' ">
				AND index_code = #{index_code,jdbcType=VARCHAR}
			</if>
			<if test="budg_value != null and budg_value != '' ">
				AND budg_value= #{budg_value,jdbcType=NUMERIC}
			</if>
			<if test="last_year_workload != null and last_year_workload != ''">
				AND last_year_workload= #{last_year_workload,jdbcType= NUMERIC }
			</if>
			<if test="grow_rate != null and grow_rate != ''">
				AND grow_rate  = #{grow_rate,jdbcType= NUMERIC }
			</if>
		</where> 
        order by index_code
	</select>
	
	<select id="queryIssueData" parameterType="java.util.Map" resultMap="budgWorkCheck" >
	SELECT to_char(issue_data,'yyyy-MM-dd')  as issue_data FROM BUDG_WORK_CHECK a left join budg_work_adj  b 
	 on a.group_id=b.group_id and a.hos_id=b.hos_id and a.copy_code=b.copy_code
     
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND a.group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND a.hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		</where>   
	</select>
	<select id="queryBudgAdjFile" parameterType="java.util.Map" resultMap="budgWorkCheckMap" >
		select adj_file from budg_work_adj  
		<where>
		<if test="group_id != null and group_id != ''">
				AND group_id = #{group_id,jdbcType=INTEGER}
				</if>
				<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
				</if>
				<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
				</if>
		        <if test="adj_file != null and adj_file != ''">
				AND adj_file = #{copy_code,jdbcType=VARCHAR}
				</if>
		</where>
	</select>
	
	<!-- 初始审批  校验数据是否存在  -->
	<select id="queryDateExist" resultType="java.lang.Integer"  parameterType="java.util.Map" >
	
		SELECT count(1) from budg_work_check
		
		WHERE 
		group_id = #{group_id,jdbcType=INTEGER}   
		and hos_id = #{hos_id,jdbcType=INTEGER}   
		and copy_code = #{copy_code,jdbcType=VARCHAR}  
		and budg_year = #{budg_year,jdbcType=VARCHAR}   
		and check_type = #{check_type,jdbcType=VARCHAR}
	</select>
	
	<!-- 根据参数 查询 初始审批单是否已下达   -->
	<select id="queryInitDateExist" resultType="java.lang.Integer"  parameterType="java.util.Map" >
	
		SELECT count(1) from budg_work_check
		
		WHERE 
		group_id = #{group_id,jdbcType=INTEGER}   
		and hos_id = #{hos_id,jdbcType=INTEGER}   
		and copy_code = #{copy_code,jdbcType=VARCHAR}  
		and budg_year = #{budg_year,jdbcType=VARCHAR}   
		and check_type = #{check_type,jdbcType=VARCHAR}
		and bc_state = #{bc_state,jdbcType=VARCHAR}
	</select>
	
	<!-- 根据参数 查询 是否存在未下达 审批单  -->
	<select id="queryIssueDateExist" resultType="java.lang.Integer"  parameterType="java.util.Map" >
	
		SELECT count(1) from budg_work_check
		
		WHERE 
		group_id = #{group_id,jdbcType=INTEGER}   
		and hos_id = #{hos_id,jdbcType=INTEGER}   
		and copy_code = #{copy_code,jdbcType=VARCHAR}  
		and bc_state != #{bc_state,jdbcType=VARCHAR}
	</select>
	
	<!--查验医院月合计与医院年 数据 是否一致 -->
	<select id="queryHosMonthDataCheck" resultType="java.lang.String" parameterType="java.util.Map">
		with sumMonth as (
			select a.group_id , a.hos_id ,	a.copy_code , a.year , 	a.index_code ,
		 		sum(nvl(a.budg_value,0)) budg_value
	     	from  BUDG_WORK_HOS_MONTH a
	     	Left join budg_index_dict bid
	     		on	
	     			a.group_id = bid.group_id
	     			and a.hos_id = bid.hos_id
	     			and a.copy_code = bid.copy_code
	     			and a.index_code = bid.index_code
	     			and bid.is_stop = 0
			where
				a.group_id = ${group_id}
				AND a.hos_id = ${hos_id}
				AND a.copy_code = ${copy_code}
				AND a.year= ${year}
				AND bid.data_nature = '01'
			group by a.group_id , a.hos_id , a.copy_code , a.year , a.index_code 
		)
		
		select bwhy.index_code ||' '|| bid.index_name
		
		from BUDG_WORK_HOS_YEAR bwhy
		
		Left join budg_index_dict bid
	     		on	
	     			bwhy.group_id = bid.group_id
	     			and bwhy.hos_id = bid.hos_id
	     			and bwhy.copy_code = bid.copy_code
	     			and bwhy.index_code = bid.index_code
	     			and bid.is_stop = 0
		
		left join sumMonth t
			on 
				bwhy.group_id = t.group_id
     			and bwhy.hos_id = t.hos_id
     			and bwhy.copy_code = t.copy_code
     			and bwhy.year = t.year
     			and bwhy.index_code = t.index_code
		where
				bwhy.group_id = #{group_id,jdbcType=INTEGER}
				AND bwhy.hos_id = #{hos_id,jdbcType=INTEGER}
				AND bwhy.copy_code = #{copy_code,jdbcType=VARCHAR}
				AND bwhy.year= #{year,jdbcType=VARCHAR}
				AND bid.data_nature = '01'
				and (( bwhy.budg_value - t.budg_value ) &gt;= ${paraValue} 
						or ( bwhy.budg_value - t.budg_value ) &lt;= -${paraValue}  )
				and bwhy.budg_value != 0
				and bwhy.budg_value is not null
				and t.budg_value != 0
				 
	</select>
	
	<!--查验科室合计与医院年 数据 是否一致 -->
	<select id="queryDeptYearDataCheck" resultType="java.lang.String" parameterType="java.util.Map">
		with sumDeptYear as (
			select a.group_id , a.hos_id ,	a.copy_code , a.year , 	a.index_code ,
		 		sum(nvl(a.budg_value,0)) budg_value
	     	from  BUDG_WORK_DEPT_YEAR a
	     	Left join budg_index_dict bid
	     		on	
	     			a.group_id = bid.group_id
	     			and a.hos_id = bid.hos_id
	     			and a.copy_code = bid.copy_code
	     			and a.index_code = bid.index_code
	     			and bid.is_stop = 0
			where
				a.group_id = ${group_id}
				AND a.hos_id = ${hos_id}
				AND a.copy_code = ${copy_code}
				AND a.year= ${year}
				AND bid.data_nature = '01'
			group by a.group_id , a.hos_id , a.copy_code , a.year , a.index_code 
		)
		
		select bwhy.index_code ||' '|| bid.index_name
		
		from BUDG_WORK_HOS_YEAR bwhy
		
		Left join budg_index_dict bid
	     		on	
	     			bwhy.group_id = bid.group_id
	     			and bwhy.hos_id = bid.hos_id
	     			and bwhy.copy_code = bid.copy_code
	     			and bwhy.index_code = bid.index_code
	     			and bid.is_stop = 0
		
		left join sumDeptYear t
			on 
				bwhy.group_id = t.group_id
     			and bwhy.hos_id = t.hos_id
     			and bwhy.copy_code = t.copy_code
     			and bwhy.year = t.year
     			and bwhy.index_code = t.index_code
		where
				bwhy.group_id = #{group_id,jdbcType=INTEGER}
				AND bwhy.hos_id = #{hos_id,jdbcType=INTEGER}
				AND bwhy.copy_code = #{copy_code,jdbcType=VARCHAR}
				AND bwhy.year= #{year,jdbcType=VARCHAR}
				AND bid.data_nature = '01'
				and (( bwhy.budg_value - t.budg_value ) &gt;= ${paraValue} 
						or ( bwhy.budg_value - t.budg_value ) &lt;= -${paraValue}  )
				and bwhy.budg_value != 0
				and bwhy.budg_value is not null
				and t.budg_value != 0
				 
	</select>
	
	<!-- 查验 科室月合计与科室年 数据 是否一致。 -->
	<select id="queryDeptMonthDataCheck" resultType="java.lang.String" parameterType="java.util.Map">
		with sumDeptMonth as (
			select a.group_id , a.hos_id ,	a.copy_code , a.year , 	a.index_code , a.dept_id ,
		 		sum(nvl(a.budg_value,0)) budg_value
	     	from  BUDG_WORK_DEPT_MONTH a
	     	Left join budg_index_dict bid
	     		on	
	     			a.group_id = bid.group_id
	     			and a.hos_id = bid.hos_id
	     			and a.copy_code = bid.copy_code
	     			and a.index_code = bid.index_code
	     			and bid.is_stop = 0
			where
				a.group_id = ${group_id}
				AND a.hos_id = ${hos_id}
				AND a.copy_code = ${copy_code}
				AND a.year= ${year}
				AND bid.data_nature = '01'
			group by a.group_id , a.hos_id , a.copy_code , a.year , a.index_code , a.dept_id 
		)
		
		select  hdd.dept_name ||'-'|| bwdy.index_code ||' '|| bid.index_name 
		
		from BUDG_WORK_DEPT_YEAR bwdy
		
		Left join budg_index_dict bid
	     		on	
	     			bwdy.group_id = bid.group_id
	     			and bwdy.hos_id = bid.hos_id
	     			and bwdy.copy_code = bid.copy_code
	     			and bwdy.index_code = bid.index_code
	     			and bid.is_stop = 0
    	Left join HOS_DEPT_DICT hdd
     		on	
     			bwdy.group_id = hdd.group_id
     			and bwdy.hos_id = hdd.hos_id
     			and bwdy.dept_id = hdd.dept_id
     			and hdd.is_stop = 0
		
		left join sumDeptMonth t
			on 
				bwdy.group_id = t.group_id
     			and bwdy.hos_id = t.hos_id
     			and bwdy.copy_code = t.copy_code
     			and bwdy.year = t.year
     			and bwdy.index_code = t.index_code
     			and bwdy.dept_id = t.dept_id
		where
				bwdy.group_id = #{group_id,jdbcType=INTEGER}
				AND bwdy.hos_id = #{hos_id,jdbcType=INTEGER}
				AND bwdy.copy_code = #{copy_code,jdbcType=VARCHAR}
				AND bwdy.year= #{year,jdbcType=VARCHAR}
				and (( bwdy.budg_value - t.budg_value ) &gt;= ${paraValue} 
						or ( bwdy.budg_value - t.budg_value ) &lt;= -${paraValue}  )
				AND bid.data_nature = '01'
				and bwdy.budg_value != 0
				and bwdy.budg_value is not null
				and t.budg_value != 0
				 
	</select>
	
	<!-- 状态查询  （校验数据专用） -->
	<select id="queryBudgWorkCheckState" parameterType="java.util.Map" resultType="java.lang.String" >
		SELECT check_code  FROM BUDG_WORK_CHECK 
		WHERE
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND budg_year = #{budg_year,jdbcType=VARCHAR}
			<if test="check_code != null and check_code != ''">
			AND check_code in  (${check_code})
			</if>
			<!-- 前台传参    -->
			and bc_state != #{bc_state,jdbcType=VARCHAR}
	</select>
	
	 <!-- 预算下达时 备份 业务预算医院月份数据 budg_work_hos_month_copy -->
	<insert id="copyHMData" parameterType="java.util.List" >
    	INSERT INTO   BUDG_WORK_HOS_MONTH_COPY (
             check_code, 
             group_id,
             hos_id,
             copy_code,
             year,
             index_code,
             month,
             count_value,
             budg_value ,
             remark,
             grow_rate,
             resolve_rate,
             last_year_workload,
             last_month_carried,
             carried_next_month 
         ) select t.* from(
            <foreach collection="list" item="item" index="index" separator=" union all " >
           select 	
	           #{item.check_code,jdbcType=VARCHAR} ,
	           group_id,
	           hos_id,
	           copy_code,
	           year,
	           index_code,
	           month,
	           count_value ,
	           budg_value ,
	           remark,
	           grow_rate ,
	           resolve_rate ,
	           last_year_workload ,
	           last_month_carried ,
	           carried_next_month
	        from budg_work_hos_month	 
	        where
	             group_id = #{item.group_id,jdbcType=INTEGER}
	             AND hos_id = #{item.hos_id,jdbcType=INTEGER}
	             AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
	             AND year = #{item.budg_year,jdbcType=VARCHAR}
		</foreach>
		)t
	</insert>
	
	<!-- 预算下达时 备份 业务预算 医院年度数据 budg_work_hos_year_copy -->
	<insert id="copyHYData" parameterType="java.util.List" >
	INSERT INTO   BUDG_WORK_HOS_YEAR_COPY
 		(
		 check_code, 
		 group_id,
		 hos_id,
         copy_code,
         year,
         index_code,
         count_value,
         budg_value,
         remark,
         grow_rate,
         grow_value,
         last_year_workload   
		) select t.* from (
		<foreach collection="list" item="item" index="index" separator=" union all " >
	
			select 	
		   		#{item.check_code,jdbcType=VARCHAR},
				group_id,
		        hos_id,
		        copy_code,
		        year,
		        index_code,
		        count_value ,
		        budg_value ,
		        remark,
		        grow_rate,
		        grow_value,
		        last_year_workload
		    from budg_work_hos_year
			where
				group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND year = #{item.budg_year,jdbcType=VARCHAR}
		</foreach>
		)t
	</insert>
	
	<!-- 预算下达时 备份 业务预算科 室年度数据  budg_work_dept_year_copy -->
	<insert id="copyDYData" parameterType="java.util.List" >
		INSERT INTO  BUDG_WORK_DEPT_YEAR_COPY  (
			 check_code,
			 group_id,
		     hos_id,
		     copy_code,
		     year,
		     index_code,
		     dept_id,
		     count_value,
		     budg_value,
		     remark,
		     grow_rate,
		     grow_value,
		     resolve_rate,
		     last_year_workload
		) select t.* from (
			<foreach collection="list" item="item" index="index" separator=" union all " >
		
				select 	
			   		#{item.check_code,jdbcType=VARCHAR} ,
			   		group_id,
				    hos_id,
				    copy_code,
				    year,
				    index_code,
				    dept_id,
				    count_value ,
				    budg_value,
				    remark,
				    grow_rate,
				    grow_value,
				    resolve_rate,
				    last_year_workload
			
			    from budg_work_dept_year
				where
					group_id = #{item.group_id,jdbcType=INTEGER}
					AND hos_id = #{item.hos_id,jdbcType=INTEGER}
					AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
					AND year = #{item.budg_year,jdbcType=VARCHAR}
			</foreach>
			)t
	</insert>
	
	<!-- 预算下达时 备份 业务预算科室月份数据，budg_work_dept_month_copy -->
	<insert id="copyDMData" parameterType="java.util.List" >
		INSERT INTO BUDG_WORK_DEPT_MONTH_COPY (
			 check_code,
			 group_id,
		     hos_id,
		     copy_code,
		     year,
		     index_code,
		     dept_id,
		     month,
		     count_value,
		     budg_value,
		     remark,
		     grow_rate,
		     resolve_rate,
		     last_year_workload,
		     last_month_carried,
		     carried_next_month
			) select t.* from (
			<foreach collection="list" item="item" index="index" separator=" union all " >
				select 	
			   		#{item.check_code,jdbcType=VARCHAR} ,
			   		group_id,
				    hos_id,
				    copy_code,
				    year,
				    index_code,
				    dept_id,
				    month,
				    count_value ,
				    budg_value,
				    remark,
				    grow_rate,
				    resolve_rate,
				    last_year_workload,
				    last_month_carried,
				    carried_next_month
			    from budg_work_dept_month
				where
					group_id = #{item.group_id,jdbcType=INTEGER}
					AND hos_id = #{item.hos_id,jdbcType=INTEGER}
					AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
					AND year = #{item.budg_year,jdbcType=VARCHAR}
			</foreach>
			)t
	</insert>
	
	<!-- 取消下达时  删除业务预算医院月份备份数据 -->
	<delete id="deleteHMCopy" parameterType="java.util.List">
		DELETE FROM budg_work_hos_month_copy
		where
			<foreach collection="list" index="index" item="item" open="(" separator="or" close=")">
				check_code = #{item.check_code,jdbcType=VARCHAR}
				AND group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND year = #{item.budg_year,jdbcType=VARCHAR}
			</foreach>
	</delete>
	
	<!-- 取消下达时 删除业务预算医院年度备份数据 -->
	<delete id="deleteHYCopy" parameterType="java.util.List">
		DELETE FROM budg_work_hos_year_copy
		where
			<foreach collection="list" index="index" item="item" open="(" separator="or" close=")">
				check_code = #{item.check_code,jdbcType=VARCHAR}
				AND group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND year = #{item.budg_year,jdbcType=VARCHAR}
			</foreach>
	</delete>
	
	<!-- 取消下达时 删除业务预算科室月份备份数据 -->
	<delete id="deleteDMCopy" parameterType="java.util.List">
		DELETE FROM budg_work_dept_month_copy
		where
			<foreach collection="list" index="index" item="item" open="(" separator="or" close=")">
				check_code = #{item.check_code,jdbcType=VARCHAR}
				AND group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND year = #{item.budg_year,jdbcType=VARCHAR}
			</foreach>
	</delete>
	
	<!-- 取消下达时 删除业务预算科室年度备份数据 -->
	<delete id="deleteDYCopy"  parameterType="java.util.List">
		DELETE FROM budg_work_dept_year_copy
		where
			<foreach collection="list" index="index" item="item" open="(" separator="or" close=")">
				check_code = #{item.check_code,jdbcType=VARCHAR}
				AND group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND year = #{item.budg_year,jdbcType=VARCHAR}
			</foreach>
	</delete>
	
	<!-- 查询 审批申请单是否已做调整 -->
	<select id="queryIsAdjust" parameterType="java.util.Map" resultType="java.lang.Integer" >
		SELECT COUNT(1)  FROM BUDG_WORK_ADJ
		WHERE
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND budg_year = #{budg_year,jdbcType=VARCHAR}
			AND last_check_code = #{check_code,jdbcType=VARCHAR}
	</select>
	
	<!-- 查询最大审批申请单号 -->
	<select id="queryMaxCheckCode" parameterType="java.util.Map" resultType="java.lang.String" >
		SELECT max(check_code)  FROM BUDG_WORK_CHECK
		WHERE
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND budg_year = #{budg_year,jdbcType=VARCHAR}
	</select>
	
	
	<update id="updateMaxNo"   parameterType="java.util.Map">
		update   budg_no_manage set max_no = max_no - 1
		where
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND table_code = #{table_code,jdbcType=VARCHAR}
			AND year = #{budg_year,jdbcType=VARCHAR}
	</update>
	
	<!-- 查询 审批申请单是否已做调整(取消预算下达时使用) -->
	<select id="queryCheckIsAdjust" parameterType="java.util.Map" resultType="java.lang.String" >
		<foreach collection="list" item="item" index="index" separator=" union all " >
			SELECT distinct last_check_code FROM BUDG_WORK_ADJ
			WHERE
				group_id = #{item.group_id,jdbcType=INTEGER}
				AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				AND budg_year = #{item.budg_year,jdbcType=VARCHAR}
				AND last_check_code = #{item.check_code,jdbcType=VARCHAR}
		</foreach>
	</select>
	
	<!-- 更新医院意见 -->
	<update id="updateHosSuggest" parameterType="java.util.Map">
		UPDATE BUDG_WORK_HOS_YEAR set
			hos_suggest = #{hos_suggest,jdbcType=INTEGER} 
		where                     
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND year = #{year,jdbcType=VARCHAR}
			AND index_code = #{index_code,jdbcType=VARCHAR}
	
	</update>
	
	<!-- 更新科室意见 -->
	<update id="updateDeptSuggest" parameterType="java.util.Map">
		UPDATE BUDG_WORK_DEPT_YEAR set
			dept_suggest = #{dept_suggest,jdbcType=INTEGER} 
		where                     
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND year = #{year,jdbcType=VARCHAR}
			AND index_code = #{index_code,jdbcType=VARCHAR}
			AND dept_id = #{dept_id,jdbcType=INTEGER}
	</update>
	
	<!-- 根据所传预算年度 查询 业务预算编制模式 -->
	<select id="queryWorkBudgMode" parameterType="java.util.Map" resultType="java.lang.String" >
		SELECT work_budg_mode  FROM BUDG_SYS_SET
		WHERE
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			AND budg_year = #{budg_year,jdbcType=VARCHAR}
	</select>
</mapper>

