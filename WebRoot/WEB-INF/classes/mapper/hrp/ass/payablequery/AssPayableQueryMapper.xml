<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.ass.dao.payablequery.AssPayableQueryMapper">
	
	<resultMap id="goodsArrivedInvoiceNotMap" type="java.util.Map">
		<result property="ass_card_no" column="ass_card_no"/>
		<result property="ass_name" column="ass_name"/>
		<result property="ass_type_name" column="ass_type_name"/>
		<result property="naturs_name" column="naturs_name"/>
		<result property="in_date" column="in_date"/>
		<result property="ass_spec" column="ass_spec"/>
		<result property="ass_mondl" column="ass_mondl"/>
		<result property="ass_brand" column="ass_brand"/>
		<result property="ven_name" column="ven_name"/>
		<result property="ass_seq_no" column="ass_seq_no"/>
		<result property="ass_in_no" column="ass_in_no"/>
		<result property="equi_usage_name" column="equi_usage_name"/>
		<result property="dept_name" column="dept_name"/>
		<result property="store_name" column="store_name"/>
	</resultMap>
	
	<resultMap id="paySearchMap" type="java.util.Map">
		<result property="ass_card_no" column="ass_card_no"/>
		<result property="ass_name" column="ass_name"/>
		<result property="ass_type_name" column="ass_type_name"/>
		<result property="naturs_name" column="naturs_name"/>
		<result property="in_date" column="in_date"/>
		<result property="ass_spec" column="ass_spec"/>
		<result property="ass_mondl" column="ass_mondl"/>
		<result property="ass_brand" column="ass_brand"/>
		<result property="ven_name" column="ven_name"/>
		<result property="ass_seq_no" column="ass_seq_no"/>
		<result property="ass_in_no" column="ass_in_no"/>
		<result property="equi_usage_name" column="equi_usage_name"/>
		<result property="dept_name" column="dept_name"/>
		<result property="store_name" column="store_name"/>
		<result property="price" column="price"/>
		<result property="pay_plan_money" column="pay_plan_money"/>
		<result property="pay_money" column="pay_money"/>
		<result property="unpay_money" column="unpay_money"/>
	</resultMap>
	
	<resultMap id="payCardSearchMap" type="java.util.Map">
		<result property="ass_card_no" column="ass_card_no"/>
		<result property="ass_name" column="ass_name"/>
		<result property="price" column="price"/>
		<result property="nc_d" column="nc_d"/>
		<result property="nc_c" column="nc_c"/>
		<result property="nc_e" column="nc_e"/>
		<result property="nc_f" column="nc_f"/>
		<result property="qc_d" column="qc_d"/>
		<result property="qc_c" column="qc_c"/>
		<result property="qc_e" column="qc_e"/>
		<result property="qc_f" column="qc_f"/>
	</resultMap>
	
	
	<resultMap id="payVenSearchMap" type="java.util.Map">
		<result property="ven_name" column="ven_name"/>
		<result property="price" column="price"/>
		<result property="nc_d" column="nc_d"/>
		<result property="nc_c" column="nc_c"/>
		<result property="nc_e" column="nc_e"/>
		<result property="nc_f" column="nc_f"/>
		<result property="qc_d" column="qc_d"/>
		<result property="qc_c" column="qc_c"/>
		<result property="qc_e" column="qc_e"/>
		<result property="qc_f" column="qc_f"/>
	</resultMap>
	
	
	
	<select id="queryGoodsArrivedInvoiceNot" parameterType="java.util.Map" resultMap="goodsArrivedInvoiceNotMap" >
		select * from (
			  select 
			    t.ass_card_no,
			    t1.ass_code||' '||t1.ass_name ass_name,
			    t2.ass_type_name,
			    t3.naturs_name,
			    t.in_date,
			    t.run_date,
			    t.ass_spec,
			    t.ass_mondl,
			    t.ass_brand,
			    t4.sup_code||' '||t4.sup_name ven_name,
			    t.ass_seq_no,
			    t.ass_in_no,
			    t5.equi_usage_name,
			    t6.dept_code||' '||t6.dept_name dept_name,
			    t7.store_code||' '||t7.store_name store_name,
			    t.dept_id,
			    t.dept_no,
			    t.use_state,
			    t.ass_id,
			    t.ass_no,
			    t2.ass_type_id,
			    t2.acc_type_code,
			    t.ass_purpose,
			    t.store_id,
			    t.store_no,
			    t.ven_id,
			    t.ven_no
			  from ass_card_special t 
			
			  left join ass_no_dict t1 on
			  t.group_id = t1.group_id
			  and t.hos_id = t1.hos_id
			  and t.copy_code = t1.copy_code
			  and t.ass_id = t1.ass_id
			  and t1.is_stop = 0
			
			  left join ass_type_dict t2 on
			  t1.group_id = t2.group_id
			  and t1.hos_id = t2.hos_id
			  and t1.copy_code = t2.copy_code
			  and t1.ass_type_id = t2.ass_type_id
			
			  left join ass_naturs t3 on
			  t2.ass_naturs = t3.naturs_code
			
			  left join hos_sup_dict t4 on
			  t.group_id = t4.group_id
			  and t.hos_id = t4.hos_id
			  and t.ven_id = t4.sup_id
			  and t4.is_stop = 0
			
			  left join ASS_USAGE_DICT t5 on
			  t.group_id = t5.group_id
			  and t.hos_id = t5.hos_id
			  and t.copy_code = t5.copy_code
			  and t.ass_purpose = t5.equi_usage_code
			
			  left join hos_dept_dict t6 on
			  t.group_id = t6.group_id
			  and t.hos_id = t6.hos_id
			  and t.dept_id = t6.dept_id
			  and t6.is_stop = 0
			
			  left join hos_store_dict t7 on
			  t.group_id = t7.group_id
			  and t.hos_id = t7.hos_id
			  and t.store_id = t7.store_id
			  and t7.is_stop = 0
			
			  where 
			  	  t.group_id = #{group_id}
			  	  and t.hos_id = #{hos_id}
			  	  and t.copy_code = #{copy_code}
			      and t.in_date is not null
			      and t.ass_card_no not in (
			          select ass_card_no from ass_bill_detail d
			          left join ass_bill_main m on
			          d.group_id = m.group_id
			          and d.hos_id = m.hos_id
			          and d.copy_code = m.copy_code
			          and d.bill_no = m.bill_no
			          where d.group_id = #{group_id}
			                and d.hos_id = #{hos_id}
			                and d.copy_code = #{copy_code}
			                and m.state = 2
			          group by d.ass_card_no    
			      )
			  union all
			
			  select 
			    t.ass_card_no,
			    t1.ass_code||' '||t1.ass_name ass_name,
			    t2.ass_type_name,
			    t3.naturs_name,
			    t.in_date,
			    t.run_date,
			    t.ass_spec,
			    t.ass_mondl,
			    t.ass_brand,
			    t4.sup_code||' '||t4.sup_name ven_name,
			    t.ass_seq_no,
			    t.ass_in_no,
			    t5.equi_usage_name,
			    t6.dept_code||' '||t6.dept_name dept_name,
			    t7.store_code||' '||t7.store_name store_name,
			    t.dept_id,
			    t.dept_no,
			    t.use_state,
			    t.ass_id,
			    t.ass_no,
			    t2.ass_type_id,
			    t2.acc_type_code,
			    t.ass_purpose,
			    t.store_id,
			    t.store_no,
			    t.ven_id,
			    t.ven_no
			  from ass_card_general t 
			
			  left join ass_no_dict t1 on
			  t.group_id = t1.group_id
			  and t.hos_id = t1.hos_id
			  and t.copy_code = t1.copy_code
			  and t.ass_id = t1.ass_id
			  and t1.is_stop = 0
			
			  left join ass_type_dict t2 on
			  t1.group_id = t2.group_id
			  and t1.hos_id = t2.hos_id
			  and t1.copy_code = t2.copy_code
			  and t1.ass_type_id = t2.ass_type_id
			
			  left join ass_naturs t3 on
			  t2.ass_naturs = t3.naturs_code
			
			  left join hos_sup_dict t4 on
			  t.group_id = t4.group_id
			  and t.hos_id = t4.hos_id
			  and t.ven_id = t4.sup_id
			  and t4.is_stop = 0
			
			  left join ASS_USAGE_DICT t5 on
			  t.group_id = t5.group_id
			  and t.hos_id = t5.hos_id
			  and t.copy_code = t5.copy_code
			  and t.ass_purpose = t5.equi_usage_code
			
			  left join hos_dept_dict t6 on
			  t.group_id = t6.group_id
			  and t.hos_id = t6.hos_id
			  and t.dept_id = t6.dept_id
			  and t6.is_stop = 0
			
			  left join hos_store_dict t7 on
			  t.group_id = t7.group_id
			  and t.hos_id = t7.hos_id
			  and t.store_id = t7.store_id
			  and t7.is_stop = 0
			
			  where 
			  	  t.group_id = #{group_id}
			  	  and t.hos_id = #{hos_id}
			  	  and t.copy_code = #{copy_code}
			      and t.in_date is not null
			      and t.ass_card_no not in (
			          select ass_card_no from ass_bill_detail d
			          left join ass_bill_main m on
			          d.group_id = m.group_id
			          and d.hos_id = m.hos_id
			          and d.copy_code = m.copy_code
			          and d.bill_no = m.bill_no
			          where d.group_id = #{group_id}
			                and d.hos_id = #{hos_id}
			                and d.copy_code = #{copy_code}
			                and m.state = 2
			          group by d.ass_card_no      
			      )  
			        
			union all
			
			select 
			    t.ass_card_no,
			    t1.ass_code||' '||t1.ass_name ass_name,
			    t2.ass_type_name,
			    t3.naturs_name,
			    t.in_date,
			    t.run_date,
			    '' ass_spec,
			    '' ass_mondl,
			    '' ass_brand,
			    t4.sup_code||' '||t4.sup_name ven_name,
			    null ass_seq_no,
			    t.ass_in_no,
			    t5.equi_usage_name,
			    t6.dept_code||' '||t6.dept_name dept_name,
			    t7.store_code||' '||t7.store_name store_name,
			    t.dept_id,
			    t.dept_no,
			    t.use_state,
			    t.ass_id,
			    t.ass_no,
			    t2.ass_type_id,
			    t2.acc_type_code,
			    '' ass_purpose,
			    null store_id,
			    null store_no,
			    t.ven_id,
			    t.ven_no
			  from ass_card_inassets t 
			
			  left join ass_no_dict t1 on
			  t.group_id = t1.group_id
			  and t.hos_id = t1.hos_id
			  and t.copy_code = t1.copy_code
			  and t.ass_id = t1.ass_id
			  and t1.is_stop = 0
			
			  left join ass_type_dict t2 on
			  t1.group_id = t2.group_id
			  and t1.hos_id = t2.hos_id
			  and t1.copy_code = t2.copy_code
			  and t1.ass_type_id = t2.ass_type_id
			
			  left join ass_naturs t3 on
			  t2.ass_naturs = t3.naturs_code
			
			  left join hos_sup_dict t4 on
			  t.group_id = t4.group_id
			  and t.hos_id = t4.hos_id
			  and t.ven_id = t4.sup_id
			  and t4.is_stop = 0
			
			  left join ASS_USAGE_DICT t5 on
			  t.group_id = t5.group_id
			  and t.hos_id = t5.hos_id
			  and t.copy_code = t5.copy_code
			  and t.ass_purpose = t5.equi_usage_code
			
			  left join hos_dept_dict t6 on
			  t.group_id = t6.group_id
			  and t.hos_id = t6.hos_id
			  and t.dept_id = t6.dept_id
			  and t6.is_stop = 0
			
			  left join hos_store_dict t7 on
			  t.group_id = t7.group_id
			  and t.hos_id = t7.hos_id
			  and t.store_id = t7.store_id
			  and t7.is_stop = 0
			
			  where 
			  	  t.group_id = #{group_id}
			  	  and t.hos_id = #{hos_id}
			  	  and t.copy_code = #{copy_code}
			      and t.in_date is not null
			      and t.ass_card_no not in (
			          select ass_card_no from ass_bill_detail d
			          left join ass_bill_main m on
			          d.group_id = m.group_id
			          and d.hos_id = m.hos_id
			          and d.copy_code = m.copy_code
			          and d.bill_no = m.bill_no
			          where d.group_id = #{group_id}
			                and d.hos_id = #{hos_id}
			                and d.copy_code = #{copy_code}
			                and m.state = 2
			          group by d.ass_card_no      
			      )    
			
			union all
			
			select 
			    t.ass_card_no,
			    t1.ass_code||' '||t1.ass_name ass_name,
			    t2.ass_type_name,
			    t3.naturs_name,
			    t.in_date,
			    t.run_date,
			    '' ass_spec,
			    '' ass_mondl,
			    '' ass_brand,
			    t4.sup_code||' '||t4.sup_name ven_name,
			    null ass_seq_no,
			    t.ass_in_no,
			    '' equi_usage_name,
			    t6.dept_code||' '||t6.dept_name dept_name,
			    '' store_name,
			    t.dept_id,
			    t.dept_no,
			    t.use_state,
			    t.ass_id,
			    t.ass_no,
			    t2.ass_type_id,
			    t2.acc_type_code,
			    '' ass_purpose,
			    null store_id,
			    null store_no,
			    t.ven_id,
			    t.ven_no
			  from ass_card_house t 
			
			  left join ass_no_dict t1 on
			  t.group_id = t1.group_id
			  and t.hos_id = t1.hos_id
			  and t.copy_code = t1.copy_code
			  and t.ass_id = t1.ass_id
			  and t1.is_stop = 0
			
			  left join ass_type_dict t2 on
			  t1.group_id = t2.group_id
			  and t1.hos_id = t2.hos_id
			  and t1.copy_code = t2.copy_code
			  and t1.ass_type_id = t2.ass_type_id
			
			  left join ass_naturs t3 on
			  t2.ass_naturs = t3.naturs_code
			
			  left join hos_sup_dict t4 on
			  t.group_id = t4.group_id
			  and t.hos_id = t4.hos_id
			  and t.ven_id = t4.sup_id
			  and t4.is_stop = 0
			
			
			
			  left join hos_dept_dict t6 on
			  t.group_id = t6.group_id
			  and t.hos_id = t6.hos_id
			  and t.dept_id = t6.dept_id
			  and t6.is_stop = 0
			
			  where 
			      t.group_id = #{group_id}
			  	  and t.hos_id = #{hos_id}
			  	  and t.copy_code = #{copy_code}
			      and t.in_date is not null
			      and t.ass_card_no not in (
			          select ass_card_no from ass_bill_detail d
			          left join ass_bill_main m on
			          d.group_id = m.group_id
			          and d.hos_id = m.hos_id
			          and d.copy_code = m.copy_code
			          and d.bill_no = m.bill_no
			          where d.group_id = #{group_id}
			                and d.hos_id = #{hos_id}
			                and d.copy_code = #{copy_code}
			                and m.state = 2
			          group by d.ass_card_no      
			      )    
			
			union all
			
			select 
			    t.ass_card_no,
			    t1.ass_code||' '||t1.ass_name ass_name,
			    t2.ass_type_name,
			    t3.naturs_name,
			    t.in_date,
			    t.run_date,
			    t.ass_spec,
			    t.ass_mondl,
			    t.ass_brand,
			    t4.sup_code||' '||t4.sup_name ven_name,
			    t.ass_seq_no,
			    t.ass_in_no,
			    t5.equi_usage_name,
			    t6.dept_code||' '||t6.dept_name dept_name,
			    t7.store_code||' '||t7.store_name store_name,
			    t.dept_id,
			    t.dept_no,
			    t.use_state,
			    t.ass_id,
			    t.ass_no,
			    t2.ass_type_id,
			    t2.acc_type_code,
			    t.ass_purpose,
			    t.store_id,
			    t.store_no,
			    t.ven_id,
			    t.ven_no
			  from ass_card_other t 
			
			  left join ass_no_dict t1 on
			  t.group_id = t1.group_id
			  and t.hos_id = t1.hos_id
			  and t.copy_code = t1.copy_code
			  and t.ass_id = t1.ass_id
			  and t1.is_stop = 0
			
			  left join ass_type_dict t2 on
			  t1.group_id = t2.group_id
			  and t1.hos_id = t2.hos_id
			  and t1.copy_code = t2.copy_code
			  and t1.ass_type_id = t2.ass_type_id
			
			  left join ass_naturs t3 on
			  t2.ass_naturs = t3.naturs_code
			
			  left join hos_sup_dict t4 on
			  t.group_id = t4.group_id
			  and t.hos_id = t4.hos_id
			  and t.ven_id = t4.sup_id
			  and t4.is_stop = 0
			
			  left join ASS_USAGE_DICT t5 on
			  t.group_id = t5.group_id
			  and t.hos_id = t5.hos_id
			  and t.copy_code = t5.copy_code
			  and t.ass_purpose = t5.equi_usage_code
			
			  left join hos_dept_dict t6 on
			  t.group_id = t6.group_id
			  and t.hos_id = t6.hos_id
			  and t.dept_id = t6.dept_id
			  and t6.is_stop = 0
			
			  left join hos_store_dict t7 on
			  t.group_id = t7.group_id
			  and t.hos_id = t7.hos_id
			  and t.store_id = t7.store_id
			  and t7.is_stop = 0
			
			  where 
			     t.group_id = #{group_id}
			  	  and t.hos_id = #{hos_id}
			  	  and t.copy_code = #{copy_code}
			      and t.in_date is not null
			      and t.ass_card_no not in (
			          select ass_card_no from ass_bill_detail d
			          left join ass_bill_main m on
			          d.group_id = m.group_id
			          and d.hos_id = m.hos_id
			          and d.copy_code = m.copy_code
			          and d.bill_no = m.bill_no
			          where d.group_id = #{group_id}
			                and d.hos_id = #{hos_id}
			                and d.copy_code = #{copy_code}
			                and m.state = 2
			          group by d.ass_card_no    
			      )
			      
			union all
			
			select 
			    t.ass_card_no,
			    t1.ass_code||' '||t1.ass_name ass_name,
			    t2.ass_type_name,
			    t3.naturs_name,
			    t.in_date,
			    t.run_date,
			    '' ass_spec,
			    '' ass_mondl,
			    '' ass_brand,
			    t4.sup_code||' '||t4.sup_name ven_name,
			    null ass_seq_no,
			    t.ass_in_no,
			    '' equi_usage_name,
			    t6.dept_code||' '||t6.dept_name dept_name,
			    '' store_name,
			    t.dept_id,
			    t.dept_no,
			    t.use_state,
			    t.ass_id,
			    t.ass_no,
			    t2.ass_type_id,
			    t2.acc_type_code,
			    '' ass_purpose,
			    null store_id,
			    null store_no,
			    t.ven_id,
			    t.ven_no
			  from ass_card_land t 
			
			  left join ass_no_dict t1 on
			  t.group_id = t1.group_id
			  and t.hos_id = t1.hos_id
			  and t.copy_code = t1.copy_code
			  and t.ass_id = t1.ass_id
			  and t1.is_stop = 0
			
			  left join ass_type_dict t2 on
			  t1.group_id = t2.group_id
			  and t1.hos_id = t2.hos_id
			  and t1.copy_code = t2.copy_code
			  and t1.ass_type_id = t2.ass_type_id
			
			  left join ass_naturs t3 on
			  t2.ass_naturs = t3.naturs_code
			
			  left join hos_sup_dict t4 on
			  t.group_id = t4.group_id
			  and t.hos_id = t4.hos_id
			  and t.ven_id = t4.sup_id
			  and t4.is_stop = 0
			
			  left join hos_dept_dict t6 on
			  t.group_id = t6.group_id
			  and t.hos_id = t6.hos_id
			  and t.dept_id = t6.dept_id
			  and t6.is_stop = 0
			
			  where 
			      t.group_id = #{group_id}
			  	  and t.hos_id = #{hos_id}
			  	  and t.copy_code = #{copy_code}
			      and t.in_date is not null
			      and t.ass_card_no not in (
			          select ass_card_no from ass_bill_detail d
			          left join ass_bill_main m on
			          d.group_id = m.group_id
			          and d.hos_id = m.hos_id
			          and d.copy_code = m.copy_code
			          and d.bill_no = m.bill_no
			          where d.group_id = #{group_id}
			                and d.hos_id = #{hos_id}
			                and d.copy_code = #{copy_code}
			                and m.state = 2
			          group by d.ass_card_no    
			      )      
			) t      
			<where>
				   <if test="use_state != null and use_state != ''">
			      	and t.use_state = #{use_state}
			       </if>
			       <if test="dept_id != null and dept_id != ''">
			      	and t.dept_id = #{dept_id}
			       </if>
			       <if test="dept_no != null and dept_no != ''">
			      	and t.dept_no = #{dept_no}
			       </if>
			       <if test="ass_card_no != null and ass_card_no != ''">
					and t.ass_card_no like '%${ass_card_no}%'
				   </if>
			       <if test="ass_id != null and ass_id != ''">
					and t.ass_id = #{ass_id}
				   </if>
				   <if test="ass_no != null and ass_no != ''">
				    and t.ass_no = #{ass_no}
				   </if>
				   <if test="store_id != null and store_id != ''">
					and t.store_id = #{store_id}
				   </if>
				   <if test="store_no != null and store_no != ''">
				    and t.store_no = #{store_no}
				   </if>
				   <if test="ven_id != null and ven_id != ''">
					and t.ven_id = #{ven_id}
				   </if>
				   <if test="ven_no != null and ven_no != ''">
				    and t.ven_no = #{ven_no}
				   </if>
				   <if test="ass_type_id != null and ass_type_id != ''">
					AND t.ass_type_id = #{ass_type_id}
				   </if>
				   <if test="fina_type_code != null and fina_type_code != ''">
					AND t.acc_type_code = #{fina_type_code}
				   </if>
				   <if test="ass_purpose != null and ass_purpose != ''">
					AND t.ass_purpose = #{ass_purpose}
				   </if>
				   <if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				    AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
				   </if>
				   <if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				    AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
				   </if>
			</where>
		order by t.ass_card_no
	</select>
	
	
	<select id="queryPaySearch" parameterType="java.util.Map" resultMap="paySearchMap">
		select *
		from (
					select t.ass_card_no, t1.ass_code || ' ' || t1.ass_name as ass_name, t2.ass_type_name, t3.naturs_name, t.in_date
						, t.run_date, t.ass_spec, t.ass_mondl, t.ass_brand, t4.sup_code || ' ' || t4.sup_name as ven_name
						, t.ass_seq_no, t.ass_in_no, t5.equi_usage_name, t6.dept_code || ' ' || t6.dept_name as dept_name, t7.store_code || ' ' || t7.store_name as store_name
						, t.dept_id, t.dept_no, t.use_state, t.ass_id, t.ass_no
						, t2.ass_type_id, t2.acc_type_code, t.ass_purpose, t.store_id, t.store_no
						, t.ven_id, t.ven_no,t.price,t8.pay_plan_money,t8.pay_money,t8.unpay_money
					from ass_card_special t
					left join ass_no_dict t1 on 
		      t.group_id = t1.group_id
					and t.hos_id = t1.hos_id
					and t.copy_code = t1.copy_code
					and t.ass_id = t1.ass_id
					and t1.is_stop = 0 
					left join ass_type_dict t2 on 
		      t1.group_id = t2.group_id
					and t1.hos_id = t2.hos_id
					and t1.copy_code = t2.copy_code
					and t1.ass_type_id = t2.ass_type_id 
					left join ass_naturs t3 on 
		      t2.ass_naturs = t3.naturs_code 
					left join hos_sup_dict t4 on 
		      t.group_id = t4.group_id
					and t.hos_id = t4.hos_id
					and t.ven_id = t4.sup_id
					and t4.is_stop = 0 
					left join ass_usage_dict t5 on
		       t.group_id = t5.group_id
					and t.hos_id = t5.hos_id
					and t.copy_code = t5.copy_code
					and t.ass_purpose = t5.equi_usage_code 
					left join hos_dept_dict t6 on 
		      t.group_id = t6.group_id
					and t.hos_id = t6.hos_id
					and t.dept_id = t6.dept_id
					and t6.is_stop = 0 
					left join hos_store_dict t7 on 
		      t.group_id = t7.group_id
					and t.hos_id = t7.hos_id
					and t.store_id = t7.store_id
					and t7.is_stop = 0 
		      
		      left join (
		           select 
		           a.group_id,
		           a.hos_id,
		           a.copy_code,
		           a.ass_card_no,
		           sum(a.pay_plan_money) pay_plan_money,
		           sum(a.pay_money) pay_money,
		           sum(a.unpay_money) unpay_money 
		           from ass_pay_stage_special a
		           left join ass_card_special b on
		           a.group_id = b.group_id
		           and a.hos_id = b.hos_id
		           and a.copy_code = b.copy_code
		           and a.ass_card_no = b.ass_card_no
		           group by a.group_id,a.hos_id,a.copy_code,a.ass_card_no
		      ) t8 on 
		      t.group_id = t8.group_id
		      and t.hos_id = t8.hos_id
		      and t.copy_code = t8.copy_code
		      and t.ass_card_no = t8.ass_card_no
		      
		      
					where t.group_id = #{group_id}
						and t.hos_id = #{hos_id}
						and t.copy_code = #{copy_code}
						and t.in_date is not null
						
					union all
					select t.ass_card_no, t1.ass_code || ' ' || t1.ass_name as ass_name, t2.ass_type_name, t3.naturs_name, t.in_date
						, t.run_date, t.ass_spec, t.ass_mondl, t.ass_brand, t4.sup_code || ' ' || t4.sup_name as ven_name
						, t.ass_seq_no, t.ass_in_no, t5.equi_usage_name, t6.dept_code || ' ' || t6.dept_name as dept_name, t7.store_code || ' ' || t7.store_name as store_name
						, t.dept_id, t.dept_no, t.use_state, t.ass_id, t.ass_no
						, t2.ass_type_id, t2.acc_type_code, t.ass_purpose, t.store_id, t.store_no
						, t.ven_id, t.ven_no,t.price,t8.pay_plan_money,t8.pay_money,t8.unpay_money
					from ass_card_general t
					left join ass_no_dict t1 on t.group_id = t1.group_id
					and t.hos_id = t1.hos_id
					and t.copy_code = t1.copy_code
					and t.ass_id = t1.ass_id
					and t1.is_stop = 0 
					left join ass_type_dict t2 on t1.group_id = t2.group_id
					and t1.hos_id = t2.hos_id
					and t1.copy_code = t2.copy_code
					and t1.ass_type_id = t2.ass_type_id 
					left join ass_naturs t3 on t2.ass_naturs = t3.naturs_code 
					left join hos_sup_dict t4 on t.group_id = t4.group_id
					and t.hos_id = t4.hos_id
					and t.ven_id = t4.sup_id
					and t4.is_stop = 0 
					left join ass_usage_dict t5 on t.group_id = t5.group_id
					and t.hos_id = t5.hos_id
					and t.copy_code = t5.copy_code
					and t.ass_purpose = t5.equi_usage_code 
					left join hos_dept_dict t6 on t.group_id = t6.group_id
					and t.hos_id = t6.hos_id
					and t.dept_id = t6.dept_id
					and t6.is_stop = 0 
						left join hos_store_dict t7 on t.group_id = t7.group_id
					and t.hos_id = t7.hos_id
					and t.store_id = t7.store_id
					and t7.is_stop = 0 
		      
		      left join (
		           select 
		           a.group_id,
		           a.hos_id,
		           a.copy_code,
		           a.ass_card_no,
		           sum(a.pay_plan_money) pay_plan_money,
		           sum(a.pay_money) pay_money,
		           sum(a.unpay_money) unpay_money 
		           from ass_pay_stage_general a
		           left join ass_card_general b on
		           a.group_id = b.group_id
		           and a.hos_id = b.hos_id
		           and a.copy_code = b.copy_code
		           and a.ass_card_no = b.ass_card_no
		           group by a.group_id,a.hos_id,a.copy_code,a.ass_card_no
		      ) t8 on 
		      t.group_id = t8.group_id
		      and t.hos_id = t8.hos_id
		      and t.copy_code = t8.copy_code
		      and t.ass_card_no = t8.ass_card_no
		      
					where t.group_id = #{group_id}
						and t.hos_id = #{hos_id}
						and t.copy_code = #{copy_code}
						and t.in_date is not null
					  
					union all
					select t.ass_card_no, t1.ass_code || ' ' || t1.ass_name as ass_name, t2.ass_type_name, t3.naturs_name, t.in_date
						, t.run_date, null as ass_spec, null as ass_mondl, null as ass_brand, t4.sup_code || ' ' || t4.sup_name as ven_name
						, null as ass_seq_no, t.ass_in_no, t5.equi_usage_name, t6.dept_code || ' ' || t6.dept_name as dept_name, t7.store_code || ' ' || t7.store_name as store_name
						, t.dept_id, t.dept_no, t.use_state, t.ass_id, t.ass_no
						, t2.ass_type_id, t2.acc_type_code, null as ass_purpose, null as store_id, null as store_no
						, t.ven_id, t.ven_no,t.price,t8.pay_plan_money,t8.pay_money,t8.unpay_money
					from ass_card_inassets t
					left join ass_no_dict t1 on t.group_id = t1.group_id
					and t.hos_id = t1.hos_id
					and t.copy_code = t1.copy_code
					and t.ass_id = t1.ass_id
					and t1.is_stop = 0 
					left join ass_type_dict t2 on t1.group_id = t2.group_id
					and t1.hos_id = t2.hos_id
					and t1.copy_code = t2.copy_code
					and t1.ass_type_id = t2.ass_type_id 
					left join ass_naturs t3 on t2.ass_naturs = t3.naturs_code 
					left join hos_sup_dict t4 on t.group_id = t4.group_id
					and t.hos_id = t4.hos_id
					and t.ven_id = t4.sup_id
					and t4.is_stop = 0 
					left join ass_usage_dict t5 on t.group_id = t5.group_id
					and t.hos_id = t5.hos_id
					and t.copy_code = t5.copy_code
					and t.ass_purpose = t5.equi_usage_code 
					left join hos_dept_dict t6 on t.group_id = t6.group_id
					and t.hos_id = t6.hos_id
					and t.dept_id = t6.dept_id
					and t6.is_stop = 0 
						left join hos_store_dict t7 on t.group_id = t7.group_id
					and t.hos_id = t7.hos_id
					and t.store_id = t7.store_id
					and t7.is_stop = 0 
		      
		      left join (
		           select 
		           a.group_id,
		           a.hos_id,
		           a.copy_code,
		           a.ass_card_no,
		           sum(a.pay_plan_money) pay_plan_money,
		           sum(a.pay_money) pay_money,
		           sum(a.unpay_money) unpay_money 
		           from ass_pay_stage_inassets a
		           left join ass_card_inassets b on
		           a.group_id = b.group_id
		           and a.hos_id = b.hos_id
		           and a.copy_code = b.copy_code
		           and a.ass_card_no = b.ass_card_no
		           group by a.group_id,a.hos_id,a.copy_code,a.ass_card_no
		      ) t8 on 
		      t.group_id = t8.group_id
		      and t.hos_id = t8.hos_id
		      and t.copy_code = t8.copy_code
		      and t.ass_card_no = t8.ass_card_no
		      
					where t.group_id = #{group_id}
						and t.hos_id = #{hos_id}
						and t.copy_code = #{copy_code}
						and t.in_date is not null
						
					union all
					select t.ass_card_no, t1.ass_code || ' ' || t1.ass_name as ass_name, t2.ass_type_name, t3.naturs_name, t.in_date
						, t.run_date, null as ass_spec, null as ass_mondl, null as ass_brand, t4.sup_code || ' ' || t4.sup_name as ven_name
						, null as ass_seq_no, t.ass_in_no, null as equi_usage_name, t6.dept_code || ' ' || t6.dept_name as dept_name, null as store_name
						, t.dept_id, t.dept_no, t.use_state, t.ass_id, t.ass_no
						, t2.ass_type_id, t2.acc_type_code, null as ass_purpose, null as store_id, null as store_no
						, t.ven_id, t.ven_no,t.price,t8.pay_plan_money,t8.pay_money,t8.unpay_money
					from ass_card_house t
					left join ass_no_dict t1 on t.group_id = t1.group_id
					and t.hos_id = t1.hos_id
					and t.copy_code = t1.copy_code
					and t.ass_id = t1.ass_id
					and t1.is_stop = 0 
					left join ass_type_dict t2 on t1.group_id = t2.group_id
		      and t1.hos_id = t2.hos_id
		      and t1.copy_code = t2.copy_code
		      and t1.ass_type_id = t2.ass_type_id 
		      left join ass_naturs t3 on t2.ass_naturs = t3.naturs_code 
		      left join hos_sup_dict t4 on t.group_id = t4.group_id
		      and t.hos_id = t4.hos_id
		      and t.ven_id = t4.sup_id
		      and t4.is_stop = 0 
		        left join hos_dept_dict t6 on t.group_id = t6.group_id
		      and t.hos_id = t6.hos_id
		      and t.dept_id = t6.dept_id
		      and t6.is_stop = 0 
		      
		      left join (
		           select 
		           a.group_id,
		           a.hos_id,
		           a.copy_code,
		           a.ass_card_no,
		           sum(a.pay_plan_money) pay_plan_money,
		           sum(a.pay_money) pay_money,
		           sum(a.unpay_money) unpay_money 
		           from ass_pay_stage_house a
		           left join ass_card_house b on
		           a.group_id = b.group_id
		           and a.hos_id = b.hos_id
		           and a.copy_code = b.copy_code
		           and a.ass_card_no = b.ass_card_no
		           group by a.group_id,a.hos_id,a.copy_code,a.ass_card_no
		      ) t8 on 
		      t.group_id = t8.group_id
		      and t.hos_id = t8.hos_id
		      and t.copy_code = t8.copy_code
		      and t.ass_card_no = t8.ass_card_no
		      
		      where t.group_id = #{group_id}
					and t.hos_id = #{hos_id}
					and t.copy_code = #{copy_code}
		        and t.in_date is not null
		       
		      union all
		      select t.ass_card_no, t1.ass_code || ' ' || t1.ass_name as ass_name, t2.ass_type_name, t3.naturs_name, t.in_date
		        , t.run_date, t.ass_spec, t.ass_mondl, t.ass_brand, t4.sup_code || ' ' || t4.sup_name as ven_name
		        , t.ass_seq_no, t.ass_in_no, t5.equi_usage_name, t6.dept_code || ' ' || t6.dept_name as dept_name, t7.store_code || ' ' || t7.store_name as store_name
		        , t.dept_id, t.dept_no, t.use_state, t.ass_id, t.ass_no
		        , t2.ass_type_id, t2.acc_type_code, t.ass_purpose, t.store_id, t.store_no
		        , t.ven_id, t.ven_no,t.price,t8.pay_plan_money,t8.pay_money,t8.unpay_money
		      from ass_card_other t
		      left join ass_no_dict t1 on t.group_id = t1.group_id
		      and t.hos_id = t1.hos_id
		      and t.copy_code = t1.copy_code
		      and t.ass_id = t1.ass_id
		      and t1.is_stop = 0 
		      left join ass_type_dict t2 on t1.group_id = t2.group_id
		      and t1.hos_id = t2.hos_id
		      and t1.copy_code = t2.copy_code
		      and t1.ass_type_id = t2.ass_type_id 
		      left join ass_naturs t3 on t2.ass_naturs = t3.naturs_code 
		      left join hos_sup_dict t4 on t.group_id = t4.group_id
		      and t.hos_id = t4.hos_id
		      and t.ven_id = t4.sup_id
		      and t4.is_stop = 0 
		      left join ass_usage_dict t5 on t.group_id = t5.group_id
		      and t.hos_id = t5.hos_id
		      and t.copy_code = t5.copy_code
		      and t.ass_purpose = t5.equi_usage_code 
		      left join hos_dept_dict t6 on t.group_id = t6.group_id
		      and t.hos_id = t6.hos_id
		      and t.dept_id = t6.dept_id
		      and t6.is_stop = 0 
		        left join hos_store_dict t7 on t.group_id = t7.group_id
		      and t.hos_id = t7.hos_id
		      and t.store_id = t7.store_id
		      and t7.is_stop = 0 
		      
		       left join (
		           select 
		           a.group_id,
		           a.hos_id,
		           a.copy_code,
		           a.ass_card_no,
		           sum(a.pay_plan_money) pay_plan_money,
		           sum(a.pay_money) pay_money,
		           sum(a.unpay_money) unpay_money 
		           from ass_pay_stage_other a
		           left join ass_card_other b on
		           a.group_id = b.group_id
		           and a.hos_id = b.hos_id
		           and a.copy_code = b.copy_code
		           and a.ass_card_no = b.ass_card_no
		           group by a.group_id,a.hos_id,a.copy_code,a.ass_card_no
		      ) t8 on 
		      t.group_id = t8.group_id
		      and t.hos_id = t8.hos_id
		      and t.copy_code = t8.copy_code
		      and t.ass_card_no = t8.ass_card_no
		      
		      where t.group_id = #{group_id}
					and t.hos_id = #{hos_id}
					and t.copy_code = #{copy_code}
		        and t.in_date is not null
		        
		      union all
		      select t.ass_card_no, t1.ass_code || ' ' || t1.ass_name as ass_name, t2.ass_type_name, t3.naturs_name, t.in_date
		        , t.run_date, null as ass_spec, null as ass_mondl, null as ass_brand, t4.sup_code || ' ' || t4.sup_name as ven_name
		        , null as ass_seq_no, t.ass_in_no, null as equi_usage_name, t6.dept_code || ' ' || t6.dept_name as dept_name, null as store_name
		        , t.dept_id, t.dept_no, t.use_state, t.ass_id, t.ass_no
		        , t2.ass_type_id, t2.acc_type_code, null as ass_purpose, null as store_id, null as store_no
		        , t.ven_id, t.ven_no,t.price,t8.pay_plan_money,t8.pay_money,t8.unpay_money
		      from ass_card_land t
		      left join ass_no_dict t1 on t.group_id = t1.group_id
		      and t.hos_id = t1.hos_id
		      and t.copy_code = t1.copy_code
		      and t.ass_id = t1.ass_id
		      and t1.is_stop = 0 
		      left join ass_type_dict t2 on t1.group_id = t2.group_id
		      and t1.hos_id = t2.hos_id
		      and t1.copy_code = t2.copy_code
		      and t1.ass_type_id = t2.ass_type_id 
		      left join ass_naturs t3 on t2.ass_naturs = t3.naturs_code 
		      left join hos_sup_dict t4 on t.group_id = t4.group_id
		      and t.hos_id = t4.hos_id
		      and t.ven_id = t4.sup_id
		      and t4.is_stop = 0 
		        left join hos_dept_dict t6 on t.group_id = t6.group_id
		      and t.hos_id = t6.hos_id
		      and t.dept_id = t6.dept_id
		      and t6.is_stop = 0 
		      
		      left join (
		           select 
		           a.group_id,
		           a.hos_id,
		           a.copy_code,
		           a.ass_card_no,
		           sum(a.pay_plan_money) pay_plan_money,
		           sum(a.pay_money) pay_money,
		           sum(a.unpay_money) unpay_money 
		           from ass_pay_stage_land a
		           left join ass_card_land b on
		           a.group_id = b.group_id
		           and a.hos_id = b.hos_id
		           and a.copy_code = b.copy_code
		           and a.ass_card_no = b.ass_card_no
		           group by a.group_id,a.hos_id,a.copy_code,a.ass_card_no
		      ) t8 on 
		      t.group_id = t8.group_id
		      and t.hos_id = t8.hos_id
		      and t.copy_code = t8.copy_code
		      and t.ass_card_no = t8.ass_card_no
		      
		      where t.group_id = #{group_id}
					and t.hos_id = #{hos_id}
					and t.copy_code = #{copy_code}
		        and t.in_date is not null
    ) t
    		<where>
				   <if test="use_state != null and use_state != ''">
			      	and t.use_state = #{use_state}
			       </if>
			       <if test="dept_id != null and dept_id != ''">
			      	and t.dept_id = #{dept_id}
			       </if>
			       <if test="dept_no != null and dept_no != ''">
			      	and t.dept_no = #{dept_no}
			       </if>
			       <if test="ass_card_no != null and ass_card_no != ''">
					and t.ass_card_no like '%${ass_card_no}%'
				   </if>
			       <if test="ass_id != null and ass_id != ''">
					and t.ass_id = #{ass_id}
				   </if>
				   <if test="ass_no != null and ass_no != ''">
				    and t.ass_no = #{ass_no}
				   </if>
				   <if test="store_id != null and store_id != ''">
					and t.store_id = #{store_id}
				   </if>
				   <if test="store_no != null and store_no != ''">
				    and t.store_no = #{store_no}
				   </if>
				   <if test="ven_id != null and ven_id != ''">
					and t.ven_id = #{ven_id}
				   </if>
				   <if test="ven_no != null and ven_no != ''">
				    and t.ven_no = #{ven_no}
				   </if>
				   <if test="ass_type_id != null and ass_type_id != ''">
					AND t.ass_type_id = #{ass_type_id}
				   </if>
				   <if test="fina_type_code != null and fina_type_code != ''">
					AND t.acc_type_code = #{fina_type_code}
				   </if>
				   <if test="ass_purpose != null and ass_purpose != ''">
					AND t.ass_purpose = #{ass_purpose}
				   </if>
				   <if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				    AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
				   </if>
				   <if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				    AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
				   </if>
			</where>
    order by t.ass_card_no
	
	</select>
	
	
	<select id="queryPayCardSearch" resultMap="payCardSearchMap" parameterType="java.util.Map">
		select 
		  t.ass_card_no,
		  ad.ass_code||' '||ad.ass_name ass_name,
		  nvl(t.price,0) price,
		  nvl(t2.bill_money,0) + nvl(t3.back_bill_money,0) nc_d,
		  nvl(t.price,0) - (nvl(t2.bill_money,0) + nvl(t3.back_bill_money,0)) nc_c,
		  nvl(t2.bill_money,0) nc_e,
		  nvl(t3.back_bill_money,0) nc_f,
		  nvl(t4.pay_money,0) + nvl(t5.back_pay_money,0) qc_d,
		  nvl(t.price,0) - (nvl(t4.pay_money,0) + nvl(t5.back_pay_money,0)) qc_c,
		  nvl(t4.pay_money,0) qc_e,
		  nvl(t5.back_pay_money,0) qc_f
		    
		 from (
		      select 
		      group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,price,use_state,in_date,run_date,ven_id,ven_no,store_id,store_no 
		      ,dept_id,dept_no,ass_purpose
		      from ass_card_general 
		        where   group_id = ${group_id}
		            AND hos_id = ${hos_id}
		            AND copy_code = ${copy_code}
		      union all
		      select 
		      group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,price,use_state,in_date,run_date,ven_id,ven_no,store_id,store_no 
		      ,dept_id,dept_no,ass_purpose
		      from ass_card_special
		        where   group_id = ${group_id}
		            AND hos_id = ${hos_id}
		            AND copy_code = ${copy_code}
		      union all
		      select 
		      group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,price,use_state,in_date,run_date,ven_id,ven_no,null store_id,null store_no 
		      ,dept_id,dept_no,null ass_purpose
		      from ass_card_house
		        where   group_id = ${group_id}
		            AND hos_id = ${hos_id}
		            AND copy_code = ${copy_code}
		      union all
		      select 
		      group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,price,use_state,in_date,run_date,ven_id,ven_no,store_id,store_no 
		      ,dept_id,dept_no,ass_purpose
		      from ass_card_inassets
		        where   group_id = ${group_id}
		            AND hos_id = ${hos_id}
		            AND copy_code = ${copy_code}
		      union all
		      select 
		      group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,price,use_state,in_date,run_date,ven_id,ven_no,null store_id,null store_no 
		      ,dept_id,dept_no,null ass_purpose
		      from ass_card_land
		        where   group_id = ${group_id}
		            AND hos_id = ${hos_id}
		            AND copy_code = ${copy_code}
		      union all
		      select 
		      group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,price,use_state,in_date,run_date,ven_id,ven_no,store_id,store_no 
		      ,dept_id,dept_no,ass_purpose
		      from ass_card_other
		        where   group_id = ${group_id}
		            AND hos_id = ${hos_id}
		            AND copy_code = ${copy_code}
		            
		     ) t       
		     left join ass_no_dict ad on
		     t.group_id = ad.group_id
		     and t.hos_id = ad.hos_id
		     and t.copy_code = ad.copy_code
		     and t.ass_id = ad.ass_id
		     and ad.is_stop = 0
		     
		      left join ass_type_dict atd on 
		      ad.group_id = atd.group_id
		      and ad.hos_id = atd.hos_id
		      and ad.copy_code = atd.copy_code
		      and ad.ass_type_id = atd.ass_type_id 
		     
		     left join (
		          select t1.group_id,t1.hos_id,t1.copy_code,t1.ass_card_no,sum(t1.bill_money) bill_money from ass_bill_detail t1
		           where   t1.group_id = ${group_id}
		            AND t1.hos_id = ${hos_id}
		            AND t1.copy_code = ${copy_code}
		          group by t1.group_id,t1.hos_id,t1.copy_code,t1.ass_card_no
		     ) t2 on 
		      t.group_id = t2.group_id
		     and t.hos_id = t2.hos_id
		     and t.copy_code = t2.copy_code
		     and t.ass_card_no = t2.ass_card_no
		     
		     left join (
		           select t1.group_id,t1.hos_id,t1.copy_code,t1.ass_card_no,sum(t1.bill_money) back_bill_money from ass_back_bill_detail t1
		           where   t1.group_id = ${group_id}
		            AND t1.hos_id = ${hos_id}
		            AND t1.copy_code = ${copy_code}
		           group by t1.group_id,t1.hos_id,t1.copy_code,t1.ass_card_no
		     ) t3 on 
		     t.group_id = t3.group_id
		     and t.hos_id = t3.hos_id
		     and t.copy_code = t3.copy_code
		     and t.ass_card_no = t3.ass_card_no
		     
		     left join (
		     
		          select t1.group_id,t1.hos_id,t1.copy_code,sum(t1.bill_money) pay_money,t2.ass_card_no from ass_pay_detail t1 
		          left join ass_bill_detail t2 on
		          t1.group_id = t2.group_id
		          and t1.hos_id = t2.hos_id
		          and t1.copy_code = t2.copy_code
		          and t1.bill_no = t2.bill_no
		          where   t1.group_id = ${group_id}
		            AND t1.hos_id = ${hos_id}
		            AND t1.copy_code = ${copy_code}
		          group by t1.group_id,t1.hos_id,t1.copy_code,t2.ass_card_no
		     ) t4 on
		     t.group_id = t4.group_id
		     and t.hos_id = t4.hos_id
		     and t.copy_code = t4.copy_code
		     and t.ass_card_no = t4.ass_card_no
		     
		     left join (
		     
		          select t1.group_id,t1.hos_id,t1.copy_code,sum(t1.bill_money) back_pay_money,t2.ass_card_no from ass_back_pay_detail t1 
		          left join ass_back_bill_detail t2 on
		          t1.group_id = t2.group_id
		          and t1.hos_id = t2.hos_id
		          and t1.copy_code = t2.copy_code
		          and t1.bill_no = t2.bill_no
		          where   t1.group_id = ${group_id}
		            AND t1.hos_id = ${hos_id}
		            AND t1.copy_code = ${copy_code}
		          group by t1.group_id,t1.hos_id,t1.copy_code,t2.ass_card_no
		     ) t5 on
		     t.group_id = t5.group_id
		     and t.hos_id = t5.hos_id
		     and t.copy_code = t5.copy_code
		     and t.ass_card_no = t5.ass_card_no
     
	where   t.group_id = ${group_id}
		    AND t.hos_id = ${hos_id}
		    AND t.copy_code = ${copy_code}
		    <if test="ass_card_no != null and ass_card_no != ''">
				and t.ass_card_no like '%${ass_card_no}%'
		    </if>
		    <if test="ass_id != null and ass_id != ''">
				and t.ass_id = #{ass_id}
			</if>
			<if test="ass_no != null and ass_no != ''">
				and t.ass_no = #{ass_no}
			</if>
			<if test="use_state != null and use_state != ''">
			    and t.use_state = #{use_state}
			</if>
			<if test="ven_id != null and ven_id != ''">
				and t.ven_id = #{ven_id}
			</if>
			<if test="ven_no != null and ven_no != ''">
				and t.ven_no = #{ven_no}
			</if>
			<if test="store_id != null and store_id != ''">
				and t.store_id = #{store_id}
			</if>
			<if test="store_no != null and store_no != ''">
				and t.store_no = #{store_no}
			</if>
			<if test="dept_id != null and dept_id != ''">
			    and t.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null and dept_no != ''">
			    and t.dept_no = #{dept_no}
			</if>
			<if test="ass_type_id != null and ass_type_id != ''">
				AND ad.ass_type_id = #{ass_type_id}
			</if>
			<if test="fina_type_code != null and fina_type_code != ''">
				AND atd.acc_type_code = #{fina_type_code}
			</if>
			<if test="ass_purpose != null and ass_purpose != ''">
				AND t.ass_purpose = #{ass_purpose}
			</if>
			<if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
			</if>
			<if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
			</if>
		    order by t.ass_card_no
	</select>
	
	
	<select id="queryPayVenSearch" resultMap="payVenSearchMap" parameterType="java.util.Map">
		select 
			  t.sup_code||' '||t.sup_name ven_name,
			  nvl(t5.price,0) price,
			  nvl(t1.bill_money,0) + nvl(t2.back_bill_money,0) nc_d,
			  nvl(t5.price,0) - (nvl(t1.bill_money,0) + nvl(t2.back_bill_money,0)) nc_c,
			  nvl(t1.bill_money,0) nc_e,
			  nvl(t2.back_bill_money,0) nc_f,
			  nvl(t3.pay_money,0) + nvl(t4.back_pay_money,0) qc_d,
			  nvl(t5.price,0) - (nvl(t3.pay_money,0) + nvl(t4.back_pay_money,0)) qc_c,
			  nvl(t3.pay_money,0) qc_e,
			  nvl(t4.back_pay_money,0) qc_f

			from hos_sup_dict t
			left join (
			     select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,sum(t.bill_money) bill_money from ass_bill_main t
			     where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			     group by t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no
			) t1 on
			t.group_id = t1.group_id
			and t.hos_id = t1.hos_id
			and t.sup_id = t1.ven_id

			left join (
			     select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,sum(t.bill_money) back_bill_money from ass_back_bill_main t
			     where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			     group by t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no
			) t2 on
			t.group_id = t2.group_id
			and t.hos_id = t2.hos_id
			and t.sup_id = t2.ven_id

			left join (
			     select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,sum(t.pay_money) pay_money from ass_pay_main t
			     where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			     group by t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no
			) t3 on
			t.group_id = t3.group_id
			and t.hos_id = t3.hos_id
			and t.sup_id = t3.ven_id

			left join (
			     select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,sum(t.pay_money) back_pay_money from ass_back_pay_main t
			     where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			     group by t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no
			) t4 on
			t.group_id = t4.group_id
			and t.hos_id = t4.hos_id
			and t.sup_id = t4.ven_id

			 left join (
           select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,sum(t.price) price,t.ass_card_no,t.USE_STATE,t.in_date,t.run_date, t.store_id,t.store_no,t.dept_id,t.dept_no,t.ass_id,t.ass_no,t.ass_type_id,t.ass_type_code  from (
          select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,t.price,t.ass_card_no,t.USE_STATE,t.in_date,t.run_date ,t.store_id,t.store_no,t.dept_id,t.dept_no,t.ass_id,t.ass_no,atd.ass_type_id,atd.ass_type_code  from ass_card_special t
           left join ass_no_dict ad on
         t.group_id = ad.group_id
         and t.hos_id = ad.hos_id
         and t.copy_code = ad.copy_code
         and t.ass_id = ad.ass_id
         and ad.is_stop = 0
         
          left join ass_type_dict atd on 
          ad.group_id = atd.group_id
          and ad.hos_id = atd.hos_id
          and ad.copy_code = atd.copy_code
          and ad.ass_type_id = atd.ass_type_id 
          where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			     <if test="ass_card_no != null and ass_card_no != ''">
				and t.ass_card_no like '%${ass_card_no}%'
		    </if>
		    <if test="ass_id != null and ass_id != ''">
				and t.ass_id = #{ass_id}
			</if>
			<if test="ass_no != null and ass_no != ''">
				and t.ass_no = #{ass_no}
			</if>
			<if test="use_state != null and use_state != ''">
			    and t.use_state = #{use_state}
			</if>
			
			<if test="store_id != null and store_id != ''">
				and t.store_id = #{store_id}
			</if>
			<if test="store_no != null and store_no != ''">
				and t.store_no = #{store_no}
			</if>
			<if test="dept_id != null and dept_id != ''">
			    and t.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null and dept_no != ''">
			    and t.dept_no = #{dept_no}
			</if>
			<if test="ass_type_id != null and ass_type_id != ''">
				AND atd.ass_type_id = #{ass_type_id}
			</if>
			<if test="fina_type_code != null and fina_type_code != ''">
				AND atd.acc_type_code = #{fina_type_code}
			</if>
			
			<if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
			</if>
			<if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
			</if>
          
          union all
          select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,t.price,t.ass_card_no ,t.USE_STATE,t.in_date,t.run_date, t.store_id,t.store_no,t.dept_id,t.dept_no,t.ass_id,t.ass_no,atd.ass_type_id,atd.ass_type_code  from ass_card_general t
          left join ass_no_dict ad on
         t.group_id = ad.group_id
         and t.hos_id = ad.hos_id
         and t.copy_code = ad.copy_code
         and t.ass_id = ad.ass_id
         and ad.is_stop = 0
         
          left join ass_type_dict atd on 
          ad.group_id = atd.group_id
          and ad.hos_id = atd.hos_id
          and ad.copy_code = atd.copy_code
          and ad.ass_type_id = atd.ass_type_id 
         where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			       <if test="ass_card_no != null and ass_card_no != ''">
				and t.ass_card_no like '%${ass_card_no}%'
		    </if>
		    <if test="ass_id != null and ass_id != ''">
				and t.ass_id = #{ass_id}
			</if>
			<if test="ass_no != null and ass_no != ''">
				and t.ass_no = #{ass_no}
			</if>
			<if test="use_state != null and use_state != ''">
			    and t.use_state = #{use_state}
			</if>
			
			<if test="store_id != null and store_id != ''">
				and t.store_id = #{store_id}
			</if>
			<if test="store_no != null and store_no != ''">
				and t.store_no = #{store_no}
			</if>
			<if test="dept_id != null and dept_id != ''">
			    and t.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null and dept_no != ''">
			    and t.dept_no = #{dept_no}
			</if>
			<if test="ass_type_id != null and ass_type_id != ''">
				AND atd.ass_type_id = #{ass_type_id}
			</if>
			<if test="fina_type_code != null and fina_type_code != ''">
				AND atd.acc_type_code = #{fina_type_code}
			</if>
			
			<if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
			</if>
			<if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
			</if>
          union all
          select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,t.price,t.ass_card_no,t.USE_STATE,t.in_date,t.run_date ,null store_id,null store_no,t.dept_id,t.dept_no,t.ass_id,t.ass_no,atd.ass_type_id,atd.ass_type_code  from ass_card_house t
           left join ass_no_dict ad on
         t.group_id = ad.group_id
         and t.hos_id = ad.hos_id
         and t.copy_code = ad.copy_code
         and t.ass_id = ad.ass_id
         and ad.is_stop = 0
         
          left join ass_type_dict atd on 
          ad.group_id = atd.group_id
          and ad.hos_id = atd.hos_id
          and ad.copy_code = atd.copy_code
          and ad.ass_type_id = atd.ass_type_id 
         where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			       <if test="ass_card_no != null and ass_card_no != ''">
				and t.ass_card_no like '%${ass_card_no}%'
		    </if>
		    <if test="ass_id != null and ass_id != ''">
				and t.ass_id = #{ass_id}
			</if>
			<if test="ass_no != null and ass_no != ''">
				and t.ass_no = #{ass_no}
			</if>
			<if test="use_state != null and use_state != ''">
			    and t.use_state = #{use_state}
			</if>
		
			<if test="dept_id != null and dept_id != ''">
			    and t.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null and dept_no != ''">
			    and t.dept_no = #{dept_no}
			</if>
			<if test="ass_type_id != null and ass_type_id != ''">
				AND atd.ass_type_id = #{ass_type_id}
			</if>
			<if test="fina_type_code != null and fina_type_code != ''">
				AND atd.acc_type_code = #{fina_type_code}
			</if>
			
			<if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
			</if>
			<if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
			</if>
          union all
          select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,t.price,t.ass_card_no ,t.USE_STATE,t.in_date,t.run_date ,t.store_id,t.store_no,t.dept_id,t.dept_no,t.ass_id,t.ass_no,atd.ass_type_id,atd.ass_type_code  from ass_card_inassets t
            left join ass_no_dict ad on
         t.group_id = ad.group_id
         and t.hos_id = ad.hos_id
         and t.copy_code = ad.copy_code
         and t.ass_id = ad.ass_id
         and ad.is_stop = 0
         
          left join ass_type_dict atd on 
          ad.group_id = atd.group_id
          and ad.hos_id = atd.hos_id
          and ad.copy_code = atd.copy_code
          and ad.ass_type_id = atd.ass_type_id 
           where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			       <if test="ass_card_no != null and ass_card_no != ''">
				and t.ass_card_no like '%${ass_card_no}%'
		    </if>
		    <if test="ass_id != null and ass_id != ''">
				and t.ass_id = #{ass_id}
			</if>
			<if test="ass_no != null and ass_no != ''">
				and t.ass_no = #{ass_no}
			</if>
			<if test="use_state != null and use_state != ''">
			    and t.use_state = #{use_state}
			</if>
			
			<if test="store_id != null and store_id != ''">
				and t.store_id = #{store_id}
			</if>
			<if test="store_no != null and store_no != ''">
				and t.store_no = #{store_no}
			</if>
			<if test="dept_id != null and dept_id != ''">
			    and t.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null and dept_no != ''">
			    and t.dept_no = #{dept_no}
			</if>
			<if test="ass_type_id != null and ass_type_id != ''">
				AND atd.ass_type_id = #{ass_type_id}
			</if>
			<if test="fina_type_code != null and fina_type_code != ''">
				AND atd.acc_type_code = #{fina_type_code}
			</if>
			
			<if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
			</if>
			<if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
			</if>
          union all
          select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,t.price,t.ass_card_no,t.USE_STATE,t.in_date,t.run_date, t.store_id,t.store_no,t.dept_id,t.dept_no,t.ass_id,t.ass_no,atd.ass_type_id,atd.ass_type_code  from ass_card_other t
           left join ass_no_dict ad on
         t.group_id = ad.group_id
         and t.hos_id = ad.hos_id
         and t.copy_code = ad.copy_code
         and t.ass_id = ad.ass_id
         and ad.is_stop = 0
         
          left join ass_type_dict atd on 
          ad.group_id = atd.group_id
          and ad.hos_id = atd.hos_id
          and ad.copy_code = atd.copy_code
          and ad.ass_type_id = atd.ass_type_id 
        where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			       <if test="ass_card_no != null and ass_card_no != ''">
				and t.ass_card_no like '%${ass_card_no}%'
		    </if>
		    <if test="ass_id != null and ass_id != ''">
				and t.ass_id = #{ass_id}
			</if>
			<if test="ass_no != null and ass_no != ''">
				and t.ass_no = #{ass_no}
			</if>
			<if test="use_state != null and use_state != ''">
			    and t.use_state = #{use_state}
			</if>
			
			<if test="store_id != null and store_id != ''">
				and t.store_id = #{store_id}
			</if>
			<if test="store_no != null and store_no != ''">
				and t.store_no = #{store_no}
			</if>
			<if test="dept_id != null and dept_id != ''">
			    and t.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null and dept_no != ''">
			    and t.dept_no = #{dept_no}
			</if>
			<if test="ass_type_id != null and ass_type_id != ''">
				AND atd.ass_type_id = #{ass_type_id}
			</if>
			<if test="fina_type_code != null and fina_type_code != ''">
				AND atd.acc_type_code = #{fina_type_code}
			</if>
			
			<if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
			</if>
			<if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
			</if>
          union all
          select t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,t.price,t.ass_card_no,t.USE_STATE,t.in_date,t.run_date,null store_id,null store_no,t.dept_id,t.dept_no,t.ass_id,t.ass_no,atd.ass_type_id,atd.ass_type_code  from ass_card_land t
            left join ass_no_dict ad on
         t.group_id = ad.group_id
         and t.hos_id = ad.hos_id
         and t.copy_code = ad.copy_code
         and t.ass_id = ad.ass_id
         and ad.is_stop = 0
         
          left join ass_type_dict atd on 
          ad.group_id = atd.group_id
          and ad.hos_id = atd.hos_id
          and ad.copy_code = atd.copy_code
          and ad.ass_type_id = atd.ass_type_id 
          where t.group_id = #{group_id}
			     and t.hos_id = #{hos_id}
			     and t.copy_code = #{copy_code}
			       <if test="ass_card_no != null and ass_card_no != ''">
				and t.ass_card_no like '%${ass_card_no}%'
		    </if>
		    <if test="ass_id != null and ass_id != ''">
				and t.ass_id = #{ass_id}
			</if>
			<if test="ass_no != null and ass_no != ''">
				and t.ass_no = #{ass_no}
			</if>
			<if test="use_state != null and use_state != ''">
			    and t.use_state = #{use_state}
			</if>
			
			<if test="dept_id != null and dept_id != ''">
			    and t.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null and dept_no != ''">
			    and t.dept_no = #{dept_no}
			</if>
			<if test="ass_type_id != null and ass_type_id != ''">
				AND atd.ass_type_id = #{ass_type_id}
			</if>
			<if test="fina_type_code != null and fina_type_code != ''">
				AND atd.acc_type_code = #{fina_type_code}
			</if>
			
			<if test="in_date_beg != null and in_date_beg != '' and in_date_end != null and in_date_end != ''">
				AND t.in_date between to_date(#{in_date_beg},'YYYY-MM-DD') and to_date(#{in_date_end},'YYYY-MM-DD')
			</if>
			<if test="run_date_beg != null and run_date_beg != '' and run_date_end != null and run_date_end != ''">
				AND t.run_date between to_date(#{run_date_beg},'YYYY-MM-DD') and to_date(#{run_date_end},'YYYY-MM-DD')
			</if>
       
       ) t
       group by t.group_id,t.hos_id,t.copy_code,t.ven_id,t.ven_no,t.ass_card_no,t.USE_STATE,t.in_date,t.run_date, t.store_id,t.store_no,t.dept_id,t.dept_no,t.ass_id,t.ass_no,t.ass_type_id,t.ass_type_code 
      ) t5 on
			t.group_id = t5.group_id
			and t.hos_id = t5.hos_id
			and t.sup_id = t5.ven_id

		where 
		t.group_id = ${group_id}
		and t.hos_id = ${hos_id}
		and t.is_stop = 0 
		and t.is_ass = 1
		<if test="ven_id != null and ven_id != ''">
			and t.sup_id = #{ven_id}
		</if>
		<if test="ven_no != null and ven_no != ''">
			and t.sup_no = #{ven_no}
		</if>
		
	</select>
</mapper>

