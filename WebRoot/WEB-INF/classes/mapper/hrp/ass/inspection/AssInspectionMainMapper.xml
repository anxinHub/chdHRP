<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.ass.dao.inspection.AssInspectionMainMapper">
	
	<resultMap id="assInspectionMain" type="com.chd.hrp.ass.entity.inspection.AssInspectionMain">
	<result property="group_id" column="group_id"/>
	<result property="hos_id" column="hos_id"/>
	<result property="copy_code" column="copy_code"/>
	<result property="ins_id" column="ins_id"/>
	<result property="ins_no" column="ins_no"/>
	<result property="ins_name" column="ins_name"/>
	<result property="ass_year" column="ass_year"/>
	<result property="ass_month" column="ass_month"/>
	<result property="ass_nature" column="ass_nature"/>
	<result property="naturs_name" column="naturs_name"/>
	<result property="dept_id" column="dept_id"/>
	<result property="dept_no" column="dept_no"/>
	<result property="dept_name" column="dept_name"/>
	<result property="create_emp" column="create_emp"/>
	<result property="create_emp_name" column="create_emp_name"/>
	<result property="create_date" column="create_date"/>
	<result property="audit_emp" column="audit_emp"/>
	<result property="audit_emp_name" column="audit_emp_name"/>
	<result property="audit_date" column="audit_date"/>
	<result property="state" column="state"/>
	<result property="note" column="note"/>
	</resultMap>
	
	<resultMap id="assInspectionMainMap" type="java.util.Map">
	<result property="group_id" column="group_id"/>
	<result property="hos_id" column="hos_id"/>
	<result property="copy_code" column="copy_code"/>
	<result property="ins_id" column="ins_id"/>
	<result property="ins_no" column="ins_no"/>
	<result property="ins_name" column="ins_name"/>
	<result property="ass_year" column="ass_year"/>
	<result property="ass_month" column="ass_month"/>
	<result property="ass_nature" column="ass_nature"/>
	<result property="naturs_name" column="naturs_name"/>
	<result property="dept_id" column="dept_id"/>
	<result property="dept_no" column="dept_no"/>
	<result property="dept_name" column="dept_name"/>
	<result property="create_emp" column="create_emp"/>
	<result property="create_emp_name" column="create_emp_name"/>
	<result property="create_date" column="create_date"/>
	<result property="audit_emp" column="audit_emp"/>
	<result property="audit_emp_name" column="audit_emp_name"/>
	<result property="audit_date" column="audit_date"/>
	<result property="state" column="state"/>
	<result property="note" column="note"/>
	<result property="ass_card_no" column="ass_card_no"/>
	<result property="ass_spec" column="ass_spec"/>
	<result property="ass_brand" column="ass_brand"/>
	<result property="ass_mondl" column="ass_mondl"/>
	<result property="ass_seq_no" column="ass_seq_no"/>
	<result property="fac_name" column="fac_name"/>
	<result property="ass_code" column="ass_code"/>
	<result property="ass_name" column="ass_name"/>
	<result property="state_go" column="state_go"/>
	<result property="is_rep" column="is_rep"/>
	<result property="is_main" column="is_main"/>
	<result property="ins_result" column="ins_result"/>
	</resultMap>
	
	<resultMap type="java.util.Map" id="assCardTable">
		<result property="ass_id_no" column="ass_id_no" />
		<result property="ass_nature" column="ass_nature" />
		<result property="naturs_code" column="naturs_code" />
		<result property="ass_card_no" column="ass_card_no" />
		<result property="ass_code" column="ass_code" />
		<result property="ass_name" column="ass_name" />
		<result property="ass_spec" column="ass_spec" />
		<result property="ass_model" column="ass_model" />
		<result property="ass_brand" column="ass_brand" />
		<result property="ass_unit_name" column="ass_unit_name" />
		<result property="fac_name" column="fac_name" />
		<result property="ven_name" column="ven_name" />
		<result property="price" column="price" />
		<result property="depre_money" column="depre_money" />
		<result property="manage_depre_money" column="manage_depre_money" />
		<result property="cur_money" column="cur_money" />
		<result property="fore_money" column="fore_money" />
		<result property="add_depre_month" column="add_depre_month" />
		<result property="add_manage_month" column="add_manage_month" />
		<result property="buy_type" column="buy_type" />
		<result property="use_state" column="use_state" />
		<result property="in_date" column="in_date" />
		<result property="ven_id" column="ven_id" />
		<result property="ven_no" column="ven_no" />
		<result property="store_id" column="store_id" />
		<result property="store_no" column="store_no" />
		<result property="is_dept" column="is_dept" />
		
	
	</resultMap>
	<select id="queryCurrentSequence" resultType="java.lang.Long">
		select ASS_INSPECTION_SEQ.currval val from dual
	</select>
	<insert id="addAssInspectionMain" useGeneratedKeys="true" >
	
		INSERT INTO ASS_INSPECTION (
		<trim suffix="" suffixOverrides=",">
		<if test="group_id != null and group_id != ''">
		group_id
		,
		</if>
		<if test="hos_id != null and hos_id != ''">
		hos_id
		,
		</if>
		<if test="copy_code != null and copy_code != ''">
		copy_code
		,
		</if>

		ins_id
		,

		<if test="ins_no != null and ins_no != ''">
		ins_no
		,
		</if>
		<if test="ins_name != null and ins_name != ''">
		ins_name
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		ass_year
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		ass_month
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		ass_nature
		,
		</if>
		<if test="dept_id != null and dept_id != ''">
		dept_id
		,
		</if>
		<if test="dept_no != null and dept_no != ''">
		dept_no
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		create_emp
		,
		</if>
		<if test="create_date != null and create_date != ''">
		create_date
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		audit_emp
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		audit_date
		,
		</if>
		<if test="state != null and state != ''">
		state
		,
		</if>
		<if test="note != null and note != ''">
		note
		</if>
		</trim>
		) VALUES (
		<trim suffix="" suffixOverrides=",">
		<if test="group_id != null and group_id != ''">
		#{group_id,jdbcType=INTEGER}
		,
		</if>
		<if test="hos_id != null and hos_id != ''">
		#{hos_id,jdbcType=INTEGER}
		,
		</if>
		<if test="copy_code != null and copy_code != ''">
		#{copy_code,jdbcType=VARCHAR}
		,
		</if>

		ASS_INSPECTION_SEQ.nextval
		,

		<if test="ins_no != null and ins_no != ''">
		#{ins_no,jdbcType=VARCHAR}
		,
		</if>
		<if test="ins_name != null and ins_name != ''">
		#{ins_name,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		#{ass_year,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		#{ass_month,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		#{ass_nature,jdbcType=VARCHAR}
		,
		</if>
		<if test="dept_id != null and dept_id != ''">
		#{dept_id,jdbcType=INTEGER}
		,
		</if>
		<if test="dept_no != null and dept_no != ''">
		#{dept_no,jdbcType=INTEGER}
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		#{create_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="create_date != null and create_date != ''">
		#{create_date,jdbcType=DATE}
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		#{audit_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		#{audit_date,jdbcType=DATE}
		,
		</if>
		<if test="state != null and state != ''">
		#{state,jdbcType=INTEGER}
		,
		</if>
		<if test="note != null and note != ''">
		#{note,jdbcType=VARCHAR}
		
		</if>
		</trim>		
		)
	
	</insert>
	<insert id="addBatchAssInspectionMain" parameterType="java.util.List" >
	
		INSERT INTO ASS_INSPECTION (
		<trim suffix="" suffixOverrides=",">
		<if test="group_id != null and group_id != ''">
		group_id
		,
		</if>
		<if test="hos_id != null and hos_id != ''">
		hos_id
		,
		</if>
		<if test="copy_code != null and copy_code != ''">
		copy_code
		,
		</if>
<!-- 		<if test="ins_id != null and ins_id != ''"> -->
		ins_id
		,
<!-- 		</if> -->
		<if test="ins_no != null and ins_no != ''">
		ins_no
		,
		</if>
		<if test="ins_name != null and ins_name != ''">
		ins_name
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		ass_year
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		ass_month
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		ass_nature
		,
		</if>
		<if test="dept_id != null and dept_id != ''">
		dept_id
		,
		</if>
		<if test="dept_no != null and dept_no != ''">
		dept_no
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		create_emp
		,
		</if>
		<if test="create_date != null and create_date != ''">
		create_date
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		audit_emp
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		audit_date
		,
		</if>
		<if test="state != null and state != ''">
		state
		,
		</if>
		<if test="note != null and note != ''">
		note
		,
		</if>
		</trim>
		) select ASS_INSPECTION_SEQ.nextval , t.* from(
		<foreach collection="list" item="item" index="index" separator=" union all " >
			select 		
			<trim suffix="" suffixOverrides=",">
			<if test="group_id != null and group_id != ''">
		#{item.group_id,jdbcType=INTEGER}
		,
		</if>
		<if test="hos_id != null and hos_id != ''">
		#{item.hos_id,jdbcType=INTEGER}
		,
		</if>
		<if test="copy_code != null and copy_code != ''">
		#{item.copy_code,jdbcType=VARCHAR}
		,
		</if>
        <if test="ins_id != null and ins_id != ''">
		#{item.ins_id,jdbcType=VARCHAR}
		,
		</if>
		<if test="ins_no != null and ins_no != ''">
		#{item.ins_no,jdbcType=VARCHAR}
		,
		</if>
		<if test="ins_name != null and ins_name != ''">
		#{item.ins_name,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		#{item.ass_year,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		#{item.ass_month,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		#{item.ass_nature,jdbcType=VARCHAR}
		,
		</if>
		<if test="dept_id != null and dept_id != ''">
		#{item.dept_id,jdbcType=INTEGER}
		,
		</if>
		<if test="dept_no != null and dept_no != ''">
		#{item.dept_no,jdbcType=INTEGER}
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		#{item.create_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="create_date != null and create_date != ''">
		#{item.create_date,jdbcType=DATE}
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		#{item.audit_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		#{item.audit_date,jdbcType=DATE}
		,
		</if>
		<if test="state != null and state != ''">
		#{item.state,jdbcType=INTEGER}
		
		</if>
		<if test="note != null and note != ''">
		#{item.note,jdbcType=VARCHAR}
		
		</if>
			</trim>
		    from dual
		</foreach>
		)t
	</insert>
	
	<update id="updateAssInspectionMain" parameterType="java.util.Map">
	
		UPDATE ASS_INSPECTION 
		<trim prefix="SET"  suffixOverrides=","> 
		<if test="ins_no != null and ins_no != ''">
		ins_no = #{ins_no,jdbcType=VARCHAR}
		,
		</if>
		<if test="ins_name != null and ins_name != ''">
		ins_name = #{ins_name,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		ass_year = #{ass_year,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		ass_month = #{ass_month,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		ass_nature = #{ass_nature,jdbcType=VARCHAR}
		,
		</if>
		<if test="dept_id != null and dept_id != ''">
		dept_id = #{dept_id,jdbcType=INTEGER}
		,
		</if>
		<if test="dept_no != null and dept_no != ''">
		dept_no = #{dept_no,jdbcType=INTEGER}
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		create_emp = #{create_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="create_date != null and create_date != ''">
		create_date = #{create_date,jdbcType=DATE}
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		audit_emp = #{audit_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		audit_date = #{audit_date,jdbcType=DATE}
		,
		</if>
		<if test="state != null and state != ''">
		state = #{state,jdbcType=INTEGER}
		,
		</if>
		<if test="note != null and note != ''">
		note = #{note,jdbcType=INTEGER}
		,
		</if>
		</trim>
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="ins_id != null and ins_id != ''">
		AND ins_id = #{ins_id,jdbcType=INTEGER}
		</if>
		<if test="ins_no != null and ins_no != ''">
		AND ins_no = #{ins_no,jdbcType=VARCHAR}
		</if>
<!-- 		<if test="ins_name != null and ins_name != ''"> -->
<!-- 		and ins_name = #{ins_name,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="ass_year != null and ass_year != ''"> -->
<!-- 		AND ass_year = #{ass_year,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="ass_month != null and ass_month != ''"> -->
<!-- 		AND ass_month = #{ass_month,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="ass_nature != null and ass_nature != ''"> -->
<!-- 		and ass_nature = #{ass_nature,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="dept_id != null and dept_id != ''"> -->
<!-- 		AND dept_id = #{dept_id,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="dept_no != null and dept_no != ''"> -->
<!-- 		AND dept_no = #{dept_no,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="create_emp != null and create_emp != ''"> -->
<!-- 		AND create_emp = #{create_emp,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="create_date != null and create_date != ''"> -->
<!-- 		AND create_date = #{create_date,jdbcType=DATE} -->
<!-- 		</if> -->
<!-- 		<if test="audit_emp != null and audit_emp != ''"> -->
<!-- 		AND audit_emp = #{audit_emp,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="audit_date != null and audit_date != ''"> -->
<!-- 		AND audit_date = #{audit_date,jdbcType=DATE} -->
<!-- 		</if> -->
<!-- 		<if test="state != null and state != ''"> -->
<!-- 		AND state = #{state,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="note != null and note != ''"> -->
<!-- 		AND note = #{note,jdbcType=INTEGER} -->
<!-- 		</if> -->
		</where>  
<!-- 		UPDATE ASS_INSPECTION  -->
<!-- 		set -->
<!-- 		ins_no = #{ins_no,jdbcType=VARCHAR} -->
<!-- 		, -->
<!-- 		ins_name = #{ins_name,jdbcType=VARCHAR} -->
<!-- 		, -->
<!-- 		ass_year = #{ass_year,jdbcType=VARCHAR} -->
<!-- 		, -->
<!-- 		ass_month = #{ass_month,jdbcType=VARCHAR} -->
<!-- 		, -->
<!-- 		ass_nature = #{ass_nature,jdbcType=VARCHAR} -->
<!-- 		, -->
<!-- 		dept_id = #{dept_id,jdbcType=INTEGER} -->
<!-- 		, -->
<!-- 		dept_no = #{dept_no,jdbcType=INTEGER} -->
<!-- 		, -->
<!-- 		create_emp = #{create_emp,jdbcType=INTEGER} -->
<!-- 		, -->
<!-- 		create_date = #{create_date,jdbcType=DATE} -->
<!-- 		, -->
<!-- 		audit_emp = #{audit_emp,jdbcType=INTEGER} -->
<!-- 		, -->
<!-- 		audit_date = #{audit_date,jdbcType=DATE} -->
<!-- 		, -->
<!-- 		state = #{state,jdbcType=INTEGER} -->
<!-- 		, -->
<!-- 		note = #{note,jdbcType=INTEGER} -->
<!-- 	    where  -->
<!-- 	    group_id = #{group_id,jdbcType=INTEGER} -->
<!-- 	    AND hos_id = #{hos_id,jdbcType=INTEGER} -->
<!-- 		AND copy_code = #{copy_code,jdbcType=VARCHAR} -->
<!-- 		AND ins_id = #{ins_id,jdbcType=INTEGER} -->
<!-- 		AND ins_no = #{ins_no,jdbcType=VARCHAR} -->
	</update>
	
	<update id="updateBatchAssInspectionMain" parameterType="java.util.List">
	
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
			UPDATE ass_inspection 
			<trim prefix="SET"  suffixOverrides=","> 
			 
				<if test="item.state != null and item.state != ''">
					state = #{item.state},
				</if> 
			    <if test="item.audit_emp != null and item.audit_emp != ''">
					audit_emp = #{item.audit_emp} ,
				</if>
				<if test="item.audit_date != null and item.audit_date != ''">
					audit_date = #{item.audit_date} ,
				</if>
			  
			</trim>
			<where>                     
					state=0
				<if test="item.group_id != null and item.group_id != ''">
					AND group_id = #{item.group_id}
				</if>
				<if test="item.hos_id != null and item.hos_id != ''">
					AND hos_id = #{item.hos_id}
				</if>
				<if test="item.copy_code != null and item.copy_code != ''">
					AND copy_code = #{item.copy_code}
				</if> 
				<if test="item.ins_id != null and item.ins_id != ''">
					AND ins_id = #{item.ins_id}
				</if>
			</where>  			
		</foreach>
	</update>
	 
	
	
		<update id="updateBatchAssInspectionMainBack" parameterType="java.util.List">
	
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">
			UPDATE ass_inspection
			<trim prefix="SET" suffixOverrides=",">
				<if test="item.state != null and item.state != ''">
					state = #{item.state},
				</if> 
					  audit_emp = #{item.audit_emp},  
				      audit_date = #{item.audit_date},
				 
			</trim>
			<where>
					state=1
				<if test="item.group_id != null and item.group_id != ''">
					AND group_id = #{item.group_id}
				</if>
				<if test="item.hos_id != null and item.hos_id != ''">
					AND hos_id = #{item.hos_id}
				</if>
				<if test="item.copy_code != null and item.copy_code != ''">
					AND copy_code = #{item.copy_code}
				</if> 
				<if test="item.ins_id != null and item.ins_id != ''">
					AND ins_id = #{item.ins_id}
				</if>
			</where>
			</foreach>
	</update>
	
	
	 <update id="updateBatchAssInspectionMainStop" parameterType="java.util.List">
	
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">
			UPDATE ass_inspection
			<trim prefix="SET" suffixOverrides=",">
				<if test="item.state != null and item.state != ''">
					state = #{item.state},
				</if>   
			</trim>
			<where> 
				<if test="item.group_id != null and item.group_id != ''">
					AND group_id = #{item.group_id}
				</if>
				<if test="item.hos_id != null and item.hos_id != ''">
					AND hos_id = #{item.hos_id}
				</if>
				<if test="item.copy_code != null and item.copy_code != ''">
					AND copy_code = #{item.copy_code}
				</if> 
				<if test="item.ins_id != null and item.ins_id != ''">
					AND ins_id = #{item.ins_id}
				</if>
			</where>
			</foreach>
	</update>
	
	
	<delete id="deleteAssInspectionMain" parameterType="java.util.Map">
	
		DELETE FROM ass_inspection 
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="ins_id != null and ins_id != ''">
		AND ins_id = #{ins_id,jdbcType=INTEGER}
		</if>
		<if test="ins_no != null and ins_no != ''">
		AND ins_no = #{ins_no,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		and ass_nature = #{iass_nature,jdbcType=VARCHAR}
	
		</if>
		<if test="dept_id != null and dept_id != ''">
		AND dept_id = #{dept_id,jdbcType=INTEGER}
		</if>
		<if test="dept_no != null and dept_no != ''">
		AND dept_no = #{dept_no,jdbcType=INTEGER}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date != null and create_date != ''">
		AND create_date = #{create_date,jdbcType=DATE}
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		<if test="audit_date != null and audit_date != ''">
		AND audit_date = #{audit_date,jdbcType=DATE}
		</if>
		<if test="state != null and state != ''">
		AND state = #{state,jdbcType=INTEGER}
		</if>
		<if test="note != null and note != ''">
		AND note = #{note,jdbcType=INTEGER}
		</if>
		</where>  
	</delete>
	<delete id="deleteBatchAssInspectionMain" parameterType="java.util.List">
	        DELETE FROM ass_inspection

			<where>
				<foreach collection="list" index="index" item="item" open="(" separator="or" close=")">
					state = 0
					<if test="item.group_id != null and item.group_id != ''">
							AND group_id = #{item.group_id}
						</if>
						<if test="item.hos_id != null and item.hos_id != ''">
							AND hos_id = #{item.hos_id}
						</if>
						<if test="item.copy_code != null and item.copy_code != ''">
							AND copy_code = #{item.copy_code}
						</if> 
						<if test="item.ins_id != null and item.ins_id != ''">
							AND ins_id = #{item.ins_id}
						</if>
		            
				</foreach>
  		 </where>
 
	</delete>
	
	
	
	<select id="queryAssInspectionMain" parameterType="java.util.Map" resultMap="assInspectionMain" >
	
		select a.group_id,
       a.hos_id,
       a.copy_code,
       a.ins_id,
       a.ins_no,
       a.ins_name,
       a.ass_year,
       a.ass_month,
       a.ass_nature,
       n.naturs_name,
       a.dept_id,
       a.dept_no,
       h.dept_name,
       a.create_emp,
       s.user_name   create_emp_name,
       a.create_date,
       a.audit_emp,
       s1.user_name  audit_emp_name,
       a.audit_date,
       a.state,
       a.note

  from ass_inspection a
  left join (select group_id,
                    hos_id,
                    copy_code,
                    ins_id,
                    max(ass_card_no) ass_card_no
               from ass_inspection_detail
              group by group_id, hos_id, copy_code, ins_id
             
             ) aa
    on aa.group_id = a.group_id
   and aa.hos_id = a.hos_id
   and aa.copy_code = a.copy_code
   and aa.ins_id = a.ins_id
  left join v_ass_card ca
    on ca.GROUP_ID = aa.group_id
   and ca.HOS_ID = aa.hos_id
   and ca.COPY_CODE = aa.copy_code
   and ca.ASS_CARD_NO = aa.ass_card_no
  left join ass_no_dict di
    on di.group_id = ca.GROUP_ID
   and di.hos_id = ca.HOS_ID
   and di.copy_code = ca.COPY_CODE
   and di.ass_id = ca.ASS_ID
   and di.ass_no = ca.ASS_NO
   and di.is_stop = 0
  left join HOS_DEPT_DICT h
    on a.dept_id = h.dept_id
   and a.group_id = h.group_id
   and a.hos_id = h.hos_id
   and a.dept_no = h.dept_no
  left join sys_user s
    on s.group_id = a.group_id
   and s.hos_id = a.hos_id
   and s.user_id = a.create_emp
  left join sys_user s1
    on a.group_id = s1.group_id
   and a.hos_id = s1.hos_id
   and s1.user_id = a.audit_emp
  left join ASS_NATURS n
    on a.ass_nature = n.naturs_code

		<where>                     
		<if test="group_id != null and group_id != ''">
		AND a.group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND a.hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="ins_id != null and ins_id != ''">
		AND a.ins_id = #{ins_id,jdbcType=INTEGER}
		</if>
		<if test="ins_no != null and ins_no != ''">
		AND a.ins_no = #{ins_no,jdbcType=VARCHAR}
		</if><if test="ins_name != null and ins_name != ''">
		AND a.ins_name = #{ins_name,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND a.ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND a.ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND a.ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="dept_id != null and dept_id != ''">
		AND a.dept_id = #{dept_id,jdbcType=INTEGER}
		</if>
		<if test="dept_no != null and dept_no != ''">
		AND a.dept_no = #{dept_no,jdbcType=INTEGER}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND a.create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date_begin != null and  create_date_end !=null and create_date_begin != '' and create_date_end !=''">
		AND a.create_date between  to_date(#{create_date_begin,jdbcType=DATE}, 'yyyy-MM-dd')  and to_date(#{create_date_end,jdbcType=DATE}, 'yyyy-MM-dd')  
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND a.audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		<if test="audit_date_begin != null and audit_date_end != null  and audit_date_begin != '' and audit_date_end != '' ">
		AND a.audit_date between to_date(#{audit_date_begin,jdbcType=DATE}, 'yyyy-MM-dd')  and to_date(#{audit_date_end,jdbcType=DATE}, 'yyyy-MM-dd')  
		</if>
		<if test="state != null and state != ''">
		AND a.state = #{state,jdbcType=INTEGER}
		</if>
		<if test="note != null and note != ''">
		AND a.note = #{note,jdbcType=VARCHAR}
		</if>
		<if test="ass_table != null and ass_table != ''">
		AND (di.ass_name like '%${ass_table}%' 
		or aa.ass_card_no  like '%${ass_table}%' 
		or di.ass_code like '%${ass_table}%'  
		)
		</if>
		</where>   
		order by a.group_id ASC
	</select>
	
	<select id="queryAssInspectionMainByCard" parameterType="java.util.Map" resultMap="assInspectionMain" >
	
		select 
  a.group_id,
  a.hos_id,
  a.copy_code,
  a.ins_id,
  a.ins_no,
  a.ins_name,
  a.ass_year,
  a.ass_month,
  a.ass_nature,
  n.naturs_name,
  a.dept_id,
  a.dept_no,
  h.dept_name,
  a.create_emp,
  s.user_name create_emp_name,
  a.create_date,
  a.audit_emp,
  s1.user_name audit_emp_name,
  a.audit_date,
  a.state,
  a.note
from ASS_INSPECTION_DETAIL aid
right join ass_inspection a on a.ins_id=aid.ins_id
 left join HOS_DEPT_DICT h on a.dept_id=h.dept_id and a.group_id=h.group_id and a.hos_id=h.hos_id and a.dept_no=h.dept_no
 left join sys_user s on s.group_id=a.group_id and s.hos_id=a.hos_id and s.user_id=a.create_emp
 left join sys_user s1 on a.group_id=s1.group_id and a.hos_id=s1.hos_id and s1.user_id=a.audit_emp
 left join ASS_NATURS n on a.ass_nature=n.naturs_code
		<where>
		aid.ass_card_no=#{ass_card_no,jdbcType=VARCHAR}                     
		<if test="group_id != null and group_id != ''">
		AND a.group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND a.hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="ins_id != null and ins_id != ''">
		AND a.ins_id = #{ins_id,jdbcType=INTEGER}
		</if>
		<if test="ins_no != null and ins_no != ''">
		AND a.ins_no = #{ins_no,jdbcType=VARCHAR}
		</if><if test="ins_name != null and ins_name != ''">
		AND a.ins_name = #{ins_name,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND a.ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND a.ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND a.ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="dept_id != null and dept_id != ''">
		AND a.dept_id = #{dept_id,jdbcType=INTEGER}
		</if>
		<if test="dept_no != null and dept_no != ''">
		AND a.dept_no = #{dept_no,jdbcType=INTEGER}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND a.create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date_begin != null and  create_date_end !=null and create_date_begin != '' and create_date_end !=''">
		AND a.create_date between  to_date(#{create_date_begin,jdbcType=DATE}, 'yyyy-MM-dd')  and to_date(#{create_date_end,jdbcType=DATE}, 'yyyy-MM-dd')  
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND a.audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		<if test="audit_date_begin != null and audit_date_end != null  and audit_date_begin != '' and audit_date_end != '' ">
		AND a.audit_date between to_date(#{audit_date_begin,jdbcType=DATE}, 'yyyy-MM-dd')  and to_date(#{audit_date_end,jdbcType=DATE}, 'yyyy-MM-dd')  
		</if>
		<if test="state != null and state != ''">
		AND a.state = #{state,jdbcType=INTEGER}
		</if>
		<if test="note != null and note != ''">
		AND a.note = #{note,jdbcType=VARCHAR}
		</if>
		</where>   
		order by a.group_id ASC
	</select>
	
	<select id="queryAssInspectionMainByCode" resultMap="assInspectionMain"  parameterType="java.util.Map" >
	
		select 
          	  a.group_id,
			  a.hos_id,
			  a.copy_code,
			  a.ins_id,
			  a.ins_no,
			  a.ins_name,
			  a.ass_year,
			  a.ass_month,
			  a.ass_nature,
			  n.naturs_name,
			  a.dept_id,
			  a.dept_no,
			  h.dept_code,
			  h.dept_name,
			  a.create_emp,
			  s.user_name create_emp_name,
			  a.create_date,
			  a.audit_emp,
			  s1.user_name audit_emp_name,
			  a.audit_date,
			  a.state,
			  a.note
         from ass_inspection a
         
          	 left join HOS_DEPT_DICT h on a.dept_id=h.dept_id and a.group_id=h.group_id and a.hos_id=h.hos_id and h.is_stop=0
			 left join sys_user s on s.group_id=a.group_id and s.hos_id=a.hos_id and s.user_id=a.create_emp
			 left join sys_user s1 on a.group_id=s1.group_id and a.hos_id=s1.hos_id and s1.user_id=a.audit_emp
			 left join ASS_NATURS n on a.ass_nature=n.naturs_code
		WHERE 
		a.group_id = #{group_id,jdbcType=INTEGER}   and 
		a.hos_id = #{hos_id,jdbcType=INTEGER}   and 
		a.copy_code = #{copy_code,jdbcType=VARCHAR}   and 
		a.ins_id = #{ins_id,jdbcType=INTEGER} 
	
	</select>
	<select id="queryAssInspectionMainByUniqueness" resultMap="assInspectionMain"  parameterType="java.util.Map" >
	
		select 
          group_id,
          hos_id,
          copy_code,
          ins_id,
          ins_no,
          ins_name,
          ass_year,
          ass_month,
          ass_nature,
          dept_id,
          dept_no,
          create_emp,
          create_date,
          audit_emp,
          audit_date,
          state,
          note
         from ass_inspection
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="ins_id != null and ins_id != ''">
		AND ins_id = #{ins_id,jdbcType=INTEGER}
		</if>
<!-- 		<if test="ins_no != null and ins_no != ''"> -->
<!-- 		AND ins_no = #{ins_no,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="ins_name != null and ins_name != ''"> -->
<!-- 		AND ins_name = #{ins_name,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="ass_year != null and ass_year != ''"> -->
<!-- 		AND ass_year = #{ass_year,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="ass_month != null and ass_month != ''"> -->
<!-- 		AND ass_month = #{ass_month,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="ass_nature != null and ass_nature != ''"> -->
<!-- 		AND ass_nature = #{ass_nature,jdbcType=VARCHAR} -->
<!-- 		</if> -->
<!-- 		<if test="dept_id != null and dept_id != ''"> -->
<!-- 		AND dept_id = #{dept_id,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="dept_no != null and dept_no != ''"> -->
<!-- 		AND dept_no = #{dept_no,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="create_emp != null and create_emp != ''"> -->
<!-- 		AND create_emp = #{create_emp,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="create_date != null and create_date != ''"> -->
<!-- 		AND create_date = #{create_date,jdbcType=DATE} -->
<!-- 		</if> -->
<!-- 		<if test="audit_emp != null and audit_emp != ''"> -->
<!-- 		AND audit_emp = #{audit_emp,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="audit_date != null and audit_date != ''"> -->
<!-- 		AND audit_date = #{audit_date,jdbcType=DATE} -->
<!-- 		</if> -->
<!-- 		<if test="state != null and state != ''"> -->
<!-- 		AND state = #{state,jdbcType=INTEGER} -->
<!-- 		</if> -->
<!-- 		<if test="note != null and note != ''"> -->
<!-- 		AND note = #{state,jdbcType=VARCHAR} -->
<!-- 		</if> -->
		</where>   
		order by group_id ASC
	</select>
	<select id="queryAssInspectionMainExists" resultMap="assInspectionMain"  parameterType="java.util.Map" >
	
		select 
          group_id,
          hos_id,
          copy_code,
          ins_id,
          ins_no,
          ins_name,
          ass_year,
          ass_month,
          ass_nature,
          dept_id,
          dept_no,
          create_emp,
          create_date,
          audit_emp,
          audit_date,
          state,
          note
         from ass_inspection
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="ins_id != null and ins_id != ''">
		AND ins_id = #{ins_id,jdbcType=INTEGER}
		</if>
		<if test="ins_no != null and ins_no != ''">
		AND ins_no = #{ins_no,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="ins_date != null and ins_date != ''">
		AND ins_date = #{ins_date,jdbcType=DATE}
		</if>
		<if test="summary != null and summary != ''">
		AND summary = #{summary,jdbcType=VARCHAR}
		</if>
		<if test="contract_id != null and contract_id != ''">
		AND contract_id = #{contract_id,jdbcType=INTEGER}
		</if>
		<if test="ven_id != null and ven_id != ''">
		AND ven_id = #{ven_id,jdbcType=INTEGER}
		</if>
		<if test="ven_no != null and ven_no != ''">
		AND ven_no = #{ven_no,jdbcType=INTEGER}
		</if>
		<if test="dept_id != null and dept_id != ''">
		AND dept_id = #{dept_id,jdbcType=INTEGER}
		</if>
		<if test="dept_no != null and dept_no != ''">
		AND dept_no = #{dept_no,jdbcType=INTEGER}
		</if>
		<if test="accept_desc != null and accept_desc != ''">
		AND accept_desc = #{accept_desc,jdbcType=VARCHAR}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date != null and create_date != ''">
		AND create_date = #{create_date,jdbcType=DATE}
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		<if test="audit_date != null and audit_date != ''">
		AND audit_date = #{audit_date,jdbcType=DATE}
		</if>
		<if test="state != null and state != ''">
		AND state = #{state,jdbcType=INTEGER}
		</if>
		</where>   
		order by group_id asc
	</select>
	
	<select id="queryAssCardLand" resultMap="assCardTable">
		SELECT
			an.naturs_code||' '||an.naturs_name ass_nature,
			an.naturs_code naturs_code,
			a.ass_card_no , 
			b.ass_code,
			b.ass_name,
			b.ass_spec,
			b.ass_model,
			b.ass_brand,
		    hu.unit_name ass_unit_name,
		    hfd.fac_code||' '||hfd.fac_name fac_name,
		    hsd.sup_code||' '||hsd.sup_name ven_name,
		    a.price,
		    a.depre_money,
		    a.manage_depre_money,
		    a.cur_money,
		    a.fore_money,
		    a.add_depre_month,
		    a.add_manage_month,
		    a.buy_type,
		    a.use_state,
		    a.in_date,
		    a.ven_id,
		    a.ven_no,
		    null store_id,
		    null store_no,
		    null is_dept
		FROM
		ass_card_land a 
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0
		and b.is_check = 1
		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
	    and b.copy_code = c.copy_code
	    and b.ass_type_id = c.ass_type_id
	    and c.is_stop = 0
	    
	    left join ass_naturs an on
	    c.ass_naturs = an.naturs_code
	    
	    left join hos_unit hu on
	    b.group_id=hu.group_id and
	    b.hos_id=hu.hos_id and
	    b.ass_unit=hu.unit_code 
	    and hu.is_stop=0
	    
	    left join hos_fac_dict hfd on 
	    b.group_id = hfd.group_id
	    and b.hos_id = hfd.hos_id
	    and b.fac_id = hfd.fac_id
	    and hfd.is_stop = 0
	    
	    left join hos_sup_dict hsd on
	    a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and hsd.is_stop = 0
		
		left join (
         select 	 
         			 t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
			         nvl(sum(t1.unpay_money),0) unpay_money,
			         nvl(sum(t1.pay_money),0) pay_money ,
			         nvl(sum(t1.pay_plan_money),0) pay_plan_money
			         
         	from  ass_pay_stage_land t1 
                left join ass_card_land t2 on
                t1.group_id = t2.group_id
                and t1.hos_id = t2.hos_id
                and t1.copy_code = t2.copy_code
                and t1.ass_card_no = t2.ass_card_no
               group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no   
	    )  pay on a.group_id = pay.group_id 
	    and a.hos_id = pay.hos_id
	    and a.copy_code = pay.copy_code
	    and a.ass_card_no = pay.ass_card_no 
		
		
		<where>
				and a.group_id = #{group_id}
				and a.hos_id = #{hos_id}
				and a.copy_code = #{copy_code}
				and b.is_check = 1
				
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>	
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and a.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and a.dept_no = #{dept_no}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>	
			<if test="in_date != null  and in_date != ''">
				and a.in_date  &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>	
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>	
			<if test="ven_no != null  and ven_no != ''">
				and a.ven_no = #{ven_no}
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="contract_id != null  and contract_id != ''">
				and a.contract_id = #{contract_id}
			</if>	
			<if test="in_dept_id != null  and in_dept_id != '' and in_dept_no != null  and in_dept_no != ''">
				 and exists(

						select 1 from ass_share_dept_land t1
						where a.hos_id = t1.hos_id
						and a.copy_code = t1.copy_code
						and a.ass_card_no = t1.ass_card_no 
				  		and t1.dept_id = #{in_dept_id}
				        and t1.dept_no = #{in_dept_no}
 					)
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test=" key != null  and  key != ''">
				and (
					a.ass_card_no like '%${key}%' or
					a.ass_id like '%${key}%' or
					b.ass_code like '%${key}%' or
					b.ass_name like '%${key}%' or
					an.naturs_code like '%${key}%' or 
				    b.spell_code like '%${key}%' or
					b.wbx_code like '%${key}%'
				)
			</if>
		</where> 
		order by a.ass_card_no
	</select>
	
	<select id="queryAssCardInassets" resultMap="assCardTable">
		SELECT
			an.naturs_code||' '||an.naturs_name ass_nature,
			an.naturs_code naturs_code,
			a.ass_card_no , 
			b.ass_code,
			b.ass_name,
			b.ass_spec,
			b.ass_model,
			b.ass_brand,
		    hu.unit_name ass_unit_name,
		    hfd.fac_code||' '||hfd.fac_name fac_name,
		    hsd.sup_code||' '||hsd.sup_name ven_name,
		    a.price,
		    a.depre_money,
		    a.manage_depre_money,
		    a.cur_money,
		    a.fore_money,
		    a.add_depre_month,
		    a.add_manage_month,
		    a.buy_type,
		    a.use_state,
		    a.in_date,
		    a.ven_id,
		    a.ven_no,
		    a.store_id,
		    a.store_no,
		    a.is_dept
		FROM
		ass_card_inassets a 
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0
		and b.is_check = 1
		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
	    and b.copy_code = c.copy_code
	    and b.ass_type_id = c.ass_type_id
	    and c.is_stop = 0
	    
	    left join ass_naturs an on
	    c.ass_naturs = an.naturs_code
	    
	    left join hos_unit hu on
	    b.group_id=hu.group_id and
	    b.hos_id=hu.hos_id and
	    b.ass_unit=hu.unit_code 
	    and hu.is_stop=0
	    
	    left join hos_fac_dict hfd on 
	    b.group_id = hfd.group_id
	    and b.hos_id = hfd.hos_id
	    and b.fac_id = hfd.fac_id
	    and hfd.is_stop = 0
	    
	    left join hos_sup_dict hsd on
	    a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and hsd.is_stop = 0
        
        left join (
         select 	 
         			 t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
			         nvl(sum(t1.unpay_money),0) unpay_money,
			         nvl(sum(t1.pay_money),0) pay_money ,
			         nvl(sum(t1.pay_plan_money),0) pay_plan_money
			         
         	from  ass_pay_stage_inassets t1 
                left join ass_card_inassets t2 on
                t1.group_id = t2.group_id
                and t1.hos_id = t2.hos_id
                and t1.copy_code = t2.copy_code
                and t1.ass_card_no = t2.ass_card_no
               group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no   
	    )  pay on a.group_id = pay.group_id 
	    and a.hos_id = pay.hos_id
	    and a.copy_code = pay.copy_code
	    and a.ass_card_no = pay.ass_card_no
        
		<where>
				and a.group_id = #{group_id}
				and a.hos_id = #{hos_id}
				and a.copy_code = #{copy_code}
				and b.is_check = 1
				
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>	
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>	
			<if test="in_date != null  and in_date != ''">
				and a.in_date  &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>	
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and a.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and a.dept_no = #{dept_no}
			</if>
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>	
			<if test="ven_no != null  and ven_no != ''">
				and a.ven_no = #{ven_no}
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="contract_id != null  and contract_id != ''">
				and a.contract_id = #{contract_id}
			</if>	
			<if test="in_dept_id != null  and in_dept_id != '' and in_dept_no != null  and in_dept_no != ''">
				 and exists(

						select 1 from ass_share_dept_inassets t1
						where a.hos_id = t1.hos_id
						and a.copy_code = t1.copy_code
						and a.ass_card_no = t1.ass_card_no 
				  		and t1.dept_id = #{in_dept_id}
				        and t1.dept_no = #{in_dept_no}
 					)
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test=" key != null  and  key != ''">
				and (
					a.ass_card_no like '%${key}%' or
					a.ass_id like '%${key}%' or
					b.ass_code like '%${key}%' or
					b.ass_name like '%${key}%' or
					an.naturs_code like '%${key}%' or 
				    b.spell_code like '%${key}%' or
					b.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.ass_card_no
	</select>
	
	<select id="queryAssCardOther" resultMap="assCardTable">
		SELECT
			an.naturs_code||' '||an.naturs_name ass_nature,
			an.naturs_code naturs_code,
			a.ass_card_no , 
			b.ass_code,
			b.ass_name,
			b.ass_spec,
			b.ass_model,
			b.ass_brand,
		    hu.unit_name ass_unit_name,
		    hfd.fac_code||' '||hfd.fac_name fac_name,
		    hsd.sup_code||' '||hsd.sup_name ven_name,
		    a.price,
		    a.depre_money,
		    a.manage_depre_money,
		    a.cur_money,
		    a.fore_money,
		    a.add_depre_month,
		    a.add_manage_month,
		    a.buy_type,
		    a.use_state,
		    a.in_date,
		    a.ven_id,
		    a.ven_no,
		    a.store_id,
		    a.store_no,
		    a.is_dept
		FROM
		ASS_CARD_OTHER a 
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0
		and b.is_check = 1
		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
	    and b.copy_code = c.copy_code
	    and b.ass_type_id = c.ass_type_id
	    and c.is_stop = 0
	    
	    left join ass_naturs an on
	    c.ass_naturs = an.naturs_code
	    
	    left join hos_unit hu on
	    b.group_id=hu.group_id and
	    b.hos_id=hu.hos_id and
	    b.ass_unit=hu.unit_code 
	    and hu.is_stop=0
	    
	    left join hos_fac_dict hfd on 
	    b.group_id = hfd.group_id
	    and b.hos_id = hfd.hos_id
	    and b.fac_id = hfd.fac_id
	    and hfd.is_stop = 0
	    
	    left join hos_sup_dict hsd on
	    a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and hsd.is_stop = 0
        
        left join (
         select 	 
         			 t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
			         nvl(sum(t1.unpay_money),0) unpay_money,
			         nvl(sum(t1.pay_money),0) pay_money ,
			         nvl(sum(t1.pay_plan_money),0) pay_plan_money
			         
         	from  ass_pay_stage_OTHER t1 
                left join ass_card_OTHER t2 on
                t1.group_id = t2.group_id
                and t1.hos_id = t2.hos_id
                and t1.copy_code = t2.copy_code
                and t1.ass_card_no = t2.ass_card_no
               group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no   
	    )  pay on a.group_id = pay.group_id 
	    and a.hos_id = pay.hos_id
	    and a.copy_code = pay.copy_code
	    and a.ass_card_no = pay.ass_card_no
		
		<where>
				and a.group_id = #{group_id}
				and a.hos_id = #{hos_id}
				and a.copy_code = #{copy_code}
				and b.is_check = 1
				
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>	
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>	
			<if test="dept_id != null  and dept_id != ''">
				and a.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and a.dept_no = #{dept_no}
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date  &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>	
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>	
			<if test="ven_no != null  and ven_no != ''">
				and a.ven_no = #{ven_no}
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="contract_id != null  and contract_id != ''">
				and a.contract_id = #{contract_id}
			</if>
			<if test="in_dept_id != null  and in_dept_id != '' and in_dept_no != null  and in_dept_no != ''">
				 and exists(

						select 1 from ass_share_dept_OTHER t1
						where a.hos_id = t1.hos_id
						and a.copy_code = t1.copy_code
						and a.ass_card_no = t1.ass_card_no 
				  		and t1.dept_id = #{in_dept_id}
				        and t1.dept_no = #{in_dept_no}
 					)
			</if>	
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test=" key != null  and  key != ''">
				and (
					a.ass_card_no like '%${key}%' or
					a.ass_id like '%${key}%' or
					b.ass_code like '%${key}%' or
					b.ass_name like '%${key}%' or
					an.naturs_code like '%${key}%' or 
				    b.spell_code like '%${key}%' or
					b.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.ass_card_no
	</select>
	
	<select id="queryAssCardHouse" resultMap="assCardTable">
		SELECT
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code naturs_code,
		a.ass_card_no , 
		b.ass_code,
		b.ass_name,
		b.ass_spec,
		b.ass_model,
		b.ass_brand,
	    hu.unit_name ass_unit_name,
	    hfd.fac_code||' '||hfd.fac_name fac_name,
	    hsd.sup_code||' '||hsd.sup_name ven_name,
	    a.price,
	    a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.use_state,
		a.in_date,
		    a.ven_id,
		    a.ven_no,
		    null store_id,
		    null store_no,
		    null is_dept
		FROM
		ASS_CARD_HOUSE a 
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0
		and b.is_check = 1
		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
	    and b.copy_code = c.copy_code
	    and b.ass_type_id = c.ass_type_id
	    and c.is_stop = 0
	    
	    left join ass_naturs an on
	    c.ass_naturs = an.naturs_code
	    
	    left join hos_unit hu on
	    b.group_id=hu.group_id and
	    b.hos_id=hu.hos_id and
	    b.ass_unit=hu.unit_code 
	    and hu.is_stop=0
	    
	    left join hos_fac_dict hfd on 
	    b.group_id = hfd.group_id
	    and b.hos_id = hfd.hos_id
	    and b.fac_id = hfd.fac_id
	    and hfd.is_stop = 0
	    
	    left join hos_sup_dict hsd on
	    a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and hsd.is_stop = 0
        
        left join (
         select 	 
         			 t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
			         nvl(sum(t1.unpay_money),0) unpay_money,
			         nvl(sum(t1.pay_money),0) pay_money ,
			         nvl(sum(t1.pay_plan_money),0) pay_plan_money
			         
         	from  ass_pay_stage_HOUSE t1 
                left join ass_card_HOUSE t2 on
                t1.group_id = t2.group_id
                and t1.hos_id = t2.hos_id
                and t1.copy_code = t2.copy_code
                and t1.ass_card_no = t2.ass_card_no
               group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no   
	    )  pay on a.group_id = pay.group_id 
	    and a.hos_id = pay.hos_id
	    and a.copy_code = pay.copy_code
	    and a.ass_card_no = pay.ass_card_no
		
		<where>
				and a.group_id = #{group_id}
				and a.hos_id = #{hos_id}
				and a.copy_code = #{copy_code}
				and b.is_check = 1
				
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>	
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and a.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and a.dept_no = #{dept_no}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>	
			<if test="in_date != null  and in_date != ''">
				and a.in_date  &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>	
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>	
			<if test="ven_no != null  and ven_no != ''">
				and a.ven_no = #{ven_no}
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="contract_id != null  and contract_id != ''">
				and a.contract_id = #{contract_id}
			</if>	
			<if test="in_dept_id != null  and in_dept_id != '' and in_dept_no != null  and in_dept_no != ''">
				 and exists(

						select 1 from ass_share_dept_HOUSE t1
						where a.hos_id = t1.hos_id
						and a.copy_code = t1.copy_code
						and a.ass_card_no = t1.ass_card_no 
				  		and t1.dept_id = #{in_dept_id}
				        and t1.dept_no = #{in_dept_no}
 					)
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test=" key != null  and  key != ''">
				and (
					a.ass_card_no like '%${key}%' or
					a.ass_id like '%${key}%' or
					b.ass_code like '%${key}%' or
					b.ass_name like '%${key}%' or
					an.naturs_code like '%${key}%' or 
				    b.spell_code like '%${key}%' or
					b.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.ass_card_no
	</select>
	
	<select id="queryAssCardGeneral" resultMap="assCardTable">
		SELECT
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code naturs_code,
		a.ass_card_no , 
		b.ass_code,
		b.ass_name,
		b.ass_spec,
		b.ass_model,
		b.ass_brand,
	    hu.unit_name ass_unit_name,
	    hfd.fac_code||' '||hfd.fac_name fac_name,
	    hsd.sup_code||' '||hsd.sup_name ven_name,
	    a.price,
	    a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.use_state,
		a.in_date,
		    a.ven_id,
		    a.ven_no,
		    a.store_id,
		    a.store_no,
		    a.is_dept
		FROM
		ASS_CARD_GENERAL a 
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0
		and b.is_check = 1
		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
	    and b.copy_code = c.copy_code
	    and b.ass_type_id = c.ass_type_id
	    and c.is_stop = 0
	    
	    left join ass_naturs an on
	    c.ass_naturs = an.naturs_code
	    
	    left join hos_unit hu on
	    b.group_id=hu.group_id and
	    b.hos_id=hu.hos_id and
	    b.ass_unit=hu.unit_code 
	    and hu.is_stop=0
	    
	    left join hos_fac_dict hfd on 
	    b.group_id = hfd.group_id
	    and b.hos_id = hfd.hos_id
	    and b.fac_id = hfd.fac_id
	    and hfd.is_stop = 0
	    
	    left join hos_sup_dict hsd on
	    a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and hsd.is_stop = 0
        
        left join (
         select 	 
         			 t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
			         nvl(sum(t1.unpay_money),0) unpay_money,
			         nvl(sum(t1.pay_money),0) pay_money ,
			         nvl(sum(t1.pay_plan_money),0) pay_plan_money 
			         
         	from  ass_pay_stage_GENERAL t1 
                left join ass_card_GENERAL t2 on
                t1.group_id = t2.group_id
                and t1.hos_id = t2.hos_id
                and t1.copy_code = t2.copy_code
                and t1.ass_card_no = t2.ass_card_no
               group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no   
	    )  pay on a.group_id = pay.group_id 
	    and a.hos_id = pay.hos_id
	    and a.copy_code = pay.copy_code
	    and a.ass_card_no = pay.ass_card_no
		
		<where>
				and a.group_id = #{group_id}
				and a.hos_id = #{hos_id}
				and a.copy_code = #{copy_code}
				and b.is_check = 1
				
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>	
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>	
			<if test="in_date != null  and in_date != ''">
				and a.in_date  &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and a.dept_id = #{dept_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and a.dept_no = #{dept_no}
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>	
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>	
			<if test="ven_no != null  and ven_no != ''">
				and a.ven_no = #{ven_no}
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="contract_id != null  and contract_id != ''">
				and a.contract_id = #{contract_id}
			</if>	
			<if test="in_dept_id != null  and in_dept_id != '' and in_dept_no != null  and in_dept_no != ''">
				 and exists(

						select 1 from ass_share_dept_GENERAL t1
						where a.hos_id = t1.hos_id
						and a.copy_code = t1.copy_code
						and a.ass_card_no = t1.ass_card_no 
				  		and t1.dept_id = #{in_dept_id}
				        and t1.dept_no = #{in_dept_no}
 					)
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test=" key != null  and  key != ''">
				and (
					a.ass_card_no like '%${key}%' or
					a.ass_id like '%${key}%' or
					b.ass_code like '%${key}%' or
					b.ass_name like '%${key}%' or
					an.naturs_code like '%${key}%' or 
				    b.spell_code like '%${key}%' or
					b.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.ass_card_no
	</select>
	
	<select id="queryAssCardSpecial" resultMap="assCardTable">
		SELECT
			an.naturs_code||' '||an.naturs_name ass_nature,
			an.naturs_code naturs_code,
			a.ass_card_no , 
			b.ass_code,
			b.ass_name,
			b.ass_spec,
			b.ass_model,
			b.ass_brand,
		    hu.unit_name ass_unit_name,
		    hfd.fac_code||' '||hfd.fac_name fac_name,
		    hsd.sup_code||' '||hsd.sup_name ven_name,
		    a.price,
		    a.depre_money,
		    a.manage_depre_money,
		    a.cur_money,
		    a.fore_money,
		    a.add_depre_month,
		    a.add_manage_month,
		    a.buy_type,
		    a.use_state,
		    a.in_date,
		    a.ven_id,
		    a.ven_no,
		    a.store_id,
		    a.store_no,
		    a.is_dept
		FROM ASS_CARD_SPECIAL a 
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0
		and b.is_check = 1
		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
	    and b.copy_code = c.copy_code
	    and b.ass_type_id = c.ass_type_id
	    and c.is_stop = 0
	    
	    left join ass_naturs an on
	    c.ass_naturs = an.naturs_code
	    
	    left join hos_unit hu on
	    b.group_id=hu.group_id and
	    b.hos_id=hu.hos_id and
	    b.ass_unit=hu.unit_code 
	    and hu.is_stop=0
	    
	    left join hos_fac_dict hfd on 
	    b.group_id = hfd.group_id
	    and b.hos_id = hfd.hos_id
	    and b.fac_id = hfd.fac_id
	    and hfd.is_stop = 0
	    
	    left join hos_sup_dict hsd on
	    a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and hsd.is_stop = 0
        
        left join (
         select 	 
         			 t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
			         nvl(sum(t1.unpay_money),0) unpay_money,
			         nvl(sum(t1.pay_money),0) pay_money ,
			         nvl(sum(t1.pay_plan_money),0) pay_plan_money 
			         
         	from  ass_pay_stage_SPECIAL t1 
                left join ass_card_SPECIAL t2 on
                t1.group_id = t2.group_id
                and t1.hos_id = t2.hos_id
                and t1.copy_code = t2.copy_code
                and t1.ass_card_no = t2.ass_card_no
               group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no   
	    )  pay on a.group_id = pay.group_id 
	    and a.hos_id = pay.hos_id
	    and a.copy_code = pay.copy_code
	    and a.ass_card_no = pay.ass_card_no
		
		<where>
				and a.group_id = #{group_id}
				and a.hos_id = #{hos_id}
				and a.copy_code = #{copy_code}
				and b.is_check = 1
				
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>	
			<if test="in_dept_id != null  and in_dept_id != ''">
				and a.dept_id = #{in_dept_id}
			</if>	
			<if test="in_dept_no != null  and in_dept_no != ''">
				and a.dept_no = #{in_dept_no}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>	
			<if test="in_date != null  and in_date != ''">
				and a.in_date  &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>	
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>	
			<if test="ven_no != null  and ven_no != ''">
				and a.ven_no = #{ven_no}
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="contract_id != null  and contract_id != ''">
				and a.contract_id = #{contract_id}
			</if>	
			<if test="in_dept_id != null  and in_dept_id != '' and in_dept_no != null  and in_dept_no != ''">
				 and exists(

						select 1 from ass_share_dept_SPECIAL t1
						where a.hos_id = t1.hos_id
						and a.copy_code = t1.copy_code
						and a.ass_card_no = t1.ass_card_no 
				  		and t1.dept_id = #{in_dept_id}
				        and t1.dept_no = #{in_dept_no}
 					)
			</if>	
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test=" key != null  and  key != ''">
				and (
					a.ass_card_no like '%${key}%' or
					a.ass_id like '%${key}%' or
					b.ass_code like '%${key}%' or
					b.ass_name like '%${key}%' or
					an.naturs_code like '%${key}%' or 
				    b.spell_code like '%${key}%' or
					b.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.ass_card_no
	</select>
	
	<!--  -->
	<select id="queryInspectionMainByMainBatch" parameterType="java.util.Map" resultType="java.util.Map">
	select 
	 
	  a.ins_id as id,
	  a.ins_no,
	  a.ins_name,
	   a.group_id,
	  a.hos_id,
	  a.copy_code,
	  a.ass_year,
	  a.ass_month,
	  a.ass_nature,
	  n.naturs_name,
	  a.dept_id,
	  a.dept_no,
	  h.dept_name,
	  a.create_emp,
	  s.user_name create_emp_name,
	  a.create_date,
	  a.audit_emp,
	  s1.user_name audit_emp_name,
	  a.audit_date,
	   case when a.state = 0 then '' when a.state = 1 then '' when a.state = 2 then '' else '' end state,
	  a.state,
	  a.note
	
	 from ass_inspection a
	 left join HOS_DEPT_DICT h on a.dept_id=h.dept_id and a.group_id=h.group_id and a.hos_id=h.hos_id and a.dept_no=h.dept_no
	 left join sys_user s on s.group_id=a.group_id and s.hos_id=a.hos_id and s.user_id=a.create_emp
	 left join sys_user s1 on a.group_id=s1.group_id and a.hos_id=s1.hos_id and s1.user_id=a.audit_emp
	 left join ASS_NATURS n on a.ass_nature=n.naturs_code
	where                     
			a.group_id = #{group_id}
			AND a.hos_id = #{hos_id}
			AND a.copy_code = #{copy_code}
			AND a.ins_id in (${paraId})
		order by a.ins_id asc
	
	</select>
	
	<!--  -->
	<select id="queryInspectionMainByDetail" parameterType="java.util.Map" resultType="java.util.Map">
	select 
       a.ins_id as id,
       a.group_id,
       a.hos_id,
       a.copy_code,
       b.ASS_CARD_NO,
       c.ass_code,
       c.ass_name,
       b.ASS_SPEC,
       b.ASS_MONDL,
       b.ASS_BRAND,
       d.fac_name,
       case
         when a.state = 0 then
          ''
         when a.state = 1 then
          ''
         else
          ''
       end state_name,
       case
         when a.is_rep = 0 then
          ''
         when a.is_rep = 1 then
          ''
         else
          ''
       end is_rep,
       case
         when a.is_main = 0 then
          ''
         when a.is_main = 1 then
          ''
         else
          ''
       end is_main,
       case
         when a.ins_result = 0 then
          ''
         when a.ins_result = 1 then
          ''
         else
          ''
       end ins_result,
       a.note note_detail,
       b.ASS_SEQ_NO
  from ass_inspection_detail a
  left join v_ass_card b
    on a.group_id = b.GROUP_ID
   and a.hos_id = b.HOS_ID
   and a.copy_code = b.COPY_CODE
   and a.ass_card_no = b.ASS_CARD_NO
  left join ass_no_dict c
    on c.group_id = b.GROUP_ID
   and c.hos_id = b.HOS_ID
   and c.copy_code = b.COPY_CODE
   and c.ass_id = b.ASS_ID
   and c.ass_no = b.ASS_NO
   and c.is_stop = 0
  left join hos_fac_dict d
    on d.group_id = b.GROUP_ID
   and d.hos_id = b.HOS_ID
   and d.fac_id = b.FAC_ID
   and d.fac_no = b.FAC_NO
   and d.is_stop = 0
	where 
		a.group_id = #{group_id,jdbcType=INTEGER}
			AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="paraId != null and paraId != ''">
			AND a.ins_id in  (${paraId})
			</if>
			<if test="ins_id != null and ins_id != ''">
			AND a.ins_id = #{ins_id,jdbcType=VARCHAR}
			</if> 	
	
	order by a.ins_id asc
	
	</select>
	
	<!--  -->
	<select id="queryInspectionMainByMain" parameterType="java.util.Map" resultType="java.util.Map">
		select 
	 
	  a.ins_id as id,
	  a.ins_no,
	  a.ins_name,
	   a.group_id,
	  a.hos_id,
	  a.copy_code,
	  a.ass_year,
	  a.ass_month,
	  a.ass_nature,
	  n.naturs_name,
	  a.dept_id,
	  a.dept_no,
	  h.dept_name,
	  a.create_emp,
	  s.user_name create_emp_name,
	  a.create_date,
	  a.audit_emp,
	  s1.user_name audit_emp_name,
	  a.audit_date,
	   case when a.state = 0 then '' when a.state = 1 then '' when a.state = 2 then '' else '' end state,
	  a.state,
	  a.note
	
	 from ass_inspection a
	 left join HOS_DEPT_DICT h on a.dept_id=h.dept_id and a.group_id=h.group_id and a.hos_id=h.hos_id and a.dept_no=h.dept_no
	 left join sys_user s on s.group_id=a.group_id and s.hos_id=a.hos_id and s.user_id=a.create_emp
	 left join sys_user s1 on a.group_id=s1.group_id and a.hos_id=s1.hos_id and s1.user_id=a.audit_emp
	 left join ASS_NATURS n on a.ass_nature=n.naturs_code
	where                     
			a.group_id = #{group_id}
			AND a.hos_id = #{hos_id}
			AND a.copy_code = #{copy_code}
			AND a.ins_id  = #{ins_id}
		order by a.ins_id asc
	</select>
	
	<!--  -->
	<select id="queryInSpectionMainStatee" parameterType="java.util.Map" resultType="java.lang.String">
	SELECT ins_no FROM ass_inspection 
		WHERE
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="paraId != null and paraId != ''">
			AND ins_id in  (${paraId})
			</if>
			<if test="ins_id != null and ins_id != ''">
			AND ins_id = #{ins_id,jdbcType=VARCHAR}
			</if>
			<!--    2  -->
			and state != #{state,jdbcType=INTEGER}
	</select>
	
<!--  -->
<select id="queryDetails" parameterType="java.util.Map" resultMap="assInspectionMainMap">
	with detail_temp as
 (select a.group_id,
         a.hos_id,
         a.copy_code,
         a.ins_id,
         a.ins_no,
         a.ins_name,
         a.ass_year,
         a.ass_month,
         a.ass_nature,
         n.naturs_name,
         a.dept_id,
         a.dept_no,
         h.dept_name,
         a.create_emp,
         s.user_name   create_emp_name,
         a.create_date,
         a.audit_emp,
         s1.user_name  audit_emp_name,
         a.audit_date,
         a.state,
         a.note,
         b.ass_card_no,
         c.ASS_SPEC,
         c.ASS_BRAND,
         c.ASS_MONDL,
         c.ASS_SEQ_NO,
         e.fac_name,
         d.ass_code,
         d.ass_name,
         b.state       state_go,
         b.is_rep,
         b.is_main,
         b.ins_result
    from ass_inspection a
    left join ass_inspection_detail b
      on a.group_id = b.group_id
     and a.hos_id = b.hos_id
     and a.copy_code = b.copy_code
     and a.ins_id = b.ins_id
    left join v_ass_card c
      on c.GROUP_ID = b.group_id
     and c.HOS_ID = b.hos_id
     and c.COPY_CODE = b.copy_code
     and c.ASS_CARD_NO = b.ass_card_no
    left join ass_no_dict d
      on d.group_id = c.GROUP_ID
     and d.hos_id = c.HOS_ID
     and d.copy_code = c.COPY_CODE
     and d.ass_id = c.ASS_ID
     and d.ass_no = c.ASS_NO
     and d.is_stop = 0
    left join hos_fac_dict e
      on e.group_id = c.GROUP_ID
     and e.hos_id = c.HOS_ID
     and e.fac_id = c.FAC_ID
     and e.fac_no = c.FAC_NO
     and e.is_stop = 0
    left join HOS_DEPT_DICT h
      on a.dept_id = h.dept_id
     and a.group_id = h.group_id
     and a.hos_id = h.hos_id
     and a.dept_no = h.dept_no
    left join sys_user s
      on s.group_id = a.group_id
     and s.hos_id = a.hos_id
     and s.user_id = a.create_emp
    left join sys_user s1
      on a.group_id = s1.group_id
     and a.hos_id = s1.hos_id
     and s1.user_id = a.audit_emp
    left join ASS_NATURS n
      on a.ass_nature = n.naturs_code
      <where>                     
		<if test="group_id != null and group_id != ''">
		AND a.group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND a.hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="ins_id != null and ins_id != ''">
		AND a.ins_id = #{ins_id,jdbcType=INTEGER}
		</if>
		<if test="ins_no != null and ins_no != ''">
		AND a.ins_no = #{ins_no,jdbcType=VARCHAR}
		</if><if test="ins_name != null and ins_name != ''">
		AND a.ins_name = #{ins_name,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND a.ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND a.ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND a.ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="dept_id != null and dept_id != ''">
		AND a.dept_id = #{dept_id,jdbcType=INTEGER}
		</if>
		<if test="dept_no != null and dept_no != ''">
		AND a.dept_no = #{dept_no,jdbcType=INTEGER}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND a.create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date_begin != null and  create_date_end !=null and create_date_begin != '' and create_date_end !=''">
		AND a.create_date between  to_date(#{create_date_begin,jdbcType=DATE}, 'yyyy-MM-dd')  and to_date(#{create_date_end,jdbcType=DATE}, 'yyyy-MM-dd')  
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND a.audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		<if test="audit_date_begin != null and audit_date_end != null  and audit_date_begin != '' and audit_date_end != '' ">
		AND a.audit_date between to_date(#{audit_date_begin,jdbcType=DATE}, 'yyyy-MM-dd')  and to_date(#{audit_date_end,jdbcType=DATE}, 'yyyy-MM-dd')  
		</if>
		<if test="state != null and state != ''">
		AND a.state = #{state,jdbcType=INTEGER}
		</if>
		<if test="note != null and note != ''">
		AND a.note = #{note,jdbcType=VARCHAR}
		</if>
		<if test="ass_table != null and ass_table != ''">
		AND (d.ass_name like '%${ass_table}%' 
		or b.ass_card_no  like '%${ass_table}%' 
		or d.ass_code like '%${ass_table}%'  
		)
		</if>
		</where> 
      
  
  )
select group_id,
       hos_id,
       copy_code,
       ins_id,
       ins_no,
       ins_name,
       ass_year,
       ass_month,
       ass_nature,
       naturs_name,
       dept_id,
       dept_no,
       dept_name,
       create_emp,
       create_emp_name,
       create_date,
       audit_emp,
       audit_emp_name,
       audit_date,
       state,
       note,
       ass_card_no,
       ASS_SPEC,
       ASS_BRAND,
       ASS_MONDL,
       ASS_SEQ_NO,
       fac_name,
       ass_code,
       ass_name,
       state_go,
       is_rep,
       is_main,
       ins_result
  from detail_temp
	order by ins_id

</select>	
</mapper>

