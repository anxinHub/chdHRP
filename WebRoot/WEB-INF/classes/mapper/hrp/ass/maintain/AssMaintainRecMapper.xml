<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.ass.dao.maintain.AssMaintainRecMapper">
	
	<resultMap id="assMaintainRec" type="com.chd.hrp.ass.entity.maintain.AssMaintainRec">
	<result property="group_id" column="group_id"/>
	<result property="hos_id" column="hos_id"/>
	<result property="copy_code" column="copy_code"/>
	<result property="rec_id" column="rec_id"/>
	<result property="rec_no" column="rec_no"/>
	<result property="ass_year" column="ass_year"/>
	<result property="ass_month" column="ass_month"/>
	<result property="plan_id" column="plan_id"/>
	<result property="plan_no" column="plan_no"/>
	<result property="plan_name" column="plan_name"/>
	<result property="ass_nature" column="ass_nature"/>
	<result property="naturs_name" column="naturs_name"/>
	<result property="fact_exec_emp" column="fact_exec_emp"/>
	<result property="fact_exec_emp_name" column="fact_exec_emp_name"/>
	<result property="plan_exec_date" column="plan_exec_date"/>
	<result property="fact_exec_date" column="fact_exec_date"/>
	<result property="maintain_hours" column="maintain_hours"/>
	<result property="maintain_money" column="maintain_money"/>
	<result property="maintain_desc" column="maintain_desc"/>
	<result property="state" column="state"/>
	<result property="maintain_dept_id" column="maintain_dept_id"/>
	<result property="maintain_dept_no" column="maintain_dept_no"/>
	<result property="maintain_dept_code" column="maintain_dept_code"/>
	<result property="maintain_dept_name" column="maintain_dept_name"/>
	<result property="create_emp" column="create_emp"/>
	<result property="create_emp_name" column="create_emp_name"/>
	<result property="create_date" column="create_date"/>
	<result property="audit_date" column="audit_date"/>
	<result property="audit_emp" column="audit_emp"/>
	<result property="audit_emp_name" column="audit_emp_name"/>
	</resultMap>
	
	<resultMap id="assMaintainRecMap" type="java.util.Map">
	<result property="group_id" column="group_id"/>
	<result property="hos_id" column="hos_id"/>
	<result property="copy_code" column="copy_code"/>
	<result property="rec_id" column="rec_id"/>
	<result property="rec_no" column="rec_no"/>
	<result property="ass_year" column="ass_year"/>
	<result property="ass_month" column="ass_month"/>
	<result property="plan_id" column="plan_id"/>
	<result property="plan_no" column="plan_no"/>
	<result property="plan_name" column="plan_name"/>
	<result property="ass_nature" column="ass_nature"/>
	<result property="naturs_name" column="naturs_name"/>
	<result property="fact_exec_emp" column="fact_exec_emp"/>
	<result property="fact_exec_emp_name" column="fact_exec_emp_name"/>
	<result property="plan_exec_date" column="plan_exec_date"/>
	<result property="fact_exec_date" column="fact_exec_date"/>
	<result property="maintain_hours" column="maintain_hours"/>
	<result property="maintain_money" column="maintain_money"/>
	<result property="maintain_desc" column="maintain_desc"/>
	<result property="state" column="state"/>
	<result property="maintain_dept_id" column="maintain_dept_id"/>
	<result property="maintain_dept_no" column="maintain_dept_no"/>
	<result property="maintain_dept_code" column="maintain_dept_code"/>
	<result property="maintain_dept_name" column="maintain_dept_name"/>
	<result property="create_emp" column="create_emp"/>
	<result property="create_emp_name" column="create_emp_name"/>
	<result property="create_date" column="create_date"/>
	<result property="audit_date" column="audit_date"/>
	<result property="audit_emp" column="audit_emp"/>
	<result property="audit_emp_name" column="audit_emp_name"/>
	<result property="ass_card_no" column="ass_card_no"/>
	<result property="ass_spec" column="ass_spec"/>
	<result property="ass_mondl" column="ass_mondl"/>
	<result property="ass_brand" column="ass_brand"/>
	<result property="ass_code" column="ass_code"/>
	<result property="ass_name" column="ass_name"/>
	<result property="fac_name" column="fac_name"/>
	<result property="maintain_unit" column="maintain_unit"/>
	</resultMap>
	
	<select id="queryCurrentSequence" resultType="java.lang.Long">
		select ASS_MAINTAIN_REC_SEQ.currval val from dual
	</select>
	
	
	<insert id="addAssMaintainRec" useGeneratedKeys="true" >
	
		INSERT INTO ASS_MAINTAIN_REC (
		<trim suffix="" suffixOverrides=",">
		<if test="group_id != null and group_id != ''">
		group_id
		,
		</if>
		<if test="hos_id != null and hos_id != ''">
		hos_id
		,
		</if>
		<if test="copy_code != null and copy_code != ''">
		copy_code
		,
		</if>
		rec_id
		,
		
		<if test="rec_no != null and rec_no != ''">
		rec_no
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		ass_year
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		ass_month
		,
		</if>
		<if test="plan_id != null and plan_id != ''">
		plan_id
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		ass_nature
		,
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		fact_exec_emp
		,
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		plan_exec_date
		,
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		fact_exec_date
		,
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		maintain_hours
		,
		</if>
		
		maintain_money
		,
		
		<if test="maintain_desc != null and maintain_desc != ''">
		maintain_desc
		,
		</if>
		<if test="state != null and state != ''">
		state
		,
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		maintain_dept_id
		,
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		maintain_dept_no
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		create_emp
		,
		</if>
		<if test="create_date != null and create_date != ''">
		create_date
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		audit_date
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		audit_emp
		,
		</if>
		</trim>
		) VALUES (
		<trim suffix="" suffixOverrides=",">
		<if test="group_id != null and group_id != ''">
		#{group_id,jdbcType=INTEGER}
		,
		</if>
		<if test="hos_id != null and hos_id != ''">
		#{hos_id,jdbcType=INTEGER}
		,
		</if>
		<if test="copy_code != null and copy_code != ''">
		#{copy_code,jdbcType=VARCHAR}
		,
		</if>
		ASS_MAINTAIN_REC_SEQ.nextval
		,
		
		<if test="rec_no != null and rec_no != ''">
		#{rec_no,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		#{ass_year,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		#{ass_month,jdbcType=VARCHAR}
		,
		</if>
		<if test="plan_id != null and plan_id != ''">
		#{plan_id,jdbcType=INTEGER}
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		#{ass_nature,jdbcType=VARCHAR}
		,
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		#{fact_exec_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		#{plan_exec_date,jdbcType=DATE}
		,
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		#{fact_exec_date,jdbcType=DATE}
		,
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		#{maintain_hours,jdbcType=INTEGER}
		,
		</if>
		<if test="maintain_money != null and maintain_money != ''">#{maintain_money,jdbcType=INTEGER},</if>
		<if test="maintain_money == null or maintain_money == ''">0 ,</if>
		<if test="maintain_desc != null and maintain_desc != ''">
		#{maintain_desc,jdbcType=VARCHAR}
		,
		</if>
		<if test="state != null and state != ''">
		#{state,jdbcType=INTEGER}
		,
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		#{maintain_dept_id,jdbcType=VARCHAR}
		,
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		#{maintain_dept_no,jdbcType=VARCHAR}
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		#{create_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="create_date != null and create_date != ''">
		#{create_date,jdbcType=DATE}
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		#{audit_date,jdbcType=DATE}
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		#{audit_emp,jdbcType=INTEGER}
		
		</if>
		</trim>		
		)
	
	</insert>
	<insert id="addBatchAssMaintainRec" parameterType="java.util.List" >
	
		INSERT INTO ASS_MAINTAIN_REC (
		<trim suffix="" suffixOverrides=",">
		<if test="group_id != null and group_id != ''">
		group_id
		,
		</if>
		<if test="hos_id != null and hos_id != ''">
		hos_id
		,
		</if>
		<if test="copy_code != null and copy_code != ''">
		copy_code
		,
		</if>
		<if test="rec_id != null and rec_id != ''">
		rec_id
		,
		</if>
		<if test="rec_no != null and rec_no != ''">
		rec_no
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		ass_year
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		ass_month
		,
		</if>
		<if test="plan_id != null and plan_id != ''">
		plan_id
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		ass_nature
		,
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		fact_exec_emp
		,
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		plan_exec_date
		,
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		fact_exec_date
		,
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		maintain_hours
		,
		</if>
		
		maintain_money
		,
	
		<if test="maintain_desc != null and maintain_desc != ''">
		maintain_desc
		,
		</if>
		<if test="state != null and state != ''">
		state
		,
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		maintain_dept_id
		,
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		maintain_dept_no
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		create_emp
		,
		</if>
		<if test="create_date != null and create_date != ''">
		create_date
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		audit_date
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		audit_emp
		,
		</if>
		</trim>
		) select ASS_MAINTAIN_REC_SEQ.nextval , t.* from(
		<foreach collection="list" item="item" index="index" separator=" union all " >
			select 		
			<trim suffix="" suffixOverrides=",">
			<if test="group_id != null and group_id != ''">
			#{item.group_id},jdbcType=INTEGER}
			,
			</if>
			<if test="hos_id != null and hos_id != ''">
			#{item.hos_id},jdbcType=INTEGER}
			,
			</if>
			<if test="copy_code != null and copy_code != ''">
			#{item.copy_code},jdbcType=VARCHAR}
			,
			</if>
			<if test="rec_id != null and rec_id != ''">
			#{item.rec_id},jdbcType=INTEGER}
			,
			</if>
			<if test="rec_no != null and rec_no != ''">
			#{item.rec_no},jdbcType=VARCHAR}
			,
			</if>
			<if test="ass_year != null and ass_year != ''">
			#{item.ass_year},jdbcType=VARCHAR}
			,
			</if>
			<if test="ass_month != null and ass_month != ''">
			#{item.ass_month},jdbcType=VARCHAR}
			,
			</if>
			<if test="plan_id != null and plan_id != ''">
			#{item.plan_id},jdbcType=INTEGER}
			,
			</if>
			<if test="ass_nature != null and ass_nature != ''">
			#{item.ass_nature},jdbcType=VARCHAR}
			,
			</if>
			<if test="fact_exec_emp != null and fact_exec_emp != ''">
			#{item.fact_exec_emp},jdbcType=INTEGER}
			,
			</if>
			<if test="plan_exec_date != null and plan_exec_date != ''">
			#{item.plan_exec_date},jdbcType=DATE}
			,
			</if>
			<if test="fact_exec_date != null and fact_exec_date != ''">
			#{item.fact_exec_date},jdbcType=DATE}
			,
			</if>
			<if test="maintain_hours != null and maintain_hours != ''">
			#{item.maintain_hours},jdbcType=INTEGER}
			,
			</if>
			<if test="maintain_money != null and maintain_money != ''">#{item.maintain_money,jdbcType=INTEGER},</if>
			<if test="maintain_money == null or maintain_money == ''">0 ,</if>
			<if test="maintain_desc != null and maintain_desc != ''">
			#{item.maintain_desc},jdbcType=VARCHAR}
			,
			</if>
			<if test="state != null and state != ''">
			#{item.state},jdbcType=INTEGER}
			,
			</if>
			<if test="maintain_dept_id != null and maintain_dept_id != ''">
			#{item.maintain_dept_id},jdbcType=VARCHAR}
			,
			</if>
			<if test="maintain_dept_no != null and maintain_dept_no != ''">
			#{item.maintain_dept_no},jdbcType=VARCHAR}
			,
			</if>
			<if test="create_emp != null and create_emp != ''">
			#{item.create_emp},jdbcType=INTEGER}
			,
			</if>
			<if test="create_date != null and create_date != ''">
			#{item.create_date},jdbcType=DATE}
			,
			</if>
			<if test="audit_date != null and audit_date != ''">
			#{item.audit_date},jdbcType=DATE}
			,
			</if>
			<if test="audit_emp != null and audit_emp != ''">
			#{item.audit_emp},jdbcType=INTEGER}
			,
			</if>
			</trim>
		    from dual
		</foreach>
		)t
	</insert>
	
	<update id="updateAssMaintainRec" parameterType="java.util.Map">
	
		UPDATE ass_maintain_rec 
		<trim prefix="SET"  suffixOverrides=","> 
		<if test="rec_no != null and rec_no != ''">
		rec_no = #{rec_no,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_year != null and ass_year != ''">
		ass_year = #{ass_year,jdbcType=VARCHAR}
		,
		</if>
		<if test="ass_month != null and ass_month != ''">
		ass_month = #{ass_month,jdbcType=VARCHAR}
		,
		</if>
		<if test="plan_id != null and plan_id != ''">
		plan_id = #{plan_id,jdbcType=INTEGER}
		,
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		ass_nature = #{ass_nature,jdbcType=VARCHAR}
		,
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		fact_exec_emp = #{fact_exec_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		plan_exec_date = #{plan_exec_date,jdbcType=DATE}
		,
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		fact_exec_date = #{fact_exec_date,jdbcType=DATE}
		,
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		maintain_hours = #{maintain_hours,jdbcType=INTEGER}
		,
		</if>
		<if test="maintain_money != null and maintain_money != ''">
		maintain_money = #{maintain_money,jdbcType=INTEGER}
		,
		</if>
		<if test="maintain_desc != null and maintain_desc != ''">
		maintain_desc = #{maintain_desc,jdbcType=VARCHAR}
		,
		</if>
		<if test="state != null and state != ''">
		state = #{state,jdbcType=INTEGER}
		,
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		maintain_dept_id = #{maintain_dept_id,jdbcType=VARCHAR}
		,
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		maintain_dept_no = #{maintain_dept_no,jdbcType=VARCHAR}
		,
		</if>
		<if test="create_emp != null and create_emp != ''">
		create_emp = #{create_emp,jdbcType=INTEGER}
		,
		</if>
		<if test="create_date != null and create_date != ''">
		create_date = #{create_date,jdbcType=DATE}
		,
		</if>
		<if test="audit_date != null and audit_date != ''">
		audit_date = #{audit_date,jdbcType=DATE}
		,
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		audit_emp = #{audit_emp,jdbcType=INTEGER}
		,
		</if>
		</trim>
		<where>                      
		  group_id = #{group_id,jdbcType=INTEGER} 
		  
		AND hos_id = #{hos_id,jdbcType=INTEGER}

		AND copy_code = #{copy_code,jdbcType=VARCHAR}

		AND rec_id = #{rec_id,jdbcType=INTEGER}
		
		</where>  
	</update>
	
	<!-- 审核数据 -->
	<update id="updateBatchAssMaintainRec" parameterType="java.util.List">
	
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";" >
			UPDATE ass_maintain_rec 
			<trim prefix="SET"  suffixOverrides=","> 
	            <if test="item.state != null and item.state != ''">
					state = #{item.state},
				</if> 
			    <if test="item.audit_emp != null and item.audit_emp != ''">
					audit_emp = #{item.audit_emp} ,
				</if>
				<if test="item.audit_date != null and item.audit_date != ''">
					audit_date = #{item.audit_date} ,
				</if>
			</trim>
			<where>                     
					state=0
				<if test="item.group_id != null and item.group_id != ''">
					AND group_id = #{item.group_id}
				</if>
				<if test="item.hos_id != null and item.hos_id != ''">
					AND hos_id = #{item.hos_id}
				</if>
				<if test="item.copy_code != null and item.copy_code != ''">
					AND copy_code = #{item.copy_code}
				</if> 
				<if test="item.rec_id != null and item.rec_id != ''">
					AND rec_id = #{item.rec_id}
				</if>
			</where>  			
		</foreach>
	</update>
	<!-- 消审数据 -->
	<update id="updateBatchAssMaintainRecBack" parameterType="java.util.List">
	
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">
			UPDATE ass_maintain_rec
			<trim prefix="SET" suffixOverrides=",">
				<if test="item.state != null and item.state != ''">
					state = #{item.state},
				</if> 
					  audit_emp = #{item.audit_emp},  
				      audit_date = #{item.audit_date},
				 
			</trim>
			<where>
					state=1
				<if test="item.group_id != null and item.group_id != ''">
					AND group_id = #{item.group_id}
				</if>
				<if test="item.hos_id != null and item.hos_id != ''">
					AND hos_id = #{item.hos_id}
				</if>
				<if test="item.copy_code != null and item.copy_code != ''">
					AND copy_code = #{item.copy_code}
				</if> 
				<if test="item.rec_id != null and item.rec_id != ''">
					AND rec_id = #{item.rec_id}
				</if>
			</where>
			</foreach>
	</update>
	
	<!-- 终止计划 -->
	 <update id="updateBatchAssMaintainRecStop" parameterType="java.util.List">
	
		<foreach collection="list" item="item" index="index" open="begin" close=";end;" separator=";">
			UPDATE ass_maintain_rec
			<trim prefix="SET" suffixOverrides=",">
				<if test="item.state != null and item.state != ''">
					state = #{item.state},
				</if>  
				 
			</trim>
			<where> 
				<if test="item.group_id != null and item.group_id != ''">
					AND group_id = #{item.group_id}
				</if>
				<if test="item.hos_id != null and item.hos_id != ''">
					AND hos_id = #{item.hos_id}
				</if>
				<if test="item.copy_code != null and item.copy_code != ''">
					AND copy_code = #{item.copy_code}
				</if> 
				<if test="item.rec_id != null and item.rec_id != ''">
					AND rec_id = #{item.rec_id}
				</if>
			</where>
			</foreach>
	</update>
	<delete id="deleteAssMaintainRec" parameterType="java.util.Map">
	
		DELETE FROM ass_maintain_rec 
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="rec_id != null and rec_id != ''">
		AND rec_id = #{rec_id,jdbcType=INTEGER}
		</if>
		<if test="rec_no != null and rec_no != ''">
		AND rec_no = #{rec_no,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="plan_id != null and plan_id != ''">
		AND plan_id = #{plan_id,jdbcType=INTEGER}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		AND fact_exec_emp = #{fact_exec_emp,jdbcType=INTEGER}
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		AND plan_exec_date = #{plan_exec_date,jdbcType=DATE}
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		AND fact_exec_date = #{fact_exec_date,jdbcType=DATE}
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		AND maintain_hours = #{maintain_hours,jdbcType=INTEGER}
		</if>
		<if test="maintain_money != null and maintain_money != ''">
		AND maintain_money = #{maintain_money,jdbcType=INTEGER}
		</if>
		<if test="maintain_desc != null and maintain_desc != ''">
		AND maintain_desc = #{maintain_desc,jdbcType=VARCHAR}
		</if>
		<if test="state != null and state != ''">
		AND state = #{state,jdbcType=INTEGER}
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		AND maintain_dept_id = #{maintain_dept_id,jdbcType=VARCHAR}
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		AND maintain_dept_no = #{maintain_dept_no,jdbcType=VARCHAR}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date != null and create_date != ''">
		AND create_date = #{create_date,jdbcType=DATE}
		</if>
		<if test="audit_date != null and audit_date != ''">
		AND audit_date = #{audit_date,jdbcType=DATE}
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		</where>  
	</delete>
	<delete id="deleteBatchAssMaintainRec" parameterType="java.util.List">
		DELETE FROM ass_maintain_rec 
		<where>
			<foreach collection="list" index="index" item="item" open="(" separator="or" close=")"> 
				 group_id = #{item.group_id,jdbcType=INTEGER}

				AND hos_id = #{item.hos_id,jdbcType=INTEGER}

				AND copy_code = #{item.copy_code,jdbcType=VARCHAR}

				AND rec_id = #{item.rec_id,jdbcType=INTEGER}
		 
				
			</foreach>
	    </where>  
	</delete>
	<select id="queryAssMaintainRec" parameterType="java.util.Map" resultMap="assMaintainRec" >
	
		SELECT amr.group_id,
       amr.hos_id,
       amr.copy_code,
       amr.rec_id,
       amr.rec_no,
       amr.ass_year,
       amr.ass_month,
       amr.plan_id,
       amp.plan_no,
       amp.plan_name,
       amr.ass_nature,
       an.naturs_name,
       amr.fact_exec_emp,
       su.user_name fact_exec_emp_name,
       amr.plan_exec_date,
       amr.fact_exec_date,
       amr.maintain_hours,
       amr.maintain_money,
       amr.maintain_desc,
       amr.state,
       case
         when amr.state = 0 then
          '新建'
         when amr.state = 1 then
          '审核'
         when amr.state = 2 then
          '终止'
         else
          ''
       end state_name,
       amr.maintain_dept_id,
       amr.maintain_dept_no,
       hdd.dept_code maintain_dept_code,
       hdd.dept_name maintain_dept_name,
       amr.create_emp,
       suu.user_name create_emp_name,
       amr.create_date,
       amr.audit_date,
       amr.audit_emp,
       suuu.user_name audit_emp_name
  FROM ASS_MAINTAIN_REC amr
  left join (select group_id,
                    hos_id,
                    copy_code,
                    rec_id,
                    max(ass_card_no) ass_card_no
               from ass_maintain_rec_ass
              group by group_id, hos_id, copy_code, rec_id
             
             ) aa
    on aa.group_id = amr.group_id
   and aa.hos_id = amr.hos_id
   and aa.copy_code = amr.copy_code
   and aa.rec_id = amr.rec_id
  left join v_ass_card ca
    on ca.GROUP_ID = aa.group_id
   and ca.HOS_ID = aa.hos_id
   and ca.COPY_CODE = aa.copy_code
   and ca.ASS_CARD_NO = aa.ass_card_no
  left join ass_no_dict di
    on di.group_id = ca.GROUP_ID
   and di.hos_id = ca.HOS_ID
   and di.copy_code = ca.COPY_CODE
   and di.ass_id = ca.ASS_ID
   and di.ass_no = ca.ASS_NO
   and di.is_stop = 0
  left join ASS_MAINTAIN_PLAN amp
    on amr.plan_id = amp.plan_id
  left join ass_naturs an
    on amr.ass_nature = an.naturs_code
  left join SYS_USER su
    on amr.fact_exec_emp = su.user_id
  left join HOS_DEPT_DICT hdd
    on amr.maintain_dept_id = hdd.dept_id
   and amr.maintain_dept_no = hdd.dept_no
  left join SYS_USER suu
    on amr.create_emp = suu.user_id
  left join SYS_USER suuu
    on amr.audit_emp = suuu.user_id

		<where>                     
		<if test="group_id != null and group_id != ''">
		AND amr.group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND amr.hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND amr.copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="rec_id != null and rec_id != ''">
		AND amr.rec_id = #{rec_id,jdbcType=INTEGER}
		</if>
		<if test="rec_no != null and rec_no != ''">
		AND amr.rec_no = #{rec_no,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND amr.ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND amr.ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="plan_id != null and plan_id != ''">
		AND amr.plan_id = #{plan_id,jdbcType=INTEGER}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND amr.ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		AND amr.fact_exec_emp = #{fact_exec_emp,jdbcType=INTEGER}
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		AND amr.plan_exec_date = #{plan_exec_date,jdbcType=DATE}
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		AND amr.fact_exec_date = #{fact_exec_date,jdbcType=DATE}
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		AND amr.maintain_hours = #{maintain_hours,jdbcType=INTEGER}
		</if>
		<if test="maintain_money != null and maintain_money != ''">
		AND amr.maintain_money = #{maintain_money,jdbcType=INTEGER}
		</if>
		<if test="maintain_desc != null and maintain_desc != ''">
		AND amr.maintain_desc = #{maintain_desc,jdbcType=VARCHAR}
		</if>
		<if test="state != null and state != ''">
		AND amr.state = #{state,jdbcType=INTEGER}
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		AND amr.maintain_dept_id = #{maintain_dept_id,jdbcType=VARCHAR}
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		AND amr.maintain_dept_no = #{maintain_dept_no,jdbcType=VARCHAR}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND amr.create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date != null and create_date != ''">
		AND amr.create_date = #{create_date,jdbcType=DATE}
		</if>
	    <if test="create_date_begin != null and create_date_begin != '' and create_date_end != null and create_date_end != ''">
			AND amr.create_date between to_date(#{create_date_begin},'yyyy/mm/dd') and to_date(#{create_date_end},'yyyy/mm/dd')
		</if>
		<if test="audit_date != null and audit_date != ''">
		AND amr.audit_date = #{audit_date,jdbcType=DATE}
		</if>
		<if test="audit_date_begin != null and audit_date_begin != '' and audit_date_end != null and audit_date_end != ''">
			AND amr.audit_date between to_date(#{audit_date_begin},'yyyy/mm/dd') and to_date(#{audit_date_end},'yyyy/mm/dd')
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND amr.audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		<if test="ass_table != null and ass_table != ''">
		AND (di.ass_name like '%${ass_table}%' 
		or aa.ass_card_no  like '%${ass_table}%' 
		or di.ass_code like '%${ass_table}%'  
		)
		</if>
		
		<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			amr.group_id=b.group_id and amr.hos_id=b.hos_id and
			to_char(amr.maintain_dept_id)=b.perm_code
			AND TABLE_CODE =
			upper('hos_dept_dict')
			and b.user_id=#{user_id,jdbcType=INTEGER}
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>   
		order by amr.rec_no asc
	</select>
	
	<!--卡片查询保养记录  -->
	<select id="queryAssMaintainRecCard" parameterType="java.util.Map" resultMap="assMaintainRec" >
	
		SELECT 
		amr.group_id,
		amr.hos_id,
		amr.copy_code,
		amr.rec_id,
		amr.rec_no,
		amr.ass_year,
		amr.ass_month,
		amr.plan_id,
    amp.plan_no,
    amp.plan_name,
		amr.ass_nature,
    an.naturs_name,
		amr.fact_exec_emp,
    su.user_name fact_exec_emp_name, 
		amr.plan_exec_date,
    amr.fact_exec_date,
    amr.maintain_hours,
    amr.maintain_money,
    amr.maintain_desc,
    amr.state,
    amr.maintain_dept_id,
    amr.maintain_dept_no,
    hdd.dept_code maintain_dept_code,
    hdd.dept_name maintain_dept_name,
    amr.create_emp,
    suu.user_name create_emp_name,
    amr.create_date,
    amr.audit_date,
    amr.audit_emp,
    suuu.user_name audit_emp_name
      from ASS_MAINTAIN_REC_ASS amrs 
 right join  ASS_MAINTAIN_REC amr on amr.REC_ID=amrs.REC_ID
    left join ASS_MAINTAIN_PLAN amp on amr.plan_id = amp.plan_id
    left join ass_naturs an on amr.ass_nature = an.naturs_code
    left join SYS_USER su on amr.fact_exec_emp = su.user_id
    left join HOS_DEPT_DICT hdd on amr.maintain_dept_id = hdd.dept_id and amr.maintain_dept_no = hdd.dept_no
    left join SYS_USER suu on amr.create_emp = suu.user_id
    left join SYS_USER suuu on amr.audit_emp = suuu.user_id
		<where> 
		amrs.ASS_CARD_NO=#{ass_card_no,jdbcType=VARCHAR}                    
		<if test="group_id != null and group_id != ''">
		AND amr.group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND amr.hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND amr.copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="rec_id != null and rec_id != ''">
		AND amr.rec_id = #{rec_id,jdbcType=INTEGER}
		</if>
		<if test="rec_no != null and rec_no != ''">
		AND amr.rec_no = #{rec_no,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND amr.ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND amr.ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="plan_id != null and plan_id != ''">
		AND amr.plan_id = #{plan_id,jdbcType=INTEGER}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND amr.ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		AND amr.fact_exec_emp = #{fact_exec_emp,jdbcType=INTEGER}
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		AND amr.plan_exec_date = #{plan_exec_date,jdbcType=DATE}
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		AND amr.fact_exec_date = #{fact_exec_date,jdbcType=DATE}
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		AND amr.maintain_hours = #{maintain_hours,jdbcType=INTEGER}
		</if>
		<if test="maintain_money != null and maintain_money != ''">
		AND amr.maintain_money = #{maintain_money,jdbcType=INTEGER}
		</if>
		<if test="maintain_desc != null and maintain_desc != ''">
		AND amr.maintain_desc = #{maintain_desc,jdbcType=VARCHAR}
		</if>
		<if test="state != null and state != ''">
		AND amr.state = #{state,jdbcType=INTEGER}
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		AND amr.maintain_dept_id = #{maintain_dept_id,jdbcType=VARCHAR}
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		AND amr.maintain_dept_no = #{maintain_dept_no,jdbcType=VARCHAR}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND amr.create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date != null and create_date != ''">
		AND amr.create_date = #{create_date,jdbcType=DATE}
		</if>
	    <if test="create_date_begin != null and create_date_begin != '' and create_date_end != null and create_date_end != ''">
			AND amr.create_date between to_date(#{create_date_begin},'yyyy/mm/dd') and to_date(#{create_date_end},'yyyy/mm/dd')
		</if>
		<if test="audit_date != null and audit_date != ''">
		AND amr.audit_date = #{audit_date,jdbcType=DATE}
		</if>
		<if test="audit_date_begin != null and audit_date_begin != '' and audit_date_end != null and audit_date_end != ''">
			AND amr.audit_date between to_date(#{audit_date_begin},'yyyy/mm/dd') and to_date(#{audit_date_end},'yyyy/mm/dd')
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND amr.audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		</where>   
		order by amr.rec_no asc
	</select>
	<select id="queryAssMaintainRecByCode" resultMap="assMaintainRec"  parameterType="java.util.Map" >
	
			SELECT 
		t.group_id,
		t.hos_id,
		t.copy_code,
		t.rec_id,
		t.rec_no,
		t.ass_year,
		t.ass_month,
		t.plan_id,
		t.ass_nature,
    a.naturs_name,
		t.fact_exec_emp,
		t.plan_exec_date,
		t.fact_exec_date,
		t.maintain_hours,
		t.maintain_money,
		t.maintain_desc,
		t.state,
		t.maintain_dept_id,
		t.maintain_dept_no,
		t.create_emp,
		t.create_date,
		t.audit_date,
		t.audit_emp
		FROM ass_maintain_rec t
    left join ass_naturs a
    on a.naturs_code =t.ass_nature
		WHERE 
		group_id = #{group_id,jdbcType=INTEGER}   and 
		hos_id = #{hos_id,jdbcType=INTEGER}   and 
		copy_code = #{copy_code,jdbcType=VARCHAR}   and 
		rec_id = #{rec_id,jdbcType=INTEGER} 
	
	</select>
	<select id="queryAssMaintainRecByUniqueness" resultMap="assMaintainRec"  parameterType="java.util.Map" >
	
		SELECT 
		group_id,
		hos_id,
		copy_code,
		rec_id,
		rec_no,
		ass_year,
		ass_month,
		plan_id,
		ass_nature,
		fact_exec_emp,
		plan_exec_date,
		fact_exec_date,
		maintain_hours,
		maintain_money,
		maintain_desc,
		state,
		maintain_dept_id,
		maintain_dept_no,
		create_emp,
		create_date,
		audit_date,
		audit_emp
		FROM ASS_MAINTAIN_REC 
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="rec_id != null and rec_id != ''">
		AND rec_id = #{rec_id,jdbcType=INTEGER}
		</if>
		<if test="rec_no != null and rec_no != ''">
		AND rec_no = #{rec_no,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="plan_id != null and plan_id != ''">
		AND plan_id = #{plan_id,jdbcType=INTEGER}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		AND fact_exec_emp = #{fact_exec_emp,jdbcType=INTEGER}
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		AND plan_exec_date = #{plan_exec_date,jdbcType=DATE}
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		AND fact_exec_date = #{fact_exec_date,jdbcType=DATE}
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		AND maintain_hours = #{maintain_hours,jdbcType=INTEGER}
		</if>
		<if test="maintain_money != null and maintain_money != ''">
		AND maintain_money = #{maintain_money,jdbcType=INTEGER}
		</if>
		<if test="maintain_desc != null and maintain_desc != ''">
		AND maintain_desc = #{maintain_desc,jdbcType=VARCHAR}
		</if>
		<if test="state != null and state != ''">
		AND state = #{state,jdbcType=INTEGER}
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		AND maintain_dept_id = #{maintain_dept_id,jdbcType=VARCHAR}
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		AND maintain_dept_no = #{maintain_dept_no,jdbcType=VARCHAR}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date != null and create_date != ''">
		AND create_date = #{create_date,jdbcType=DATE}
		</if>
		<if test="audit_date != null and audit_date != ''">
		AND audit_date = #{audit_date,jdbcType=DATE}
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		</where>   
		order by group_id asc
	</select>
	<select id="queryAssMaintainRecExists" resultMap="assMaintainRec"  parameterType="java.util.Map" >
	
		SELECT 
		group_id,
		hos_id,
		copy_code,
		rec_id,
		rec_no,
		ass_year,
		ass_month,
		plan_id,
		ass_nature,
		fact_exec_emp,
		plan_exec_date,
		fact_exec_date,
		maintain_hours,
		maintain_money,
		maintain_desc,
		state,
		maintain_dept_id,
		maintain_dept_no,
		create_emp,
		create_date,
		audit_date,
		audit_emp
		FROM ASS_MAINTAIN_REC 
		<where>                     
		<if test="group_id != null and group_id != ''">
		AND group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="rec_id != null and rec_id != ''">
		AND rec_id = #{rec_id,jdbcType=INTEGER}
		</if>
		<if test="rec_no != null and rec_no != ''">
		AND rec_no = #{rec_no,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="plan_id != null and plan_id != ''">
		AND plan_id = #{plan_id,jdbcType=INTEGER}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		AND fact_exec_emp = #{fact_exec_emp,jdbcType=INTEGER}
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		AND plan_exec_date = #{plan_exec_date,jdbcType=DATE}
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		AND fact_exec_date = #{fact_exec_date,jdbcType=DATE}
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		AND maintain_hours = #{maintain_hours,jdbcType=INTEGER}
		</if>
		<if test="maintain_money != null and maintain_money != ''">
		AND maintain_money = #{maintain_money,jdbcType=INTEGER}
		</if>
		<if test="maintain_desc != null and maintain_desc != ''">
		AND maintain_desc = #{maintain_desc,jdbcType=VARCHAR}
		</if>
		<if test="state != null and state != ''">
		AND state = #{state,jdbcType=INTEGER}
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		AND maintain_dept_id = #{maintain_dept_id,jdbcType=VARCHAR}
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		AND maintain_dept_no = #{maintain_dept_no,jdbcType=VARCHAR}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date != null and create_date != ''">
		AND create_date = #{create_date,jdbcType=DATE}
		</if>
		<if test="audit_date != null and audit_date != ''">
		AND audit_date = #{audit_date,jdbcType=DATE}
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		</where>   
		order by group_id asc
	</select>
	
	<!-- 打印主表 -->
	<select id="queryAssMainRecPlanByMainBatch"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
		
		amr.rec_id as id,
		amr.rec_no,
		amr.group_id,
		amr.hos_id,
		amr.copy_code,
		amr.ass_year,
		amr.ass_month,
		amr.plan_id,
    amp.plan_no,
    amp.plan_name,
		amr.ass_nature,
    an.naturs_name,
    amr.fact_exec_emp,
    su.user_name fact_exec_emp_name, 
    amr.plan_exec_date,
    amr.fact_exec_date,
    amr.maintain_hours,
    amr.maintain_money,
    amr.maintain_desc,
    amr.state,
    case when amr.state = 0 then '新建' when amr.state = 1 then '审核' when amr.state = 2 then '终止' else '' end state_name,
    amr.maintain_dept_id,
    amr.maintain_dept_no,
    hdd.dept_code maintain_dept_code,
    hdd.dept_name maintain_dept_name,
    amr.create_emp,
    suu.user_name create_emp_name,
    amr.create_date,
    amr.audit_date,
    amr.audit_emp,
    suuu.user_name audit_emp_name
    FROM ASS_MAINTAIN_REC  amr
    left join ASS_MAINTAIN_PLAN amp on amr.plan_id = amp.plan_id
    left join ass_naturs an on amr.ass_nature = an.naturs_code
    left join SYS_USER su on amr.fact_exec_emp = su.user_id
    left join HOS_DEPT_DICT hdd on amr.maintain_dept_id = hdd.dept_id and amr.maintain_dept_no = hdd.dept_no
    left join SYS_USER suu on amr.create_emp = suu.user_id
    left join SYS_USER suuu on amr.audit_emp = suuu.user_id
	where                     
			amr.group_id = #{group_id}
			AND amr.hos_id = #{hos_id}
			AND amr.copy_code = #{copy_code}
			AND amr.rec_id in (${paraId})
		order by amr.rec_id asc
	
	</select>
	
	<!-- 修改页面主表打印 -->
	<select id="queryAssMainRecPlanByMain"  parameterType="java.util.Map" resultType="java.util.Map">
		SELECT 
		
		amr.rec_id as id,
		amr.rec_no,
		amr.group_id,
		amr.hos_id,
		amr.copy_code,
		amr.ass_year,
		amr.ass_month,
		amr.plan_id,
    amp.plan_no,
    amp.plan_name,
		amr.ass_nature,
    an.naturs_name,
    amr.fact_exec_emp,
    su.user_name fact_exec_emp_name, 
    amr.plan_exec_date,
    amr.fact_exec_date,
    amr.maintain_hours,
    amr.maintain_money,
    amr.maintain_desc,
    amr.state,
    case when amr.state = 0 then '新建' when amr.state = 1 then '审核' when amr.state = 2 then '终止' else '' end state_name,
    amr.maintain_dept_id,
    amr.maintain_dept_no,
    hdd.dept_code maintain_dept_code,
    hdd.dept_name maintain_dept_name,
    amr.create_emp,
    suu.user_name create_emp_name,
    amr.create_date,
    amr.audit_date,
    amr.audit_emp,
    suuu.user_name audit_emp_name
    FROM ASS_MAINTAIN_REC  amr
    left join ASS_MAINTAIN_PLAN amp on amr.plan_id = amp.plan_id
    left join ass_naturs an on amr.ass_nature = an.naturs_code
    left join SYS_USER su on amr.fact_exec_emp = su.user_id
    left join HOS_DEPT_DICT hdd on amr.maintain_dept_id = hdd.dept_id and amr.maintain_dept_no = hdd.dept_no
    left join SYS_USER suu on amr.create_emp = suu.user_id
    left join SYS_USER suuu on amr.audit_emp = suuu.user_id
	where                     
			amr.group_id = #{group_id}
			AND amr.hos_id = #{hos_id}
			AND amr.copy_code = #{copy_code}
			AND amr.rec_id = #{rec_id}
		order by amr.rec_id asc
	</select>
	
	<select id="queryAssMainRecPlanByDetail" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
		       amri.rec_id as id,
		        amri.group_id,
		       amri.hos_id,
		       amri.copy_code,
		       amri.detail_id,
		       amri.ass_card_no,
		       andd.ass_code,
		       andd.ass_name,
		       andd.ass_spec,
		       andd.ass_model ass_mondl,
		       hfd.fac_name,
		       amea.maintain_money maintain_moneyy,
		       case
		         when amea.maintain_unit = 0 then
		          '年'
		         when amea.maintain_unit = 1 then
		          '月'
		         when amea.maintain_unit = 2 then
		          '日'
		         when amea.maintain_unit = 3 then
		          '时'
		         when amea.maintain_unit = 4 then
		          '分'
		         else
		          ''
		       end maintain_unitt,
		       amea.maintain_unit,
		       amea.maintain_hours maintain_hourss,
           it.item_code ,
           it.item_name,ach.ASS_SEQ_NO
		  from ass_maintain_rec_ASS amri
      left join ass_maintain_rec_ass amea
        on amri.rec_id = amea.rec_id
       and amri.ass_card_no = amea.ass_card_no
      left join v_ass_card ach
        on amri.ass_card_no = ach.ass_card_no
       and amri.group_id = ach.GROUP_ID
       and amri.hos_id = ach.HOS_ID
       and amri.copy_code = ach.COPY_CODE
      left join ASS_NO_DICT andd
        on andd.group_id = ach.GROUP_ID
       and andd.hos_id = ach.HOS_ID
       and andd.copy_code = ach.COPY_CODE
       and andd.ass_id = ach.ASS_ID
       and andd.ass_no = ach.ASS_NO
      left join HOS_FAC_DICT hfd
        on hfd.group_id = andd.GROUP_ID
       and hfd.hos_id = andd.HOS_ID
       and hfd.fac_id = andd.FAC_ID
       and hfd.fac_no = andd.FAC_NO
      left join ASS_MAINTAIN_REC_ITEM it
      on it.group_id = amri.group_id
      and it.hos_id = amri.hos_id
      and it.copy_code = amri.copy_code
      and it.rec_id = amri.rec_id
      and it.ass_card_no = amri.ass_card_no
		where 
		amri.group_id = #{group_id,jdbcType=INTEGER}
			AND amri.hos_id = #{hos_id,jdbcType=INTEGER}
			AND amri.copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="paraId != null and paraId != ''">
			AND amri.rec_id in  (${paraId})
			</if>
			<if test="rec_id != null and rec_id != ''">
			AND amri.rec_id = #{rec_id,jdbcType=VARCHAR}
			</if> 	
	
	order by amri.rec_id asc
	</select>
	
	<!-- 保养计划单打印状态 -->
	<select id="queryAssMainRecState" parameterType="java.util.Map" resultType="java.lang.String">
	SELECT rec_no  FROM ASS_MAINTAIN_REC 
		WHERE
			group_id = #{group_id,jdbcType=INTEGER}
			AND hos_id = #{hos_id,jdbcType=INTEGER}
			AND copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="paraId != null and paraId != ''">
			AND rec_id in  (${paraId})
			</if>
			<if test="rec_id != null and rec_id != ''">
			AND rec_id = #{rec_id,jdbcType=VARCHAR}
			</if>
			<!-- 前台传参   2 确认 -->
			and state != #{state,jdbcType=INTEGER}
	</select>
	
<!-- 是否明细 -->
<select id="queryDetails" parameterType="java.util.Map" resultMap="assMaintainRecMap">
	with detail_temp as
 (select a.group_id,
         a.hos_id,
         a.copy_code,
         a.rec_id,
         a.rec_no,
         a.ass_year,
         a.ass_month,
         a.plan_id,
         amp.plan_no,
         amp.plan_name,
         a.ass_nature,
         an.naturs_name,
         a.fact_exec_emp,
         su.user_name fact_exec_emp_name,
         a.plan_exec_date,
         a.fact_exec_date,
         a.maintain_hours,
         a.maintain_money,
         a.maintain_desc,
         a.state,
         case
           when a.state = 0 then
            '新建'
           when a.state = 1 then
            '审核'
           when a.state = 2 then
            '终止'
           else
            ''
         end state_name,
         a.maintain_dept_id,
         a.maintain_dept_no,
         hdd.dept_code maintain_dept_code,
         hdd.dept_name maintain_dept_name,
         a.create_emp,
         suu.user_name create_emp_name,
         a.create_date,
         a.audit_date,
         a.audit_emp,
         suuu.user_name audit_emp_name,
         c.ASS_CARD_NO,
         c.ASS_SPEC,
         c.ASS_MONDL,
         c.ASS_BRAND,
         d.ass_code,
         d.ass_name,
         di.fac_name,
         b.maintain_unit
    from ASS_MAINTAIN_REC a
    left join ass_maintain_rec_ass b
      on a.group_id = b.group_id
     and a.hos_id = b.hos_id
     and a.copy_code = b.copy_code
     and a.rec_id = b.rec_id
    left join v_ass_card c
      on b.group_id = c.GROUP_ID
     and b.hos_id = c.HOS_ID
     and b.copy_code = c.COPY_CODE
     and b.ass_card_no = c.ASS_CARD_NO
    left join ass_no_dict d
      on d.group_id = c.GROUP_ID
     and d.hos_id = c.HOS_ID
     and d.copy_code = c.COPY_CODE
     and d.ass_id = c.ASS_ID
     and d.ass_no = c.ASS_NO
     and d.is_stop = 0
    left join HOS_FAC_DICT di
      on di.group_id = c.GROUP_ID
     and di.hos_id = c.HOS_ID
     and di.fac_id = c.FAC_ID
     and di.fac_no = c.FAC_NO
     and di.is_stop = 0
  
    left join ASS_MAINTAIN_PLAN amp
      on a.plan_id = amp.plan_id
    left join ass_naturs an
      on a.ass_nature = an.naturs_code
    left join SYS_USER su
      on a.fact_exec_emp = su.user_id
    left join HOS_DEPT_DICT hdd
      on a.maintain_dept_id = hdd.dept_id
     and a.maintain_dept_no = hdd.dept_no
    left join SYS_USER suu
      on a.create_emp = suu.user_id
    left join SYS_USER suuu
      on a.audit_emp = suuu.user_id
  <where>                     
		<if test="group_id != null and group_id != ''">
		AND a.group_id = #{group_id,jdbcType=INTEGER}
		</if>
		<if test="hos_id != null and hos_id != ''">
		AND a.hos_id = #{hos_id,jdbcType=INTEGER}
		</if>
		<if test="copy_code != null and copy_code != ''">
		AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
		</if>
		<if test="rec_id != null and rec_id != ''">
		AND a.rec_id = #{rec_id,jdbcType=INTEGER}
		</if>
		<if test="rec_no != null and rec_no != ''">
		AND a.rec_no = #{rec_no,jdbcType=VARCHAR}
		</if>
		<if test="ass_year != null and ass_year != ''">
		AND a.ass_year = #{ass_year,jdbcType=VARCHAR}
		</if>
		<if test="ass_month != null and ass_month != ''">
		AND a.ass_month = #{ass_month,jdbcType=VARCHAR}
		</if>
		<if test="plan_id != null and plan_id != ''">
		AND a.plan_id = #{plan_id,jdbcType=INTEGER}
		</if>
		<if test="ass_nature != null and ass_nature != ''">
		AND a.ass_nature = #{ass_nature,jdbcType=VARCHAR}
		</if>
		<if test="fact_exec_emp != null and fact_exec_emp != ''">
		AND a.fact_exec_emp = #{fact_exec_emp,jdbcType=INTEGER}
		</if>
		<if test="plan_exec_date != null and plan_exec_date != ''">
		AND a.plan_exec_date = #{plan_exec_date,jdbcType=DATE}
		</if>
		<if test="fact_exec_date != null and fact_exec_date != ''">
		AND a.fact_exec_date = #{fact_exec_date,jdbcType=DATE}
		</if>
		<if test="maintain_hours != null and maintain_hours != ''">
		AND a.maintain_hours = #{maintain_hours,jdbcType=INTEGER}
		</if>
		<if test="maintain_money != null and maintain_money != ''">
		AND a.maintain_money = #{maintain_money,jdbcType=INTEGER}
		</if>
		<if test="maintain_desc != null and maintain_desc != ''">
		AND a.maintain_desc = #{maintain_desc,jdbcType=VARCHAR}
		</if>
		<if test="state != null and state != ''">
		AND a.state = #{state,jdbcType=INTEGER}
		</if>
		<if test="maintain_dept_id != null and maintain_dept_id != ''">
		AND a.maintain_dept_id = #{maintain_dept_id,jdbcType=VARCHAR}
		</if>
		<if test="maintain_dept_no != null and maintain_dept_no != ''">
		AND a.maintain_dept_no = #{maintain_dept_no,jdbcType=VARCHAR}
		</if>
		<if test="create_emp != null and create_emp != ''">
		AND a.create_emp = #{create_emp,jdbcType=INTEGER}
		</if>
		<if test="create_date != null and create_date != ''">
		AND a.create_date = #{create_date,jdbcType=DATE}
		</if>
	    <if test="create_date_begin != null and create_date_begin != '' and create_date_end != null and create_date_end != ''">
			AND a.create_date between to_date(#{create_date_begin},'yyyy/mm/dd') and to_date(#{create_date_end},'yyyy/mm/dd')
		</if>
		<if test="audit_date != null and audit_date != ''">
		AND a.audit_date = #{audit_date,jdbcType=DATE}
		</if>
		<if test="audit_date_begin != null and audit_date_begin != '' and audit_date_end != null and audit_date_end != ''">
			AND a.audit_date between to_date(#{audit_date_begin},'yyyy/mm/dd') and to_date(#{audit_date_end},'yyyy/mm/dd')
		</if>
		<if test="audit_emp != null and audit_emp != ''">
		AND a.audit_emp = #{audit_emp,jdbcType=INTEGER}
		</if>
		<if test="ass_table != null and ass_table != ''">
		AND (c.ass_name like '%${ass_table}%' 
		or b.ass_card_no  like '%${ass_table}%' 
		or c.ass_code like '%${ass_table}%'  
		)
		</if>
		</where>   
  
  
  )
select group_id,
       hos_id,
       copy_code,
       rec_id,
       rec_no,
       ass_year,
       ass_month,
       plan_id,
       plan_no,
       plan_name,
       ass_nature,
       naturs_name,
       fact_exec_emp,
       fact_exec_emp_name,
       plan_exec_date,
       fact_exec_date,
       maintain_hours,
       maintain_money,
       maintain_desc,
       state,
       state_name,
       maintain_dept_id,
       maintain_dept_no,
       maintain_dept_code,
       maintain_dept_name,
       create_emp,
       create_emp_name,
       create_date,
       audit_date,
       audit_emp,
       audit_emp_name,
       ASS_CARD_NO,
       ASS_SPEC,
       ASS_MONDL,
       ASS_BRAND,
       ass_code,
       ass_name,
       fac_name,
      
       maintain_unit
      
  from detail_temp

order 	by  rec_id

</select>	

<select id="queryAssMainRecStateList" parameterType="java.util.List" resultType="int" > 
	SELECT 
		count(1) 
		FROM ASS_MAINTAIN_REC 
		<where>   
		<foreach collection="list" item="item" index="index" open="(" separator=" or "  close=")">
		                  
			<if test="item.group_id != null and item.group_id != ''">
			group_id = #{item.group_id,jdbcType=INTEGER}
			</if>
			<if test="item.hos_id != null and item.hos_id != ''">
			AND hos_id = #{item.hos_id,jdbcType=INTEGER}
			</if>
			<if test="item.copy_code != null and item.copy_code != ''">
			AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
			</if>
			<if test="item.plan_id != null and item.plan_id != ''">
			AND plan_id = #{item.plan_id,jdbcType=INTEGER}
			</if>
		</foreach>
		</where>


</select>
</mapper>

