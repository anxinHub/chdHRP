<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.ass.dao.HrpAssSelectMapper">
	<resultMap type="com.chd.hrp.ass.entity.HrpAssSelect" id="hrpAssSelect">    
		<result property="id" column="id" />
		<result property="text" column="text" /> 
	</resultMap>   
	<resultMap id="hrpAssNoDict" type="com.chd.hrp.ass.entity.dict.AssNoDict"> 
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="ass_id" column="ass_id" /> 
		<result property="ass_no" column="ass_no" />
		<result property="id" column="id" />
		<result property="text" column="text" /> 
		<result property="ass_id_no" column="ass_id_no" />
		<result property="ass_code" column="ass_code" />
		<result property="ass_name" column="ass_name" />
		<result property="unit_name" column="unit_name" />
		<result property="ass_card_no" column="ass_card_no" />
		<result property="ass_type_id" column="ass_type_id" />
		<result property="ass_type_name" column="ass_type_name" /> 
		<result property="acc_type_code" column="acc_type_code" />
		<result property="acc_type_name" column="acc_type_name" />
		<result property="ass_unit" column="ass_unit" />
		<result property="ass_unit_name" column="ass_unit_name" />
		<result property="is_measure" column="is_measure" />
		<result property="is_depre" column="is_depre" />
		<result property="ass_depre_code" column="ass_depre_code" />
		<result property="ass_depre_name" column="ass_depre_name" />
		<result property="depre_years" column="depre_years" />
		<result property="is_stop" column="is_stop" />
		<result property="ass_spec" column="ass_spec" />
		<result property="ass_model" column="ass_model" />
		<result property="fac_id" column="fac_id" />
		<result property="fac_no" column="fac_no" />
		<result property="fac_id_name" column="fac_id_name" />
		<result property="fac_no_name" column="fac_no_name" />
		<result property="ven_id" column="ven_id" />
		<result property="ven_no" column="ven_no" />
		<result property="ven_id_name" column="ven_id_name" />
		<result property="ven_no_name" column="ven_no_name" />
		<result property="usage_code" column="usage_code" />
		<result property="usage_name" column="usage_name" />
		<result property="gb_code" column="gb_code" />
		<result property="spell_code" column="spell_code" />
		<result property="wbx_code" column="wbx_code" />
	</resultMap>
	<resultMap id="hrpAssMaintainItemDict"
		type="com.chd.hrp.ass.entity.dict.AssMaintainItemDict">
		<result property="maintain_item_code" column="maintain_item_code" />
		<result property="maintain_item_name" column="maintain_item_name" />
		<result property="spell_code" column="spell_code" />
		<result property="wbx_code" column="wbx_code" />
	</resultMap>

	<resultMap id="hrpAssMaintainItemDict1"
		type="com.chd.hrp.ass.entity.dict.AssMaintainItemDict">
		<result property="item_code" column="item_code" />
		<result property="item_name" column="item_name" />
		<result property="spell_code" column="spell_code" />
		<result property="wbx_code" column="wbx_code" />
	</resultMap>
	<resultMap type="java.util.Map" id="DeptMap">
		<result property="dept_id" column="dept_id" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="super_code" column="super_code" />
	</resultMap>

	<resultMap id="hrpAssNoDictTable" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="ass_id" column="ass_id" />
		<result property="ass_no" column="ass_no" />
		<result property="ass_id_no" column="ass_id_no" />
		<result property="ass_code" column="ass_code" />
		<result property="ass_name" column="ass_name" />
		<result property="ass_type_id" column="ass_type_id" />
		<result property="ass_type_name" column="ass_type_name" />
		<result property="acc_type_code" column="acc_type_code" />
		<result property="acc_type_name" column="acc_type_name" />
		<result property="ass_unit" column="ass_unit" />
		<result property="ass_unit_name" column="ass_unit_name" />
		<result property="is_measure" column="is_measure" />
		<result property="is_depre" column="is_depre" />
		<result property="ass_depre_code" column="ass_depre_code" />
		<result property="ass_depre_name" column="ass_depre_name" />
		<result property="depre_years" column="depre_years" />
		<result property="is_stop" column="is_stop" />
		<result property="ass_spec" column="ass_spec" />
		<result property="ass_model" column="ass_model" />
		<result property="fac_id" column="fac_id" />
		<result property="fac_no" column="fac_no" />
		<result property="fac_id_name" column="fac_id_name" />
		<result property="fac_no_name" column="fac_no_name" />
		<result property="ven_id" column="ven_id" />
		<result property="ven_no" column="ven_no" />
		<result property="ven_id_name" column="ven_id_name" />
		<result property="ven_no_name" column="ven_no_name" />
		<result property="usage_code" column="usage_code" />
		<result property="usage_name" column="usage_name" />
		<result property="gb_code" column="gb_code" />
		<result property="spell_code" column="spell_code" />
		<result property="wbx_code" column="wbx_code" />
	</resultMap>
	<resultMap type="java.util.Map" id="assCardTable">
		<result property="ass_id_no" column="ass_id_no" />
		<result property="ass_nature" column="ass_nature" />
		<result property="naturs_code" column="naturs_code" />
		<result property="ass_card_no" column="ass_card_no" />
		<result property="ass_ori_card_no" column="ass_ori_card_no" />
		<result property="unit_name" column="unit_name" />
		<result property="ass_code" column="ass_code" />
		<result property="ass_name" column="ass_name" />
		<result property="ass_spec" column="ass_spec" />
		<result property="ass_model" column="ass_model" />
		<result property="ass_brand" column="ass_brand" />
		<result property="ass_unit_name" column="ass_unit_name" />
		<result property="fac_name" column="fac_name" />
		<result property="ven_name" column="ven_name" />
		<result property="price" column="price" />
		<result property="depre_money" column="depre_money" />
		<result property="manage_depre_money" column="manage_depre_money" />
		<result property="cur_money" column="cur_money" />
		<result property="fore_money" column="fore_money" />
		<result property="add_depre_month" column="add_depre_month" />
		<result property="add_manage_month" column="add_manage_month" />
		<result property="buy_type" column="buy_type" />
		<result property="use_state" column="use_state" />
		<result property="in_date" column="in_date" />
		<result property="ven_id" column="ven_id" />
		<result property="ven_no" column="ven_no" />
		<result property="store_id" column="store_id" />
		<result property="store_no" column="store_no" />
		<result property="is_dept" column="is_dept" />
		<result property="dept_name" column="dept_name" />
		<result property="is_measure_name" column="is_measure_name" />
		<result property="ass_seq_no" column="ass_seq_no" />
		<result property="in_date" column="in_date" />
		<result property="store_name" column="store_name" />
		
		<result property="unpay_money" column="unpay_money" />
		<result property="pay_money" column="pay_money" />
		<result property="pay_plan_money" column="pay_plan_money" />
		<result property="bill_money" column="bill_money" />
		<result property="unbill_money" column="unbill_money" />
 		<result property="ass_in_no" column="ass_in_no" />
	</resultMap>
	<resultMap type="java.util.Map" id="assPayStageMap">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="ass_card_no" column="ass_card_no" />
		<result property="stage_no" column="stage_no" />
		<result property="stage_name" column="stage_name" />
		<result property="pay_term_id" column="pay_term_id" />
		<result property="pay_plan_date" column="pay_plan_date" />
		<result property="pay_plan_percent" column="pay_plan_percent" />
		<result property="pay_plan_money" column="pay_plan_money" />
		<result property="pay_money" column="pay_money" />
		<result property="unpay_money" column="unpay_money" />
	</resultMap>

	<resultMap type="java.util.Map" id="hrpAssFinaSelectMap">
		<result property="id" column="id" />
		<result property="text" column="text" />
	</resultMap>
	<resultMap type="java.util.Map" id="assBillDetailMap">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="bill_no" column="bill_no" />
		<result property="ass_card_no" column="ass_card_no" />
		<result property="ass_name" column="ass_name" />
		<result property="bill_money" column="bill_money" />
		<result property="invoice_no" column="invoice_no" />
		<result property="bill_date" column="bill_date" />
	</resultMap>
	<resultMap type="java.util.Map" id="asstypedict">
		<result property="id" column="id" />
		<result property="text" column="text" />
		<result property="manage_depre_amount" column="manage_depre_amount" />
	</resultMap>
	<select id="queryAssAcceptItemDict" resultMap="hrpAssSelect">
		SELECT
		accept_item_code id,
		accept_item_name text
		FROM
		ass_accept_item_dict
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				accept_item_code like '%${key}%' or
				accept_item_name
				like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by accept_item_code
	</select>


	<select id="queryAssAcceptItemAffi" resultMap="hrpAssSelect">
		SELECT
		a.accept_item_code id,
		b.accept_item_name text
		FROM
		ass_accept_item_affi a
		left join ass_accept_item_dict b on
		a.group_id =
		b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and
		a.accept_item_code = b.accept_item_code
		<where>
			a.ass_id = #{ass_id}
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="key != null and key != ''">
				and (
				b.accept_item_code like '%${key}%' or
				b.accept_item_name like
				'%${key}%'
				or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by a.accept_item_code
	</select>


	<select id="queryContractMain" resultMap="hrpAssSelect">
		select
		acm.contract_id id,
		nvl(acm.CONTRACT_ORI_NO,acm.CONTRACT_NO) text
		from ass_contract_main acm
		<where>
			<if test="group_id != null  and group_id != ''">
				and acm.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and acm.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and acm.copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				acm.CONTRACT_NO like '%${key}%' or
				acm.CONTRACT_NAME
				like '%${key}%'
				)
			</if>
		</where>
		order by acm.CONTRACT_NO
	</select>
	<select id="querySuperLocationSelect" resultMap="hrpAssSelect">
		select
		loc_code as id,
		loc_name_all as text
		from ass_location b
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and is_stop = 0
		<if test="key != null and key != ''">
			and (
			loc_code like '%${key}%' or
			loc_name like '%${key}%' or
			SPELL_CODE like '%${key}%' or
			WBX_CODE like '%${key}%'
			)
		</if>
		<if test="dept_id != null and dept_id != ''"> 
			and exists (
				select 1 from ass_location_dept a
				where b.group_id = a.group_id
				and b.hos_id = a.hos_id
				and b.copy_code = a.copy_code
				and b.loc_code=a.loc_code
				and a.dept_id = #{dept_id}
			)
		</if>
		<if test="is_last != null and is_last != ''">
			and is_last=#{is_last}
		</if>
		order by loc_code
	</select>


	<select id="queryNotExistsLocationSelect" resultMap="hrpAssSelect">
		select
		a.loc_code as id,
		a.loc_name_all as text
		from ass_location a
		where
		a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		and a.is_stop = 0
		<if test="key != null and key != ''">
			and (
			loc_code like '%${key}%' or
			loc_name like '%${key}%' or
			SPELL_CODE like '%${key}%' or
			WBX_CODE like '%${key}%'
			)
		</if>
		<if test="is_last != null and is_last != ''">
			and a.is_last=#{is_last}
		</if>
		<if test="dept_id != null and dept_id != ''">
			and not exists(
			select 1 from ass_location_dept b
			where
			b.group_id = #{group_id}
			and b.hos_id = #{hos_id}
			and b.copy_code = #{copy_code}
			and a.loc_code=b.loc_code
			and dept_id=#{dept_id}
			)
		</if>
		order by loc_code
	</select>
	<select id="querySuperFaultTypeSelect" resultMap="hrpAssSelect">
		select
		fau_code as id,
		fau_name as text
		from ass_fault_type
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and is_stop = 0
		<if test="key != null and key != ''">
			and (
			fau_code like '%${key}%' or
			fau_name like '%${key}%' or
			SPELL_CODE like '%${key}%' or
			WBX_CODE like '%${key}%'
			)
		</if>
		<if test="is_last != null and is_last != ''">
			and is_last=#{is_last}
		</if>
		order by fau_code
	</select>

	<select id="queryContractMainDict" resultMap="hrpAssSelect">
		select
		acm.CONTRACT_ID id,
		nvl(acm.CONTRACT_ORI_NO,acm.CONTRACT_NO) text
		from ASS_CONTRACT_MAIN acm
		<where>
			<if test="state != null  and state != ''">
				and acm.state = #{state}
			</if>
			<if test="group_id != null  and group_id != ''">
				and acm.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and acm.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and acm.copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				acm.CONTRACT_NO like '%${key}%' or
				acm.CONTRACT_NAME
				like
				'%${key}%'
				)
			</if>
		</where>
		order by acm.CONTRACT_NO
	</select>


	<select id="queryAssNoDictTree" resultMap="hrpAssSelect">
		select *
		from (select ass_type_code as id,
		lpad(chr(41377), 2 * type_level - 2, chr(41377)) ||
		ass_type_code || ' ' || ass_type_name as text,
		nvl(super_code, '0') as seq
		from ass_type_dict
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		union all
		select t1.ass_code as id,
		lpad(chr(41377), 2 * t2.type_level, chr(41377)) ||
		t1.ass_code || ' ' || t1.ass_name as text,
		t2.ass_type_code as seq
		from ass_dict t1
		left join ass_type_dict t2
		on t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_type_id = t2.ass_type_id
		where
		t1.group_id = #{group_id}
		and t1.hos_id = #{hos_id}
		and t1.copy_code = #{copy_code}
		) t
		start with t.id in (select ass_type_code
		from ass_type_dict m
		where
		m.group_id = #{group_id}
		and m.hos_id = #{hos_id}
		and m.copy_code = #{copy_code}
		<if test="key != null and key != ''">
			and (
			m.ass_type_code like '%${key}%' or
			m.ass_type_name like '%${key}%' or
			m.spell_code like '%${key}%' or
			m.wbx_code like '%${key}%'
			)
		</if>
		and m.type_level =
		(select min(t5.type_level)
		from ass_type_dict t5
		where
		t5.group_id = #{group_id}
		and t5.hos_id = #{hos_id}
		and t5.copy_code = #{copy_code}
		<if test="key != null and key != ''">
			and (
			t5.ass_type_code like '%${key}%' or
			t5.ass_type_name like '%${key}%' or
			t5.spell_code like '%${key}%' or
			t5.wbx_code like '%${key}%'
			)
		</if>
		)
		union all

		select t1.ass_code
		from ass_dict t1
		where
		t1.group_id = #{group_id}
		and t1.hos_id = #{hos_id}
		and t1.copy_code = #{copy_code}
		<if test="key != null and key != ''">
			and (
			t1.ass_code like '%${key}%' or
			t1.ass_name like '%${key}%' or
			t1.spell_code like '%${key}%' or
			t1.wbx_code like '%${key}%'
			)
		</if>
		and not exists(select 1
		from ass_type_dict atd
		where
		atd.group_id = #{group_id}
		and atd.hos_id = #{hos_id}
		and atd.copy_code = #{copy_code}
		<if test="key != null and key != ''">
			and (
			atd.ass_type_code like '%${key}%' or
			atd.ass_type_name like '%${key}%' or
			atd.spell_code like '%${key}%' or
			atd.wbx_code like '%${key}%'
			)
		</if>
		)
		)
		CONNECT BY t.seq = PRIOR t.id
		order SIBLINGS by t.id
	</select>


	<select id="queryAssNoDict" resultMap="hrpAssSelect"> 

		SELECT distinct
		a.ass_id||'@'||a.ass_no id,
		a.ass_code||' '||a.ass_name text,
		a.ass_code
		FROM
		<if test="store_info == '02'">
			ass_card_special acs
		left join ASS_NO_DICT a
		on
			acs.group_id = a.group_id
        and acs.hos_id = a.hos_id
        and acs.copy_code = a.copy_code
        and acs.ass_id = a.ass_id	
		</if>
		<if test="store_info == '03'">
			ass_card_general acs
		left join ASS_NO_DICT a
		on
			acs.group_id = a.group_id
        and acs.hos_id = a.hos_id
        and acs.copy_code = a.copy_code
        and acs.ass_id = a.ass_id
		</if>
		<if test="store_info == '04'">
			ass_card_other acs
		left join ASS_NO_DICT a
		on
			acs.group_id = a.group_id
        and acs.hos_id = a.hos_id
        and acs.copy_code = a.copy_code
        and acs.ass_id = a.ass_id
		</if>
		<if test="store_info == null or store_info == ''">
			ASS_NO_DICT a
		</if>
		left join ass_type_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code =
		b.copy_code
		and a.ass_type_id = b.ass_type_id
		<where>
			a.is_stop=0
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="ass_naturs != null  and ass_naturs != ''">
				and b.ass_naturs = #{ass_naturs}
			</if>
			<if test="key != null and key != ''">
				and (
				a.ass_code like '%${key}%' or
				a.ass_name like
				'%${key}%'
				or
				a.spell_code like '%${key}%' or
				a.wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by a.ass_code
	</select>
	<select id="queryAssNoDictTable" resultMap="hrpAssNoDict">

		SELECT
		a.group_id,
		a.hos_id,
		a.copy_code,
		a.ass_id,
		a.ass_id||'@'||a.ass_no
		ass_id_no,
		a.ass_code,
		a.ass_name,
		a.ass_type_id,
		b.ass_type_name,
		b.acc_type_code,
		a.ass_unit,
		hu.unit_name ass_unit_name,
		a.is_measure,
		a.is_depre,
		a.ass_depre_code,
		c.ass_depre_name,
		a.depre_years,
		a.is_stop,
		a.ass_spec,
		a.ass_brand,
		a.ass_model,
		case when
		a.fac_id is not null then a.fac_id||'@'||a.fac_no else '' end fac_id,
		a.fac_no,
		hfd.fac_code,
		hfd.fac_code||''||hfd.fac_name fac_name,
		case
		when a.ven_id is not null then a.ven_id||'@'||a.ven_no else '' end
		ven_id,
		a.ven_no,
		hsd.sup_code,
		hsd.sup_code||'@'||hsd.sup_name sup_name,
		a.usage_code,
		a.usage_code ||''|| d.equi_usage_name usage_name,
		a.gb_code,
		an.naturs_code,
		an.naturs_name,
		a.price,
		t1.cert_code reg_no
		FROM
		ASS_NO_DICT a


		left join
		ass_type_dict b on a.group_id=b.group_id and
		a.hos_id=b.hos_id
		and
		a.copy_code=b.copy_code
		and
		a.ass_type_id=b.ass_type_id

		left join ass_naturs an on
		b.ASS_NATURS = an.NATURS_CODE

		left join
		ass_depre_method_dict c on
		a.ass_depre_code=c.ass_depre_code


		left join
		ass_usage_dict d on
		a.group_id=d.group_id and
		a.hos_id=d.hos_id and
		a.copy_code=d.copy_code
		and a.usage_code=d.equi_usage_code


		left join
		HOS_FAC_DICT hfd on
		a.hos_id = hfd.hos_id
		and a.group_id =
		hfd.group_id
		and a.fac_id =
		hfd.fac_id
		and hfd.is_stop = 0



		left join hos_sup_dict hsd
		on
		a.hos_id =
		hsd.hos_id
		and a.group_id =
		hsd.group_id
		and a.ven_id =
		hsd.sup_id
		and
		hsd.is_stop = 0

		left join hos_unit hu on
		a.group_id=hu.group_id and
		a.hos_id=hu.hos_id and
		a.ass_unit=hu.unit_code and hu.is_stop=0
		LEFT JOIN Ass_Cert_Detail t1 on a.group_id=t1.group_id and a.hos_id=t1.hos_id and a.copy_code=t1.copy_code and a.ass_id=t1.ass_id
		<where>
			a.is_stop=0 
			<if test="ass_naturs != null  and ass_naturs != ''">
				and b.ass_naturs=#{ass_naturs}
			</if>
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and a.copy_code = #{copy_code}
			</if>
			<if test="ass_type_code != null and ass_type_code != ''">
				AND a.ass_type_id = #{ass_type_id}
			</if>
			<if test="acc_type_code != null and acc_type_code != ''">
				AND b.acc_type_code = #{acc_type_code}
			</if>
			<if test="ass_depre_code != null and ass_depre_code != ''">
				AND a.ass_depre_code = #{ass_depre_code}
			</if>
			<if test="fac_id != null and fac_id != ''">
				AND a.fac_id = #{fac_id}
			</if>
			<if test="fac_no != null and fac_no != ''">
				AND a.fac_no = #{fac_no}
			</if>
			<!-- <if test="ven_id != null and ven_id != ''"> AND a.ven_id = #{ven_id} 
				</if> <if test="ven_no != null and ven_no != ''"> AND a.ven_no = #{ven_no} 
				</if> -->
			<if test="usage_code != null and usage_code != ''">
				AND a.usage_code = #{usage_code}
			</if>
			<if test="key != null and key != ''">
				and (
				a.ass_code like '%${key}%' or
				a.ass_name like
				'%${key}%' or
				a.spell_code like '%${key}%' or
				a.wbx_code like
				'%${key}%'
				)
			</if>
			<if test="is_ins != null and is_ins != ''">
				AND a.is_ins = #{is_ins}
			</if>
			<if test="is_accept != null and is_accept != ''">
				AND a.is_accept = #{is_accept}
			</if>
			<if test="is_check != null and is_check != ''">
				AND a.is_check = #{is_check}
			</if>
		</where>
		order by ass_code
	</select>

	<select id="queryAssTypeDict" resultMap="hrpAssSelect">
		SELECT
		ass_type_id id,
		ass_type_code||' '||ass_type_name text
		FROM
		ASS_TYPE_DICT a
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="ass_nature != null  and ass_nature != ''">
				and ass_naturs = #{ass_nature}
			</if>
			<if test="is_last != null  and is_last != ''">
				and is_last = #{is_last}
			</if>
			<if test="key != null and key != ''">
				and (
				ass_type_code like '%${key}%' or
				ass_type_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			
			and exists (
				select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.ass_type_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('ass_type_dict')
				and  b.is_write = 1
				
	          	union all
	          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.ass_type_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('ass_type_dict')
				and b.is_read = 1
          	)
		</where>
		order by ass_type_code
	</select>
	<select id="queryAssTypeDictIsLast" resultMap="asstypedict">
		SELECT
		ass_type_id id,
		ass_type_code||' '||ass_type_name text,
		manage_depre_amount
		FROM
		ASS_TYPE_DICT a
		<where>
			is_last=1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="ass_type_code != null  and ass_type_code != ''">
				and ass_type_code = #{ass_type_code}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="ass_naturs != null  and ass_naturs != ''">
				and ass_naturs = #{ass_naturs}
			</if>
			<if test="key != null and key != ''">
				and (
				ass_type_code like '%${key}%' or
				ass_type_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>

			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.ass_type_id)=b.perm_code
			AND TABLE_CODE =
			upper('ass_type_dict')
			and b.user_id=#{user_id}
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by ass_type_code
	</select>
	<select id="queryAssTypeSuperCode" resultMap="hrpAssSelect">
		SELECT
		ass_type_code id,
		ass_type_code||' '||ass_type_name text
		FROM
		ASS_TYPE_DICT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			and is_last = 0

			<if test="key != null and key != ''">
				and (
				ass_type_code like '%${key}%' or
				ass_type_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by ass_type_code
	</select>
	<!-- 查找仓库 -->
	<select id="queryAllotHosStoreDict" resultMap="hrpAssSelect">
		SELECT
		store_id||'@'||store_no id,
		store_code||' '||store_name text
		FROM
		HOS_STORE_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				store_code like '%${key}%' or
				store_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%' or
				store_id like '%${key}%'
				)
			</if>
			<!-- 添加性质权限 -->
			<if test="naturs_code != null and naturs_code != ''">
				and exists (select 1 from ass_naturs_store_map t
				where t.group_id = #{group_id}
				and t.hos_id = #{hos_id}
				and t.copy_code = #{copy_code}
				and t.naturs_code = #{naturs_code}
				and a.store_id = t.store_id
				)
			</if>

			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.store_id)=b.perm_code
			AND TABLE_CODE =
			upper('hos_store_dict')
			and b.user_id=#{user_id}
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by store_code
	</select>
	<!-- 查找仓库 -->
	<select id="queryHosStoreDict" resultMap="hrpAssSelect">
		SELECT
		store_id||'@'||store_no id,
		store_code||' '||store_name text
		FROM
		HOS_STORE_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				store_code like '%${key}%' or
				store_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%' or
				store_id like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (
			select 1 from v_user_data_perm b
			where
			a.group_id=b.group_id
			and a.hos_id=b.hos_id
			and to_char(a.store_id)=b.perm_code
			AND TABLE_CODE = upper('hos_store_dict')
			and user_id=#{user_id}
			and (b.is_read = 1
			or b.is_write = 1 )
			)

			<!-- 添加性质权限 -->
			<if test="naturs_code != null and naturs_code != ''">
				and exists (select 1 from ass_naturs_store_map t
				where t.group_id = #{group_id}
				and t.hos_id = #{hos_id}
				and t.copy_code = #{copy_code}
				and t.naturs_code = #{naturs_code}
				and a.store_id = t.store_id
				)
			</if>
		</where>
		order by store_code
	</select>
	<!-- 查找人员 -->
	<select id="queryHeadEmp" resultMap="hrpAssSelect">
		SELECT
		emp_no id,
		emp_code ||' '|| emp_name text
		FROM
		hos_emp_dict a
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="emp_code != null  and emp_code != ''">
				and emp_code = #{emp_code}
			</if>
			<if test="key != null and key != ''">
				and (
				emp_code like '%${key}%' or
				emp_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			and is_stop=0
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.emp_id)=b.perm_code
			and user_id=#{user_id}
			AND TABLE_CODE =
			upper('hos_emp_dict')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by emp_code
	</select>

	<!-- 查找主管部门 -->
	<select id="queryDept" resultMap="hrpAssSelect">
		SELECT
		dept_id||'@'|| dept_no id ,
		dept_id||' '|| dept_no text
		FROM
		HOS_DEPT_DICT a
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				dept_id like '%${key}%' or
				dept_no like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.dept_id)=b.perm_code
			and user_id=#{user_id}
			AND TABLE_CODE =
			upper('hos_dept_dict')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by dept_id
	</select>
	<select id="queryHosFacDict" resultMap="hrpAssSelect">
		SELECT
		fac_id||'@'||fac_no id,
		fac_code||' '||fac_name text
		FROM
		HOS_FAC_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				fac_code like '%${key}%' or
				fac_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<if test="is_read != 2 ">
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.fac_id)=b.perm_code
			and b.user_id=#{user_id}
			AND TABLE_CODE =
			upper('HOS_FAC_DICT')
			and (b.is_read = 1
			or b.is_write = 1 ))
			</if>
		</where>
		order by fac_code
	</select>
	<select id="queryHosFac" resultMap="hrpAssSelect">
		SELECT
		fac_id id,
		fac_code||' '||fac_name text
		FROM HOS_FAC_DICT a
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="fac_id != null  and fac_id != ''">
				and fac_id = #{fac_id}
			</if>
			and is_stop = 0
			and is_ass = 1
			<if test="key != null and key != ''">
				and (
				fac_code like '${key}%' or
				fac_name like '%${key}%'
				or
				spell_code like '%${key}%'
				<!-- or wbx_code like '%${key}%' -->
				)
			</if>
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.fac_id)=b.perm_code
			and b.user_id=#{user_id}
			AND TABLE_CODE =
			upper('HOS_FAC_DICT')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by fac_code
	</select>
	<select id="queryHosSupDict" resultMap="hrpAssSelect">
		SELECT
		sup_id||'@'||sup_no id,
		sup_code||' '||sup_name text
		FROM
		HOS_SUP_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				sup_code like '%${key}%' or
				sup_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.sup_id)=b.perm_code
			and user_id=#{user_id}
			AND TABLE_CODE =
			upper('HOS_SUP_DICT')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by sup_code
	</select>
	<select id="queryAssUsageDict" resultMap="hrpAssSelect">
		SELECT
		equi_usage_code id,
		equi_usage_code||' '||equi_usage_name text
		FROM ass_usage_dict
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				equi_usage_code like '%${key}%' or
				equi_usage_name
				like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by equi_usage_code
	</select>

	<select id="queryAssProjDict" resultMap="hrpAssSelect">
		SELECT
		proj_id||'@'||proj_no id,
		proj_code||' '||proj_name text
		FROM
		HOS_PROJ_DICT
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				proj_code like '${key}%' or
				proj_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by proj_code
	</select>

	<select id="queryAssFileTypeDict" resultMap="hrpAssSelect">
		SELECT
		equi_usage_code id,
		equi_usage_code||' '||equi_usage_name text
		FROM ass_file_type_dict
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				equi_usage_code like '%${key}%' or
				equi_usage_name
				like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by equi_usage_code
	</select>

	<!-- 折旧方法 -->
	<select id="queryAssDepreMethodDict" resultMap="hrpAssSelect">
		SELECT
		ass_depre_code id,
		ass_depre_name text
		FROM
		ass_depre_method_dict
		<where>
			<if test="key != null and key != ''">
				and (
				ass_depre_code like '%${key}%' or
				ass_depre_name like
				'%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by ass_depre_code
	</select>


	<!-- 科室默认值 -->
	<select id="queryDeptDictInitValue" resultMap="hrpAssSelect">
		select t.dept_id||'@'||t.dept_no id ,t2.dept_code||' '||t2.dept_name
		text from hos_emp_dict t
		left join hos_dept_dict t2
		on t.group_id =
		t2.group_id
		and t.hos_id = t2.hos_id
		and t.dept_id = t2.dept_id
		and
		t.dept_no = t2.dept_no
		and t2.is_stop = 0
		<where>
			t.group_id = #{group_id}
			and t.hos_id = #{hos_id}
			and emp_id in
			(select emp_code from sys_user where group_id =#{group_id} and hos_id
			= #{hos_id} and user_id = #{user_id})
			and t.is_stop = 0

		</where>

	</select>


	<select id="queryDeptDict" resultMap="hrpAssSelect">
		SELECT
		dept_id||'@'||dept_no id,
		dept_code||' '||dept_name text
		FROM
		HOS_DEPT_DICT a
		<where>
			is_stop = 0
			and is_last = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="is_last != null  and is_last != ''">
				and is_last = #{is_last}
			</if>
			<if test="is_stop != null  and is_stop != ''">
				and is_stop = #{is_stop}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				dept_code like '%${key}%' or
				dept_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if> 
			<!-- 添加用户数据权限 -->
			and exists (
				select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and  b.is_write = 1
				
	          	union all
	          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and b.is_read = 1
          	)
		</where>
		order by dept_id
	</select>
	
	
	<select id="queryDeptDictAll" resultMap="hrpAssSelect">
		SELECT
		dept_id||'@'||dept_no id,
		dept_code||' '||dept_name text
		FROM
		HOS_DEPT_DICT a
		<where>
			is_stop = 0
			and is_last = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="is_last != null  and is_last != ''">
				and is_last = #{is_last}
			</if>
			<if test="is_stop != null  and is_stop != ''">
				and is_stop = #{is_stop}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				dept_code like '%${key}%' or
				dept_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by dept_id
	</select>
	
	
	<select id="queryAssNaturs" resultMap="hrpAssSelect">
		select naturs_code id,
		naturs_code || ' ' || naturs_name text
		from ass_naturs a
		where
			exists (
				select 1 from v_user_data_perm b
				where
				b.group_id=#{group_id}
				and b.hos_id=#{hos_id}
				and a.naturs_code=b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('ass_naturs')
				and (b.is_read = 1
				or b.is_write = 1 )
				<!-- <if test="mod_code != null  and mod_code != ''">
				and mod_code = #{mod_code}
				</if> -->
			)
			
		order by
		naturs_code
	</select>
	<select id="queryAssBusType" resultMap="hrpAssSelect">
		select bus_type_code id,
		bus_type_name text
		from
		ASS_BUS_TYPE_DICT
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="in_out_type != null and in_out_type != ''">
				and in_out_type = (${in_out_type})
			</if>
			<if test="bus_type_code != null and bus_type_code != ''">
				and bus_type_code in (${bus_type_code})
			</if>
			<if test="is_menu != null and is_menu != ''">
				and is_menu = #{is_menu}
			</if>
		</where>
		order by bus_type_code
	</select>
	<!-- 查找资产卡片号 -->
	<select id="queryAssCardNoDict" resultMap="hrpAssSelect">
		select t.ass_card_no||' '||t.naturs_code as id ,t.ass_card_no||'
		'||nod.ass_name as text from (
		select
		group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'02'
		naturs_code from ass_card_general
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'01'
		naturs_code from ass_card_special
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'04'
		naturs_code from ass_card_house
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'05'
		naturs_code from ass_card_inassets
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'06'
		naturs_code from ass_card_land
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'03'
		naturs_code from ass_card_other
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}

		) t
		left join ass_no_dict nod
		on t.group_id = nod.group_id
		and t.hos_id = nod.hos_id
		and t.copy_code = nod.copy_code
		and t.ass_id = nod.ass_id
		<where>
			and t.group_id = #{group_id}
			and t.hos_id = #{hos_id}
			and t.copy_code = #{copy_code}
			<if test="use_state != null and use_state != ''">
				and t.use_state in (${use_state})
			</if>
			<if test="key != null and key != ''">
				and (
				t.ass_card_no like '%${key}%' or
				t.ass_card_no like
				'%${key}%'
				)
			</if>
		</where>
		order by t.ass_card_no
	</select>
	<!-- 维修申请资产卡片下拉框表单 -->
	<select id="queryAssCardNoDictTable" resultMap="hrpAssNoDict">
		select t.ass_card_no||' '||t.naturs_code as id ,t.ass_card_no||'
		'||nod.ass_name as text ,
		nod.ass_code,nod.ass_name,nod.ass_model,nod.ass_brand,nod.ass_spec,t.ass_card_no,b.ass_type_name,hu.unit_name
		from ass_no_dict nod
		right join (
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'02'
		naturs_code from ass_card_general
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'01'
		naturs_code from ass_card_special
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'04'
		naturs_code from ass_card_house
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'05'
		naturs_code from ass_card_inassets
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'06'
		naturs_code from ass_card_land
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,hos_id,copy_code,ass_card_no,ass_id,ass_no,use_state,'03'
		naturs_code from ass_card_other
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}

		) t
		on t.group_id = nod.group_id
		and t.hos_id = nod.hos_id
		and t.copy_code = nod.copy_code
		and t.ass_id = nod.ass_id
		left join
		ass_type_dict b on nod.group_id=b.group_id and
		nod.hos_id=b.hos_id
		and
		nod.copy_code=b.copy_code
		and
		nod.ass_type_id=b.ass_type_id
		left join hos_unit hu on
		nod.group_id=hu.group_id and
		nod.hos_id=hu.hos_id and
		nod.ass_unit=hu.unit_code and hu.is_stop=0


		<where>
			and nod.group_id = #{group_id}
			and nod.hos_id = #{hos_id}
			and nod.copy_code = #{copy_code}
			<if test="use_state != null and use_state != ''">
				and t.use_state in (${use_state})
			</if>
			<if test="key != null and key != ''">
				and (
				t.ass_card_no like '%${key}%' or
				t.ass_card_no like
				'%${key}%' or
				nod.ass_code like '%${key}%' or
				nod.ass_name like
				'%${key}%'
				)
			</if>
		</where>
		order by t.ass_card_no
	</select>
	<select id="queryAssCardNoDictSelect" resultMap="hrpAssSelect">
		select t.ass_card_no as id,
		t.ass_card_no || ' ' || nod.ass_name as text
		from ass_no_dict nod
		right join (select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		ass_id,
		ass_no,
		use_state,
		'03' naturs_code,
		dept_id,
		dept_no
		from ass_card_general
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		ass_id,
		ass_no,
		use_state,
		'02' naturs_code,
		dept_id,
		dept_no
		from ass_card_special
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		ass_id,
		ass_no,
		use_state,
		'01' naturs_code,
		dept_id,
		dept_no
		from ass_card_house
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		ass_id,
		ass_no,
		use_state,
		'05' naturs_code,
		dept_id,
		dept_no
		from ass_card_inassets
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		ass_id,
		ass_no,
		use_state,
		'06' naturs_code,
		dept_id,
		dept_no
		from ass_card_land
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		ass_id,
		ass_no,
		use_state,
		'04' naturs_code,
		dept_id,
		dept_no
		from ass_card_other
		where group_id = #{group_id}
		AND hos_id = #{hos_id}
		AND copy_code = #{copy_code}

		) t
		on t.group_id = nod.group_id
		and t.hos_id = nod.hos_id
		and t.copy_code = nod.copy_code
		and t.ass_id = nod.ass_id
		where
		nod.group_id = #{group_id}
		and nod.hos_id = #{hos_id}
		and nod.copy_code = #{copy_code}
		<if test="use_state != null and use_state != ''">
			and t.use_state in (${use_state})
		</if>
		<if test="dept_id != null and dept_id != ''">
			and t.dept_id||'@'||t.dept_no=#{dept_id}
		</if>
		<if test="key != null and key != ''">
			and (
			t.ass_card_no like '%${key}%' or
			t.ass_card_no like '%${key}%' or
			nod.ass_code like '%${key}%' or
			nod.ass_name like '%${key}%'
			)
		</if>
		order by t.ass_card_no
	</select>
	<!-- 维修班组下拉框 -->
	<select id="queryRepTeam" resultMap="hrpAssSelect">
		select rep_team_code as id,
		rep_team_code||' '||rep_team_name as text
		from ASS_REPAIR_TEAM_DICT
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		<if test=" key != null  and  key != ''">
			and (
			rep_team_code like '%${key}%' or
			rep_team_name like '%${key}%' or
			spell_code like '%${key}%' or
			wbx_code like '%${key}%'
			)
		</if>
	</select>
	<!-- 查找申请单号 -->
	<select id="queryAssApplyNoDict" resultMap="hrpAssSelect">
		SELECT
		APPLY_NO id,
		APPLY_NO text
		FROM
		ASS_REPAIR_APPLY
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				APPLY_NO like '%${key}%' or
				APPLY_NO like
				'%${key}%'
				or
				APPLY_NO like '%${key}%' or
				APPLY_NO like '%${key}%'
				)
			</if>
		</where>
		order by APPLY_NO
	</select>
	<!-- 保养计划 -->
	<select id="queryAssMaintainPlanDict" resultMap="hrpAssSelect">
		SELECT
		plan_id id,
		plan_no||' '||plan_name text
		FROM
		ASS_MAINTAIN_PLAN
		<where>
			<if test="group_id != null  and group_id != ''">
				group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>

			<if test=" key != null  and  key != ''">
				and (
				plan_no like '%${key}%' or
				plan_name like
				'%${key}%'
				)
			</if>
		</where>
		order by plan_id
	</select>

	<!-- 保养项目字典 下拉框表格 -->
	<select id="queryAssMaintainItemTable" resultMap="hrpAssMaintainItemDict">
		SELECT
		maintain_item_code ,
		maintain_item_name
		FROM
		ASS_MAINTAIN_ITEM_DICT
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>

			<if test=" key != null  and  key != ''">
				and (
				maintain_item_code like '%${key}%' or
				maintain_item_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by maintain_item_code
	</select>


	<select id="queryAssMaintainItem" resultMap="hrpAssSelect">
		SELECT
		maintain_item_code as id,
		maintain_item_name as text
		FROM
		ASS_MAINTAIN_ITEM_DICT
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>

			<if test=" key != null  and  key != ''">
				and (
				maintain_item_code like '%${key}%' or
				maintain_item_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<if test="maintain_degree != null and maintain_degree != ''">
				and maintain_degree = #{maintain_degree}
			</if>
			<if test="ass_name != null and ass_name != ''">
				and ass_name like '%${ass_name}%'
			</if>
		</where>
		order by maintain_item_code
	</select>


	<select id="queryAssDeperMethodDict" resultMap="hrpAssSelect">
		SELECT
		ASS_DEPRE_CODE id ,
		ASS_DEPRE_CODE||' '||ASS_DEPRE_NAME text
		FROM
		ASS_DEPRE_METHOD_DICT
		<where>
			is_stop=0
			<if test=" key != null  and  key != ''">
				and (
				ASS_DEPRE_CODE like '%${key}%' or
				ASS_DEPRE_NAME like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by ASS_DEPRE_CODE
	</select>

	<!-- 计量计划 -->
	<select id="queryAssMeasurePlanDict" resultMap="hrpAssSelect">
		SELECT
		plan_id id,
		plan_no||' '||plan_name text
		FROM
		ASS_MEASURE_PLAN
		<where>
			<if test="group_id != null  and group_id != ''">
				group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>

			<if test=" key != null  and  key != ''">
				and (
				plan_no like '%${key}%' or
				plan_name like
				'%${key}%'
				)
			</if>
		</where>
		order by plan_id
	</select>

	<select id="queryPayStageGrid" resultMap="assPayStageMap">
		select * from (
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		stage_no,
		stage_name,
		pay_plan_percent,
		pay_plan_date,
		pay_plan_money,
		pay_money,
		unpay_money
		from ass_pay_stage_general
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		stage_no,
		stage_name,
		pay_plan_percent,
		pay_plan_date,
		pay_plan_money,
		pay_money,
		unpay_money
		from ass_pay_stage_special
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		stage_no,
		stage_name,
		pay_plan_percent,
		pay_plan_date,
		pay_plan_money,
		pay_money,
		unpay_money
		from ass_pay_stage_other
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		stage_no,
		stage_name,
		pay_plan_percent,
		pay_plan_date,
		pay_plan_money,
		pay_money,
		unpay_money
		from ass_pay_stage_house
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		stage_no,
		stage_name,
		pay_plan_percent,
		pay_plan_date,
		pay_plan_money,
		pay_money,
		unpay_money
		from ass_pay_stage_inassets
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		union all
		select group_id,
		hos_id,
		copy_code,
		ass_card_no,
		stage_no,
		stage_name,
		pay_plan_percent,
		pay_plan_date,
		pay_plan_money,
		pay_money,
		unpay_money
		from ass_pay_stage_land
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		) t
		where t.group_id = #{group_id}
		and t.hos_id = #{hos_id}
		and t.copy_code = #{copy_code}
		<if test="ass_card_no != null  and ass_card_no != ''">
			and t.ass_card_no = #{ass_card_no}
		</if>
		<if test="is_payment != null  and is_payment != ''">
			and t.pay_plan_money - t.pay_money > 0
		</if>
		<if test="is_unpayment != null  and is_unpayment != ''">
			and t.pay_money > 0
		</if>
	</select>

	<select id="queryAssExistsSpecialCard" resultType="java.lang.Integer">
		SELECT
		count(1)
		FROM ASS_CARD_SPECIAL a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		b.group_id=hu.group_id and
		b.hos_id=hu.hos_id and
		b.ass_unit=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_SPECIAL t1
		left join ass_card_SPECIAL t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			a.group_id = #{group_id,jdbcType=INTEGER}
			and a.hos_id = #{hos_id,jdbcType=INTEGER}
			and a.copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no = #{ass_card_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature,jdbcType=VARCHAR}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code,jdbcType=VARCHAR}
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id,jdbcType=INTEGER}
			</if>
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no,jdbcType=VARCHAR}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id,jdbcType=INTEGER}
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="ven_id_bill != null  and ven_id_bill != ''">
				and exists (
					select 1 from ass_pay_stage_SPECIAL t
					where a.group_id = t.group_id
					and a.hos_id = t.hos_id
					and a.copy_code = t.copy_code
					and a.ass_card_no = t.ass_card_no
					and t.ven_id = #{ven_id_bill}
				
				)
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept,jdbcType=INTEGER}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' and dept_no != null  and dept_no != ''">
				and a.dept_id = #{dept_id}
				and a.dept_no = #{dept_no}
				<!-- 
				and exists(

				select 1 from ass_share_dept_SPECIAL t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.bar_code like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%'
				)
			</if>

		</where>
	</select>

	<select id="queryAssExistsGeneralCard" resultType="java.lang.Integer">
		SELECT
		count(1)
		FROM
		ASS_CARD_GENERAL a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		b.group_id=hu.group_id and
		b.hos_id=hu.hos_id and
		b.ass_unit=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_GENERAL t1
		left join ass_card_GENERAL t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			a.group_id = #{group_id,jdbcType=INTEGER}
			and a.hos_id = #{hos_id,jdbcType=INTEGER}
			and a.copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no = #{ass_card_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature,jdbcType=VARCHAR}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code,jdbcType=VARCHAR}
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id,jdbcType=INTEGER}
			</if>
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no,jdbcType=VARCHAR}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id,jdbcType=INTEGER}
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="ven_id_bill != null  and ven_id_bill != ''">
				and exists (
					select 1 from ass_pay_stage_GENERAL t
					where a.group_id = t.group_id
					and a.hos_id = t.hos_id
					and a.copy_code = t.copy_code
					and a.ass_card_no = t.ass_card_no
					and t.ven_id = #{ven_id_bill}
				
				)
			</if>	
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept,jdbcType=INTEGER}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' and dept_no != null  and dept_no != ''">
				and a.dept_id = #{dept_id}
				and a.dept_no = #{dept_no}
				<!-- 
				and exists(

				select 1 from ass_share_dept_GENERAL t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.bar_code like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%'
				)
			</if>

		</where>
	</select>


	<select id="queryAssExistsHouseCard" resultType="java.lang.Integer">
		SELECT
		count(1)
		FROM
		ASS_CARD_HOUSE a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		b.group_id=hu.group_id and
		b.hos_id=hu.hos_id and
		b.ass_unit=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_HOUSE t1
		left join ass_card_HOUSE t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no = #{ass_card_no}
			</if>
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<if test="ven_id_bill != null  and ven_id_bill != ''">
				and exists (
					select 1 from ass_pay_stage_HOUSE t
					where a.group_id = t.group_id
					and a.hos_id = t.hos_id
					and a.copy_code = t.copy_code
					and a.ass_card_no = t.ass_card_no
					and t.ven_id = #{ven_id_bill}
				
				)
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' and dept_no != null  and dept_no != ''">
				and a.dept_id = #{dept_id}
				and a.dept_no = #{dept_no}
				<!-- 
				and exists(

				select 1 from ass_share_dept_HOUSE t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%'
				)
			</if>
		</where>
	</select>

	<select id="queryAssExistsOtherCard" resultType="java.lang.Integer">
		SELECT
		count(1)
		FROM
		ASS_CARD_OTHER a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		b.group_id=hu.group_id and
		b.hos_id=hu.hos_id and
		b.ass_unit=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_OTHER t1
		left join ass_card_OTHER t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			a.group_id = #{group_id,jdbcType=INTEGER}
			and a.hos_id = #{hos_id,jdbcType=INTEGER}
			and a.copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no = #{ass_card_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature,jdbcType=VARCHAR}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code,jdbcType=VARCHAR}
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id,jdbcType=INTEGER}
			</if>
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no,jdbcType=VARCHAR}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id,jdbcType=INTEGER}
			</if>
			<if test="ven_id_bill != null  and ven_id_bill != ''">
				and exists (
					select 1 from ass_pay_stage_OTHER t
					where a.group_id = t.group_id
					and a.hos_id = t.hos_id
					and a.copy_code = t.copy_code
					and a.ass_card_no = t.ass_card_no
					and t.ven_id = #{ven_id_bill}
				
				)
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept,jdbcType=INTEGER}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' and dept_no != null  and dept_no != ''">
				and a.dept_id = #{dept_id}
				and a.dept_no = #{dept_no}
				<!-- 
				and exists(

				select 1 from ass_share_dept_other t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.bar_code like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%'
				)
			</if>
		</where>
	</select>

	<select id="queryAssExistsInassetsCard" resultType="java.lang.Integer">
		SELECT
		count(1)
		FROM
		ass_card_inassets a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		b.group_id=hu.group_id and
		b.hos_id=hu.hos_id and
		b.ass_unit=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_inassets t1
		left join ass_card_inassets t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no = #{ass_card_no}
			</if>
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<if test="ven_id_bill != null  and ven_id_bill != ''">
				and exists (
					select 1 from ass_pay_stage_inassets t
					where a.group_id = t.group_id
					and a.hos_id = t.hos_id
					and a.copy_code = t.copy_code
					and a.ass_card_no = t.ass_card_no
					and t.ven_id = #{ven_id_bill}
				
				)
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' and dept_no != null  and dept_no != ''">
				and a.dept_id = #{dept_id}
				and a.dept_no = #{dept_no}
				<!-- 
				and exists(

				select 1 from ass_share_dept_inassets t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%'
				)
			</if>
		</where>
	</select>

	<select id="queryAssExistsLandCard" resultType="java.lang.Integer">
		SELECT
		count(1)
		FROM
		ass_card_land a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		b.group_id=hu.group_id and
		b.hos_id=hu.hos_id and
		b.ass_unit=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_land t1
		left join ass_card_land t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no = #{ass_card_no}
			</if>
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<if test="ven_id_bill != null  and ven_id_bill != ''">
				and exists (
					select 1 from ass_pay_stage_land t
					where a.group_id = t.group_id
					and a.hos_id = t.hos_id
					and a.copy_code = t.copy_code
					and a.ass_card_no = t.ass_card_no
					and t.ven_id = #{ven_id_bill}
				
				)
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' and dept_no != null  and dept_no != ''">
				and a.dept_id = #{dept_id}
				<!--and a.dept_no = #{dept_no}
				 
				and exists(

				select 1 from ass_share_dept_land t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%'
				)
			</if>
		</where>

	</select>


	<select id="queryAssCardSpecial" resultMap="assCardTable">
		SELECT
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code naturs_code,
		a.ass_card_no,
		a.ass_ori_card_no,
		b.ass_code,
		b.ass_name,
		a.ass_spec,
		a.ass_mondl ass_model,
		a.ass_brand,
		hu.unit_name ass_unit_name,
		hfd.fac_code||' '||hfd.fac_name fac_name,
		hsd.sup_code||' '||hsd.sup_name ven_name,
		a.price,
		a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.ass_in_no,
		a.use_state,
		a.in_date,
		a.ven_id,
		a.ven_no,
		a.store_id,
		a.store_no,
		a.is_dept,
		dd.dept_name,
		case when a.is_measure = 0 then '否' when a.is_measure = 1 then '是' else ''
		end is_measure_name,
		a.ass_seq_no,
		hed.store_name,
		pay.unpay_money,
    pay.pay_money ,
    pay.pay_plan_money<!-- ,
    pay.bill_money,
    pay.unbill_money -->
		FROM ASS_CARD_SPECIAL a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		a.group_id=hu.group_id and
		a.hos_id=hu.hos_id and
		a.unit_code=hu.unit_code
		and hu.is_stop=0

		left join HOS_DEPT_DICT dd
		on dd.group_id = a.group_id
		and dd.hos_id = a.hos_id
		and dd.dept_id = a.dept_id
		and dd.dept_no= a.dept_no

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0
		
		left join hos_store_dict hed on
		a.group_id = hed.group_id
		and a.hos_id = hed.hos_id
		and a.store_id = hed.store_id
		and hed.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_SPECIAL t1
		left join ass_card_SPECIAL t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			and a.group_id = #{group_id,jdbcType=INTEGER}
			and a.hos_id = #{hos_id,jdbcType=INTEGER}
			and a.copy_code = #{copy_code,jdbcType=VARCHAR}
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature,jdbcType=VARCHAR}
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and (a.ass_card_no like '%${ass_card_no}%' or 
				     a.bar_code like '%${ass_card_no}%' or 
				     a.sn like '%${ass_card_no}%' or 
				     a.ass_ori_card_no like '%${ass_card_no}%'
				)
			</if>
			<if test="ass_ori_card_no != null  and ass_ori_card_no != ''">
				and a.ass_ori_card_no like '%${ass_ori_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code,jdbcType=VARCHAR}
			</if>
			<if test="ass_in_no != null  and ass_in_no != ''">
				and a.ass_in_no = #{ass_in_no,jdbcType=VARCHAR}
			</if>
			
			<if test="ass_in_no_str != null  and ass_in_no_str != ''">
				and a.ass_in_no like '%${ass_in_no_str}%'
			</if>
			
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id,jdbcType=INTEGER}  
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id,jdbcType=INTEGER}
			</if>
			<if test="ass_id != null  and ass_id != ''">
				and b.ass_id = #{ass_id}
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_check !=null and is_check !=''">
				and b.is_check=1
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept,jdbcType=INTEGER}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_codepact_code}
			</if>
			
			<if test="dept_id != null  and dept_id != ''">
				and a.dept_id = #{dept_id}
				<!--and a.dept_no = #{dept_no}
				 
				and exists(

				select 1 from ass_share_dept_SPECIAL t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test="ass_card_not_exists != null  and ass_card_not_exists != ''">
				and a.ass_card_no not in (${ass_card_not_exists})
			</if> 
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.bar_code like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%' or
				a.bar_code like '%${key}%' or
				dd.dept_code like '%${key}%' or
				dd.dept_name like '%${key}%'
				)
			</if>
			<if test=" sql != null  and  sql != ''">
				and not exists (
				${sql}
				)
			</if>
			<if test=" sqll != null  and  sqll != ''">
				and not exists (
				${sqll}
				)
			</if>
			and exists (
				select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and  b.is_write = 1
				
	          	union all
	          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and b.is_read = 1
          	)
          		
          	and exists (
          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_read = 1
          		
          		union all
          		
          		select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_write = 1 
          	)
		</where>
		order by a.ass_card_no
	</select>

	<select id="queryAssCardGeneral" resultMap="assCardTable">
		SELECT
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code
		naturs_code,
		a.ass_card_no,
		a.ass_ori_card_no,
		b.ass_code,
		b.ass_name,
		a.ass_spec,
		a.ass_mondl ass_model,
		a.ass_brand,
		hu.unit_name ass_unit_name,
		hfd.fac_code||' '||hfd.fac_name fac_name,
		hsd.sup_code||' '||hsd.sup_name ven_name,
		a.price,
		a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.ass_in_no,
		a.use_state,
		a.in_date,
		a.ven_id,
		a.ven_no,
		a.store_id,
		a.store_no,
		a.is_dept,
		dd.dept_name,
		hed.store_name,
		case when a.is_measure = 0 then '否' when a.is_measure = 1 then '是' else ''
		end is_measure_name,
		a.ass_seq_no,
		pay.unpay_money,
    pay.pay_money ,
    pay.pay_plan_money
   
		FROM
		ASS_CARD_GENERAL a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join HOS_DEPT_DICT dd
		on dd.group_id = a.group_id
		and dd.hos_id = a.hos_id
		and dd.dept_id = a.dept_id
		and dd.dept_no= a.dept_no

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		a.group_id=hu.group_id and
		a.hos_id=hu.hos_id and
		a.unit_code=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0
		
		left join hos_store_dict hed on
		a.group_id = hed.group_id
		and a.hos_id = hed.hos_id
		and a.store_id = hed.store_id
		and hed.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_GENERAL t1
		left join ass_card_GENERAL t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and (a.ass_card_no like '%${ass_card_no}%' or 
					 a.bar_code like '%${ass_card_no}%' or 
					 a.sn like '%${ass_card_no}%' or 
					 a.ass_ori_card_no like '%${ass_card_no}%'
				)
			</if>
			<if test="ass_ori_card_no != null  and ass_ori_card_no != ''">
				and a.ass_ori_card_no like '%${ass_ori_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="ass_in_no != null  and ass_in_no != ''">
				and a.ass_in_no = #{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_in_no_str != null  and ass_in_no_str != ''">
				and a.ass_in_no like '%${ass_in_no_str}%'
			</if>
			<if test="is_check !=null and is_check !=''">
				and b.is_check=1
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="ass_id != null  and ass_id != ''">
				and b.ass_id = #{ass_id}
			</if>
			<!-- 
			<if test="store_no != null  and store_no != ''">
				and a.store_no = #{store_no}
			</if> -->
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' ">
				and a.dept_id = #{dept_id}
				<!--and a.dept_no = #{dept_no}
				 
				and exists(

				select 1 from ass_share_dept_GENERAL t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test="ass_card_not_exists != null  and ass_card_not_exists != ''">
				and a.ass_card_no not in (${ass_card_not_exists})
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.bar_code like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%' or
				dd.dept_code like '%${key}%' or
				dd.dept_name like '%${key}%'
				)
			</if>
			<if test=" sql != null  and  sql != ''">
				and not exists (
				${sql}
				)
			</if>
			<if test=" sqll != null  and  sqll != ''">
				and not exists (
				${sqll}
				)
			</if>
			and exists (
				select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and  b.is_write = 1
				
	          	union all
	          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and b.is_read = 1
          	)
          		
          	and exists (
          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_read = 1
          		
          		union all
          		
          		select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_write = 1 
          	)
		</where>
		order by a.ass_card_no
	</select>

	<select id="queryAssCardHouse" resultMap="assCardTable">
		SELECT
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code
		naturs_code,
		a.ass_card_no,
		a.ass_ori_card_no,
		b.ass_code,
		b.ass_name,
		b.ass_spec,
		b.ass_model,
		b.ass_brand,
		hu.unit_name ass_unit_name,
		hfd.fac_code||' '||hfd.fac_name fac_name,
		hsd.sup_code||' '||hsd.sup_name ven_name,
		a.price,
		a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.ass_in_no,
		a.use_state,
		a.in_date,
		a.ven_id,
		a.ven_no,
		null store_id,
		null store_no,
		null is_dept,
		dd.dept_name,
		null is_measure_name,
		pay.unpay_money,
    pay.pay_money ,
    pay.pay_plan_money
		FROM
		ASS_CARD_HOUSE a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join HOS_DEPT_DICT dd
		on dd.group_id = a.group_id
		and dd.hos_id = a.hos_id
		and dd.dept_id = a.dept_id
		and dd.dept_no= a.dept_no

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		a.group_id=hu.group_id and
		a.hos_id=hu.hos_id and
		a.unit_code=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_HOUSE t1
		left join ass_card_HOUSE t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_ori_card_no != null  and ass_ori_card_no != ''">
				and a.ass_ori_card_no like '%${ass_ori_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="ass_in_no != null  and ass_in_no != ''">
				and a.ass_in_no = #{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_in_no_str != null  and ass_in_no_str != ''">
				and a.ass_in_no like '%${ass_in_no_str}%'
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="is_check !=null and is_check !=''">
				and b.is_check=1
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<if test="ass_id != null  and ass_id != ''">
				and b.ass_id = #{ass_id}
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' ">
				and a.dept_id = #{dept_id}
				<!--and a.dept_no = #{dept_no}
				 
				and exists(

				select 1 from ass_share_dept_HOUSE t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test="ass_card_not_exists != null  and ass_card_not_exists != ''">
				and a.ass_card_no not in (${ass_card_not_exists})
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%' or
				dd.dept_code like '%${key}%' or
				dd.dept_name like '%${key}%'
				)
			</if>
		</where>
		order by a.ass_card_no
	</select>

	<select id="queryAssCardOther" resultMap="assCardTable">
		SELECT
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code naturs_code,
		a.ass_card_no,
		a.ass_ori_card_no,
		b.ass_code,
		b.ass_name,
		a.ass_spec,
		a.ass_mondl ass_model,
		a.ass_brand,
		hu.unit_name ass_unit_name,
		hfd.fac_code||' '||hfd.fac_name fac_name,
		hsd.sup_code||' '||hsd.sup_name ven_name,
		a.price,
		a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.ass_in_no,
		a.use_state,
		a.in_date,
		a.ven_id,
		a.ven_no,
		a.store_id,
		a.store_no,
		hed.store_name,
		a.is_dept,
		dd.dept_name,
		case when a.is_measure = 0 then '否' when a.is_measure = 1 then '是' else ''
		end is_measure_name,
		a.ass_seq_no,
		pay.unpay_money,
    pay.pay_money ,
    pay.pay_plan_money
		FROM
		ASS_CARD_OTHER a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join HOS_DEPT_DICT dd
		on dd.group_id = a.group_id
		and dd.hos_id = a.hos_id
		and dd.dept_id = a.dept_id
		and dd.dept_no= a.dept_no


		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		a.group_id=hu.group_id and
		a.hos_id=hu.hos_id and
		a.unit_code=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and hsd.is_stop = 0
		
		left join hos_store_dict hed on
		a.group_id = hed.group_id
		and a.hos_id = hed.hos_id
		and a.store_id = hed.store_id
		and hed.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_OTHER t1
		left join ass_card_OTHER t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and (a.ass_card_no like '%${ass_card_no}%' or 
				     a.bar_code like '%${ass_card_no}%' or 
				     a.sn like '%${ass_card_no}%' or 
				     a.ass_ori_card_no like '%${ass_card_no}%'
				 )
			</if>
			<if test="ass_ori_card_no != null  and ass_ori_card_no != ''">
				and a.ass_ori_card_no like '%${ass_ori_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="ass_in_no != null  and ass_in_no != ''">
				and a.ass_in_no = #{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_in_no_str != null  and ass_in_no_str != ''">
				and a.ass_in_no like '%${ass_in_no_str}%'
			</if>
			<if test="is_check !=null and is_check !=''">
				and b.is_check=1
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<if test="ass_id != null  and ass_id != ''">
				and b.ass_id = #{ass_id}
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if
				test="dept_id != null  and dept_id != '' ">
				and a.dept_id = #{dept_id}
				<!--and a.dept_no = #{dept_no}
				 
				and exists(

				select 1 from ass_share_dept_OTHER t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test="ass_card_not_exists != null  and ass_card_not_exists != ''">
				and a.ass_card_no not in (${ass_card_not_exists})
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.bar_code like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%' or
				dd.dept_code like '%${key}%' or
				dd.dept_name like '%${key}%'
				)
			</if>
			<if test=" sql != null  and  sql != ''">
				and not exists (
				${sql}
				)
			</if>
			<if test=" sqll != null  and  sqll != ''">
				and not exists (
				${sqll}
				)
			</if>
			and exists (
				select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and  b.is_write = 1
				
	          	union all
	          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and b.is_read = 1
          	)
          		
          	and exists (
          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_read = 1
          		
          		union all
          		
          		select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_write = 1 
          	)
		</where>
		order by a.ass_card_no
	</select>


	<select id="queryAssCardInassets" resultMap="assCardTable">
		SELECT
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code naturs_code,
		a.ass_card_no,
		a.ass_ori_card_no,
		b.ass_code,
		b.ass_name,
		b.ass_spec,
		b.ass_model,
		a.ass_brand,
		hu.unit_name ass_unit_name,
		hfd.fac_code||' '||hfd.fac_name fac_name,
		hsd.sup_code||' '||hsd.sup_name ven_name,
		a.price,
		a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.ass_in_no,
		a.use_state,
		a.in_date,
		a.ven_id,
		a.ven_no,
		a.store_id,
		a.store_no,
		hed.store_name,
		a.is_dept,
		dd.dept_name,
		pay.unpay_money,
    pay.pay_money ,
    pay.pay_plan_money
		FROM
		ass_card_inassets a
		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join HOS_DEPT_DICT dd
		on dd.group_id = a.group_id
		and dd.hos_id = a.hos_id
		and dd.dept_id = a.dept_id
		and dd.dept_no= a.dept_no

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		a.group_id=hu.group_id and
		a.hos_id=hu.hos_id and
		a.unit_code=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0
		
		left join hos_store_dict hed on
		a.group_id = hed.group_id
		and a.hos_id = hed.hos_id
		and a.store_id = hed.store_id
		and hed.is_stop = 0

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_inassets t1
		left join ass_card_inassets t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_ori_card_no != null  and ass_ori_card_no != ''">
				and a.ass_ori_card_no like '%${ass_ori_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="ass_in_no != null  and ass_in_no != ''">
				and a.ass_in_no = #{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_in_no_str != null  and ass_in_no_str != ''">
				and a.ass_in_no like '%${ass_in_no_str}%'
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_check !=null and is_check !=''">
				and b.is_check=1
			</if>
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if test="ass_id != null  and ass_id != ''">
				and b.ass_id = #{ass_id}
			</if>
			<if
				test="dept_id != null  and dept_id != '' ">
				and a.dept_id = #{dept_id}
				<!-- and a.dept_no = #{dept_no}
				
				and exists(

				select 1 from ass_share_dept_inassets t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test="ass_card_not_exists != null  and ass_card_not_exists != ''">
				and a.ass_card_no not in (${ass_card_not_exists})
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%' or
				dd.dept_code like '%${key}%' or
				dd.dept_name like '%${key}%'
				)
			</if>
			<if test=" sql != null  and  sql != ''">
				and not exists (
				${sql}
				)
			</if>
			<if test=" sqll != null  and  sqll != ''">
				and not exists (
				${sqll}
				)
			</if>
			and exists (
				select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and  b.is_write = 1
				
	          	union all
	          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and b.is_read = 1
          	)
          		
          	and exists (
          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_read = 1
          		
          		union all
          		
          		select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_write = 1 
          	)
		</where>
		order by a.ass_card_no
	</select>


	<select id="queryAssCardLand" resultMap="assCardTable">
		SELECT
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code naturs_code,
		a.ass_card_no,
		a.ass_ori_card_no,
		b.ass_code,
		b.ass_name,
		b.ass_spec,
		b.ass_model,
		b.ass_brand,
		hu.unit_name ass_unit_name,
		hfd.fac_code||' '||hfd.fac_name fac_name,
		hsd.sup_code||' '||hsd.sup_name ven_name,
		a.price,
		a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.ass_in_no,
		a.use_state,
		a.in_date,
		a.ven_id,
		a.ven_no,
		null store_id,
		null store_no,
		null is_dept,
		dd.dept_name,
		null is_measure_name,
		pay.unpay_money,
    pay.pay_money ,
    pay.pay_plan_money
		FROM ass_card_land a

		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join HOS_DEPT_DICT dd
		on dd.group_id = a.group_id
		and dd.hos_id = a.hos_id
		and dd.dept_id = a.dept_id
		and dd.dept_no= a.dept_no



		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id = c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		a.group_id=hu.group_id and
		a.hos_id=hu.hos_id and
		a.unit_code=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0
		

		left join (
		select
		t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
		nvl(sum(t1.unpay_money),0) unpay_money,
		nvl(sum(t1.pay_money),0) pay_money ,
		nvl(sum(t1.pay_plan_money),0) pay_plan_money

		from ass_pay_stage_land t1
		left join ass_card_land t2 on
		t1.group_id = t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.ass_card_no = t2.ass_card_no
		group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no


		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_ori_card_no != null  and ass_ori_card_no != ''">
				and a.ass_ori_card_no like '%${ass_ori_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="ass_in_no != null  and ass_in_no != ''">
				and a.ass_in_no = #{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_in_no_str != null  and ass_in_no_str != ''">
				and a.ass_in_no like '%${ass_in_no_str}%'
			</if>
			<if test="is_check !=null and is_check !=''">
				and b.is_check=1
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if test="ass_id != null  and ass_id != ''">
				and b.ass_id = #{ass_id}
			</if>
			<if test="dept_id != null  and dept_id != '' ">
				and a.dept_id = #{dept_id}
				<!-- and a.dept_no = #{dept_no}
				
				and exists(

				select 1 from ass_share_dept_land t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
			</if>
			<if test="ass_card_not_exists != null  and ass_card_not_exists != ''">
				and a.ass_card_no not in (${ass_card_not_exists})
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%' or
				dd.dept_code like '%${key}%' or
				dd.dept_name like '%${key}%'
				)
			</if>
		</where>
		order by a.ass_card_no
	</select>


	<select id="queryAssCardAll" resultMap="assCardTable">
		SELECT distinct 
		an.naturs_code||' '||an.naturs_name ass_nature,
		an.naturs_code naturs_code,
		a.ass_card_no,
		a.ass_ori_card_no,
		b.ass_code,
		b.ass_name,
		a.ass_spec,
		a.ASS_MONDL as ass_model,
		a.ass_brand,
		hu.unit_name ass_unit_name,
		hfd.fac_code||' '||hfd.fac_name fac_name,
		hsd.sup_code||' '||hsd.sup_name ven_name,
		a.price,
		a.depre_money,
		a.manage_depre_money,
		a.cur_money,
		a.fore_money,
		a.add_depre_month,
		a.add_manage_month,
		a.buy_type,
		a.ass_in_no,
		a.use_state,
		a.in_date,
		a.ven_id,
		<!-- a.ven_no, -->
		a.store_id,
		a.store_no,
		hed.store_name,
		a.is_dept,
		hdd.dept_name,
		a.ass_seq_no,
		pay.unpay_money,
    pay.pay_money ,
    pay.pay_plan_money,
    pay.bill_money,
    pay.unbill_money
		FROM v_ass_card a

		left join ass_no_dict b on
		a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.ass_id = b.ass_id
		and b.is_stop = 0

		left join ass_type_dict c on
		b.group_id = c.group_id
		and b.hos_id =
		c.hos_id
		and b.copy_code = c.copy_code
		and b.ass_type_id = c.ass_type_id
		and c.is_stop = 0

		left join ass_naturs an on
		c.ass_naturs = an.naturs_code

		left join hos_unit hu on
		a.group_id=hu.group_id and
		a.hos_id=hu.hos_id and
		a.unit_code=hu.unit_code
		and hu.is_stop=0

		left join hos_fac_dict hfd on
		b.group_id = hfd.group_id
		and b.hos_id = hfd.hos_id
		and b.fac_id = hfd.fac_id
		and hfd.is_stop = 0

		left join hos_sup_dict hsd on
		a.group_id = hsd.group_id
		and a.hos_id = hsd.hos_id
		and a.ven_id = hsd.sup_id
		and
		hsd.is_stop = 0
		
		left join hos_dept_dict hdd on
		a.group_id = hdd.group_id
		and a.hos_id = hdd.hos_id
		and a.dept_id = hdd.dept_id
		and
		hdd.is_stop = 0
		
		left join hos_store_dict hed on
		a.group_id = hed.group_id
		and a.hos_id = hed.hos_id
		and a.store_id = hed.store_id
		and hed.is_stop = 0

		left join (
			select
			t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no,
			nvl(sum(t1.unpay_money),0) unpay_money,
			nvl(sum(t1.pay_money),0) pay_money ,
			nvl(sum(t1.pay_plan_money),0) pay_plan_money,
			nvl(sum(t1.bill_money),0) bill_money,
			nvl(sum(t1.unbill_money),0) unbill_money
	
			from v_ass_pay_stage t1
			
			left join v_ass_card t2 on
			t1.group_id = t2.group_id
			and t1.hos_id = t2.hos_id
			and t1.copy_code = t2.copy_code
			and t1.ass_card_no = t2.ass_card_no
			
			
			
			group by t1.group_id, t1.hos_id, t1.copy_code, t1.ass_card_no
		) pay on a.group_id = pay.group_id
		and a.hos_id = pay.hos_id
		and a.copy_code = pay.copy_code
		and a.ass_card_no = pay.ass_card_no

		left join v_ass_bill_vis vabv on
		a.group_id = vabv.group_id
		and a.hos_id = vabv.hos_id
		and a.copy_code = vabv.copy_code
		and
		a.ass_naturs = vabv.naturs_code
		and a.ass_card_no = vabv.ass_card_no


		left join v_ass_back_bill_vis vabbv on
		a.group_id = vabbv.group_id
		and a.hos_id = vabbv.hos_id
		and a.copy_code = vabbv.copy_code
		and
		a.ass_naturs = vabbv.naturs_code
		and a.ass_card_no = vabbv.ass_card_no


		<where>
			and a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			<if test="ass_nature != null  and ass_nature != ''">
				and an.naturs_code = #{ass_nature}
			</if>
			<if test="ass_natures != null  and ass_natures != ''">
				and an.naturs_code in(${ass_natures})
			</if>
			<if test="bus_type_code != null  and bus_type_code != ''">
				and a.buy_type = #{bus_type_code}
			</if>
			<if test="use_state != null  and use_state != ''">
				and a.use_state in (${use_state})
			</if>
			<if test="ass_card_no != null  and ass_card_no != ''">
				and a.ass_card_no like '%${ass_card_no}%'
			</if>
			<if test="ass_ori_card_no != null  and ass_ori_card_no != ''">
				and a.ass_ori_card_no like '%${ass_ori_card_no}%'
			</if>
			<if test="ass_name != null  and ass_name != ''">
				and b.ass_name like '%${ass_name}%'
			</if>
			<if test="ass_in_no != null  and ass_in_no != ''">
				and a.ass_in_no = #{ass_in_no,jdbcType=VARCHAR}
			</if>
			<if test="ass_in_no_str != null  and ass_in_no_str != ''">
				and a.ass_in_no like '%${ass_in_no_str}%'
			</if>
			<if test="is_check !=null and is_check !=''">
				and b.is_check=1
			</if>
			<if test="in_date != null  and in_date != ''">
				and a.in_date &lt;= to_date(#{in_date},'YYYY-MM-DD')
			</if>
			<if test="store_id != null  and store_id != ''">
				and a.store_id = #{store_id}
			</if>
			<if test="ven_id != null  and ven_id != ''">
				and a.ven_id = #{ven_id}
			</if>
			<if test="ven_id_bill != null  and ven_id_bill != ''">
				and exists (
					select 1 from v_ass_pay_stage t
					where a.group_id = t.group_id
					and a.hos_id = t.hos_id
					and a.copy_code = t.copy_code
					and a.ass_card_no = t.ass_card_no
					and t.ven_id = #{ven_id_bill}
				
				)
			</if>
			<!-- <if test="ven_no != null and ven_no != ''"> and a.ven_no = #{ven_no,jdbcType=VARCHAR} 
				</if> -->
			<if test="is_dept != null  and is_dept != ''">
				and a.is_dept = #{is_dept}
			</if>
			<if test="pact_code != null  and pact_code != ''">
				and a.pact_code = #{pact_code}
			</if>
			<if test="ass_id != null  and ass_id != ''">
				and b.ass_id = #{ass_id}
			</if>
			<if test="dept_id != null  and dept_id != '' ">
				and a.dept_id = #{dept_id}
				<!--and a.dept_no = #{dept_no}
				 
				and exists(

				select 1 from v_ass_share_dept t1
				where a.hos_id = t1.hos_id
				and a.copy_code = t1.copy_code
				and a.ass_card_no = t1.ass_card_no
				and t1.dept_id = #{dept_id}
				and t1.dept_no = #{dept_no}
				) -->
			</if>
			<if test="is_show_dis == 'true'">
				and a.use_state != 6 and a.use_state != 7
			</if>
			<if test="is_payment != null  and is_payment != ''">
				and pay.pay_plan_money - pay.pay_money > 0
				and pay.unbill_money > 0
				and pay.pay_plan_money > nvl(vabv.bill_money,0)
				and nvl(a.dispose_type,0) != 41
				
			</if>
			<if test="is_unpayment != null  and is_unpayment != ''">
				and pay.pay_money > 0
				and pay.bill_money > 0
				and pay.pay_money > abs(nvl(vabbv.bill_money,0))
			</if>
			<if test="ass_card_not_exists != null  and ass_card_not_exists != ''">
				and a.ass_card_no not in (${ass_card_not_exists})
			</if>
			<!-- <if test="price_change_where != null and price_change_where != ''"> 
				and a.price != a.depre_money </if> <if test="depre_change_where != null and 
				depre_change_where != ''"> and a.price != a.depre_money </if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.ass_card_no like '%${key}%' or
				a.ass_ori_card_no like '%${key}%' or
				a.govt_card_no like '%${key}%' or
				a.bar_code like '%${key}%' or
				a.ass_id like '%${key}%' or
				b.ass_code like '%${key}%' or
				b.ass_name like '%${key}%' or
				an.naturs_code like '%${key}%' or
				b.spell_code like '%${key}%' or
				b.wbx_code like '%${key}%' or
				hdd.dept_code like '%${key}%' or
				hdd.dept_name like '%${key}%'
				)
			</if>
			and exists (
				select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and  b.is_write = 1
				
	          	union all
	          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.dept_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_dept_dict')
				and b.is_read = 1
          	)
          		
          	and exists (
          	
	          	select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_read = 1
          		
          		union all
          		
          		select 1 from v_user_data_perm b where
				a.group_id=b.group_id 
				and a.hos_id=b.hos_id 
				and to_char(a.store_id) = b.perm_code
				and user_id=#{user_id}
				AND TABLE_CODE = upper('hos_store_dict')
				and b.is_write = 1 
          	)
		</where> 
		order by a.ass_card_no
	</select>

	<!-- 资金来源 -->
	<select id="querySourceDict" resultMap="hrpAssSelect">
		SELECT
		source_id id,
		source_code ||' '||source_name text
		FROM
		HOS_SOURCE
		<where>
			group_id = #{group_id}
			and hos_id = #{hos_id}
			<if test=" key != null  and  key != ''">
				and (
				source_code like '%${key}%' or
				source_name like
				'%${key}%'
				)
			</if>
		</where>
		order by source_id
	</select>
	
	<!-- 设备来源-->
	<select id="queryDeviceDict" resultMap="hrpAssSelect">
		SELECT
		device_code id,
		device_code ||' '|| device_name text
		FROM
		ASS_DEVICE_DICT
		<where>
			group_id = #{group_id}
			and hos_id = #{hos_id}
			<if test=" key != null  and  key != ''">
				and (
				device_code like '%${key}%' or
				device_name like
				'%${key}%'
				)
			</if>
		</where>
		order by device_code
	</select>
	
	<!-- 申购类别 -->
	<select id="queryBuyDict" resultMap="hrpAssSelect">
		SELECT
		buy_code id,
		buy_code ||' '||buy_name text
		FROM
		ASS_BUY_DICT
		<where>
			group_id = #{group_id}
			and hos_id = #{hos_id}
			<if test=" key != null  and  key != ''">
				and (
				buy_code like '%${key}%' or
				buy_name like
				'%${key}%'
				)
			</if>
		</where>
		order by buy_code
	</select>

	<!-- 计量单位 -->
	<select id="queryHosUnitDict" resultMap="hrpAssSelect">
		SELECT
		unit_code id,
		unit_name text
		FROM
		HOS_UNIT
		<where>
			group_id = #{group_id}
			and hos_id = #{hos_id}
			<if test=" key != null  and  key != ''">
				and (
				unit_code like '%${key}%' or
				unit_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by unit_code
	</select>

	<select id="queryHosCopyDict" resultMap="hrpAssSelect">
		SELECT
		copy_code id,
		copy_name text
		FROM hos_copy
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null and key != ''">
				and (
				copy_code like '%${key}%' or
				copy_name like
				'%${key}%'
				)
			</if>
		</where>
		order by copy_code
	</select>

	<select id="queryHosInfoDict" resultMap="hrpAssSelect">
		SELECT
		hos_id id,
		hos_name text
		FROM HOS_INFO
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null and key != ''">
				and (
				hos_code like '%${key}%' or
				hos_name like '%${key}%'
				or
				hos_simple like '%${key}%'
				)
			</if>
		</where>
		order by hos_code
	</select>
	<select id="queryGroupDict" resultMap="hrpAssSelect">
		SELECT
		group_id id,
		group_name text
		FROM
		sys_group
		<where>
			is_stop = 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>

			<if test=" key != null and key != ''">
				and (
				group_code like '%${key}%' or
				group_name like
				'%${key}%' or
				group_simple like '%${key}%'
				)
			</if>
		</where>
		order by group_code
	</select>

	<!-- 财务分类 -->
	<select id="queryMatFinaType" resultMap="hrpAssSelect">
		SELECT
		FINA_TYPE_CODE id,
		FINA_TYPE_CODE ||' '||FINA_TYPE_NAME text
		FROM
		ASS_FINA_DICT
		<where>
			is_stop=0
			and is_last= 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				FINA_TYPE_CODE like '%${key}%' or
				FINA_TYPE_NAME like
				'%${key}%'
				)
			</if>
		</where>
		order by FINA_TYPE_CODE
	</select>
	<!-- 财务分类 -->
	<select id="queryMatFinaTypeIsLast" resultMap="hrpAssSelect">
		SELECT
		FINA_TYPE_CODE id,
		FINA_TYPE_CODE ||' '||FINA_TYPE_NAME text
		FROM
		ASS_FINA_DICT
		<where>
			is_stop=0
			and is_last=1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				FINA_TYPE_CODE like '%${key}%' or
				FINA_TYPE_NAME like
				'%${key}%'
				)
			</if>
		</where>
		order by FINA_TYPE_CODE
	</select>

	<!-- 建筑结构 -->
	<select id="queryAssStructDict" resultMap="hrpAssSelect">
		select
		struct_code id,
		struct_name text
		from
		ass_struct_dict
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				struct_code like '%${key}%' or
				struct_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by struct_code
	</select>

	<!-- 土地来源 -->
	<select id="queryAssLandSourceDict" resultMap="hrpAssSelect">
		select
		land_source_code id,
		land_source_name text
		from
		ass_land_source_dict
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				land_source_code like '%${key}%' or
				land_source_name
				like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by land_source_code
	</select>

	<!-- 产权形式 -->
	<select id="queryAssPropDict" resultMap="hrpAssSelect">
		select
		prop_code id,
		prop_name text
		from
		ass_prop_dict
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				prop_code like '%${key}%' or
				prop_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by prop_code
	</select>

	<!-- 文物等级 -->
	<select id="queryAssRelicGradeDict" resultMap="hrpAssSelect">
		select
		relic_grade_code id,
		relic_grade_name text
		from
		ass_relic_grade_dict
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				relic_grade_code like '%${key}%' or
				relic_grade_name
				like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like
				'%${key}%'
				)
			</if>
		</where>
		order by relic_grade_code
	</select>

	<!-- 用户查询列表 -->
	<select id="queryUserDict" resultMap="hrpAssSelect">
		SELECT
		user_id id,
		user_name text 
		FROM SYS_USER
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="type_code != null  and type_code != ''">
				and type_code = #{type_code}
			</if>
			<if test=" key != null and key != ''">
				and (
				user_id like '%${key}%' or
				user_name like '%${key}%'
				or
				user_code like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code
				like '%${key}%'
				)
			</if>
			<if test="user_id != null  and user_id != ''">
				and user_id = #{user_id}
			</if>
			<if test="rep_team_code!=null and rep_team_code != '' ">
				and exists (select rep_team_code from ass_repair_user
				where rep_team_code = #{rep_team_code} and REP_USER = user_id)

			</if>
		</where>
		order by user_code
	</select>

	<!-- 入库单 -->
	<select id="queryAssInMainDict" resultMap="hrpAssSelect">
		SELECT
		ass_in_no id,
		ass_in_no text
		FROM ass_in_main
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null and key != ''">
				and (
				ass_in_id like '%${key}%' or
				ass_in_no like
				'%${key}%'
				)
			</if>
		</where>
		order by ass_in_no
	</select>

	<!-- 条码类型 -->
	<select id="queryAssBarTypeDict" resultMap="hrpAssSelect">
		select * from (
		select 1 id,'一维条码' text from dual
		union all
		select 2 id,'二维条码' text from dual
		) t
		order by t.id
	</select>

	<select id="queryAssIsDept" resultMap="hrpAssSelect">
		select * from (
		select 0 id,'在库' text from dual
		union all
		select 1 id,'在用' text from dual
		) t
		order by t.id
	</select>

	<!-- 卡片使用状态 -->
	<select id="queryAssCardUseStateDict" resultMap="hrpAssSelect">
		SELECT
		state_code id,
		state_name text
		FROM ass_card_use_state
		<where>
			<if test="state_codes != null  and state_codes != ''">
				and state_code not in (${state_codes})
			</if>
			<if test=" key != null and key != ''">
				and (
				state_code like '%${key}%' or
				state_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>

		</where>
		order by state_code
	</select>

	<!-- 处置类型 -->
	<select id="queryAssDisposeTypeDict" resultMap="hrpAssSelect">
		SELECT
		dispose_type_code id,
		dispose_type_name text
		FROM ass_dispose_type
		<where>
			<if test="dispose_type_codes != null  and dispose_type_codes != ''">
				and dispose_type_code not in (${dispose_type_codes})
			</if>
			<if test=" key != null and key != ''">
				and (
				dispose_type_code like '%${key}%' or
				dispose_type_name like '%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by dispose_type_code
	</select>

	<select id="queryFacTypeDict" resultMap="hrpAssSelect">
		SELECT
		type_code id,
		type_name text
		FROM HOS_FAC_TYPE
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				type_code like '%${key}%' or
				type_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by type_code
	</select>
	<!-- 采购发票 付款条件下拉框 -->
	<select id="queryMatPayTerm" resultMap="hrpAssSelect">
		SELECT
		pay_term_id id,
		pay_term_code ||' '|| pay_term_name text
		FROM
		MAT_PAY_TERM
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			and is_stop = 0
			<if test="key != null and key != ''">
				and (
				pay_term_code like '${key}%' or
				pay_term_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by pay_term_code
	</select>
	<!--主表库房是否停用 -->
	<select id="queryMatYearOrNo" resultMap="hrpAssSelect">
		SELECT
		0 id,
		'否' text
		FROM DUAL
		UNION ALL
		SELECT
		1 id,
		'是' text
		FROM DUAL
	</select>

	<!-- 库房分类 -->
	<select id="queryMatStoreType" resultMap="hrpAssSelect">
		select
		type_code id,
		type_code||' '||type_name text
		from hos_store_type
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			and is_stop = 0
			<if test="key != null and key != ''">
				and (
				type_code like '${key}%' or
				type_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by type_code
	</select>

	<!-- 职能科室 hos_dept -->
	<select id="queryMatDeptIsManager" resultMap="hrpAssSelect">
		select a.dept_id id,
		a.dept_code||' '||a.dept_name text
		from hos_dept a
		left join acc_dept_attr b on
		a.dept_id = b.dept_id
		and a.hos_id = b.hos_id
		and a.group_id = b.group_id
		<where>
			<if test="group_id != null  and group_id != ''">
				and a.group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and a.hos_id = #{hos_id}
			</if>
			<!-- <if test="is_last != null and is_last != ''"> -->
			<!-- and a.is_last = #{is_last} -->
			<!-- </if> -->
			and a.is_stop = 0
			<if test="key != null and key != ''">
				and (
				a.dept_code like '${key}%' or
				a.dept_name like '%${key}%'
				or
				a.spell_code like '%${key}%' or
				a.wbx_code like '%${key}%'
				)
			</if>
			and a.is_last =1

			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id
			and a.hos_id=b.hos_id and to_char(a.dept_id)=b.perm_code
			and
			user_id=#{user_id}
			AND TABLE_CODE = upper('hos_dept_DICT')
			and
			(b.is_read = 1
			or b.is_write = 1 ))

			<!-- and b.is_manager = 1 -->
		</where>
		order by a.dept_id
	</select>
	<!-- 职工表/领料人 -->
	<select id="queryMatEmp" resultMap="hrpAssSelect">

		select b.emp_code as id , a.emp_code || ' ' || a.emp_name AS text
		from hos_emp_dict a
		left join sys_user b on b.emp_code=a.emp_id
		<if test="group_id != null  and group_id != ''">
			and b.group_id = #{group_id}
		</if>
		<if test="hos_id != null  and hos_id != ''">
			and b.hos_id = #{hos_id}
		</if>
		where
		user_id=#{user_id}
		<if test="group_id != null  and group_id != ''">
			and a.group_id = #{group_id}
		</if>
		<if test="hos_id != null  and hos_id != ''">
			and a.hos_id = #{hos_id}
		</if>
		<!-- 添加用户数据权限 -->
		and exists (select 1 from v_user_data_perm b where
		a.group_id=b.group_id and a.hos_id=b.hos_id and
		to_char(a.emp_id)=b.perm_code
		and user_id=#{user_id}
		AND TABLE_CODE = upper('hos_emp_dict')
		and (b.is_read = 1
		or b.is_write = 1 ))


		union all

		select emp_id id,
		emp_code||' '||emp_name text
		from hos_emp_dict a
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>

			<if test="emp_id != null  and emp_id != ''">
				and emp_id = #{emp_id}
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and dept_id = #{dept_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and dept_no = #{dept_no}
			</if>
			and is_stop = 0
			<if test="key != null and key != ''">
				and (
				emp_code like '${key}%' or
				emp_name like '%${key}%' or
				emp_id like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.emp_id)=b.perm_code
			and user_id=#{user_id}
			AND TABLE_CODE =
			upper('hos_emp_dict')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>

	</select>
	<!-- 采购员 -->
	<select id="queryMatStockEmp" resultMap="hrpAssSelect">
		select
		emp_id id,
		emp_code||' '||emp_name text
		from hos_emp_dict a
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and dept_id = #{dept_id}
			</if>
			<if test="dept_no != null  and dept_no != ''">
				and dept_no = #{dept_no}
			</if>
			<if test="emp_id != null  and emp_id != ''">
				and emp_id = #{emp_id}
			</if>
			<if test="manager != null  and manager != ''">
				and emp_id = #{manager}
			</if>
			and is_stop = 0
			<if test="key != null and key != ''">
				and (
				emp_code like '${key}%' or
				emp_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<if test="store_id != null  and store_id != ''">
				and exists (
				select 1 from mat_store_emp_map c where
				a.group_id = c.group_id
				and a.hos_id = c.hos_id
				and c.copy_code = #{copy_code}
				and a.emp_id = c.emp_id
				and c.store_id = #{store_id}
				)
			</if>

			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.emp_id)=b.perm_code
			and user_id=#{user_id}
			AND TABLE_CODE =
			upper('hos_emp_dict')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by emp_id

	</select>

	<!-- 库房管理员 变更表 -->
	<select id="queryMatManagerEmp" resultMap="hrpAssSelect">
		select
		emp_id||','||emp_no id,
		emp_code||' '||emp_name text
		from hos_emp_dict a
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="dept_id != null  and dept_id != ''">
				and dept_id = #{dept_id}
			</if>
			and is_stop = 0
			<if test="key != null and key != ''">
				and (
				emp_code like '${key}%' or
				emp_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
			<!-- 添加用户数据权限 -->
			and exists (select 1 from v_user_data_perm b where
			a.group_id=b.group_id and a.hos_id=b.hos_id and
			to_char(a.emp_id)=b.perm_code
			and user_id=#{user_id}
			AND TABLE_CODE =
			upper('hos_emp_dict')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by emp_code

	</select>

	<select id="queryBusType" resultMap="hrpAssSelect">
		select bus_type_code as id,
		bus_type_code || ' ' || bus_type_name as text
		from ass_bus_type_dict
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and is_stop = 0
		and is_menu = '7'
		<if test="key != null and key != ''">
			and (
			bus_type_code like '${key}%' or
			bus_type_name like '%${key}%'
			or
			spell_code like '%${key}%' or
			wbx_code like '%${key}%'
			)
		</if>
	</select>

	<select id="queryAccPayType" resultMap="hrpAssSelect">
		select pay_code as id,
		pay_code || ' ' || pay_name as text
		from acc_pay_type
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and is_stop = 0
		<if test="key != null and key != ''">
			and (
			pay_code like '${key}%' or
			pay_name like '%${key}%' or
			spell_code like '%${key}%' or
			wbx_code like '%${key}%'
			)
		</if>
	</select>

	<select id="queryBillDetailExists" resultType="java.lang.Integer">
		select
		count(1)
		from ass_bill_main a
		where
		a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		and a.state = 2
		and a.bill_no = #{bill_no}
		<if test="ven_id != null and ven_id != ''">
			and a.ven_id = #{ven_id}
		</if>
		<if test="store_id != null and store_id != ''">
			and a.store_id = #{store_id}
		</if>
	</select>


	<select id="queryBillDetailGrid" resultMap="assBillDetailMap">
		select
		a.group_id,
		a.hos_id,
		a.copy_code,
		a.bill_no,
		a.bill_money,
		a.invoice_no,
		a.bill_date,
		'' ass_name
		from ass_bill_main a
		where
		a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		and a.state = 2
		<!-- <if test="in_date != null and in_date != ''"> and a.create_date &lt;= 
			to_date(#{in_date},'YYYY-MM-DD') </if> -->
		<if test="ven_id != null and ven_id != ''">
			and a.ven_id = #{ven_id}
		</if>
		<if test="store_id != null and store_id != ''">
			and a.store_id = #{store_id}
		</if>
		<if test="key != null and key != ''">
			and (
			bill_no like '${key}%' or
			invoice_no like '%${key}%'
			)
		</if>
		and not exists (
		select 1 from ass_pay_detail t
		where a.group_id = t.group_id
		and a.hos_id = t.hos_id
		and a.copy_code = t.copy_code
		and a.bill_no = t.bill_no
		)
	</select>


	<select id="queryBackBillDetailExists" resultType="java.lang.Integer">
		select
		count(1)
		from ass_back_bill_main a
		where
		a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		and a.state = 2
		and a.bill_no = #{bill_no}
		<if test="ven_id != null and ven_id != ''">
			and a.ven_id = #{ven_id}
		</if>
		<if test="store_id != null and store_id != ''">
			and a.store_id = #{store_id}
		</if>
	</select>


	<select id="queryBackBillDetailGrid" resultMap="assBillDetailMap">
		select
		a.group_id,
		a.hos_id,
		a.copy_code,
		a.bill_no,
		a.bill_money,
		a.invoice_no,
		a.bill_date,
		'' ass_name
		from ass_back_bill_main a
		where
		a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		and a.state = 2
		<if test="ven_id != null and ven_id != ''">
			and a.ven_id = #{ven_id}
		</if>
		<if test="store_id != null and store_id != ''">
			and a.store_id = #{store_id}
		</if>
		and not exists (
		select 1 from ass_back_pay_detail t
		where a.group_id = t.group_id
		and a.hos_id = t.hos_id
		and a.copy_code = t.copy_code
		and a.bill_no = t.bill_no
		)
	</select>


	<select id="queryHosDeptTerr" resultMap="DeptMap" parameterType="java.util.Map">
		select
		a.dept_id,
		a.dept_code,
		a.dept_code||' '||a.dept_name as dept_name,
		a.super_code
		from hos_dept_dict a
		where a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.is_stop = 0
		and
		a.is_disable = 0
		and a.is_last =1

		and exists (select 1 from v_user_data_perm b where
		a.group_id=b.group_id and a.hos_id=b.hos_id and to_char(a.dept_id)=b.perm_code
		and user_id=#{user_id}
		AND TABLE_CODE = upper('hos_DEPT_dict')
		and (b.is_read = 1
		or b.is_write = 1 ))
	</select>
	<select id="queryAssInvArrt" resultMap="hrpAssSelect"
		parameterType="java.util.Map">
		select a.inv_id||' '||a.inv_code as id,
		a.inv_name as text
		from ass_inv_arrt a
		where a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code =
		#{copy_code}
		and a.is_stop = 0
		<if test="key != null and key != ''">
			and (
			inv_code like '${key}%' or
			inv_name like '%${key}%' or
			spell_code like '%${key}%' or
			wbx_code like '%${key}%'
			)
		</if>
	</select>
	<select id="querySupTypeDict" resultMap="hrpAssSelect">
		SELECT
		type_code id,
		type_name text
		FROM HOS_SUP_TYPE
		<where>

			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				type_code like '%${key}%' or
				type_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by type_code
	</select>
	<!-- 资产分类快速查询 -->
	<select id="queryAssFinaDictTree" resultMap="hrpAssFinaSelectMap">

		select *
		from (
		select

		t1.fina_type_code
		as id,
		lpad(chr(41377), 2 * type_level - 2, chr(41377)) || t1.fina_type_code || ' ' ||
		t1.fina_type_name as text,


		nvl(t1.super_code,'0')
		as pId
		from ASS_FINA_DICT t1
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		<if test="key != null and key != ''">
			and (
			t1.fina_type_code like '%${key}%' or
			t1.fina_type_name like '%${key}%' or
			t1.spell_code like '%${key}%' or
			t1.wbx_code like '%${key}%'
			)
		</if>
		) t
		order by t.id
	</select>
	<!-- 财务分类上级下拉框 (cjc) -->
	<select id="queryMatFinaTypes" resultMap="hrpAssFinaSelectMap">
		SELECT
		FINA_TYPE_CODE id,
		FINA_TYPE_CODE ||' '||FINA_TYPE_NAME text
		FROM
		ASS_FINA_DICT
		<where>
			is_stop=0
			and is_last= 0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				FINA_TYPE_CODE like '%${key}%' or
				FINA_TYPE_NAME like
				'%${key}%'
				)
			</if>
		</where>
		order by FINA_TYPE_CODE
	</select>

	<!-- 资产分类快速查询(cjc) -->
	<select id="queryAssTypeDictTree" resultMap="hrpAssFinaSelectMap">
		select *
		from (
		select

		t1.ass_type_code
		as id,
		lpad(chr(41377), 2 * type_level - 2, chr(41377)) || t1.ass_type_code || ' ' ||
		t1.ass_type_name as text,


		nvl(t1.super_code,'0')
		as pId
		from ASS_TYPE_DICT t1
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		<if test="key != null and key != ''">
			and (
			t1.ass_type_code like '%${key}%' or
			t1.ASS_TYPE_NAME like '%${key}%' or
			t1.spell_code like '%${key}%' or
			t1.wbx_code like '%${key}%'
			)
		</if>
		) t
		order by t.id
	</select>

	<!-- 国标码 -->
	<select id="queryAssGBDict" resultMap="hrpAssSelect">
		select
		a.gb_code id,
		a.gb_code||' '||a.gb_name text
		from
		ass_gb_dict a
		<where>
			a.is_stop=0
			<!-- <if test="group_id != null and group_id != ''"> and group_id = #{group_id} 
				</if> <if test="hos_id != null and hos_id != ''"> and hos_id = #{hos_id} 
				</if> <if test="copy_code != null and copy_code != ''"> and copy_code = #{copy_code} 
				</if> -->
			<if test=" key != null  and  key != ''">
				and (
				a.gb_code like '%${key}%' or
				a.gb_name like '%${key}%' or
				a.spell_code like '%${key}%' or
				a.wbx_code like '%${key}%'
				)
			</if>
			and exists (select 1 from v_user_data_perm b where
			a.gb_code=b.perm_code
			and user_id=#{user_id}
			AND TABLE_CODE =
			upper('ass_gb_dict')
			and (b.is_read = 1
			or b.is_write = 1 ))
		</where>
		order by gb_code
	</select>

	<!-- 科室分类 -->
	<select id="queryDeptKindDict" resultMap="hrpAssSelect">
		select
		kind_code id,
		kind_code||' '||kind_name text
		from
		hos_dept_kind
		<where>
			is_stop=0
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test=" key != null  and  key != ''">
				and (
				kind_code like '%${key}%' or
				kind_name like
				'%${key}%' or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by kind_code
	</select>

	<select id="queryAssStoreDept" resultMap="hrpAssSelect"
		parameterType="java.util.Map">
		SELECT DISTINCT b.dept_id id, b.dept_code || ' ' || b.dept_name text
		FROM mat_store a
		INNER JOIN hos_dept_dict b
		ON a.group_id = b.group_id
		AND a.hos_id = b.hos_id
		AND a.dept_id = b.dept_id
		LEFT JOIN hos_store_dict c
		ON a.group_id = c.group_id
		AND a.hos_id = c.hos_id
		AND a.store_id = c.store_id
		WHERE c.is_ass = 1
		AND b.is_stop = 0
		AND c.is_stop = 0
		<if test="key != null and key != ''">
			and (
			b.dept_code like '${key}%' or
			b.dept_name like '%${key}%' or
			b.spell_code like '%${key}%' or
			b.wbx_code like '%${key}%'
			)
		</if>
	</select>

	<!-- 采购入库供应商下拉框单独的 -->
	<select id="queryHosSupDictNo" resultMap="hrpAssSelect">
		SELECT
		sup_id||'@'||sup_no id,
		sup_code||' '||sup_name text
		FROM
		HOS_SUP_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				sup_code like '%${key}%' or
				sup_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by sup_code
	
	</select>
	
	<!-- 采购入库生产厂商单独的 -->
	<select id="queryHosFacDictNo" resultMap="hrpAssSelect">
		SELECT
		fac_id||'@'||fac_no id,
		fac_code||' '||fac_name text
		FROM
		HOS_FAC_DICT a
		<where>
			is_stop=0
			and is_ass = 1
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				fac_code like '%${key}%' or
				fac_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
		</where>
		order by fac_code
	</select>
	
	<!-- 资产平针下拉框 -->
	<select id="queryCertNo" resultMap="hrpAssSelect">
	SELECT
		CERT_CODE id,
		CERT_INV_NAME text
		FROM
		ASS_CERT_MAIN 
		<where>
			CERT_STATE=1
			and state = 1
		
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="key != null and key != ''">
				and (
				CERT_CODE like '%${key}%' or
				CERT_INV_NAME like '%${key}%'
				)
			</if>
	</where>
	</select>
	
	<select id="queryAssMeasureKingDict" resultMap="hrpAssSelect">
	SELECT
		MEASURE_KING_CODE id,
		MEASURE_KING_NAME text
		FROM
		ASS_Measure_King_DICT 
		<where>
			is_stop=0
		
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				MEASURE_KING_CODE like '%${key}%' or
				MEASURE_KING_NAME like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
	</where>
	</select>
	
	<select id="queryAccEmpAttr" resultMap="hrpAssSelect">
		select emp_id id,phone text from acc_emp_attr 
		<where>
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="emp_phone_user != null  and emp_phone_user != ''">
				and emp_id = (select to_number(emp_code) emp_id from SYS_USER where user_id = #{emp_phone_user})
			</if>
		</where>
	</select>
	
	<select id="queryReportBusType" resultMap="hrpAssSelect">
		select id,text from ( 
				select '采购增加' text,'cq_add,1' id from dual
				union all
				select '原值增加' text,'yz_add,1' id from dual
				union all
				select '捐赠入库' text,'jz_add,1' id from dual
				union all
				select '调剂增加' text,'tj_add,1' id from dual
				union all
				
				select '原值报废' text,'bf_dec,2' id from dual
				union all
				select '原值减少' text,'yz_dec,2' id from dual
				union all
				select '原值退货' text,'th_dec,2' id from dual
				union all
				select '原值调剂减少' text,'tj_dec,2' id from dual
				
				union all
				select '折旧减少' text,'zjjs_dec,3' id from dual
				union all
				select '折旧报废' text,'bfjs_dec,3' id from dual
				union all
				select '折旧退货' text,'thjs_dec,3' id from dual
				union all
				select '折旧调剂减少' text,'tjjs_dec,3' id from dual
				
				)
	</select>
	
	<select id="queryAssTypeSixEight" resultMap="hrpAssSelect">
	SELECT
		type_code id,
		type_name text
		FROM
		ASS_TYPE_SIXEIGHT 
		<where>
			is_stop=0
		
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				type_code like '%${key}%' or
				type_name like '%${key}%'
				or
				spell_code like '%${key}%' or
				wbx_code like '%${key}%'
				)
			</if>
	</where>
	</select>
	
	
	
	
	<!-- 购置申请  预算信息 下拉框检索  sql 为测试数据用  后期调整 -->
	<select id="queryAssBudgTable" resultType="java.util.Map">

		SELECT
		'001' ass_item ,
		'测试数据'  ass_item_name ,
		1000 budg_price,
		2 budg_amount ,
		2000 budg_money ,
		1 budg_dept_id ,
		'1001' budg_dept_code,
		'预算测试科室' budg_dept_name
		from dual
	</select>
	
	
	<select id="queryPactMainFkht" resultMap="hrpAssSelect">
	SELECT
		pact_code id,
		pact_name text
		FROM
		PACT_MAIN_FKHT 
		<where>
		
			<if test="group_id != null  and group_id != ''">
				and group_id = #{group_id}
			</if>
			<if test="hos_id != null  and hos_id != ''">
				and hos_id = #{hos_id}
			</if>
			<if test="copy_code != null  and copy_code != ''">
				and copy_code = #{copy_code}
			</if>
			<if test="key != null and key != ''">
				and (
				pact_code like '%${key}%' or
				pact_name like '%${key}%'
				)
			</if>
	</where>
	</select>
</mapper>

