<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.cost.dao.analysis.AnalysisMapper">
 
	<resultMap id="costDeptCost" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" /> 
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" /> 
		<result property="acc_month" column="acc_month" /> 
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="cost_item_id" column="cost_item_id" />
		<result property="cost_item_no" column="cost_item_no" />
		<result property="cost_item_code" column="cost_item_code" />
		<result property="cost_item_name" column="cost_item_name" />
		<result property="dir_lc_amount" column="dir_lc_amount" />
		<result property="dir_yj_amount" column="dir_yj_amount" />
		<result property="dir_yf_amount" column="dir_yf_amount" />
		<result property="dir_xz_amount" column="dir_xz_amount" />
		<result property="source_id" column="source_id" />
		<result property="source_code" column="source_code" />
		<result property="source_name" column="source_name" />
		<result property="dir_amount" column="dir_amount" />
		<result property="dir_man_amount" column="dir_man_amount" />
		<result property="dir_ass_amount" column="dir_ass_amount" />
		<result property="dir_med_amount" column="dir_med_amount" />
		<result property="indir_ass_man_amount" column="indir_ass_man_amount" />
		<result property="indir_med_man_amount" column="indir_med_man_amount" />
		<result property="indir_ass_med_man_amount" column="indir_ass_med_man_amount" />
		<result property="indir_med_ass_amount" column="indir_med_ass_amount" />
	</resultMap>
	<resultMap id="c0201" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="type_code" column="type_code" />
		<result property="type_name" column="type_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
	</resultMap>
	<resultMap id="c0203" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>

	<resultMap id="c0204" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>

	<resultMap id="c0205" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>
	<resultMap id="c0303" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="item_code" column="item_code" />
		<result property="item_name" column="item_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>
	<resultMap id="c0309" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="item_code" column="item_code" />
		<result property="item_name" column="item_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_9" column="t_9" />
		<result property="t_8" column="t_8" />
		<result property="t_10" column="t_10" />
		<result property="t_11" column="t_11" />
		<result property="t_12" column="t_12" />
		<result property="t_13" column="t_13" />
	</resultMap>
	<resultMap id="c0401" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>
	<resultMap id="CostGeneralHosMap" type="java.util.Map">
		<result property="item_code" column="item_code" />
		<result property="item_name" column="item_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_9" column="t_9" />
	</resultMap>
	<resultMap id="CostGeneralHosMedMap" type="java.util.Map">
		<result property="item_code" column="item_code" />
		<result property="item_name" column="item_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>

	<resultMap id="CostGeneralDetailHosMap" type="java.util.Map">
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
	</resultMap>
	<resultMap id="CostGeneralDetailHosMedMap" type="java.util.Map">
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>
	<resultMap id="CostVolumeProfitMap" type="java.util.Map">
		<result property="item_code" column="item_code" />
		<result property="item_name" column="item_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>
	<resultMap id="CostVolumeProfitDetailMap" type="java.util.Map">
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="work" column="work" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
		<result property="t_8" column="t_8" />
		<result property="t_9" column="t_9" />
		<result property="t_10" column="t_10" />
	</resultMap>
	<resultMap id="CostVolumeProfitDetailChartMap" type="java.util.Map">
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="natur_code" column="natur_code" />
		<result property="income_money" column="income_money" />
		<result property="fixed_cost" column="fixed_cost" />
		<result property="change_cost" column="change_cost" />
		<result property="workload" column="workload" />
		<result property="t_workload" column="t_workload" />
		<result property="unit_income_money" column="unit_income_money" />
		<result property="unit_change_cost" column="unit_change_cost" />
		<result property="yaxis" column="yaxis" />
	</resultMap>
	<resultMap id="CostBreakevenMap" type="java.util.Map">
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="t_id" column="t_id" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
		<result property="t_3" column="t_3" />
		<result property="t_4" column="t_4" />
		<result property="t_5" column="t_5" />
		<result property="t_6" column="t_6" />
		<result property="t_7" column="t_7" />
	</resultMap>
	<resultMap id="CostBreakevenDetailMap" type="java.util.Map">
		<result property="charge_kind_code" column="charge_kind_code" />
		<result property="charge_kind_name" column="charge_kind_name" />
		<result property="money" column="money" />
		<result property="cost_type_code" column="cost_type_code" />
		<result property="cost_type_name" column="cost_type_name" />
		<result property="t_1" column="t_1" />
		<result property="t_2" column="t_2" />
	</resultMap>

	<select id="queryCostDeptReport_1" parameterType="java.util.Map"

		resultType="java.util.Map">

		with dept_dir as(
		select
		 d.dept_code
		,d.dept_name
		,
		sum(decode(b.cost_type_id,1,a.dir_amount,0)) cost_emp_amount<!-- 人员经费 -->
		,
		sum(decode(b.cost_type_id,2,a.dir_amount,0)) cost_mate_amount<!--卫生材料费 -->
		,
		sum(decode(b.cost_type_id,3,a.dir_amount,0)) cost_drug_amount<!--药品费 -->
		,
		sum(decode(b.cost_type_id,4,a.dir_amount,0)) cost_fasset_amount<!--固定资产 -->
		,
		sum(decode(b.cost_type_id,5,a.dir_amount,0)) cost_iasset_amount<!--无形资产 -->
		,
		sum(decode(b.cost_type_id,6,a.dir_amount,0)) cost_risk_amount<!--提取医疗风险基金 -->
		,
		sum(decode(b.cost_type_id,7,a.dir_amount,0)) cost_other_amount<!--其他费用 -->

		from
		cost_dept_dri_data a
		inner join
		hos_source t1
		on a.group_id =
		t1.group_id
		and a.hos_id = t1.hos_id
		and
		a.source_id = t1.source_id
		left
		join
		cost_item_dict b on
		a.group_id=b.group_id and a.hos_id=b.hos_id
		and
		a.copy_code=b.copy_code
		and a.cost_item_id=b.cost_item_id
		left join
		hos_dept c on
		a.group_id=c.group_id and a.hos_id=c.hos_id and
		c.dept_id=a.dept_id
		left join hos_dept_dict d on
		a.group_id=d.group_id
		and
		a.hos_id=d.hos_id and a.dept_id=d.dept_id
		<if test="is_flag == '1' ">
			and a.dept_no=d.dept_no
		</if>
		<if test="is_flag == '0' or is_flag == ''">
			and d.is_stop=0
		</if>

		<where>
			<if test="group_id != null and group_id != ''">
				AND a.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND a.copy_code = #{copy_code}
			</if>
			<if test="year_month_begin != null and year_month_begin != ''">
				AND a.acc_year || a.acc_month between #{year_month_begin}
				and #{year_month_end}
			</if>
			<if test="source_attr != null and source_attr != ''">
				AND source_attr in ${source_attr}
			</if>
		</where>
		group by d.dept_code,d.dept_name
		),

		dept_type as(
		select
		decode(c.type_code,'04','4999','03','3998','02','2999','01','1999')
		dept_code,
		decode(c.type_code,'04','管理费用合计','03','医疗辅助类科室成本小计','02','医疗技术类科室成本小计','01','临床服务类科室小计')
		dept_name,
		sum(decode(b.cost_type_id,1,a.dir_amount,0)) cost_emp_amount<!-- 
			人员经费 -->
		,
		sum(decode(b.cost_type_id,2,a.dir_amount,0)) cost_mate_amount<!--卫生材料费 -->
		,
		sum(decode(b.cost_type_id,3,a.dir_amount,0)) cost_drug_amount<!--药品费 -->
		,
		sum(decode(b.cost_type_id,4,a.dir_amount,0)) cost_fasset_amount<!--固定资产 -->
		,
		sum(decode(b.cost_type_id,5,a.dir_amount,0)) cost_iasset_amount<!--无形资产 -->
		,
		sum(decode(b.cost_type_id,6,a.dir_amount,0)) cost_risk_amount<!--提取医疗风险基金 -->
		,
		sum(decode(b.cost_type_id,7,a.dir_amount,0)) cost_other_amount<!--其他费用 -->
		from
		cost_dept_cost a
		inner join
		hos_source t1
		on a.group_id = t1.group_id
		and a.hos_id = t1.hos_id
		and
		a.source_id = t1.source_id
		left join
		cost_item_dict b on
		a.group_id=b.group_id and a.hos_id=b.hos_id
		and
		a.copy_code=b.copy_code
		and a.cost_item_id=b.cost_item_id
		left join
		acc_dept_attr c on
		a.group_id=c.group_id and a.hos_id=c.hos_id and
		c.dept_id=a.dept_id
		left join hos_dept_dict d on
		a.group_id=d.group_id
		and
		a.hos_id=d.hos_id and a.dept_id=d.dept_id
		<if test="is_flag == '1' ">
			and a.dept_no=d.dept_no
		</if>
		<if test="is_flag == '0' or is_flag == ''">
			and d.is_stop=0
		</if>
		<where>
			<if test="group_id != null and group_id != ''">
				AND a.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND a.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND a.copy_code = #{copy_code}
			</if>
			<if test="year_month_begin != null and year_month_begin != ''">
				AND a.acc_year || a.acc_month between #{year_month_begin}
				and #{year_month_end}
			</if>
			<if test="source_attr != null and source_attr != ''">
				AND source_attr in ${source_attr}
			</if>
		</where>
		group by c.type_code
		)

		select
		dept_code,dept_name,cost_emp_amount,cost_mate_amount,cost_drug_amount,cost_fasset_amount,cost_iasset_amount
		,cost_risk_amount,cost_other_amount, sum_amount
		from (
		select
		dept_code,dept_name,cost_emp_amount,cost_mate_amount,cost_drug_amount,cost_fasset_amount,cost_iasset_amount
		,cost_risk_amount,cost_other_amount,(cost_emp_amount+cost_mate_amount+cost_drug_amount+cost_fasset_amount+cost_iasset_amount
		+cost_risk_amount+cost_other_amount) sum_amount
		from
		dept_dir
		union all
		select
		dept_code,dept_name,cost_emp_amount,cost_mate_amount,cost_drug_amount,cost_fasset_amount,cost_iasset_amount
		,cost_risk_amount,cost_other_amount,(cost_emp_amount+cost_mate_amount+cost_drug_amount+cost_fasset_amount+cost_iasset_amount
		+cost_risk_amount+cost_other_amount) sum_amount from dept_type
		UNION
		ALL
		SELECT '3999', '医疗业务成本合计',
		SUM(cost_emp_amount),
		SUM(cost_mate_amount), SUM(cost_drug_amount),
		SUM(cost_fasset_amount),
		SUM(cost_iasset_amount),
		SUM(cost_risk_amount),
		SUM(cost_other_amount),
		SUM(cost_emp_amount +
		cost_mate_amount +
		cost_drug_amount +
		cost_fasset_amount +
		cost_iasset_amount +
		cost_risk_amount +
		cost_other_amount) AS
		sum_amount
		FROM dept_type
		WHERE dept_code != '4999'
		<!-- GROUP BY -->
		<!-- acc_year,acc_month -->
		UNION ALL
		SELECT 
		'6999','本月合计'
		dept_name,
		SUM(cost_emp_amount),
		SUM(cost_mate_amount),
		SUM(cost_drug_amount),
		SUM(cost_fasset_amount), 
		SUM(cost_iasset_amount),
		SUM(cost_risk_amount),
		SUM(cost_other_amount),
		SUM(cost_emp_amount +
		cost_mate_amount +
		cost_drug_amount +
		cost_fasset_amount +
		cost_iasset_amount +
		cost_risk_amount +
		cost_other_amount) AS
		sum_amount
		FROM dept_type
		<!-- GROUP BY acc_year, -->
		<!-- acc_month -->
		) t
		order by
		dept_code
		asc
	</select>
 
    <select id="queryCostDeptReportThead" parameterType="java.util.Map" resultType="java.util.Map">
  		with temp as(select 
               cid.cost_type_id,
               ctd.cost_type_name,
               cid.cost_item_code,
               cid.cost_item_name,
               1 num
          from cost_item_dict cid
          left join cost_type_dict ctd
            on cid.cost_type_id = ctd.cost_type_id
         where group_id = #{group_id}
           and hos_id = #{hos_id}
           and copy_code = #{copy_code}
           and cid.is_last = 1
         order by cid.cost_item_code
        ), t as (select 
          cost_type_id,
          cost_type_name,
          decode(grouping(cost_type_id)+
          grouping(cost_type_name)+
          grouping(cost_item_code)+
          grouping(cost_item_name),2,cost_type_id||'subtotal',
          cost_type_id||cost_item_code) cost_item_code,
          decode(grouping(cost_type_id)+
          grouping(cost_type_name)+
          grouping(cost_item_code)+
          grouping(cost_item_name),2,'小计',
          cost_item_name) cost_item_name,
          count(num)
        from temp
        group by grouping sets((cost_type_id,cost_type_name,cost_item_code,cost_item_name),(cost_type_id,cost_type_name))
				)select 
				    cost_type_id,
					cost_type_name,
					cost_item_code,
					cost_item_name
				 from t
				 <where>
				  <if test="cost_item_name != null and cost_item_name != ''">
				      cost_item_name != '小计'
			       </if>
				 </where>
				 order by cost_type_id,cost_item_code
      

		
	</select>
 
	<select id="queryCostDeptReport" parameterType="java.util.Map" resultType="java.util.Map">
	             with dept_dir as(
		select hdd.dept_code,
           hdd.dept_name,
           cidn.cost_type_id,
           decode(grouping(hdd.dept_code)+
           grouping(hdd.dept_name)+
           grouping(cidn.cost_type_id)+
           grouping(cidn.cost_item_code),1,cidn.cost_type_id||'subtotal',
           cidn.cost_type_id||cidn.cost_item_code) cost_item_code,
           sum(cddd.dir_amount) dir_amount
      from cost_dept_dri_data cddd
      left join hos_dept_dict hdd
        on cddd.group_id = hdd.group_id
       and cddd.hos_id = hdd.hos_id
       and cddd.dept_no = hdd.dept_no
       and cddd.dept_id = hdd.dept_id
      left join cost_item_dict_no cidn
        on cidn.group_id = cddd.group_id
       and cidn.hos_id = cddd.hos_id
       and cidn.copy_code = cddd.copy_code
       and cidn.cost_item_no = cddd.cost_item_no
       and cidn.cost_item_id = cddd.cost_item_id
     where cddd.group_id = #{group_id}
       and cddd.hos_id = #{hos_id}
       and cddd.copy_code = #{copy_code}
       and cddd.acc_year || cddd.acc_month between #{year_month_begin} and #{year_month_end}
       and cddd.source_id = 1
       group by grouping sets ((hdd.dept_code,
                  hdd.dept_name,
                  cidn.cost_type_id,
                  cidn.cost_item_code),
                  (hdd.dept_code,
                  hdd.dept_name,
                  cidn.cost_type_id))
       order by hdd.dept_code,hdd.dept_name,cidn.cost_type_id,cidn.cost_item_code    
		)select 
		    dept_code,
            dept_name
		   <foreach collection="listThead" item="item" index="index" separator="" >
			,sum(decode(cost_item_code,'${item.COST_ITEM_CODE}',dir_amount,0)) c${item.COST_ITEM_CODE}
		   </foreach>
		   ,
		   <foreach collection="listTheadSum" item="item" index="index" separator="+" >
               sum(decode(cost_item_code,'${item.COST_ITEM_CODE}',dir_amount,0))
		   </foreach>
		    total
		 from dept_dir
		 group by dept_code,dept_name
	</select>
	<select id="querychengbenMain" parameterType="java.util.Map"
		resultType="java.util.Map">

		with
		aaa as(
		select
		ctd.cost_type_id,ctd.cost_type_name,sum(cdc.dir_amount) as
		dir_amount,SUM(cdc.dir_man_amount)as dir_man_amount,sum(
		cdc.indir_ass_man_amount )as indir_ass_man_amount,sum(
		cdc.indir_med_man_amount ) as
		indir_med_man_amount,sum(cdc.indir_ass_med_man_amount) as
		indir_ass_med_man_amount,sum( cdc.dir_ass_amount )as
		dir_ass_amount,sum( cdc.indir_med_ass_amount ) as
		indir_med_ass_amount,sum( cdc.dir_med_amount) AS dir_med_amount

		from
		COST_DEPT_COST cdc

		left join COST_ITEM_DICT cid on
		cid.group_id=cdc.group_id and
		cid.hos_id=cdc.hos_id and
		cid.cost_item_id=cdc.cost_item_id
		left join COST_TYPE_DICT ctd on
		ctd.cost_type_id=cid.cost_type_id
		<where>
			<if test="group_id != null and group_id != ''">
				AND cdc.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND cdc.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND cdc.copy_code = #{copy_code}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND cdc.acc_year || cdc.acc_month between #{year_month_begin}
				and
				#{year_month_end}
			</if>
			and cdc.source_id='1'
		</where>


		group by ctd.cost_type_name,ctd.cost_type_id

		),
		bbb as(
		select '' as
		cost_type_id ,'' as cost_type_name ,sum(cdc.dir_amount) as
		dir_amount,SUM(cdc.dir_man_amount)as dir_man_amount,sum(
		cdc.indir_ass_man_amount )as indir_ass_man_amount,sum(
		cdc.indir_med_man_amount ) as
		indir_med_man_amount,sum(cdc.indir_ass_med_man_amount) as
		indir_ass_med_man_amount,sum( cdc.dir_ass_amount )as
		dir_ass_amount,sum( cdc.indir_med_ass_amount ) as
		indir_med_ass_amount,sum( cdc.dir_med_amount) AS dir_med_amount

		from
		COST_DEPT_COST cdc

		left join COST_ITEM_DICT cid on
		cid.group_id=cdc.group_id and
		cid.hos_id=cdc.hos_id and
		cid.cost_item_id=cdc.cost_item_id
		left join COST_TYPE_DICT ctd on
		ctd.cost_type_id=cid.cost_type_id
		<where>
			<if test="group_id != null and group_id != ''">
				AND cdc.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND cdc.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND cdc.copy_code = #{copy_code}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND cdc.acc_year || cdc.acc_month between #{year_month_begin}
				and
				#{year_month_end}
			</if>
			and cdc.source_id='1'
		</where>

		),
		ccc as(
		select
		hdk.kind_code,hdk.kind_name,ci.appl_dept_id,hd.dept_name,money from
		cost_income ci

		left join hos_dept hd on hd.group_id=ci.group_id and
		hd.hos_id =ci.hos_id
		and ci.appl_dept_id=hd.dept_id
		left join
		HOS_DEPT_KIND hdk on hd.group_id=hdk.group_id and
		hd.hos_id=hdk.hos_id
		and hd.kind_code=hdk.kind_code
		<where>
			<if test="group_id != null and group_id != ''">
				AND ci.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND ci.hos_id = #{hos_id}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND ci.acc_year || ci.acc_month between #{year_month_begin} and
				#{year_month_end}
			</if>
			and hdk.kind_code='01'
		</where>

		)
		select cost_type_id,cost_type_name,sum_amount,dir_amount,indir_amount
		from (
		select
		cost_type_id,cost_type_name,CAST(SUM(dir_amount+dir_man_amount
		+
		indir_ass_man_amount +indir_med_man_amount +
		indir_ass_med_man_amount +
		dir_ass_amount + indir_med_ass_amount +
		dir_med_amount)as
		decimal(15,2)) AS sum_amount
		,sum(dir_amount) as
		dir_amount,CAST(SUM(dir_man_amount + indir_ass_man_amount
		+indir_med_man_amount + indir_ass_med_man_amount + dir_ass_amount +
		indir_med_ass_amount + dir_med_amount)as decimal(15,2)) AS
		indir_amount
		from aaa

		group by cost_type_name,cost_type_id

		union all
		select 111,'科室医疗成本合计',CAST(SUM(dir_amount+dir_man_amount +
		indir_ass_man_amount +indir_med_man_amount + indir_ass_med_man_amount
		+ dir_ass_amount + indir_med_ass_amount + dir_med_amount)as
		decimal(15,2)) AS sum_amount
		,sum(dir_amount) as
		dir_amount,CAST(SUM(dir_man_amount + indir_ass_man_amount
		+indir_med_man_amount + indir_ass_med_man_amount + dir_ass_amount +
		indir_med_ass_amount + dir_med_amount)as decimal(15,2)) AS
		indir_amount
		from bbb
		union all
		select 222,'科室收入',sum(money)as
		sum_amount,null,null from ccc
		)
		order by cost_type_id
	</select>
	<select id="querychengbenMain2" parameterType="java.util.Map"
		resultType="java.util.Map">

		with
		aaa as(
		select
		ctd.cost_type_id,ctd.cost_type_name,sum(cdc.dir_amount) as
		dir_amount,SUM(cdc.dir_man_amount)as dir_man_amount,sum(
		cdc.indir_ass_man_amount )as indir_ass_man_amount,sum(
		cdc.indir_med_man_amount ) as
		indir_med_man_amount,sum(cdc.indir_ass_med_man_amount) as
		indir_ass_med_man_amount,sum( cdc.dir_ass_amount )as
		dir_ass_amount,sum( cdc.indir_med_ass_amount ) as
		indir_med_ass_amount,sum( cdc.dir_med_amount) AS dir_med_amount

		from
		COST_DEPT_COST cdc

		left join COST_ITEM_DICT cid on
		cid.group_id=cdc.group_id and
		cid.hos_id=cdc.hos_id and
		cid.cost_item_id=cdc.cost_item_id
		left join COST_TYPE_DICT ctd on
		ctd.cost_type_id=cid.cost_type_id
		<where>
			<if test="group_id != null and group_id != ''">
				AND cdc.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND cdc.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND cdc.copy_code = #{copy_code}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND cdc.acc_year || cdc.acc_month between #{year_month_begin}
				and
				#{year_month_end}
			</if>
			and cdc.source_id in ('1','2')
		</where>


		group by ctd.cost_type_name,ctd.cost_type_id

		),
		bbb as(
		select '' as
		cost_type_id ,'' as cost_type_name ,sum(cdc.dir_amount) as
		dir_amount,SUM(cdc.dir_man_amount)as dir_man_amount,sum(
		cdc.indir_ass_man_amount )as indir_ass_man_amount,sum(
		cdc.indir_med_man_amount ) as
		indir_med_man_amount,sum(cdc.indir_ass_med_man_amount) as
		indir_ass_med_man_amount,sum( cdc.dir_ass_amount )as
		dir_ass_amount,sum( cdc.indir_med_ass_amount ) as
		indir_med_ass_amount,sum( cdc.dir_med_amount) AS dir_med_amount

		from
		COST_DEPT_COST cdc

		left join COST_ITEM_DICT cid on
		cid.group_id=cdc.group_id and
		cid.hos_id=cdc.hos_id and
		cid.cost_item_id=cdc.cost_item_id
		left join COST_TYPE_DICT ctd on
		ctd.cost_type_id=cid.cost_type_id
		<where>
			<if test="group_id != null and group_id != ''">
				AND cdc.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND cdc.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND cdc.copy_code = #{copy_code}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND cdc.acc_year || cdc.acc_month between #{year_month_begin}
				and
				#{year_month_end}
			</if>
			and cdc.source_id in ('1','2')
		</where>

		),
		ccc as(
		select
		hdk.kind_code,hdk.kind_name,ci.appl_dept_id,hd.dept_name,money from
		cost_income ci

		left join hos_dept hd on hd.group_id=ci.group_id and
		hd.hos_id =ci.hos_id
		and ci.appl_dept_id=hd.dept_id
		left join
		HOS_DEPT_KIND hdk on hd.group_id=hdk.group_id and
		hd.hos_id=hdk.hos_id
		and hd.kind_code=hdk.kind_code
		<where>
			<if test="group_id != null and group_id != ''">
				AND ci.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND ci.hos_id = #{hos_id}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND ci.acc_year || ci.acc_month between #{year_month_begin} and
				#{year_month_end}
			</if>
			and hdk.kind_code='01'
		</where>

		)
		select cost_type_id,cost_type_name,sum_amount,dir_amount,indir_amount
		from (
		select
		cost_type_id,cost_type_name,CAST(SUM(dir_amount+dir_man_amount
		+
		indir_ass_man_amount +indir_med_man_amount +
		indir_ass_med_man_amount +
		dir_ass_amount + indir_med_ass_amount +
		dir_med_amount)as
		decimal(15,2)) AS sum_amount
		,sum(dir_amount) as
		dir_amount,CAST(SUM(dir_man_amount + indir_ass_man_amount
		+indir_med_man_amount + indir_ass_med_man_amount + dir_ass_amount +
		indir_med_ass_amount + dir_med_amount)as decimal(15,2)) AS
		indir_amount
		from aaa

		group by cost_type_name,cost_type_id

		union all
		select 111,'科室医疗成本合计',CAST(SUM(dir_amount+dir_man_amount +
		indir_ass_man_amount +indir_med_man_amount + indir_ass_med_man_amount
		+ dir_ass_amount + indir_med_ass_amount + dir_med_amount)as
		decimal(15,2)) AS sum_amount
		,sum(dir_amount) as
		dir_amount,CAST(SUM(dir_man_amount + indir_ass_man_amount
		+indir_med_man_amount + indir_ass_med_man_amount + dir_ass_amount +
		indir_med_ass_amount + dir_med_amount)as decimal(15,2)) AS
		indir_amount
		from bbb
		union all
		select 222,'科室收入',sum(money)as
		sum_amount,null,null from ccc
		)
		order by cost_type_id
	</select>
	<select id="querychengbenMain3" parameterType="java.util.Map"
		resultType="java.util.Map">

		with
		aaa as(
		select
		ctd.cost_type_id,ctd.cost_type_name,sum(cdc.dir_amount) as
		dir_amount,SUM(cdc.dir_man_amount)as dir_man_amount,sum(
		cdc.indir_ass_man_amount )as indir_ass_man_amount,sum(
		cdc.indir_med_man_amount ) as
		indir_med_man_amount,sum(cdc.indir_ass_med_man_amount) as
		indir_ass_med_man_amount,sum( cdc.dir_ass_amount )as
		dir_ass_amount,sum( cdc.indir_med_ass_amount ) as
		indir_med_ass_amount,sum( cdc.dir_med_amount) AS dir_med_amount

		from
		COST_DEPT_COST cdc

		left join COST_ITEM_DICT cid on
		cid.group_id=cdc.group_id and
		cid.hos_id=cdc.hos_id and
		cid.cost_item_id=cdc.cost_item_id
		left join COST_TYPE_DICT ctd on
		ctd.cost_type_id=cid.cost_type_id
		<where>
			<if test="group_id != null and group_id != ''">
				AND cdc.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND cdc.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND cdc.copy_code = #{copy_code}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND cdc.acc_year || cdc.acc_month between #{year_month_begin}
				and
				#{year_month_end}
			</if>
			and cdc.source_id in ('1','2','3','4')
		</where>


		group by ctd.cost_type_name,ctd.cost_type_id

		),
		bbb as(
		select '' as
		cost_type_id ,'' as cost_type_name ,sum(cdc.dir_amount) as
		dir_amount,SUM(cdc.dir_man_amount)as dir_man_amount,sum(
		cdc.indir_ass_man_amount )as indir_ass_man_amount,sum(
		cdc.indir_med_man_amount ) as
		indir_med_man_amount,sum(cdc.indir_ass_med_man_amount) as
		indir_ass_med_man_amount,sum( cdc.dir_ass_amount )as
		dir_ass_amount,sum( cdc.indir_med_ass_amount ) as
		indir_med_ass_amount,sum( cdc.dir_med_amount) AS dir_med_amount

		from
		COST_DEPT_COST cdc

		left join COST_ITEM_DICT cid on
		cid.group_id=cdc.group_id and
		cid.hos_id=cdc.hos_id and
		cid.cost_item_id=cdc.cost_item_id
		left join COST_TYPE_DICT ctd on
		ctd.cost_type_id=cid.cost_type_id
		<where>
			<if test="group_id != null and group_id != ''">
				AND cdc.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND cdc.hos_id = #{hos_id}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND cdc.copy_code = #{copy_code}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND cdc.acc_year || cdc.acc_month between #{year_month_begin}
				and
				#{year_month_end}
			</if>
			and cdc.source_id in ('1','2','3','4')
		</where>

		),
		ccc as(
		select
		hdk.kind_code,hdk.kind_name,ci.appl_dept_id,hd.dept_name,money from
		cost_income ci

		left join hos_dept hd on hd.group_id=ci.group_id and
		hd.hos_id =ci.hos_id
		and ci.appl_dept_id=hd.dept_id
		left join
		HOS_DEPT_KIND hdk on hd.group_id=hdk.group_id and
		hd.hos_id=hdk.hos_id
		and hd.kind_code=hdk.kind_code
		<where>
			<if test="group_id != null and group_id != ''">
				AND ci.group_id = #{group_id}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND ci.hos_id = #{hos_id}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND ci.acc_year || ci.acc_month between #{year_month_begin} and
				#{year_month_end}
			</if>
			and hdk.kind_code='01'
		</where>

		)
		select cost_type_id,cost_type_name,sum_amount,dir_amount,indir_amount
		from (
		select
		cost_type_id,cost_type_name,CAST(SUM(dir_amount+dir_man_amount
		+
		indir_ass_man_amount +indir_med_man_amount +
		indir_ass_med_man_amount +
		dir_ass_amount + indir_med_ass_amount +
		dir_med_amount)as
		decimal(15,2)) AS sum_amount
		,sum(dir_amount) as
		dir_amount,CAST(SUM(dir_man_amount + indir_ass_man_amount
		+indir_med_man_amount + indir_ass_med_man_amount + dir_ass_amount +
		indir_med_ass_amount + dir_med_amount)as decimal(15,2)) AS
		indir_amount
		from aaa

		group by cost_type_name,cost_type_id

		union all
		select 111,'科室医疗成本合计',CAST(SUM(dir_amount+dir_man_amount +
		indir_ass_man_amount +indir_med_man_amount + indir_ass_med_man_amount
		+ dir_ass_amount + indir_med_ass_amount + dir_med_amount)as
		decimal(15,2)) AS sum_amount
		,sum(dir_amount) as
		dir_amount,CAST(SUM(dir_man_amount + indir_ass_man_amount
		+indir_med_man_amount + indir_ass_med_man_amount + dir_ass_amount +
		indir_med_ass_amount + dir_med_amount)as decimal(15,2)) AS
		indir_amount
		from bbb
		union all
		select 222,'科室收入',sum(money)as
		sum_amount,null,null from ccc
		)
		order by cost_type_id
	</select>

	<select id="queryCostDeptReport_2" parameterType="java.util.Map"
		resultType="java.util.Map">
		with dept as
		(
		SELECT a.acc_year,
		a.acc_month,
		a.acc_year||a.acc_month as
		year_month,
		d.dept_code,
		d.dept_name,
		SUM(decode(b.cost_type_id, 1,
		a.dir_amount, 0)) AS cost_emp_amount_1,
		SUM(decode(b.cost_type_id,
		1,
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) +
		nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS
		cost_emp_amount_2,
		SUM(decode(b.cost_type_id,
		1,
		nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_emp_amount_3,
		SUM(decode(b.cost_type_id, 2, a.dir_amount, 0)) AS cost_mate_amount_1,
		SUM(decode(b.cost_type_id,
		2,
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) +
		nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS
		cost_mate_amount_2,
		SUM(decode(b.cost_type_id,
		2,
		nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_mate_amount_3,
		SUM(decode(b.cost_type_id, 3, a.dir_amount, 0)) AS cost_drug_amount_1,
		SUM(decode(b.cost_type_id,
		3,
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) +
		nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS
		cost_drug_amount_2,
		SUM(decode(b.cost_type_id,
		3,
		nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_drug_amount_3,
		SUM(decode(b.cost_type_id, 4, a.dir_amount, 0)) AS
		cost_fasset_amount_1,
		SUM(decode(b.cost_type_id,
		4,
		nvl(a.dir_man_amount, 0) + nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_fasset_amount_2,
		SUM(decode(b.cost_type_id,
		4,
		nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_fasset_amount_3,
		SUM(decode(b.cost_type_id, 5, a.dir_amount, 0)) AS
		cost_iasset_amount_1,
		SUM(decode(b.cost_type_id,
		5,
		nvl(a.dir_man_amount, 0) + nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_iasset_amount_2,
		SUM(decode(b.cost_type_id,
		5,
		nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_iasset_amount_3,
		SUM(decode(b.cost_type_id, 6, a.dir_amount, 0)) AS cost_risk_amount_1,
		SUM(decode(b.cost_type_id,
		6,
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) +
		nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS
		cost_risk_amount_2,
		SUM(decode(b.cost_type_id,
		6,
		nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_risk_amount_3,
		SUM(decode(b.cost_type_id, 7, a.dir_amount, 0)) AS
		cost_other_amount_1,
		SUM(decode(b.cost_type_id,
		7,
		nvl(a.dir_man_amount,
		0) + nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) +
		nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS
		cost_other_amount_2,
		SUM(decode(b.cost_type_id,
		7,
		nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0),
		0)) AS cost_other_amount_3
		FROM cost_dept_cost
		a
		inner join
		hos_source t1
		on a.group_id = t1.group_id
		and a.hos_id =
		t1.hos_id
		and
		a.source_id = t1.source_id
		left join cost_item_dict b on
		a.group_id=b.group_id
		and
		a.hos_id=b.hos_id
		and a.copy_code=b.copy_code
		and
		a.cost_item_id=b.cost_item_id
		left join acc_dept_attr c on
		a.group_id=c.group_id and a.hos_id=c.hos_id and c.dept_id=a.dept_id
		left join hos_dept_dict d on
		a.group_id=d.group_id and
		a.hos_id=d.hos_id and a.dept_id=d.dept_id
		<if test="is_flag == '1' ">
			and a.dept_no=d.dept_no
		</if>
		<if test="is_flag == '0' or is_flag == ''">
			and d.is_stop=0
		</if>
		<where>
			a.group_id = #{group_id}
			AND a.hos_id = #{hos_id}
			AND a.copy_code =
			#{copy_code}
			and d.is_stop=0
			<if test="year_month_begin != null and year_month_begin != ''">
				AND a.acc_year || a.acc_month between #{year_month_begin}
				and #{year_month_end}
			</if>
			and c.type_code = '01'
			<if test="source_attr != null and source_attr != ''">
				AND source_attr in ${source_attr}
			</if>
		</where>
		group by a.acc_year,a.acc_month,d.dept_code,d.dept_name
		order by
		a.acc_year,a.acc_month,d.dept_code asc
		)
		select * from (
		select
		acc_year,acc_month,year_month,dept_code,dept_name,
		cost_emp_amount_1,cost_emp_amount_2,cost_emp_amount_3,
		cost_mate_amount_1,cost_mate_amount_2,cost_mate_amount_3,
		cost_drug_amount_1,cost_drug_amount_2,cost_drug_amount_3,
		cost_fasset_amount_1,cost_fasset_amount_2,cost_fasset_amount_3,
		cost_iasset_amount_1,cost_iasset_amount_2,cost_iasset_amount_3,
		cost_risk_amount_1,cost_risk_amount_2,cost_risk_amount_3,
		cost_other_amount_1,cost_other_amount_2,cost_other_amount_3,
		(cost_emp_amount_1+cost_mate_amount_1+cost_drug_amount_1+cost_fasset_amount_1+cost_iasset_amount_1+cost_risk_amount_1+cost_other_amount_1)
		dir_amount,
		(cost_emp_amount_2+cost_mate_amount_2+cost_drug_amount_2+cost_fasset_amount_2+cost_iasset_amount_2+cost_risk_amount_2+cost_other_amount_2)
		idir_amount,
		(cost_emp_amount_3+cost_mate_amount_3+cost_drug_amount_3+cost_fasset_amount_3+cost_iasset_amount_3+cost_risk_amount_3+cost_other_amount_3)
		sum_amount
		from dept
		union all
		select
		null,null,null,'9999','各临床服务类科室合计',
		sum(cost_emp_amount_1),sum(cost_emp_amount_2),sum(cost_emp_amount_3),
		sum(cost_mate_amount_1),sum(cost_mate_amount_2),sum(cost_mate_amount_3),
		sum(cost_drug_amount_1),sum(cost_drug_amount_2),sum(cost_drug_amount_3),
		sum(cost_fasset_amount_1),sum(cost_fasset_amount_2),sum(cost_fasset_amount_3),
		sum(cost_iasset_amount_1),sum(cost_iasset_amount_2),sum(cost_iasset_amount_3),
		sum(cost_risk_amount_1),sum(cost_risk_amount_2),sum(cost_risk_amount_3),
		sum(cost_other_amount_1),sum(cost_other_amount_2),sum(cost_other_amount_3),
		sum((cost_emp_amount_1+cost_mate_amount_1+cost_drug_amount_1+cost_fasset_amount_1+cost_iasset_amount_1+cost_risk_amount_1+cost_other_amount_1))
		dir_amount,
		sum((cost_emp_amount_2+cost_mate_amount_2+cost_drug_amount_2+cost_fasset_amount_2+cost_iasset_amount_2+cost_risk_amount_2+cost_other_amount_2))
		idir_amount,
		sum((cost_emp_amount_3+cost_mate_amount_3+cost_drug_amount_3+cost_fasset_amount_3+cost_iasset_amount_3+cost_risk_amount_3+cost_other_amount_3))
		sum_amount
		from dept
		<!-- group by acc_year,acc_month，year_month -->
		) t
		order by
		dept_code,dept_name

	</select>

	<select id="queryAnalysisC0201" parameterType="java.util.Map"
		resultMap="c0201">
		with temp as
		(
		select group_id, hos_id, copy_code, acc_year, acc_month,
		type_code,
		type_name,
		t_1, t_2, t_3, t_4, t_5, t_6, t_7, t_8 from
		cost_c0201
		<where>
			<if test="group_id != null and group_id != ''">
				group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND acc_year || acc_month between #{year_month_begin} and
				#{year_month_end}
			</if>
			<if test="type_code != null and type_code != ''">
				AND type_code = #{type_code,jdbcType=VARCHAR}
			</if>
			<if test="type_name != null and type_name != ''">
				AND type_name = #{type_name,jdbcType=VARCHAR}
			</if>
			<if test="t_1 != null and t_1 != ''">
				AND t_1 = #{t_1,jdbcType=INTEGER}
			</if>
			<if test="t_2 != null and t_2 != ''">
				AND t_2 = #{t_2,jdbcType=INTEGER}
			</if>
			<if test="t_3 != null and t_3 != ''">
				AND t_3 = #{t_3,jdbcType=INTEGER}
			</if>
			<if test="t_4 != null and t_4 != ''">
				AND t_4 = #{t_4,jdbcType=INTEGER}
			</if>
			<if test="t_5 != null and t_5 != ''">
				AND t_5 = #{t_5,jdbcType=INTEGER}
			</if>
			<if test="t_6 != null and t_6 != ''">
				AND t_6 = #{t_6,jdbcType=INTEGER}
			</if>
			<if test="t_7 != null and t_7 != ''">
				AND t_7 = #{t_7,jdbcType=INTEGER}
			</if>
			<if test="t_8 != null and t_8 != ''">
				AND t_8 = #{t_8,jdbcType=INTEGER}
			</if>
		</where>
		)select group_id,hos_id,copy_code,acc_year,acc_month,
		type_code,type_name, t_1,t_2, t_3,t_4, t_5,t_6,t_7,t_8 from temp
		union
		all
		select null,null, null,null,null ,null, '总计', sum(t_1), sum(t_2),
		sum(t_3) ,
		sum(t_4), sum(t_5), sum(t_6),sum(t_7),sum(t_8) from temp

	</select>
	<select id="queryAnalysisC0203" parameterType="java.util.Map"
		resultMap="c0203">
		with temp as
		(
		select group_id, hos_id, copy_code, acc_year, acc_month,
		dept_code, dept_name,
		t_1, t_2, t_3, t_4, t_5, t_6, t_7, t_8, t_9, t_10
		from cost_c0203
		<where>
			<if test="group_id != null and group_id != ''">
				group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND acc_year || acc_month between #{year_month_begin} and
				#{year_month_end}
			</if>
			<if test="dept_code != null and dept_code != ''">
				AND dept_code = #{dept_code,jdbcType=VARCHAR}
			</if>
			<if test="dept_name != null and dept_name != ''">
				AND dept_name = #{dept_name,jdbcType=VARCHAR}
			</if>
			<if test="t_1 != null and t_1 != ''">
				AND t_1 = #{t_1,jdbcType=INTEGER}
			</if>
			<if test="t_2 != null and t_2 != ''">
				AND t_2 = #{t_2,jdbcType=INTEGER}
			</if>
			<if test="t_3 != null and t_3 != ''">
				AND t_3 = #{t_3,jdbcType=INTEGER}
			</if>
			<if test="t_4 != null and t_4 != ''">
				AND t_4 = #{t_4,jdbcType=INTEGER}
			</if>
			<if test="t_5 != null and t_5 != ''">
				AND t_5 = #{t_5,jdbcType=INTEGER}
			</if>
			<if test="t_6 != null and t_6 != ''">
				AND t_6 = #{t_6,jdbcType=INTEGER}
			</if>
			<if test="t_7 != null and t_7 != ''">
				AND t_7 = #{t_7,jdbcType=INTEGER}
			</if>
			<if test="t_8 != null and t_8 != ''">
				AND t_8 = #{t_8,jdbcType=INTEGER}
			</if>
			<if test="t_9 != null and t_9 != ''">
				AND t_9 = #{t_9,jdbcType=INTEGER}
			</if>
			<if test="t_10 != null and t_10 != ''">
				AND t_10 = #{t_10,jdbcType=INTEGER}
			</if>
		</where>
		)select group_id,hos_id,copy_code,acc_year,acc_month,
		dept_code,dept_name, t_1,t_2, t_3,t_4, t_5,t_6,t_7,t_8,t_9,t_10 from
		temp
		union all
		select null,null, null,null,null ,null, '总计', sum(t_1),
		sum(t_2), sum(t_3) ,
		sum(t_4), sum(t_5),
		sum(t_6),sum(t_7),sum(t_8),sum(t_9),sum(t_10) from
		temp

	</select>

	<select id="queryAnalysisC0204" parameterType="java.util.Map"
		resultMap="c0204">
		with temp as
		(
		select group_id, hos_id, copy_code, acc_year, acc_month,
		dept_code,
		dept_name,
		t_1, t_2, t_3, t_4, t_5, t_6, t_7, t_8, t_9, t_10
		from cost_c0204
		<where>
			<if test="group_id != null and group_id != ''">
				group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND acc_year || acc_month between #{year_month_begin} and
				#{year_month_end}
			</if>
			<if test="dept_code != null and dept_code != ''">
				AND dept_code = #{dept_code,jdbcType=VARCHAR}
			</if>
			<if test="dept_name != null and dept_name != ''">
				AND dept_name = #{dept_name,jdbcType=VARCHAR}
			</if>
			<if test="t_1 != null and t_1 != ''">
				AND t_1 = #{t_1,jdbcType=INTEGER}
			</if>
			<if test="t_2 != null and t_2 != ''">
				AND t_2 = #{t_2,jdbcType=INTEGER}
			</if>
			<if test="t_3 != null and t_3 != ''">
				AND t_3 = #{t_3,jdbcType=INTEGER}
			</if>
			<if test="t_4 != null and t_4 != ''">
				AND t_4 = #{t_4,jdbcType=INTEGER}
			</if>
			<if test="t_5 != null and t_5 != ''">
				AND t_5 = #{t_5,jdbcType=INTEGER}
			</if>
			<if test="t_6 != null and t_6 != ''">
				AND t_6 = #{t_6,jdbcType=INTEGER}
			</if>
			<if test="t_7 != null and t_7 != ''">
				AND t_7 = #{t_7,jdbcType=INTEGER}
			</if>
			<if test="t_8 != null and t_8 != ''">
				AND t_8 = #{t_8,jdbcType=INTEGER}
			</if>
			<if test="t_9 != null and t_9 != ''">
				AND t_9 = #{t_9,jdbcType=INTEGER}
			</if>
			<if test="t_10 != null and t_10 != ''">
				AND t_10 = #{t_10,jdbcType=INTEGER}
			</if>
		</where>
		)select group_id,hos_id,copy_code,acc_year,acc_month,
		dept_code,dept_name, t_1,t_2, t_3,t_4, t_5,t_6,t_7,t_8,t_9,t_10 from
		temp
		union all
		select null,null, null,null,null ,null, '总计', sum(t_1),
		sum(t_2), sum(t_3) ,
		sum(t_4), sum(t_5),
		sum(t_6),sum(t_7),sum(t_8),sum(t_9),sum(t_10) from
		temp

	</select>

	<select id="queryAnalysisC0205" parameterType="java.util.Map"
		resultMap="c0205">
		with temp as
		(
		select group_id, hos_id, copy_code, acc_year, acc_month,
		dept_code,
		dept_name,
		t_1, t_2, t_3, t_4, t_5, t_6, t_7, t_8, t_9, t_10
		from cost_c0205
		<where>
			<if test="group_id != null and group_id != ''">
				group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND acc_year || acc_month between #{year_month_begin} and
				#{year_month_end}
			</if>
			<if test="dept_code != null and dept_code != ''">
				AND dept_code = #{dept_code,jdbcType=VARCHAR}
			</if>
			<if test="dept_name != null and dept_name != ''">
				AND dept_name = #{dept_name,jdbcType=VARCHAR}
			</if>
			<if test="t_1 != null and t_1 != ''">
				AND t_1 = #{t_1,jdbcType=INTEGER}
			</if>
			<if test="t_2 != null and t_2 != ''">
				AND t_2 = #{t_2,jdbcType=INTEGER}
			</if>
			<if test="t_3 != null and t_3 != ''">
				AND t_3 = #{t_3,jdbcType=INTEGER}
			</if>
			<if test="t_4 != null and t_4 != ''">
				AND t_4 = #{t_4,jdbcType=INTEGER}
			</if>
			<if test="t_5 != null and t_5 != ''">
				AND t_5 = #{t_5,jdbcType=INTEGER}
			</if>
			<if test="t_6 != null and t_6 != ''">
				AND t_6 = #{t_6,jdbcType=INTEGER}
			</if>
			<if test="t_7 != null and t_7 != ''">
				AND t_7 = #{t_7,jdbcType=INTEGER}
			</if>
			<if test="t_8 != null and t_8 != ''">
				AND t_8 = #{t_8,jdbcType=INTEGER}
			</if>
			<if test="t_9 != null and t_9 != ''">
				AND t_9 = #{t_9,jdbcType=INTEGER}
			</if>
			<if test="t_10 != null and t_10 != ''">
				AND t_10 = #{t_10,jdbcType=INTEGER}
			</if>
		</where>
		)select group_id,hos_id,copy_code,acc_year,acc_month,
		dept_code,dept_name, t_1,t_2, t_3,t_4, t_5,t_6,t_7,t_8,t_9,t_10 from
		temp
		union all
		select null,null, null,null,null ,null, '总计', sum(t_1),
		sum(t_2), sum(t_3) ,
		sum(t_4), sum(t_5),
		sum(t_6),sum(t_7),sum(t_8),sum(t_9),sum(t_10) from
		temp

	</select>

	<select id="queryAnalysisC0303" parameterType="java.util.Map"
		resultMap="c0303">
		with temp as
		(
		select acc_year, item_code, item_name, t_1, t_2,
		t_3,
		t_4,sum(t_1 +
		t_3) as t_9, sum(t_2 + t_4) as t_10
		from cost_c0303
		<where>
			<if test="year_month_begin != null and year_month_begin != ''">
				AND acc_year || '' || acc_month &gt;= #{year_month_begin}
			</if>
			<if test="year_month_end != null and year_month_end != ''">
				and acc_year || '' || acc_month &lt;= #{year_month_end}
			</if>
		</where>
		group by acc_year, item_code, item_name, t_1, t_2, t_3, t_4
		order by
		item_code
		)select acc_year,
		item_code,item_name, t_1,t_2, t_3,t_4,
		t_9,t_10 from temp
		union all
		select null,null, '总计', sum(t_1), sum(t_2),
		sum(t_3) , sum(t_4),
		sum(t_9),sum(t_10) from temp

	</select>

	<select id="queryAnalysisC0304" parameterType="java.util.Map"
		resultMap="c0309">
		with temp as
		(
		select acc_year, acc_month, item_code, item_name, t_1,
		t_2,
		t_3, t_4,
		t_5, t_6, t_7,t_8, t_9, t_10, t_11, t_12 from cost_c0304
		<where>
			<if test="year_month_begin != null and year_month_begin != ''">
				AND acc_year || '' || acc_month &gt;= #{year_month_begin}
			</if>
			<if test="year_month_end != null and year_month_end != ''">
				and acc_year || '' || acc_month &lt;= #{year_month_end}
			</if>
		</where>
		order by item_code
		)select acc_year,acc_month,
		item_code,item_name,
		t_1,t_2, t_3,t_4, t_5,t_6,t_7,t_8,t_9,t_10,t_11,t_12 from temp
		union
		all
		select null,null ,null, '总计', sum(t_1), sum(t_2), sum(t_3) ,
		sum(t_4),
		sum(t_5),
		sum(t_6),sum(t_7),sum(t_8),sum(t_9),sum(t_10),sum(t_11),sum(t_12) from
		temp

	</select>
	<select id="queryAnalysisC0401" parameterType="java.util.Map"
		resultMap="c0401">
		with temp as
		(
		select group_id, hos_id, copy_code, acc_year, acc_month,
		dept_code,
		dept_name,
		t_1, t_2, t_3, t_4, t_5, t_6, t_7, t_8, t_9, t_10
		from cost_c0401
		<where>
			<if test="group_id != null and group_id != ''">
				group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if
				test="year_month_begin != null and year_month_begin != '' and year_month_end != null and year_month_end != ''">
				AND acc_year || acc_month between #{year_month_begin} and
				#{year_month_end}
			</if>
			<if test="dept_code != null and dept_code != ''">
				AND dept_code = #{dept_code,jdbcType=VARCHAR}
			</if>
			<if test="dept_name != null and dept_name != ''">
				AND dept_name = #{dept_name,jdbcType=VARCHAR}
			</if>
			<if test="t_1 != null and t_1 != ''">
				AND t_1 = #{t_1,jdbcType=INTEGER}
			</if>
			<if test="t_2 != null and t_2 != ''">
				AND t_2 = #{t_2,jdbcType=INTEGER}
			</if>
			<if test="t_3 != null and t_3 != ''">
				AND t_3 = #{t_3,jdbcType=INTEGER}
			</if>
			<if test="t_4 != null and t_4 != ''">
				AND t_4 = #{t_4,jdbcType=INTEGER}
			</if>
			<if test="t_5 != null and t_5 != ''">
				AND t_5 = #{t_5,jdbcType=INTEGER}
			</if>
			<if test="t_6 != null and t_6 != ''">
				AND t_6 = #{t_6,jdbcType=INTEGER}
			</if>
			<if test="t_7 != null and t_7 != ''">
				AND t_7 = #{t_7,jdbcType=INTEGER}
			</if>
			<if test="t_8 != null and t_8 != ''">
				AND t_8 = #{t_8,jdbcType=INTEGER}
			</if>
			<if test="t_9 != null and t_9 != ''">
				AND t_9 = #{t_9,jdbcType=INTEGER}
			</if>
			<if test="t_10 != null and t_10 != ''">
				AND t_10 = #{t_10,jdbcType=INTEGER}
			</if>
		</where>
		)select group_id,hos_id,copy_code,acc_year,acc_month,
		dept_code,dept_name, t_1,t_2, t_3,t_4, t_5,t_6,t_7,t_8,t_9,t_10 from
		temp
		union all
		select null, null, null, null, null
		, '总计', null,
		sum(t_1),sum(t_2)
		, sum(t_3), sum(t_4), sum(t_3)/sum(t_1) t_5
		,
		sum(t_4)/sum(t_2) t_6, sum(t_7) , sum(t_8)
		, sum(t_7)/sum(t_1)
		t_9,sum(t_8)/sum(t_2)
		from temp

	</select>


	<select id="queryCostDeptCost" parameterType="java.util.Map"
		resultMap="costDeptCost">
		with
		aaa
		as(
		select a.group_id, a.hos_id, a.copy_code, a.acc_year,
		a.acc_month,b.dept_code,b.dept_name,a.dir_amount,
		a.dir_man_amount,a.dir_ass_amount , a.dir_med_amount
		from
		COST_DEPT_COST a

		left join hos_dept_dict b on b.group_id = a.group_id
		and b.hos_id =
		a.hos_id and b.dept_id = a.dept_id and b.dept_no =
		a.dept_no
		left join hos_dept hd on hd.group_id=b.group_id and
		hd.hos_id=b.hos_id and
		hd.dept_id=b.dept_id
		left join hos_dept_kind hdk
		on hd.group_id =hdk.group_id and
		hdk.hos_id=hd.hos_id and
		hd.kind_code=hdk.kind_code
		<where>
            <if test="group_id != null and group_id != ''">
				a.group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND a.acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND a.acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="cost_item_id != null and cost_item_id != ''">
				AND a.cost_item_id = #{cost_item_id,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND a.dept_id = #{dept_id,jdbcType=VARCHAR}
			</if>
			<if test="source_id != null and source_id != ''">
				AND a.source_id = #{source_id,jdbcType=VARCHAR}
			</if>
		</where>
		order by a.cost_item_id
		)
		,
		bbb as(
		select a.group_id, a.hos_id,
		a.copy_code, a.acc_year,
		a.acc_month,a.dir_amount,
		a.dir_man_amount,a.dir_ass_amount ,
		a.dir_med_amount
		from COST_DEPT_COST
		a

		left join hos_dept_dict b on b.group_id = a.group_id and b.hos_id =
		a.hos_id and b.dept_id = a.dept_id and b.dept_no = a.dept_no
		left join
		hos_dept hd on hd.group_id=b.group_id and hd.hos_id=b.hos_id and
		hd.dept_id=b.dept_id
		left join hos_dept_kind hdk on hd.group_id
		=hdk.group_id and
		hdk.hos_id=hd.hos_id and hd.kind_code=hdk.kind_code
		<where>
            <if test="group_id != null and group_id != ''">
				 a.group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND a.acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND a.acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="cost_item_id != null and cost_item_id != ''">
				AND a.cost_item_id = #{cost_item_id,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND a.dept_id = #{dept_id,jdbcType=VARCHAR}
			</if>
			<if test="source_id != null and source_id != ''">
				AND a.source_id = #{source_id,jdbcType=VARCHAR}
			</if>
		</where>

		order by a.cost_item_id
		)
		select acc_year,
		acc_month,dept_code,dept_name,dir_amount,
		dir_man_amount,dir_ass_amount , dir_med_amount from(
		select acc_year,
		acc_month,dept_code,dept_name,sum(dir_amount) dir_amount
        , sum(dir_man_amount) dir_man_amount, sum(dir_ass_amount) dir_ass_amount, sum(dir_med_amount) dir_med_amount
		from aaa
		group by  acc_year, acc_month, dept_code, dept_name
		union all
		select
		'', '','','合计',sum(dir_amount) as dir_amount , sum(dir_man_amount) as
		dir_man_amount,sum(dir_ass_amount) as dir_ass_amount ,sum(
		dir_med_amount) as dir_med_amount
		from bbb 
		order by dept_code
		)

	</select>

	<select id="queryCostFLCost" parameterType="java.util.Map"
		resultMap="costDeptCost">
		with aaa as(
		select c.cost_item_id
		,cid.cost_item_code,cid.cost_item_name,sum(decode(hdk.kind_code,01,c.dir_amount,0))
		as dir_lc_amount,sum(decode(hdk.kind_code,02,c.dir_amount,0)) as
		dir_yj_amount
		,sum(decode(hdk.kind_code,03,c.dir_amount,0))as
		dir_yf_amount,sum(decode(hdk.kind_code,04,c.dir_amount,0)) as
		dir_xz_amount
		from COST_DEPT_COST c
		left join hos_dept hd on
		hd.group_id=c.group_id and hd.hos_id=c.hos_id and
		hd.dept_id=c.dept_id
		left join hos_dept_kind hdk on hdk.group_id=hd.group_id and
		hdk.hos_id=hd.hos_id and hdk.kind_code=hd.kind_code
		left join
		cost_item_dict cid on cid.group_id=c.group_id and
		cid.hos_id=c.hos_id
		and cid.cost_item_id=c.cost_item_id
		<where>
		    <if test="group_id != null and group_id != ''">
				 c.group_id = #{group_id,jdbcType=INTEGER} 
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND c.hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND c.copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND c.acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND c.acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="cost_item_id != null and cost_item_id != ''">
				AND c.cost_item_id = #{cost_item_id,jdbcType=INTEGER}
			</if>
			<if test="source_id != null and source_id != ''">
				AND c.source_id = #{source_id,jdbcType=INTEGER}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND c.dept_id = #{dept_id,jdbcType=INTEGER}
			</if>
		</where>
		group by c.cost_item_id,cid.cost_item_code,cid.cost_item_name

		)

		select
		cost_item_id,cost_item_code,cost_item_name,dir_lc_amount,dir_yj_amount,dir_yf_amount,dir_xz_amount,sum_dir
		from(
		select 0 as cost_item_id,'' as cost_item_code,'合计' as
		cost_item_name,sum(dir_lc_amount) as dir_lc_amount,sum(dir_yj_amount)
		as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa

		union all

		select 3 as cost_item_id,'' as
		cost_item_code,'1.人员经费' as
		cost_item_name,sum(dir_lc_amount) as
		dir_lc_amount,sum(dir_yj_amount)
		as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '01%'
		union all
		select 4 as
		cost_item_id,'' as cost_item_code,' (1)工资福利支出' as
		cost_item_name,sum(dir_lc_amount) as dir_lc_amount,sum(dir_yj_amount)
		as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '0101%'
		union all
		select
		cost_item_id,cost_item_code,cost_item_name,sum(dir_lc_amount)as
		dir_lc_amount,sum(dir_yj_amount) as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '0101%'
		group by cost_item_id
		,cost_item_code,cost_item_name
		union all
		select 39 as cost_item_id,'' as
		cost_item_code,' (2)对个人和家庭补助支出' as
		cost_item_name,sum(dir_lc_amount) as
		dir_lc_amount,sum(dir_yj_amount)
		as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '0102%'
		union all
		select
		cost_item_id,cost_item_code,cost_item_name,sum(dir_lc_amount)as
		dir_lc_amount,sum(dir_yj_amount) as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '0102%'
		group by cost_item_id
		,cost_item_code,cost_item_name

		union all

		select 58 as cost_item_id,'' as
		cost_item_code,'2.卫生材料费' as
		cost_item_name,sum(dir_lc_amount) as
		dir_lc_amount,sum(dir_yj_amount)
		as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '02%'
		union all
		select
		cost_item_id,cost_item_code,cost_item_name,sum(dir_lc_amount)as
		dir_lc_amount,sum(dir_yj_amount) as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '02%'
		group by cost_item_id
		,cost_item_code,cost_item_name

		union all

		select 76 as cost_item_id,'' as
		cost_item_code,'3.药品费' as
		cost_item_name,sum(dir_lc_amount) as
		dir_lc_amount,sum(dir_yj_amount)
		as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '03%'
		union all
		select
		cost_item_id,cost_item_code,cost_item_name,sum(dir_lc_amount)as
		dir_lc_amount,sum(dir_yj_amount) as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '03%'
		group by cost_item_id
		,cost_item_code,cost_item_name

		union all
		select
		cost_item_id,cost_item_code,'4.固定资产折旧费',sum(dir_lc_amount)as
		dir_lc_amount,sum(dir_yj_amount) as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '04%'
		group by cost_item_id
		,cost_item_code,cost_item_name

		union all
		select
		cost_item_id,cost_item_code,'5.无形资产摊销费',sum(dir_lc_amount)as
		dir_lc_amount,sum(dir_yj_amount) as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '05%'
		group by cost_item_id
		,cost_item_code,cost_item_name

		union all
		select
		cost_item_id,cost_item_code,'6.提取医疗风险基金',sum(dir_lc_amount)as
		dir_lc_amount,sum(dir_yj_amount) as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '06%'
		group by cost_item_id
		,cost_item_code,cost_item_name

		union all

		select 86 as cost_item_id,'' as
		cost_item_code,'7.其他费用' as
		cost_item_name,sum(dir_lc_amount) as
		dir_lc_amount,sum(dir_yj_amount)
		as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '07%'
		union all
		select
		cost_item_id,cost_item_code,cost_item_name,sum(dir_lc_amount)as
		dir_lc_amount,sum(dir_yj_amount) as dir_yj_amount,sum(dir_yf_amount)as
		dir_yf_amount,sum(dir_xz_amount)as
		dir_xz_amount,sum(dir_lc_amount+dir_yj_amount+dir_yf_amount+dir_xz_amount)as
		sum_dir
		from aaa
		where cost_item_code like '07%'
		group by cost_item_id
		,cost_item_code,cost_item_name
		)

		order by cost_item_id

	</select>

	<select id="queryCostGeneralHos" parameterType="java.util.Map"
		resultMap="CostGeneralHosMap">

		with temp as (
		select
		t.dept_code
		,t.dept_name
		,t.item_code
		,t.item_name
		,t1.income_money
		,t2.cost_money
		,t3.income_money_med
		,t5.workload
		from (
		select hdd.dept_id, hdd.dept_no, hdd.dept_code,
		hdd.dept_name,
		ada.natur_code as item_code
		, decode(ada.natur_code,
		'01', '门诊', '02', '住院') as item_name
		from hos_dept_dict hdd
		left join
		acc_dept_attr ada on hdd.group_id = ada.group_id
		and hdd.hos_id =
		ada.hos_id
		and hdd.dept_id = ada.dept_id
		where hdd.group_id =
		#{group_id}
		and hdd.hos_id = #{hos_id}
		and hdd.is_stop = '0'
		and
		hdd.is_last = '1'
		and ada.natur_code in ('01', '02')
		) t
		left join (
		select a.dept_id, a.dept_no, sum(a.income_money) as income_money
		from
		v_cost_appl_dept_income a
		where a.group_id = #{group_id}
		and a.hos_id =
		#{hos_id}
		and a.copy_code = #{copy_code}
		and a.acc_year || a.acc_month
		between #{year_month_begin} and
		#{year_month_end}
		group by a.dept_id,
		a.dept_no
		) t1 on t.dept_id = t1.dept_id
		and t.dept_no = t1.dept_no
		left
		join (
		select a.dept_id, a.dept_no,sum(nvl(a.t2, 0)) as cost_money
		from
		v_cost_dept_cost_sum a
		where a.group_id = #{group_id}
		and a.hos_id =
		#{hos_id}
		and a.copy_code = #{copy_code}
		and a.acc_year || a.acc_month
		between #{year_month_begin} and
		#{year_month_end}
		group by a.dept_id,
		a.dept_no
		) t2 on t.dept_id = t2.dept_id
		and t.dept_no = t2.dept_no
		left
		join (
		select t1.appl_dept_id as dept_id, t1.appl_dept_no as dept_no,
		sum(nvl(t1.money,0)) as income_money_med
		from cost_income t1
		left join
		cost_charge_kind_arrt t2 on t1.group_id = t2.group_id
		and t1.hos_id =
		t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.charge_kind_id =
		t2.charge_kind_id
		left join acc_dept_attr t3 on t3.group_id =
		t1.group_id
		and t3.hos_id = t1.hos_id
		and t3.dept_id = t1.appl_dept_id
		where t1.group_id = #{group_id}
		and t1.hos_id = #{hos_id}
		and
		t1.copy_code = #{copy_code}
		and t1.acc_year || t1.acc_month between
		#{year_month_begin} and
		#{year_month_end}
		and t2.income_type_id = '2'
		group by t1.appl_dept_id, t1.appl_dept_no
		) t3 on t.dept_id =
		t3.dept_id
		and t.dept_no = t3.dept_no
		left join (
		select dept_id,
		dept_no, sum(clinic_num) as workload
		from cost_clinic_work
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		union all
		select dept_id,
		dept_no, sum(bed_use_day_num) as workload
		from cost_inhos_work
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		) t5 on t.dept_id =
		t5.dept_id
		and t.dept_no = t5.dept_no
		)
		select
		item_code
		,item_name
		,sum(nvl(income_money,0)) t_1
		,sum(nvl(cost_money,0)) t_2
		,sum(nvl(income_money,0)) - sum(nvl(cost_money,0)) t_3
		,(sum(nvl(income_money,0)) - sum(nvl(cost_money,0)))/sum(cost_money) *
		100 t_4
		,(sum(nvl(income_money,0)) -
		sum(nvl(cost_money,0)))/sum(income_money)
		* 100 t_5
		,sum(nvl(income_money_med,0))/ sum(income_money) * 100 as t_6
		,sum(nvl(income_money,0)) / sum(workload) t_7
		,sum(nvl(cost_money,0)) /
		sum(workload) t_8
		,(sum(nvl(income_money,0)) - sum(nvl(cost_money,0)))
		/ sum(workload) t_9
		from temp
		group by item_code,item_name
		union all
		select
		'999999'
		,'合计'
		,sum(nvl(income_money,0)) t_1
		,sum(nvl(cost_money,0)) t_2
		,sum(nvl(income_money,0)) -
		sum(nvl(cost_money,0)) t_3
		,(sum(nvl(income_money,0)) -
		sum(nvl(cost_money,0)))/sum(cost_money) * 100 t_4
		,(sum(nvl(income_money,0)) - sum(nvl(cost_money,0)))/sum(income_money)
		* 100 t_5
		,sum(nvl(income_money_med,0))/ sum(income_money) * 100 as t_6
		,sum(nvl(income_money,0)) / sum(workload) t_7
		,sum(nvl(cost_money,0)) /
		sum(workload) t_8
		,(sum(nvl(income_money,0)) - sum(nvl(cost_money,0)))
		/ sum(workload) t_9
		from temp
		order by item_code


	</select>

	<select id="queryCostGeneralHosMed" parameterType="java.util.Map"
		resultMap="CostGeneralHosMedMap">
		with temp as
		(select t.dept_code
		,t.dept_name
		,t.item_code
		,t.item_name
		,t1.income_money income_money_nmed
		,t2.cost_money
		cost_money_nmed
		,t3.income_money income_money_ymed
		,t4.cost_money
		cost_money_ymed
		from (select hdd.dept_id,
		hdd.dept_no,
		hdd.dept_code,
		hdd.dept_name,
		ada.natur_code as item_code,
		decode(ada.natur_code, '01',
		'门诊', '02', '住院') as item_name
		from hos_dept_dict hdd
		left join
		acc_dept_attr ada
		on hdd.group_id = ada.group_id
		and hdd.hos_id =
		ada.hos_id
		and hdd.dept_id = ada.dept_id
		where hdd.group_id =
		#{group_id}
		and hdd.hos_id = #{hos_id}
		and hdd.is_stop = '0'
		and
		hdd.is_last = '1'
		and ada.natur_code in ('01', '02')) t
		left join
		(select t1.appl_dept_id as dept_id,
		t1.appl_dept_no as dept_no,
		sum(t1.money) as income_money
		from cost_income t1
		left join
		cost_charge_kind_arrt t2
		on t1.group_id = t2.group_id
		and t1.hos_id =
		t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.charge_kind_id =
		t2.charge_kind_id
		left join acc_dept_attr t3
		on t3.group_id =
		t1.group_id
		and t3.hos_id = t1.hos_id
		and t3.dept_id = t1.appl_dept_id
		where t1.group_id = #{group_id}
		and t1.hos_id = #{hos_id}
		and
		t1.copy_code = #{copy_code}
		and t1.acc_year || t1.acc_month between
		#{year_month_begin} and
		#{year_month_end}
		and t2.income_type_id != '2'
		group by t1.appl_dept_id, t1.appl_dept_no) t1
		on t.dept_id = t1.dept_id
		and t.dept_no = t1.dept_no
		left join (select a.dept_id, a.dept_no,
		sum(nvl(a.t2, 0)) as cost_money
		from v_cost_dept_cost_sum a
		where
		a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code =
		#{copy_code}
		and a.acc_year || a.acc_month between #{year_month_begin}
		and
		#{year_month_end}
		and a.natur_code in ('01', '02')
		and a.cost_type_id
		!= '3'
		group by a.dept_id, a.dept_no) t2
		on t.dept_id = t2.dept_id
		and
		t.dept_no = t2.dept_no
		left join (select t1.appl_dept_id as dept_id,
		t1.appl_dept_no as dept_no,
		sum(t1.money) as income_money
		from
		cost_income t1
		left join cost_charge_kind_arrt t2
		on t1.group_id =
		t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.charge_kind_id = t2.charge_kind_id
		left join acc_dept_attr t3
		on
		t3.group_id = t1.group_id
		and t3.hos_id = t1.hos_id
		and t3.dept_id =
		t1.appl_dept_id
		where t1.group_id = #{group_id}
		and t1.hos_id =
		#{hos_id}
		and t1.copy_code = #{copy_code}
		and t1.acc_year ||
		t1.acc_month between #{year_month_begin} and
		#{year_month_end}
		and
		t2.income_type_id = '2'
		group by t1.appl_dept_id, t1.appl_dept_no) t3
		on t.dept_id = t3.dept_id
		and t.dept_no = t3.dept_no
		left join (select
		a.dept_id, a.dept_no, sum(nvl(a.t2, 0)) as cost_money
		from
		v_cost_dept_cost_sum a
		where a.group_id = #{group_id}
		and a.hos_id =
		#{hos_id}
		and a.copy_code = #{copy_code}
		and a.acc_year || a.acc_month
		between #{year_month_begin} and
		#{year_month_end}
		and a.natur_code in
		('01', '02')
		and a.cost_type_id = '3'
		group by a.dept_id, a.dept_no) t4
		on t.dept_id = t4.dept_id
		and t.dept_no = t4.dept_no)
		select item_code
		,item_name
		,sum(nvl(income_money_nmed,0)) t_1
		,sum(nvl(cost_money_nmed,0)) t_2
		,sum(nvl(income_money_nmed,0)) -
		sum(nvl(cost_money_nmed,0)) t_3
		,(sum(nvl(income_money_nmed,0)) -
		sum(nvl(cost_money_nmed,0))) / sum(cost_money_nmed) * 100 t_4
		,(sum(nvl(income_money_nmed,0)) - sum(nvl(cost_money_nmed,0))) /
		sum(income_money_nmed) * 100 t_5
		,sum(nvl(income_money_ymed,0)) t_6
		,sum(nvl(cost_money_ymed,0)) t_7
		,sum(nvl(income_money_ymed,0)) -
		sum(nvl(cost_money_ymed,0)) t_8
		,(sum(nvl(income_money_ymed,0)) -
		sum(nvl(cost_money_ymed,0))) / sum(cost_money_ymed) * 100 t_9
		,(sum(nvl(income_money_ymed,0)) - sum(nvl(cost_money_ymed,0))) /
		sum(income_money_ymed) * 100 t_10
		from temp
		group by item_code,item_name
		union all
		select '999999'
		,'合计'
		,sum(nvl(income_money_nmed,0)) t_1
		,sum(nvl(cost_money_nmed,0)) t_2
		,sum(nvl(income_money_nmed,0)) -
		sum(nvl(cost_money_nmed,0)) t_3
		,(sum(nvl(income_money_nmed,0)) -
		sum(nvl(cost_money_nmed,0))) / sum(cost_money_nmed) * 100 t_4
		,(sum(nvl(income_money_nmed,0)) - sum(nvl(cost_money_nmed,0))) /
		sum(income_money_nmed)* 100 t_5
		,sum(nvl(income_money_ymed,0)) t_6
		,sum(nvl(cost_money_ymed,0)) t_7
		,sum(nvl(income_money_ymed,0)) -
		sum(nvl(cost_money_ymed,0)) t_8
		,(sum(nvl(income_money_ymed,0)) -
		sum(nvl(cost_money_ymed,0))) / sum(cost_money_ymed) * 100 t_9
		,(sum(nvl(income_money_ymed,0)) - sum(nvl(cost_money_ymed,0))) /
		sum(income_money_ymed) * 100 t_10
		from temp
		order by item_code


	</select>

	<select id="queryCostGeneralDetailHos" parameterType="java.util.Map"
		resultMap="CostGeneralDetailHosMap">

		with temp as (
		select
		t.dept_code
		,t.dept_name
		,t.item_code
		,t.item_name
		,t1.income_money
		,t2.cost_money
		,t3.income_money_med
		,t5.workload
		from (
		select hdd.dept_id, hdd.dept_no, hdd.dept_code, hdd.dept_name,
		ada.natur_code as item_code
		, decode(ada.natur_code, '01', '门诊', '02',
		'住院') as item_name
		from hos_dept_dict hdd
		left join acc_dept_attr ada on
		hdd.group_id = ada.group_id
		and hdd.hos_id = ada.hos_id
		and hdd.dept_id
		= ada.dept_id
		<where>
			hdd.group_id = #{group_id}
			and hdd.hos_id = #{hos_id}
			and hdd.is_stop =
			'0'
			and hdd.is_last = '1'
			and ada.natur_code in ('01', '02')
			<if test="natur_code == 01 and natur_code == '01'">
				and ada.natur_code = #{natur_code}
			</if>
			<if test="natur_code == 02 and natur_code == '02'">
				and ada.natur_code = #{natur_code}
			</if>
		</where>
		) t
		left join (
		select a.dept_id, a.dept_no, sum(a.income_money) as
		income_money
		from v_cost_appl_dept_income a
		where a.group_id =
		#{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		and
		a.acc_year || a.acc_month between #{year_month_begin} and
		#{year_month_end}
		group by a.dept_id, a.dept_no
		) t1 on t.dept_id =
		t1.dept_id
		and t.dept_no = t1.dept_no
		left join (
		select a.dept_id,
		a.dept_no,sum(nvl(a.t2, 0)) as cost_money
		from v_cost_dept_cost_sum a
		where a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code
		= #{copy_code}
		and a.acc_year || a.acc_month between
		#{year_month_begin} and
		#{year_month_end}
		group by a.dept_id, a.dept_no
		) t2 on t.dept_id = t2.dept_id
		and t.dept_no = t2.dept_no
		left join (
		select t1.appl_dept_id as dept_id, t1.appl_dept_no as dept_no,
		sum(nvl(t1.money,0)) as income_money_med
		from cost_income t1
		left join
		cost_charge_kind_arrt t2 on t1.group_id = t2.group_id
		and t1.hos_id =
		t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.charge_kind_id =
		t2.charge_kind_id
		left join acc_dept_attr t3 on t3.group_id =
		t1.group_id
		and t3.hos_id = t1.hos_id
		and t3.dept_id = t1.appl_dept_id
		where t1.group_id = #{group_id}
		and t1.hos_id = #{hos_id}
		and
		t1.copy_code = #{copy_code}
		and t1.acc_year || t1.acc_month between
		#{year_month_begin} and
		#{year_month_end}
		and t2.income_type_id = '2'
		group by t1.appl_dept_id, t1.appl_dept_no
		) t3 on t.dept_id =
		t3.dept_id
		and t.dept_no = t3.dept_no
		left join (
		select dept_id,
		dept_no, sum(clinic_num) as workload
		from cost_clinic_work
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		union all
		select dept_id,
		dept_no, sum(bed_use_day_num) as workload
		from cost_inhos_work
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		) t5 on t.dept_id =
		t5.dept_id
		and t.dept_no = t5.dept_no
		)
		select
		  dept_code
		, dept_name
		, sum(nvl(income_money, 0)) as t_1
		, sum(nvl(cost_money, 0)) as t_2
		, sum(nvl(income_money, 0)) - sum(nvl(cost_money, 0)) as t_3
		, decode(sum(nvl(cost_money, 0)), 0, 0, (sum(nvl(income_money, 0)) - sum(nvl(cost_money, 0))) / sum(cost_money) * 100) as t_4
	    , decode(sum(nvl(income_money, 0)), 0, 0, (sum(nvl(income_money,0)) -sum(nvl(cost_money,0)))/sum(income_money)* 100) as t_5
		, decode(sum(nvl(income_money,0)),0,0,sum(nvl(income_money_med, 0)) / sum(income_money) * 100) t_6
		, decode(sum(nvl(workload, 0)), 0, 0, sum(nvl(income_money, 0)) / sum(workload)) as t_7
        , decode(sum(nvl(workload, 0)), 0, 0, sum(nvl(cost_money, 0)) / sum(workload)) as t_8
        , decode(sum(nvl(workload, 0)), 0, 0,  (sum(nvl(income_money, 0)) - sum(nvl(cost_money, 0))) / sum(workload)) as t_9
		from temp
		group by dept_code,dept_name
		union all
		select
		''
		,'合计'
	    , sum(nvl(income_money, 0)) as t_1
		, sum(nvl(cost_money, 0)) as t_2
		, sum(nvl(income_money, 0)) - sum(nvl(cost_money, 0)) as t_3
		, decode(sum(nvl(cost_money, 0)), 0, 0, (sum(nvl(income_money, 0)) - sum(nvl(cost_money, 0))) / sum(cost_money) * 100) as t_4
	    , decode(sum(nvl(income_money, 0)), 0, 0, (sum(nvl(income_money,0)) -sum(nvl(cost_money,0)))/sum(income_money)* 100) as t_5
		, decode(sum(nvl(income_money,0)),0,0,sum(nvl(income_money_med, 0)) / sum(income_money) * 100) t_6
		, decode(sum(nvl(workload, 0)), 0, 0, sum(nvl(income_money, 0)) / sum(workload)) as t_7
        , decode(sum(nvl(workload, 0)), 0, 0, sum(nvl(cost_money, 0)) / sum(workload)) as t_8
        , decode(sum(nvl(workload, 0)), 0, 0,  (sum(nvl(income_money, 0)) - sum(nvl(cost_money, 0))) / sum(workload)) as t_9
		from temp
		order by dept_code
	</select>

	<select id="queryCostGeneralDetailMedHos" parameterType="java.util.Map"
		resultMap="CostGeneralDetailHosMedMap">

		with temp as
		(select t.dept_code
		,t.dept_name
		,t.item_code
		,t.item_name
		,t1.income_money income_money_nmed
		,t2.cost_money cost_money_nmed
		,t3.income_money income_money_ymed
		,t4.cost_money cost_money_ymed
		from
		(select hdd.dept_id,
		hdd.dept_no,
		hdd.dept_code,
		hdd.dept_name,
		ada.natur_code as item_code,
		decode(ada.natur_code, '01', '门诊', '02',
		'住院') as item_name
		from hos_dept_dict hdd
		left join acc_dept_attr ada
		on
		hdd.group_id = ada.group_id
		and hdd.hos_id = ada.hos_id
		and hdd.dept_id
		= ada.dept_id
		<where>
			hdd.group_id = #{group_id}
			and hdd.hos_id = #{hos_id}
			and hdd.is_stop =
			'0'
			and hdd.is_last = '1'
			and ada.natur_code in ('01', '02')
			<if test="natur_code == 01 and natur_code == '01'">
				and ada.natur_code = #{natur_code}
			</if>
			<if test="natur_code == 02 and natur_code == '02'">
				and ada.natur_code = #{natur_code}
			</if>
		</where>
		) t
		left join (select t1.appl_dept_id as dept_id,
		t1.appl_dept_no as
		dept_no,
		sum(t1.money) as income_money
		from cost_income t1
		left join
		cost_charge_kind_arrt t2
		on t1.group_id = t2.group_id
		and t1.hos_id =
		t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.charge_kind_id =
		t2.charge_kind_id
		left join acc_dept_attr t3
		on t3.group_id =
		t1.group_id
		and t3.hos_id = t1.hos_id
		and t3.dept_id = t1.appl_dept_id
		where t1.group_id = #{group_id}
		and t1.hos_id = #{hos_id}
		and
		t1.copy_code = #{copy_code}
		and t1.acc_year || t1.acc_month between
		#{year_month_begin} and
		#{year_month_end}
		and t2.income_type_id != '2'
		group by t1.appl_dept_id, t1.appl_dept_no) t1
		on t.dept_id = t1.dept_id
		and t.dept_no = t1.dept_no
		left join (select a.dept_id, a.dept_no,
		sum(nvl(a.t2, 0)) as cost_money
		from v_cost_dept_cost_sum a
		where
		a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code =
		#{copy_code}
		and a.acc_year || a.acc_month between #{year_month_begin}
		and
		#{year_month_end}
		and a.natur_code in ('01', '02')
		and a.cost_type_id
		!= '3'
		group by a.dept_id, a.dept_no) t2
		on t.dept_id = t2.dept_id
		and
		t.dept_no = t2.dept_no
		left join (select t1.appl_dept_id as dept_id,
		t1.appl_dept_no as dept_no,
		sum(t1.money) as income_money
		from
		cost_income t1
		left join cost_charge_kind_arrt t2
		on t1.group_id =
		t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code = t2.copy_code
		and t1.charge_kind_id = t2.charge_kind_id
		left join acc_dept_attr t3
		on
		t3.group_id = t1.group_id
		and t3.hos_id = t1.hos_id
		and t3.dept_id =
		t1.appl_dept_id
		where t1.group_id = #{group_id}
		and t1.hos_id =
		#{hos_id}
		and t1.copy_code = #{copy_code}
		and t1.acc_year ||
		t1.acc_month between #{year_month_begin} and
		#{year_month_end}
		and
		t2.income_type_id = '2'
		group by t1.appl_dept_id, t1.appl_dept_no) t3
		on t.dept_id = t3.dept_id
		and t.dept_no = t3.dept_no
		left join (select
		a.dept_id, a.dept_no, sum(nvl(a.t2, 0)) as cost_money
		from
		v_cost_dept_cost_sum a
		where a.group_id = #{group_id}
		and a.hos_id =
		#{hos_id}
		and a.copy_code = #{copy_code}
		and a.acc_year || a.acc_month
		between #{year_month_begin} and
		#{year_month_end}
		and a.natur_code in
		('01', '02')
		and a.cost_type_id = '3'
		group by a.dept_id, a.dept_no) t4
		on t.dept_id = t4.dept_id
		and t.dept_no = t4.dept_no)
		select dept_code
		,dept_name
		,sum(nvl(income_money_nmed,0)) t_1
		,sum(nvl(cost_money_nmed,0)) t_2
		,sum(nvl(income_money_nmed,0)) - sum(nvl(cost_money_nmed,0)) t_3
		,decode(sum(nvl(cost_money_nmed, 0)), 0, 0, (sum(nvl(income_money_nmed,0)) - sum(nvl(cost_money_nmed,0))) / sum(cost_money_nmed) * 100) as t_4
		,decode(sum(nvl(income_money_nmed, 0)), 0, 0,(sum(nvl(income_money_nmed,0)) - sum(nvl(cost_money_nmed,0))) / sum(income_money_nmed) * 100) as t_5
		,sum(nvl(income_money_ymed,0)) t_6
		,sum(nvl(cost_money_ymed,0)) t_7
		,decode(sum(nvl(cost_money_ymed, 0)), 0, 0, sum(nvl(income_money_ymed,0)) - sum(nvl(cost_money_ymed,0)) ) as t_8
		,decode(sum(nvl(cost_money_nmed, 0)), 0, 0,(sum(nvl(income_money_ymed,0)) - sum(nvl(cost_money_ymed,0))) / sum(cost_money_nmed) * 100) as t_9
		,decode(sum(nvl(cost_money_nmed, 0)), 0, 0, (sum(nvl(income_money_ymed,0)) - sum(nvl(cost_money_ymed,0))) / sum(income_money_ymed) * 100) as t_10
		from temp
		group by dept_code,dept_name
		union all
		select '999999'
		,'合计'
		,sum(nvl(income_money_nmed,0)) t_1
		,sum(nvl(cost_money_nmed,0)) t_2
		,sum(nvl(income_money_nmed,0)) - sum(nvl(cost_money_nmed,0)) t_3
		,decode(sum(nvl(cost_money_nmed, 0)), 0, 0, (sum(nvl(income_money_nmed,0)) - sum(nvl(cost_money_nmed,0))) / sum(cost_money_nmed) * 100) as t_4
		,decode(sum(nvl(income_money_nmed, 0)), 0, 0,(sum(nvl(income_money_nmed,0)) - sum(nvl(cost_money_nmed,0))) / sum(income_money_nmed) * 100) as t_5
		,sum(nvl(income_money_ymed,0)) t_6
		,sum(nvl(cost_money_ymed,0)) t_7
		,decode(sum(nvl(cost_money_ymed, 0)), 0, 0, sum(nvl(income_money_ymed,0)) - sum(nvl(cost_money_ymed,0)) ) as t_8
		,decode(sum(nvl(cost_money_nmed, 0)), 0, 0,(sum(nvl(income_money_ymed,0)) - sum(nvl(cost_money_ymed,0))) / sum(cost_money_nmed) * 100) as t_9
		,decode(sum(nvl(cost_money_nmed, 0)), 0, 0, (sum(nvl(income_money_ymed,0)) - sum(nvl(cost_money_ymed,0))) / sum(income_money_ymed) * 100) as t_10
		from temp
		order by dept_code


	</select>

	<select id="queryCostVolumeProfit" parameterType="java.util.Map"
		resultMap="CostVolumeProfitMap">

		with temp as (
		select
		 t.dept_id
		,t.dept_no
		,t.dept_code
		,t.dept_name
		,t.item_code
		,t.item_name
		,t1.income_money
		,t2.fixed_cost
		,t2.change_cost
		,t3.workload
		from (
		select 
		a.dept_id,
		a.dept_no,
		a.dept_code,
		a.dept_name,
		decode(b.natur_code, '01', '01', '02', '02','03') as item_code,
		decode(b.natur_code, '01', '门诊', '02', '住院', '医技')
		as item_name
		from hos_dept_dict a
		left join acc_dept_attr b
		on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.dept_id = b.dept_id
		where a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and b.natur_code in ('01', '02')
		and a.is_stop = '0'
		and a.is_last = '1'
		and to_char(a.dept_id) in (
			select b.perm_code
			from v_user_data_perm b
			where b.group_id = #{group_id}
				and b.hos_id = #{hos_id}
				and b.user_id = #{user_id}
				and b.table_code = 'HOS_DEPT_DICT'
				and (b.is_write = 1
					or b.is_read = 1)
		)
		union all
		select
		a.dept_id,
		a.dept_no,
		a.dept_code,
		a.dept_name,
		decode(b.natur_code, '01',
		'01', '02', '02', '03') as item_code,
		decode(b.natur_code, '01', '门诊',
		'02', '住院', '医技') as item_name
		from hos_dept_dict a
		left join
		acc_dept_attr b
		on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and
		a.dept_id = b.dept_id
		where a.group_id = #{group_id}
		and a.hos_id =
		#{hos_id}
		and b.type_code = '02'
		and a.is_stop = '0'
		and a.is_last = '1'
		)t left join (
		select dept_id,dept_no,sum(income_money) income_money
		from
		v_cost_appl_dept_income_temp
		where group_id = #{group_id}
		and hos_id
		= #{hos_id}
		and copy_code = #{copy_code}
		and acc_year || acc_month
		between #{year_month_begin} and #{year_month_end}
		group by dept_id,dept_no
		)t1 on t.dept_id = t1.dept_id
		and t.dept_no = t1.dept_no
		left join (
		select dept_id,sum(case nature_id when 1 then t2
		else 0 end)
		fixed_cost,
		sum(case nature_id when 2 then t2 else 0 end)
		change_cost
		from v_cost_dept_cost_detail_temp
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and acc_year || acc_month between #{year_month_begin} and #{year_month_end}
		 group by dept_id
		)t2 on t.dept_id = t2.dept_id
		left join (
		select dept_id, dept_no,
		sum(clinic_num) as workload
		from cost_clinic_work
		where group_id =
		#{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and
		acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		union all
		select dept_id,
		dept_no, sum(bed_use_day_num) as workload
		from cost_inhos_work
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		union all
		select
		server_dept_id as dept_id, server_dept_no as dept_no, sum(server_num)
		as workload
		from cost_inner_server
		where group_id = #{group_id}
		and
		hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and acc_year ||
		acc_month between #{year_month_begin} and
		#{year_month_end}
		group by
		server_dept_id, server_dept_no
		) t3 on t.dept_id = t3.dept_id
		and
		t.dept_no = t3.dept_no
		)select
		item_code
		,item_name
		,sum(income_money) t_1
		,sum(fixed_cost) t_2
		,sum(change_cost) t_3
		,sum(income_money) -
		(sum(fixed_cost) + sum(change_cost)) t_4
		,sum(workload) t_5
		,sum(income_money) / sum(workload) t_6
		,sum(change_cost) /
		sum(workload) t_7
		,(sum(income_money) - (sum(fixed_cost) +
		sum(change_cost))) / sum(workload) t_8
		,sum(fixed_cost) /
		((sum(income_money) -
		sum(change_cost))/sum(workload)) as t_9
		,sum(fixed_cost / ((income_money - change_cost) / workload) *
		(income_money /
		workload)) as t_10
		from temp
		group by item_code,item_name
		order by item_code,item_name
	</select>

	<select id="queryCostVolumeProfitDetail" parameterType="java.util.Map"
		resultMap="CostVolumeProfitDetailMap">
		with temp as (
		select t.dept_id, t.dept_no, t.dept_code,
		t.dept_name,natur_code,
		t1.income_money
		, t2.fixed_cost, t2.change_cost,
		t3.workload,work
		from (
		select a.dept_id, a.dept_no, a.dept_code,
		a.dept_name,b.natur_code
		from hos_dept_dict a
		left join acc_dept_attr b
		on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.dept_id =
		b.dept_id
		<where>
			a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.is_last = '1'
			and a.is_stop = '0'
			<if test="natur_code == 01 and natur_code == '01'">
				and b.natur_code = #{natur_code}
			</if>
			<if test="natur_code == 02 and natur_code == '02'">
				and b.natur_code = #{natur_code}
			</if>
			<if test="natur_code == 03 and natur_code == '03'">
				and b.type_code = '02'
			</if>
		   and to_char(a.dept_id) in (
			select b.perm_code
			from v_user_data_perm b
			where b.group_id = #{group_id}
				and b.hos_id = #{hos_id}
				and b.user_id = #{user_id}
				and b.table_code = 'HOS_DEPT_DICT'
				and (b.is_write = 1
					or b.is_read = 1)
		   )
		</where>
		) t
		left join (
		select dept_id, dept_no, sum(income_money) as
		income_money
		from v_cost_appl_dept_income_temp
		where group_id =
		#{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and
		acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		) t1 on t.dept_id =
		t1.dept_id
		and t.dept_no = t1.dept_no
		left join (
		select dept_id, sum(case nature_id
		when 1 then t2
		else 0
		end) as fixed_cost
		,
		sum(case nature_id
		when 2 then t2
		else 0
		end) as change_cost
		from
		v_cost_dept_cost_detail_temp
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and acc_year || acc_month between #{year_month_begin} and #{year_month_end}
		group by dept_id
		) t2
		on t.dept_id = t2.dept_id
		left join (
		select
		dept_id, dept_no,null work ,sum(clinic_num) as workload
		from
		cost_clinic_work
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and
		copy_code = #{copy_code}
		and acc_year || acc_month between
		#{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		union all
		select dept_id, dept_no,
			case when sum(open_bed_num) = 0 then 0
            else sum(bed_use_day_num) / sum(open_bed_num) * 100
            end as work
		,sum(bed_use_day_num) as workload
		from
		cost_inhos_work
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and
		copy_code = #{copy_code}
		and acc_year || acc_month between
		#{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		union all
		select server_dept_id as dept_id, server_dept_no as
		dept_no,null work,
		sum(server_num) as workload
		from cost_inner_server
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by server_dept_id, server_dept_no
		) t3 on
		t.dept_id = t3.dept_id
		and t.dept_no = t3.dept_no
		)
		select 
		  dept_code,
		  dept_name,
		  natur_code,
		  sum(income_money) as t_1, 
		  sum(fixed_cost) as t_2,
		  sum(change_cost) as t_3,
		  sum(income_money) - (sum(fixed_cost) + sum(change_cost)) as t_4,
		  sum(workload) as t_5,
		  sum(work) work,
		  sum(income_money) / sum(workload) as t_6,
		  decode(sum(workload),0,0,sum(change_cost) / sum(workload)) as t_7,
		  (sum(income_money) - (sum(fixed_cost) + sum(change_cost))) / sum(workload) as t_8, 
		  sum(fixed_cost / ((income_money - change_cost) / workload)) as t_9,
		  sum(fixed_cost /((income_money - change_cost) / workload) * (income_money / workload)) as t_10
		from temp
		group by dept_code, dept_name,natur_code
		union all
		   select 
		     '999999',
		     '合计',
		     #{natur_code} natur_code,
		     sum(income_money) as t_1,
		     sum(fixed_cost) as t_2,
		     sum(change_cost) as t_3,
		     sum(income_money) - (sum(fixed_cost) + sum(change_cost)) as t_4,
		     sum(workload) as t_5,
		     sum(work) work,
		     sum(income_money) / sum(workload) as t_6,
		    decode(sum(workload),0,0,sum(change_cost) / sum(workload)) as t_7,
		    (sum(income_money) - (sum(fixed_cost) + sum(change_cost))) / sum(workload) as t_8,
		    sum(fixed_cost) / ((sum(income_money) -	sum(change_cost))/sum(workload)) as t_9,
		    sum(fixed_cost / ((income_money - change_cost) / workload) * (income_money / workload)) as t_10
		from temp
		order by dept_code, dept_name
	</select>

	<select id="queryCostVolumeProfitDetailChart" parameterType="java.util.Map"
		resultMap="CostVolumeProfitDetailChartMap">


		with temp as (
		select t.dept_id, t.dept_no, t.dept_code, t.dept_name,
		t1.income_money
		, t2.fixed_cost, t2.change_cost, t3.workload, work
		from
		(
		select a.dept_id, a.dept_no, a.dept_code, a.dept_name
		from
		hos_dept_dict a
		left join acc_dept_attr b on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.dept_id = b.dept_id
		<where>
			a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.is_last = '1'
			and a.is_stop = '0'
			<if test="natur_code == 01 and natur_code == '01'">
				and b.natur_code = #{natur_code}
			</if>
			<if test="natur_code == 02 and natur_code == '02'">
				and b.natur_code = #{natur_code}
			</if>
			<if test="natur_code == 03 and natur_code == '03'">
				and b.type_code = '02'
			</if>
		</where>
		) t
		left join (
		select dept_id, dept_no, sum(income_money) as
		income_money
		from v_cost_appl_dept_income_temp
		where group_id =
		#{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and
		acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		) t1 on t.dept_id =
		t1.dept_id
		and t.dept_no = t1.dept_no
		left join (
		select dept_id,
		dept_no, sum(case nature_id
		when 1 then t2
		else 0
		end) as fixed_cost
		,
		sum(case nature_id
		when 2 then t2
		else 0
		end) as change_cost
		from
		v_cost_dept_cost_detail_temp
		where group_id = #{group_id}
		and hos_id =
		#{hos_id}
		and copy_code = #{copy_code}
		and acc_year || acc_month between
		#{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		) t2
		on t.dept_id = t2.dept_id
		and t.dept_no = t2.dept_no
		left join (
		select
		dept_id, dept_no, null as work, sum(clinic_num) as workload
		from
		cost_clinic_work
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and
		copy_code = #{copy_code}
		and acc_year || acc_month between
		#{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		union all
		select dept_id, dept_no
			,divide(sum(bed_use_day_num),sum(open_bed_num)) * 100 work
		, sum(bed_use_day_num) as workload
		from
		cost_inhos_work
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and
		copy_code = #{copy_code}
		and acc_year || acc_month between
		#{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no
		union all
		select server_dept_id as dept_id, server_dept_no as dept_no,
		null as work,
		sum(server_num) as workload
		from cost_inner_server
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by server_dept_id, server_dept_no
		) t3 on
		t.dept_id = t3.dept_id
		and t.dept_no = t3.dept_no
		), t as (
		select
		dept_code
		,dept_name
		,sum(income_money) income_money
		,sum(fixed_cost)
		fixed_cost
		,sum(change_cost) change_cost
		,sum(workload) workload
		,round(sum(fixed_cost / ((income_money - change_cost) / workload))) as
		t_workload
		,sum(income_money)/ sum(workload) unit_income_money
		,sum(change_cost)/ sum(workload) unit_change_cost
		,(round(sum(fixed_cost / ((income_money - change_cost) / workload))))
		* (sum(income_money)/
		sum(workload)) yAxis
		from temp
		group by dept_code,
		dept_name
		union all
		select
		'999999'
		,'合计'
		,sum(income_money) income_money
		,sum(fixed_cost) fixed_cost
		,sum(change_cost) change_cost
		,sum(workload) as workload
		,round(sum(fixed_cost) / ((sum(income_money)
		- sum(change_cost))/sum(workload))) t_workload
		,sum(income_money)/
		sum(workload) unit_income_money
		,sum(change_cost)/ sum(workload)
		unit_change_cost
		,round(sum(fixed_cost)/((sum(income_money) -
		sum(change_cost)) /
		sum(workload))) * (sum(income_money) /
		sum(workload)) yaxis
		from temp
		)select
		dept_code,dept_name,income_money,fixed_cost,change_cost,workload,unit_income_money,unit_change_cost,t_workload,yaxis
		from t
		where dept_code = #{dept_code}
	</select>

	<select id="queryCostBreakeven" parameterType="java.util.Map"
		resultMap="CostBreakevenMap">
		with temp as
		(select t.dept_id,
		t.dept_no,
		t.dept_code,
		t.dept_name,
		t1.income_money,
		t2.cost_money,
		t3.workload workload_m,
		t4.workload workload_z
		from (select a.dept_id, a.dept_no, a.dept_code,
		a.dept_name
		from hos_dept_dict a
		left join acc_dept_attr b
		on a.group_id
		= b.group_id
		and a.hos_id = b.hos_id
		and a.dept_id = b.dept_id
		where
		a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.is_stop = '0'
		and a.is_last = '1'
		and b.type_code in ('01', '02')) t
		left join (select
		a.dept_id,
		a.dept_no,
		sum(a.income_money) as income_money
		from
		v_cost_appl_dept_income a
		where a.group_id = #{group_id}
		and a.hos_id =
		#{hos_id}
		and a.copy_code = #{copy_code}
		and a.acc_year || a.acc_month
		between #{year_month_begin} and
		#{year_month_end}
		group by a.dept_id,
		a.dept_no) t1
		on t.dept_id = t1.dept_id
		and t.dept_no = t1.dept_no
		left
		join (select t.dept_id, t.dept_no, sum(t.t2) as cost_money
		from
		v_cost_dept_cost_detail t
		left join cost_item_dict_no t1
		on t.group_id =
		t1.group_id
		and t.hos_id = t1.hos_id
		and t.copy_code = t1.copy_code
		and
		t.cost_item_id = t1.cost_item_id
		and t.cost_item_no = t1.cost_item_no
		where t.group_id = #{group_id}
		and t.hos_id = #{hos_id}
		and t.copy_code
		= #{copy_code}
		and t.acc_year || t.acc_month between
		#{year_month_begin} and
		#{year_month_end}
		group by t.dept_id, t.dept_no)
		t2
		on t.dept_id = t2.dept_id
		and t.dept_no = t2.dept_no
		left join (select
		dept_id, dept_no, sum(clinic_num) as workload
		from cost_clinic_work
		where group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no) t3
		on t.dept_id =
		t3.dept_id
		and t.dept_no = t3.dept_no
		left join (select dept_id,
		dept_no, sum(bed_use_day_num) as workload
		from cost_inhos_work
		where
		group_id = #{group_id}
		and hos_id = #{hos_id}
		and copy_code =
		#{copy_code}
		and acc_year || acc_month between #{year_month_begin} and
		#{year_month_end}
		group by dept_id, dept_no) t4
		on t.dept_id =
		t4.dept_id
		and t.dept_no = t4.dept_no), t as (
		select dept_id,
		dept_no,
		dept_code,
		dept_name,
		sum(nvl(income_money, 0)) t_1,
		sum(nvl(cost_money,
		0)) t_2,
		sum(nvl(income_money, 0)) - sum(nvl(cost_money, 0)) t_3,
		(sum(nvl(income_money, 0)) - sum(nvl(cost_money, 0))) /
		sum(cost_money) * 100 t_4,
		sum(workload_m) t_5,
		sum(workload_z) t_6
		from
		temp
		group by dept_id, dept_no, dept_code, dept_name
		union all
		select
		999999,
		999999,
		'',
		'合计',
		sum(nvl(income_money, 0)) t_1,
		sum(nvl(cost_money, 0)) t_2,
		sum(nvl(income_money, 0)) -
		sum(nvl(cost_money, 0)) t_3,
		(sum(nvl(income_money, 0)) -
		sum(nvl(cost_money, 0))) /
		sum(cost_money) * 100 t_4,
		sum(workload_m)
		t_5,
		sum(workload_z) t_6
		from temp
		)select rownum t_id,a.* from (select *
		from t order by t_4 desc)
		a


	</select>

	<select id="queryCostBreakevenDetailIncome" parameterType="java.util.Map"
		resultMap="CostBreakevenDetailMap">
		with income_temp as
		(select b.charge_kind_code,
		b.charge_kind_name,
		sum(a.money)money
		from cost_income a
		left join cost_charge_kind_arrt b
		on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code =
		b.copy_code
		and a.charge_kind_id = b.charge_kind_id
		<where>
			a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code =
			#{copy_code}
			and acc_year || acc_month between #{year_month_begin} and
			#{year_month_end}
			<if test="dept_id != 999999 and dept_id != '999999'">
				and a.appl_dept_id = #{dept_id}
			</if>
			<if test="dept_no != 999999 and dept_no != '999999'">
				and a.appl_dept_no = #{dept_no}
			</if>
		</where>
		group by b.charge_kind_code,b.charge_kind_name)
		select
		charge_kind_code, charge_kind_name,money
		from income_temp
		union all
		select null,'合计',sum(money)
		from income_temp

	</select>

	<select id="queryCostBreakevenDetailCost" parameterType="java.util.Map"
		resultMap="CostBreakevenDetailMap">
		with temp as (
		select
		c.cost_type_code,
		c.cost_type_name,
		sum(dir_amount)
		t1,
		sum(dir_amount + dir_ass_amount + dir_med_amount
		+indir_med_ass_amount +
		dir_man_amount +
		indir_ass_man_amount +
		indir_med_man_amount +
		indir_ass_med_man_amount) t2
		from cost_dept_cost
		a
		left join cost_item_dict_no b
		on a.group_id = b.group_id
		and a.hos_id =
		b.hos_id
		and a.copy_code = b.copy_code
		and a.cost_item_id =
		b.cost_item_id
		and a.cost_item_no = b.cost_item_no
		left join
		cost_type_dict c
		on b.cost_type_id = c.cost_type_id
		left join
		acc_dept_attr d
		on d.group_id = a.group_id
		and d.hos_id = a.hos_id
		and
		d.dept_id = a.dept_id
		<where>
			a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code =
			#{copy_code}
			and acc_year || acc_month between #{year_month_begin} and
			#{year_month_end}
			<if test="dept_id != 999999 and dept_id != '999999'">
				and a.dept_id = #{dept_id}
			</if>
			<if test="dept_no != 999999 and dept_no != '999999'">
				and a.dept_no = #{dept_no}
			</if>
			and d.type_code = '01'
		</where>
		group by c.cost_type_code,c.cost_type_name
		)select
		cost_type_code,cost_type_name,t1,t2 from temp
		union all
		select
		null,'合计',sum(t1),sum(t2) from temp
		order by cost_type_code
	</select>


	<select id="queryCostRingRatio" parameterType="java.util.Map"
		resultType="java.util.Map">

		select
		 dept_id
		,dept_code
		,dept_name
		${selectHead}
		from
		(
		select
		a.dept_id,
		d.dept_code,
		d.dept_name,
		a.acc_year||a.acc_month year_month,
		sum(a.dir_amount) t_1,
		sum(nvl(a.dir_man_amount, 0) + nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) t_2,
		sum(nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) t_3
		from cost_dept_cost a
		inner join hos_source t1
		on a.group_id = t1.group_id
		and a.hos_id = t1.hos_id
		and a.source_id = t1.source_id
		left join cost_item_dict b
		on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.cost_item_id = b.cost_item_id
		left join acc_dept_attr c
		on a.group_id = c.group_id
		and a.hos_id = c.hos_id
		and c.dept_id = a.dept_id
		left join hos_dept_dict d
		on a.group_id = d.group_id
		and a.hos_id = d.hos_id
		and a.dept_id = d.dept_id
		and d.is_stop = 0
		where a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		and
		a.acc_year || a.acc_month between #{year_month_begin} and
		#{year_month_end}
		and source_attr in (1)
		and d.is_last = '1'
		and
		d.is_stop = '0'
		group by
		a.dept_id,d.dept_code,d.dept_name,a.acc_year||a.acc_month
		)t
		group by dept_id,dept_code,dept_name
		union all
		select
		999999 dept_id
		, '' dept_code
		, '合计' dept_name
		${selectHead}
		from (
		select
		a.dept_id,
		d.dept_code,
		d.dept_name,
		a.acc_year||a.acc_month year_month,
		sum(a.dir_amount) t_1,
		sum(nvl(a.dir_man_amount, 0) + nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) t_2,
		sum(nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) t_3
		from cost_dept_cost a
		inner join hos_source t1
		on a.group_id = t1.group_id
		and a.hos_id = t1.hos_id
		and a.source_id = t1.source_id
		left join cost_item_dict b
		on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.cost_item_id = b.cost_item_id
		left join acc_dept_attr c
		on a.group_id = c.group_id
		and a.hos_id = c.hos_id
		and c.dept_id = a.dept_id
		left join hos_dept_dict d
		on a.group_id = d.group_id
		and a.hos_id = d.hos_id
		and a.dept_id = d.dept_id
		and d.is_stop = 0
		where a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		and a.acc_year || a.acc_month between #{year_month_begin} and #{year_month_end}
		and source_attr in (1)
		and d.is_last = '1'
		and d.is_stop = '0'
		group by a.dept_id,d.dept_code,d.dept_name,a.acc_year||a.acc_month
		)t
		order by dept_code,dept_name

	</select>

	<select id="queryCostRingRatioDetail" parameterType="java.util.Map"
		resultType="java.util.Map">

		select cost_type_id
		,cost_type_code
		,cost_type_name
		${selectHead}
		from
		(select
		e.cost_type_id,
		e.cost_type_code,
		e.cost_type_name,
		a.acc_year ||
		a.acc_month as year_month,
		sum(a.dir_amount) as t_1,
		sum(nvl(a.dir_man_amount, 0) + nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) as t_2,
		sum(nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) as t_3
		from cost_dept_cost a
		inner join
		hos_source t1
		on a.group_id = t1.group_id
		and a.hos_id = t1.hos_id
		and
		a.source_id = t1.source_id
		left join cost_item_dict b
		on a.group_id =
		b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and
		a.cost_item_id = b.cost_item_id
		left join acc_dept_attr c
		on a.group_id
		= c.group_id
		and a.hos_id = c.hos_id
		and c.dept_id = a.dept_id
		left join
		hos_dept_dict d
		on a.group_id = d.group_id
		and a.hos_id = d.hos_id
		and
		a.dept_id = d.dept_id
		and a.dept_no = d.dept_no
		left join cost_type_dict
		e
		on e.cost_type_id = b.cost_type_id
		where a.group_id = #{group_id}
		and
		a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		<if test="dept_id != 999999 and dept_id != '999999'">
			and a.dept_id = #{dept_id}
		</if>
		<if test="dept_no != 999999 and dept_no != '999999'">
			and a.dept_no = #{dept_no}
		</if>
		and a.acc_year || a.acc_month between #{year_month_begin} and
		#{year_month_end}
		and source_attr in (1)
		and d.is_last = '1'
		and
		d.is_stop = '0'
		group by e.cost_type_id,
		e.cost_type_code,
		e.cost_type_name,
		a.acc_year || a.acc_month) t
		group by
		cost_type_id,cost_type_code,cost_type_name
		union all
		select null
		,''
		,'合计'
		${selectHead}
		from (select
		e.cost_type_id,
		e.cost_type_code,
		e.cost_type_name,
		a.acc_year || a.acc_month as year_month,
		sum(a.dir_amount) as t_1,
		sum(nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) +
		nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) as t_2,
		sum(nvl(a.dir_amount, 0) + nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) +
		nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) as t_3
		from
		cost_dept_cost a
		inner join hos_source t1
		on a.group_id = t1.group_id
		and a.hos_id = t1.hos_id
		and a.source_id = t1.source_id
		left join
		cost_item_dict b
		on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and
		a.copy_code = b.copy_code
		and a.cost_item_id = b.cost_item_id
		left join
		acc_dept_attr c
		on a.group_id = c.group_id
		and a.hos_id = c.hos_id
		and
		c.dept_id = a.dept_id
		left join hos_dept_dict d
		on a.group_id =
		d.group_id
		and a.hos_id = d.hos_id
		and a.dept_id = d.dept_id
		and
		a.dept_no = d.dept_no
		left join cost_type_dict e
		on e.cost_type_id =
		b.cost_type_id
		where a.group_id = #{group_id}
		and a.hos_id = #{hos_id}
		and a.copy_code = #{copy_code}
		<if test="dept_id != 999999 and dept_id != '999999'">
			and a.dept_id = #{dept_id}
		</if>
		<if test="dept_no != 999999 and dept_no != '999999'">
			and a.dept_no = #{dept_no}
		</if>
		and a.acc_year || a.acc_month between #{year_month_begin} and
		#{year_month_end}
		and source_attr in (1)
		and d.is_last = '1'
		and
		d.is_stop = '0'
		group by e.cost_type_id,
		e.cost_type_code,
		e.cost_type_name,
		a.acc_year || a.acc_month) t
		order by cost_type_code


	</select>

	<select id="queryCostRingRatioChart" parameterType="java.util.Map"
		resultType="java.util.Map">

		select
		year_month
		,sum(t_1) t_1
		,sum(t_2) t_2
		,sum(t_3) t_3
		from (
		select
		a.dept_id, d.dept_code, d.dept_name
		, a.acc_year ||
		a.acc_month as year_month, sum(a.dir_amount) as t_1
		,
		sum(nvl(a.dir_man_amount, 0) + nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) + nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) + nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) as t_2
		, sum(nvl(a.dir_amount, 0) +
		nvl(a.dir_man_amount, 0) +
		nvl(a.indir_ass_man_amount, 0) +
		nvl(a.indir_med_man_amount, 0) +
		nvl(a.indir_ass_med_man_amount, 0) +
		nvl(a.dir_ass_amount, 0) +
		nvl(a.indir_med_ass_amount, 0) +
		nvl(a.dir_med_amount, 0)) as t_3
		from cost_dept_cost a
		inner join hos_source t1 on a.group_id = t1.group_id
		and a.hos_id = t1.hos_id
		and a.source_id = t1.source_id
		left join cost_item_dict b 
		on a.group_id = b.group_id
		and a.hos_id = b.hos_id
		and a.copy_code = b.copy_code
		and a.cost_item_id = b.cost_item_id
		left join acc_dept_attr c 
		on a.group_id = c.group_id 
		and a.hos_id = c.hos_id
		and c.dept_id = a.dept_id
		left join hos_dept_dict d on a.group_id = d.group_id
		and a.hos_id = d.hos_id
		and a.dept_id = d.dept_id
		and d.is_stop = 0
		<where>
			a.group_id = #{group_id}
			and a.hos_id = #{hos_id}
			and a.copy_code = #{copy_code}
			and a.acc_year || a.acc_month between #{year_month_begin} and #{year_month_end}
			<if test="dept_id != 999999 and dept_id != '999999'">
				and a.dept_id = #{dept_id}
			</if>
			and source_attr in (1)
			and d.is_last = '1'
			and d.is_stop = '0'
		</where>
		group by a.dept_id, d.dept_code, d.dept_name, a.acc_year ||
		a.acc_month
		) t group by year_month
		order by year_month
	</select>

	<select id="queryCostClinicalDeptIncomeItemColumns"
		parameterType="java.util.Map" resultType="java.util.Map">

		select group_id, hos_id,
		copy_code, income_item_id, income_item_code
		, income_item_name,
		is_stop, spell_code, wbx_code
		from cost_income_item_arrt
		where group_id
		= #{group_id}
		and hos_id = #{hos_id}
		and copy_code = #{copy_code}
		and
		is_stop = 0
		order by income_item_code asc

	</select>

	<select id="queryCostClinicalDeptIncomeAnalysis" parameterType="java.util.Map"
		resultType="java.util.Map">

		   with temp as(
           select 
            appl.dept_code appl_dept_code,
            appl.dept_name appl_dept_name,
            exec.dept_code exec_dept_code,
            exec.dept_name exec_dept_name,
            ciia.income_item_code,
            ci.money
           from cost_income ci
           left join hos_dept_dict appl
           on appl.group_id = ci.group_id
           and appl.hos_id = ci.hos_id
           and appl.dept_no = ci.appl_dept_no
           and appl.dept_id = ci.appl_dept_id
           left join acc_dept_attr hda
           on hda.group_id = appl.group_id
           and hda.hos_id = appl.hos_id
           and hda.dept_id = appl.dept_id
           left join hos_dept_dict exec
           on ci.group_id = exec.group_id
           and ci.hos_id = exec.hos_id
           and ci.exec_dept_id = exec.dept_id
           and ci.exec_dept_no = exec.dept_no
           left join cost_charge_kind_arrt ccka
           on ccka.group_id = ci.group_id
           and ccka.hos_id = ci.hos_id
           and ccka.copy_code = ci.copy_code
           and ccka.charge_kind_id = ci.charge_kind_id
           left join cost_income_item_arrt ciia
           on ciia.group_id = ccka.group_id
           and ciia.hos_id = ccka.hos_id
           and ciia.copy_code = ccka.copy_code
           and ciia.income_item_id = ccka.income_item_id_in
           where ci.group_id = #{group_id}
           and ci.hos_id = #{hos_id}
           and ci.copy_code = #{copy_code}
           and ci.acc_year || ci.acc_month between #{year_month_begin} and #{year_month_begin}
           and hda.natur_code = '01'
           <if test="appl_dept_code != '' and appl_dept_code != null ">
		    and appl.dept_code like #{appl_dept_code}||'%'
		   </if>
		   <if test="exec_dept_code != '' and exec_dept_code != null ">
		    and exec.dept_code like #{exec_dept_code}||'%'
		   </if>
           union all
           select 
            appl.dept_code appl_dept_code,
            appl.dept_name appl_dept_name,
            exec.dept_code exec_dept_code,
            exec.dept_name exec_dept_name,
            ciia.income_item_code,
            ci.money
           from cost_income ci
           left join hos_dept_dict appl
           on appl.group_id = ci.group_id
           and appl.hos_id = ci.hos_id
           and appl.dept_no = ci.appl_dept_no
           and appl.dept_id = ci.appl_dept_id
           left join acc_dept_attr hda
           on hda.group_id = appl.group_id
           and hda.hos_id = appl.hos_id
           and hda.dept_id = appl.dept_id
           left join hos_dept_dict exec
           on ci.group_id = exec.group_id
           and ci.hos_id = exec.hos_id
           and ci.exec_dept_id = exec.dept_id
           and ci.exec_dept_no = exec.dept_no
           left join cost_charge_kind_arrt ccka
           on ccka.group_id = ci.group_id
           and ccka.hos_id = ci.hos_id
           and ccka.copy_code = ci.copy_code
           and ccka.charge_kind_id = ci.charge_kind_id
           left join cost_income_item_arrt ciia
           on ciia.group_id = ccka.group_id
           and ciia.hos_id = ccka.hos_id
           and ciia.copy_code = ccka.copy_code
           and ciia.income_item_id = ccka.income_item_id_out
           where ci.group_id = #{group_id}
           and ci.hos_id = #{hos_id}
           and ci.copy_code = #{copy_code}
           and ci.acc_year || ci.acc_month between #{year_month_begin} and #{year_month_begin}
           <if test="appl_dept_code != '' and appl_dept_code != null ">
		    and appl.dept_code like #{appl_dept_code}||'%'
		   </if>
		   <if test="exec_dept_code != '' and exec_dept_code != null ">
		    and exec.dept_code like #{exec_dept_code}||'%'
		   </if>
           and hda.natur_code = '02'
     ),income_temp as(select 
              appl_dept_code,
              appl_dept_name,
              exec_dept_code,
              exec_dept_name,
              income_item_code,
              sum(money) money
            from temp
            group by   appl_dept_code,
                  appl_dept_name,
                  exec_dept_code,
                  exec_dept_name,
                  income_item_code
      )select 
         appl_dept_code,
         appl_dept_name,
         exec_dept_code,
         exec_dept_name,
         ${field},
         ${field_by}
        from income_temp
        pivot (max(money) for income_item_code in (${pivot}))
        union all
		select
		'合计',null,null,null,${total_column},${total_row}
	   from income_temp
		pivot (max(money) for income_item_code in (${pivot}))
        order by appl_dept_code,exec_dept_code
					 
	</select>

	<select id="queryCostClinicalDeptIncomeAnalysisAppl" parameterType="java.util.Map" resultType="java.util.Map">
		     with temp as (
        select appl.dept_code as appl_dept_code, appl.dept_name as appl_dept_name, ciia.income_item_code, ci.money
        from cost_income ci
        left join hos_dept_dict appl on appl.group_id = ci.group_id
        and appl.hos_id = ci.hos_id
        and appl.dept_no = ci.appl_dept_no
        and appl.dept_id = ci.appl_dept_id 
        left join acc_dept_attr hda on hda.group_id = appl.group_id
        and hda.hos_id = appl.hos_id
        and hda.dept_id = appl.dept_id 
        left join hos_dept_dict exec on ci.group_id = exec.group_id
        and ci.hos_id = exec.hos_id
        and ci.exec_dept_id = exec.dept_id
        and ci.exec_dept_no = exec.dept_no 
        left join cost_charge_kind_arrt ccka on ccka.group_id = ci.group_id
        and ccka.hos_id = ci.hos_id
        and ccka.copy_code = ci.copy_code
        and ccka.charge_kind_id = ci.charge_kind_id 
          left join cost_income_item_arrt ciia on ciia.group_id = ccka.group_id
        and ciia.hos_id = ccka.hos_id
        and ciia.copy_code = ccka.copy_code
        and ciia.income_item_id = ccka.income_item_id_in 
        where ci.group_id = #{group_id}
          and ci.hos_id = #{hos_id}
          and ci.copy_code = #{copy_code}
          and ci.acc_year || ci.acc_month between #{year_month_begin} and #{year_month_end}
          and hda.natur_code = '01'
       <if test="appl_dept_code != '' and appl_dept_code != null ">
		   and appl.dept_code like #{appl_dept_code}||'%'
	   </if>
	   <if test="exec_dept_code != '' and exec_dept_code != null ">
	    and exec.dept_code like #{appl_dept_code}||'%'
	   </if>
        union all
        select appl.dept_code as appl_dept_code, appl.dept_name as appl_dept_name, ciia.income_item_code, ci.money
        from cost_income ci
        left join hos_dept_dict appl on appl.group_id = ci.group_id
        and appl.hos_id = ci.hos_id
        and appl.dept_no = ci.appl_dept_no
        and appl.dept_id = ci.appl_dept_id 
        left join acc_dept_attr hda on hda.group_id = appl.group_id
        and hda.hos_id = appl.hos_id
        and hda.dept_id = appl.dept_id 
        left join hos_dept_dict exec on ci.group_id = exec.group_id
        and ci.hos_id = exec.hos_id
        and ci.exec_dept_id = exec.dept_id
        and ci.exec_dept_no = exec.dept_no 
        left join cost_charge_kind_arrt ccka on ccka.group_id = ci.group_id
        and ccka.hos_id = ci.hos_id
        and ccka.copy_code = ci.copy_code
        and ccka.charge_kind_id = ci.charge_kind_id 
          left join cost_income_item_arrt ciia on ciia.group_id = ccka.group_id
        and ciia.hos_id = ccka.hos_id
        and ciia.copy_code = ccka.copy_code
        and ciia.income_item_id = ccka.income_item_id_out 
        where ci.group_id =  #{group_id}
          and ci.hos_id =  #{hos_id}
          and ci.copy_code =  #{copy_code}
          and ci.acc_year || ci.acc_month between  #{year_month_begin} and  #{year_month_end}
          and hda.natur_code = '02'
        <if test="appl_dept_code != '' and appl_dept_code != null ">
		   and appl.dept_code like #{appl_dept_code}||'%'
	   </if>
	   <if test="exec_dept_code != '' and exec_dept_code != null ">
	    and exec.dept_code like #{appl_dept_code}||'%'
	   </if>
      ), 
      income_temp as (
        select  
		   hd.dept_code appl_dept_code,
		   hd.dept_name appl_dept_name,
		   income_item_code,
		   sum(nvl(money,0)) money
        from hos_dept hd
		left join temp t
		on t.appl_dept_code like hd.dept_code||'%'
		where hd.group_id = #{group_id}
		and hd.hos_id = #{hos_id}
	   <if test="dept_level != '' and dept_level != null ">
			<if test="dept_level == 0">
	            and is_last = 1
	        </if>
	        <if test="dept_level != 0">
	            and dept_level = #{dept_level}
	        </if>
		</if>
		group by hd.dept_code,hd.dept_name, income_item_code
		having sum(nvl(money,0)) != 0
      ), 
      income_temp_sum as (
        select  
			hd.dept_code appl_dept_code,
			hd.dept_name appl_dept_name,
			income_item_code,
			sum(nvl(money,0)) money
        from hos_dept hd
		left join temp t
		on t.appl_dept_code like hd.dept_code||'%'
		where hd.group_id = #{group_id}
		and hd.hos_id = #{hos_id}
		and hd.is_last = 1
		group by hd.dept_code,hd.dept_name, income_item_code
		having sum(nvl(money,0)) != 0
      )select 
			appl_dept_code,
			appl_dept_name,
			${field},
	        ${field_by}
			from income_temp
			pivot (max(money) for income_item_code in (${pivot}))
	   union all
		select
		   '合计',
		   null,
		   ${total_column},
		   ${total_row}
	     from income_temp_sum
		   pivot (max(money) for income_item_code in (${pivot}))
		  order by appl_dept_code
	</select>
	<!-- 临床科室收入分析构成表(自定义开单科室) -->
	<select id="queryCostCustomDeptIncomeAnalysisAppl" 	parameterType="java.util.Map" resultType="java.util.Map">
		with income as (
		select ci.group_id,
		ci.hos_id,
		ci.copy_code,
		ccd.dept_id appl_dept_id,
		ccd.dept_code  appl_dept_code,
		ccd.dept_name  appl_dept_name,
		ciia.income_item_code,
		sum(ci.money) money
		from cost_income ci
		left join cost_hrp_dept_ref chdr
			on
				ci.group_id = chdr.group_id
				and ci.hos_id = chdr.hos_id
				and ci.appl_dept_id = chdr.dept_id
				and ci.acc_year || '-' || ci.acc_month  between to_char(chdr.start_date,'yyyy-mm') and to_char(nvl(chdr.end_date,to_date('9999-12-31','yyyy-mm-dd')),'yyyy-mm')
		left join cost_custom_dept ccd
			on chdr.group_id = ccd.group_id
			and chdr.hos_id = ccd.hos_id
			and chdr.cost_custom_dept_id = ccd.dept_id
			and ccd.is_stop = 0
		left join cost_charge_kind_arrt ccka
		on ccka.group_id = ci.group_id
		and ccka.hos_id = ci.hos_id
		and ccka.copy_code = ci.copy_code
		and ccka.charge_kind_id = ci.charge_kind_id
		left join cost_income_item_arrt ciia
		on ciia.group_id = ccka.group_id
		and ciia.hos_id = ccka.hos_id
		and ciia.copy_code = ccka.copy_code
		and (ciia.income_item_id = ccka.income_item_id_in )
		where ci.group_id = #{group_id}
		and ci.hos_id = #{hos_id}
		and ci.copy_code = #{copy_code}
		and ci.acc_year || ci.acc_month between #{year_month_begin} and #{year_month_end}
	    <if test="appl_dept_code != '' and appl_dept_code != null ">
			and ccd.dept_code like #{appl_dept_code}||'%'
		</if>
		<if test="income_type != '' and income_type != null and income_type == 0 ">
			and ci.appl_dept_id = ci.exec_dept_id
		</if>
		<if test="income_type != '' and income_type != null and income_type == 1 ">
			and ci.appl_dept_id != ci.exec_dept_id
		</if>
		group by ci.group_id,
		ci.hos_id,
		ci.copy_code,
		ccd.dept_id ,
		ccd.dept_code ,
		ccd.dept_name ,
		ciia.income_item_code
		) ,  result as (
		select group_id,
				hos_id,
				appl_dept_id,
				appl_dept_code,
				appl_dept_name,
		${field},
		${field_by}
		from income 
		pivot (max(money) for income_item_code in (${pivot}))
		union all
		select null,
				null,
				null,
				'9999',
				'合计',
		${total_column},
		${total_row}
		from income
		pivot (max(money) for income_item_code in (${pivot}))
		) 
		
		select * from result 
		where item9999 &lt;&gt; 0
      	order by group_id,hos_id,appl_dept_code
     
	</select>
	
	<!-- 临床科室收入分析构成表(自定义执行科室) -->
	<select id="queryCostCustomDeptIncomeAnalysisExec" 	parameterType="java.util.Map" resultType="java.util.Map">
		with income as (
		select ci.group_id,
		ci.hos_id,
		ci.copy_code,
		ccd.dept_id exec_dept_id,
		ccd.dept_code  exec_dept_code,
		ccd.dept_name  exec_dept_name,
		ciia.income_item_code,
		sum(ci.money) money
		from cost_income ci
		left join cost_hrp_dept_ref_exec chdr
			on
				ci.group_id = chdr.group_id
				and ci.hos_id = chdr.hos_id
				and ci.exec_dept_id = chdr.dept_id
				and ci.acc_year || '-' || ci.acc_month  between to_char(chdr.start_date,'yyyy-mm') and to_char(nvl(chdr.end_date,to_date('9999-12-31','yyyy-mm-dd')),'yyyy-mm')
		left join cost_custom_dept ccd
			on chdr.group_id = ccd.group_id
			and chdr.hos_id = ccd.hos_id
			and chdr.cost_custom_dept_id = ccd.dept_id
			and ccd.is_stop = 0
		left join cost_charge_kind_arrt ccka
		on ccka.group_id = ci.group_id
		and ccka.hos_id = ci.hos_id
		and ccka.copy_code = ci.copy_code
		and ccka.charge_kind_id = ci.charge_kind_id
		left join cost_income_item_arrt ciia
		on ciia.group_id = ccka.group_id
		and ciia.hos_id = ccka.hos_id
		and ciia.copy_code = ccka.copy_code
		and (ciia.income_item_id = ccka.income_item_id_in )
		where ci.group_id = #{group_id}
		and ci.hos_id = #{hos_id}
		and ci.copy_code = #{copy_code}
		and ci.acc_year || ci.acc_month between #{year_month_begin} and #{year_month_end}
	    <if test="exec_dept_code != '' and exec_dept_code != null ">
			and ccd.dept_code like #{exec_dept_code}||'%'
		</if>
		group by ci.group_id,
		ci.hos_id,
		ci.copy_code,
		ccd.dept_id ,
		ccd.dept_code ,
		ccd.dept_name ,
		ciia.income_item_code
		) ,  result as (
		select group_id,
				hos_id,
				exec_dept_id,
				exec_dept_code,
				exec_dept_name,
		${field},
		${field_by}
		from income 
		pivot (max(money) for income_item_code in (${pivot}))
		union all
		select null,
				null,
				null,
				'9999',
				'合计',
		${total_column},
		${total_row}
		from income
		pivot (max(money) for income_item_code in (${pivot}))
		) 
		
		select * from result 
		where item9999 &lt;&gt; 0
      	order by group_id,hos_id,exec_dept_code
     
	</select>
	
	<select id="queryCostClinicalDeptIncomeAnalysisExec"
		parameterType="java.util.Map" resultType="java.util.Map">
   with temp as (
        select exec.dept_code as exec_dept_code, appl.dept_name as exec_dept_name, ciia.income_item_code, ci.money
        from cost_income ci
        left join hos_dept_dict appl on appl.group_id = ci.group_id
        and appl.hos_id = ci.hos_id
        and appl.dept_no = ci.appl_dept_no
        and appl.dept_id = ci.appl_dept_id 
        left join acc_dept_attr hda on hda.group_id = appl.group_id
        and hda.hos_id = appl.hos_id
        and hda.dept_id = appl.dept_id 
        left join hos_dept_dict exec on ci.group_id = exec.group_id
        and ci.hos_id = exec.hos_id
        and ci.exec_dept_id = exec.dept_id
        and ci.exec_dept_no = exec.dept_no 
        left join cost_charge_kind_arrt ccka on ccka.group_id = ci.group_id
        and ccka.hos_id = ci.hos_id
        and ccka.copy_code = ci.copy_code
        and ccka.charge_kind_id = ci.charge_kind_id 
          left join cost_income_item_arrt ciia on ciia.group_id = ccka.group_id
        and ciia.hos_id = ccka.hos_id
        and ciia.copy_code = ccka.copy_code
        and ciia.income_item_id = ccka.income_item_id_in 
        where ci.group_id = #{group_id}
          and ci.hos_id = #{hos_id}
          and ci.copy_code = #{copy_code}
          and ci.acc_year || ci.acc_month between #{year_month_begin} and #{year_month_end}
          and hda.natur_code = '01'
       <if test="appl_dept_code != '' and appl_dept_code != null ">
		   and appl.dept_code like #{appl_dept_code}||'%'
	   </if>
	   <if test="exec_dept_code != '' and exec_dept_code != null ">
	    and exec.dept_code like #{exec_dept_code}||'%'
	   </if>
        union all
        select exec.dept_code as exec_dept_code, appl.dept_name as exec_dept_name, ciia.income_item_code, ci.money
        from cost_income ci
        left join hos_dept_dict appl on appl.group_id = ci.group_id
        and appl.hos_id = ci.hos_id
        and appl.dept_no = ci.appl_dept_no
        and appl.dept_id = ci.appl_dept_id 
        left join acc_dept_attr hda on hda.group_id = appl.group_id
        and hda.hos_id = appl.hos_id
        and hda.dept_id = appl.dept_id 
        left join hos_dept_dict exec on ci.group_id = exec.group_id
        and ci.hos_id = exec.hos_id
        and ci.exec_dept_id = exec.dept_id
        and ci.exec_dept_no = exec.dept_no 
        left join cost_charge_kind_arrt ccka on ccka.group_id = ci.group_id
        and ccka.hos_id = ci.hos_id
        and ccka.copy_code = ci.copy_code
        and ccka.charge_kind_id = ci.charge_kind_id 
          left join cost_income_item_arrt ciia on ciia.group_id = ccka.group_id
        and ciia.hos_id = ccka.hos_id
        and ciia.copy_code = ccka.copy_code
        and ciia.income_item_id = ccka.income_item_id_out 
        where ci.group_id =  #{group_id}
          and ci.hos_id =  #{hos_id}
          and ci.copy_code =  #{copy_code}
          and ci.acc_year || ci.acc_month between  #{year_month_begin} and  #{year_month_end}
          and hda.natur_code = '02'
        <if test="appl_dept_code != '' and appl_dept_code != null ">
		   and appl.dept_code like #{appl_dept_code}||'%'
	   </if>
	   <if test="exec_dept_code != '' and exec_dept_code != null ">
	    and exec.dept_code like #{exec_dept_code}||'%'
	   </if>
      ), 
      income_temp as (
        select  
		   hd.dept_code exec_dept_code,
		   hd.dept_name exec_dept_name,
		   income_item_code,
		   sum(nvl(money,0)) money
        from hos_dept hd
		left join temp t
		on t.exec_dept_code like hd.dept_code||'%'
		where hd.group_id = #{group_id}
		and hd.hos_id = #{hos_id}
	   <if test="dept_level != '' and dept_level != null ">
			<if test="dept_level == 0">
	            and is_last = 1
	        </if>
	        <if test="dept_level != 0">
	            and dept_level = #{dept_level}
	        </if>
		</if>
		group by hd.dept_code,hd.dept_name, income_item_code
		having sum(nvl(money,0)) != 0
      ), 
      income_temp_sum as (
        select  
			hd.dept_code exec_dept_code,
			hd.dept_name exec_dept_name,
			income_item_code,
			sum(nvl(money,0)) money
        from hos_dept hd
		left join temp t
		on t.exec_dept_code like hd.dept_code||'%'
		where hd.group_id = #{group_id}
		and hd.hos_id = #{hos_id}
		and hd.is_last = 1
		group by hd.dept_code,hd.dept_name, income_item_code
		having sum(nvl(money,0)) != 0
      )select 
			exec_dept_code,
			exec_dept_name,
			${field},
	        ${field_by}
			from income_temp
			pivot (max(money) for income_item_code in (${pivot}))
	   union all
		select
		   '合计',
		   null,
		   ${total_column},
		   ${total_row}
	     from income_temp_sum
		   pivot (max(money) for income_item_code in (${pivot}))
		  order by exec_dept_code
	</select>
	
	
	<select id="queryCostDeptIncomeAnalysisAchievementsAppl" parameterType="java.util.Map" resultType="java.util.Map">
              
               with dept as (
					select hdd.group_id, hdd.hos_id, hdd.dept_id as appl_dept_id, hdd.dept_no as
						appl_dept_no, hdd.dept_code as appl_dept_code, hdd.dept_name as appl_dept_name, 
						hdd.dept_level,hdd.is_last,	hdd.super_code
					from hos_dept_dict hdd
					left join acc_dept_attr ada on hdd.group_id = ada.group_id
					and hdd.hos_id = ada.hos_id
					and hdd.dept_id = ada.dept_id
					where hdd.group_id = #{group_id}
					and hdd.hos_id = #{hos_id}
					and hdd.is_stop = '0'
					<!-- and ada.type_code = '01' 河北医科大四院  开单科室 有非临床科室  此条件屏蔽不用 其他项目 自行 修改-->
				    <if test="appl_dept_code != '' and appl_dept_code != null ">
					  and hdd.dept_code like #{appl_dept_code}||'%'
					</if>
				), 
				income_detail as ( <!-- 门诊 、 住院 收费 数据 -->
					select b.group_id, b.hos_id, b.copy_code, e.dept_id appl_dept_id, e.dept_no appl_dept_no,
						e.dept_code appl_dept_code,	e.dept_name appl_dept_name,	c.income_item_code,
						sum(a.charge_money) money
					FROM cost_charge_o_view@his a <!--  河北医科大四院  其他项目 自行 修改 -->
					
					JOIN cost_charge_kind_arrt b
						ON a.charge_kind_code = b.charge_kind_code
					LEFT JOIN cost_income_item_arrt c
						on
							b.group_id = c.group_id
							and b.hos_id = c.hos_id
							and b.copy_code = c.copy_code
							and b.income_item_id_in = c.income_item_id
					LEFT JOIN hip_dept_ref d 
						ON b.group_id = d.group_id 
						AND b.hos_id = d.hos_id 
						AND a.appl_dept_code = d.hip_dept_code
						<!-- AND a.doc_type = d.doc_type  河北医科大四院 此条件屏蔽不用 其他项目 自行 修改 -->
						AND d.ds_code = '001' <!--  河北医科大四院  其他项目 自行 修改 -->
					LEFT JOIN hos_dept_dict e 
						ON d.group_id = e.group_id 
						AND d.hos_id = e.hos_id 
						AND d.hrp_dept_code = e.dept_code 
						AND e.is_stop = 0
					LEFT JOIN hip_dept_ref f 
						ON b.group_id = f.group_id 
						AND b.hos_id = f.hos_id 
						AND a.exec_dept_code = f.hip_dept_code
						<!-- AND a.doc_type = f.doc_type 河北医科大四院 此条件屏蔽不用 其他项目 自行 修改 -->
						AND f.ds_code = '001' <!--  河北医科大四院  其他项目 自行 修改 -->
					LEFT JOIN hos_dept_dict g 
						ON f.group_id = g.group_id 
						AND f.hos_id = g.hos_id 
						AND f.hrp_dept_code = g.dept_code 
						AND g.is_stop = 0
					where b.group_id = #{group_id}
					and b.hos_id = #{hos_id}
					and b.copy_code = #{copy_code}
					and a.acc_year || a.acc_month between #{year_month_begin} and #{year_month_end}
				    <if test="appl_dept_code != '' and appl_dept_code != null ">
						and e.dept_code like #{appl_dept_code}||'%'
					</if>
					<if test="exec_dept_code != '' and exec_dept_code != null ">
						and g.dept_code like #{exec_dept_code}||'%'
					</if>
					group by b.group_id, b.hos_id, b.copy_code, e.dept_id , e.dept_no ,	e.dept_code ,	
						e.dept_name ,	c.income_item_code
				union all 
					select b.group_id, b.hos_id, b.copy_code, e.dept_id appl_dept_id, e.dept_no appl_dept_no,
						e.dept_code appl_dept_code,	e.dept_name appl_dept_name,	c.income_item_code,
						sum(a.charge_money) money
					FROM cost_charge_i_view@his a <!--  河北医科大四院  其他项目 自行 修改 -->
					
					LEFT JOIN cost_charge_kind_arrt b
						ON a.charge_kind_code = b.charge_kind_code
					LEFT JOIN cost_income_item_arrt c
						on
							b.group_id = c.group_id
							and b.hos_id = c.hos_id
							and b.copy_code = c.copy_code
							and b.income_item_id_in = c.income_item_id
					LEFT JOIN hip_dept_ref d 
						ON b.group_id = d.group_id 
						AND b.hos_id = d.hos_id 
						AND a.appl_dept_code = d.hip_dept_code
						<!-- AND a.doc_type = d.doc_type  河北医科大四院 此条件屏蔽不用 其他项目 自行 修改 -->
						AND d.ds_code = '001' <!--  河北医科大四院  其他项目 自行 修改 -->
					LEFT JOIN hos_dept_dict e 
						ON d.group_id = e.group_id 
						AND d.hos_id = e.hos_id 
						AND d.hrp_dept_code = e.dept_code 
						AND e.is_stop = 0
					LEFT JOIN hip_dept_ref f 
						ON b.group_id = f.group_id 
						AND b.hos_id = f.hos_id 
						AND a.exec_dept_code = f.hip_dept_code
						<!-- AND a.doc_type = f.doc_type 河北医科大四院 此条件屏蔽不用 其他项目 自行 修改 -->
						AND f.ds_code = '001' <!--  河北医科大四院  其他项目 自行 修改 -->
					LEFT JOIN hos_dept_dict g 
						ON f.group_id = g.group_id 
						AND f.hos_id = g.hos_id 
						AND f.hrp_dept_code = g.dept_code 
						AND g.is_stop = 0
					where b.group_id = #{group_id}
					and b.hos_id = #{hos_id}
					and b.copy_code = #{copy_code}
					and a.acc_year || a.acc_month between #{year_month_begin} and #{year_month_end}
				    <if test="appl_dept_code != '' and appl_dept_code != null ">
						and e.dept_code like #{appl_dept_code}||'%'
					</if>
					<if test="exec_dept_code != '' and exec_dept_code != null ">
						and g.dept_code like #{exec_dept_code}||'%'
					</if>
					group by b.group_id, b.hos_id, b.copy_code, e.dept_id , e.dept_no ,	e.dept_code ,	
						e.dept_name ,	c.income_item_code
				) , 
				income as( <!-- 收费数据 汇总 -->
					select group_id, hos_id, copy_code, appl_dept_id, appl_dept_no, appl_dept_code,	
						appl_dept_name,	income_item_code, sum(money) money
					from income_detail 
					group by group_id, hos_id, copy_code, appl_dept_id, appl_dept_no, appl_dept_code,	
						appl_dept_name,	income_item_code
				),
				temp as (select
				a.group_id,
				a.hos_id,
				a.appl_dept_id,
				a.appl_dept_no,
				a.appl_dept_code,
				a.appl_dept_name,
				a.super_code,
				a.dept_level,
				a.is_last,
				b.income_item_code,
				b.money
				from dept a
				left join income b
				on a.group_id = b.group_id
				and a.hos_id = b.hos_id
				and a.appl_dept_id = b.appl_dept_id
				and a.appl_dept_no = b.appl_dept_no
				) , result as (
				select group_id,
						hos_id,
						appl_dept_id,
						appl_dept_no,
						appl_dept_code,
						appl_dept_name,
						super_code,
						dept_level,
						is_last,
				${field},
				${field_by}
				from temp 
				pivot (max(money) for income_item_code in (${pivot}))
				union all
				select null,
						null,
						null,
						null,
						'9999',
						'合计',
						null,
						null,
						null,
				${total_column},
				${total_row}
				from temp
				pivot (max(money) for income_item_code in (${pivot}))
				) select t.* from (
				 select group_id, hos_id, appl_dept_id, appl_dept_no,
				  appl_dept_code,
				  appl_dept_name,
				  dept_level,
				  is_last,
				   ${Superior},
				   (select 
					sum(nvl(item9999,0))
					from result p
					start with p.appl_dept_code = a.appl_dept_code
					connect by p.super_code = prior p.appl_dept_code
					)item9999
				from result a
				) t where item9999 &lt;&gt; 0
				 <if test="dept_level != '' and dept_level != null ">
					<if test="dept_level == 0">
			            and is_last = 1
			        </if>
			        <if test="dept_level != 0">
			            and dept_level = #{dept_level}
			        </if>
				</if>
		      order by group_id,hos_id,appl_dept_code

	</select>

</mapper>

