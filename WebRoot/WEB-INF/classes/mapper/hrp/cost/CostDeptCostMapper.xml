<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.chd.hrp.cost.dao.CostDeptCostMapper">
 
	<resultMap id="costDeptCost" type="com.chd.hrp.cost.entity.CostDeptCost">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="cost_item_id" column="cost_item_id" />
		<result property="cost_item_no" column="cost_item_no" />
		<result property="cost_item_code" column="cost_item_code" />
		<result property="cost_item_name" column="cost_item_name" />
		<result property="source_id" column="source_id" />
		<result property="source_code" column="source_code" />
		<result property="source_name" column="source_name" />
		<result property="dir_amount" column="dir_amount" />
		<result property="dir_man_amount" column="dir_man_amount" />
		<result property="dir_ass_amount" column="dir_ass_amount" />
		<result property="dir_med_amount" column="dir_med_amount" />
		<result property="indir_ass_man_amount" column="indir_ass_man_amount" />
		<result property="indir_med_man_amount" column="indir_med_man_amount" />
		<result property="indir_ass_med_man_amount" column="indir_ass_med_man_amount" />
		<result property="indir_med_ass_amount" column="indir_med_ass_amount" />
	</resultMap>
	<resultMap id="costDeptDriData" type="com.chd.hrp.cost.entity.CostDeptDriData">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="year_month" column="year_month" />
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="cost_item_id" column="cost_item_id" />
		<result property="cost_item_no" column="cost_item_no" />
		<result property="cost_item_code" column="cost_item_code" />
		<result property="cost_item_name" column="cost_item_name" />
		<result property="source_id" column="source_id" />
		<result property="source_code" column="source_code" />
		<result property="source_name" column="source_name" />
		<result property="dir_amount" column="dir_amount" />
		<result property="type_code" column="type_code" />
		<result property="type_name" column="type_name" />
		<result property="natur_code" column="natur_code" />
		<result property="natur_name" column="natur_name" />
		<result property="para_type_code" column="para_type_code" />
		<result property="para_type_name" column="para_type_name" />
		<result property="peer_flag" column="peer_flag" />
	</resultMap>
	<resultMap id="costDeptCostMap" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="cost_item_id" column="cost_item_id" />
		<result property="cost_item_no" column="cost_item_no" />
		<result property="source_id" column="source_id" />
		<result property="dir_amount" column="dir_amount" />
		<result property="dir_man_amount" column="dir_man_amount" />
		<result property="dir_ass_amount" column="dir_ass_amount" />
		<result property="dir_med_amount" column="dir_med_amount" />
		<result property="indir_ass_man_amount" column="indir_ass_man_amount" />
		<result property="indir_med_man_amount" column="indir_med_man_amount" />
		<result property="indir_ass_med_man_amount" column="indir_ass_med_man_amount" />
		<result property="indir_med_ass_amount" column="indir_med_ass_amount" />
	</resultMap>
	<resultMap id="costDeptDirDataMap" type="java.util.Map">
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="cost_item_id" column="cost_item_id" />
		<result property="cost_item_no" column="cost_item_no" />
		<result property="source_id" column="source_id" />
		<result property="dir_amount" column="dir_amount" />
		<result property="type_code" column="type_code" />
		<result property="natur_code" column="natur_code" />
		<result property="para_type_code" column="para_type_code" />

	</resultMap>

	<resultMap id="costDeptParaMap" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="acc_year" column="acc_year" />
		<result property="acc_month" column="acc_month" />
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="type_code" column="type_code" />
		<result property="natur_code" column="natur_code" />
		<result property="para_type_code" column="para_type_code" />
		<result property="para_code" column="para_code" />
		<result property="bill_code" column="bill_code" />

	</resultMap>
	<resultMap id="costServerDeptParaMap" type="java.util.Map">
		<result property="server_dept_id" column="server_dept_id" />
		<result property="server_dept_no" column="server_dept_no" />
		<result property="server_dept_code" column="server_dept_code" />
		<result property="server_dept_name" column="server_dept_name" />
		<result property="server_type_code" column="server_type_code" />
		<result property="server_natur_code" column="server_natur_code" />
		<result property="bill_code" column="bill_code" />

	</resultMap>
	<resultMap id="costDeptParaNumMap" type="java.util.Map">
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="server_dept_id" column="server_dept_id" />
		<result property="server_dept_no" column="server_dept_no" />
		<result property="para_code" column="para_code" />
		<result property="para_type_code" column="para_type_code" />
		<result property="num_amount" column="num_amount" />
		<result property="server_dept_code" column="server_dept_code" />
		<result property="server_dept_name" column="server_dept_name" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
	</resultMap>
	<resultMap id="costDeptParaListData" type="java.util.Map">
		<result property="type_code" column="type_code" />
		<result property="natur_code" column="natur_code" />
		<result property="server_type_code" column="server_type_code" />
		<result property="server_natur_code" column="server_natur_code" />
		<result property="dept_id" column="dept_id" />
		<result property="dept_no" column="dept_no" />
		<result property="server_dept_id" column="server_dept_id" />
		<result property="server_dept_no" column="server_dept_no" />
		<result property="para_code" column="para_code" />
		<result property="para_type_code" column="para_type_code" />
		<result property="server_dept_code" column="server_dept_code" />
		<result property="server_dept_name" column="server_dept_name" />
		<result property="dept_code" column="dept_code" />
		<result property="dept_name" column="dept_name" />
		<result property="peer_flag" column="peer_flag" />
	</resultMap>
	<resultMap id="costDeptCostCheck" type="java.util.Map">
		<result property="group_id" column="group_id" />
		<result property="hos_id" column="hos_id" />
		<result property="copy_code" column="copy_code" />
		<result property="message_code" column="message_code" />
		<result property="message_name" column="message_name" />
		<result property="message_note" column="message_note" />
	</resultMap>
	<insert id="add" useGeneratedKeys="true">

		INSERT INTO COST_DEPT_COST (
		group_id
		,
		hos_id
		,
		copy_code
		,
		acc_year
		,
		acc_month
		,
		dept_id
		,
		dept_no
		,
		cost_item_id
		,
		cost_item_no
		,
		source_id
		,
		dir_amount
		,
		dir_man_amount
		,
		dir_ass_amount
		,
		dir_med_amount
		,
		indir_ass_man_amount
		,
		indir_med_man_amount
		,
		indir_ass_med_man_amount
		,
		indir_med_ass_amount
		)
		VALUES (
		#{group_id,jdbcType=INTEGER}
		,
		#{hos_id,jdbcType=INTEGER}
		,
		#{copy_code,jdbcType=VARCHAR}
		,
		#{acc_year,jdbcType=VARCHAR}
		,
		#{acc_month,jdbcType=VARCHAR}
		,
		#{dept_id,jdbcType=INTEGER}
		,
		#{dept_no,jdbcType=INTEGER}
		,
		#{cost_item_id,jdbcType=INTEGER}
		,
		#{cost_item_no,jdbcType=INTEGER}
		,
		#{source_id,jdbcType=INTEGER}
		,
		#{dir_amount,jdbcType=INTEGER}
		,
		#{dir_man_amount,jdbcType=INTEGER}
		,
		#{dir_ass_amount,jdbcType=INTEGER}
		,
		#{dir_med_amount,jdbcType=INTEGER}
		,
		#{indir_ass_man_amount,jdbcType=INTEGER}
		,
		#{indir_med_man_amount,jdbcType=INTEGER}
		,
		#{indir_ass_med_man_amount,jdbcType=INTEGER}
		,
		#{indir_med_ass_amount,jdbcType=INTEGER}
		)

	</insert>
	<insert id="addBatch" parameterType="java.util.List">

		INSERT INTO COST_DEPT_COST (
		group_id
		,
		hos_id
		,
		copy_code
		,
		acc_year
		,
		acc_month
		,
		dept_id
		,
		dept_no
		,
		cost_item_id
		,
		cost_item_no
		,
		source_id
		,
		dir_amount
		,
		dir_man_amount
		,
		dir_ass_amount
		,
		dir_med_amount
		,
		indir_ass_man_amount
		,
		indir_med_man_amount
		,
		indir_ass_med_man_amount
		,
		indir_med_ass_amount
		) select t.* from(
		<foreach collection="list" item="item" index="index"
			separator=" union all ">
			select
			#{item.group_id}
			,
			#{item.hos_id}
			,
			#{item.copy_code}
			,
			#{item.acc_year}
			,
			#{item.acc_month}
			,
			#{item.dept_id}
			,
			#{item.dept_no}
			,
			#{item.cost_item_id}
			,
			#{item.cost_item_no}
			,
			#{item.source_id}
			,
			#{item.dir_amount}
			,
			#{item.dir_man_amount}
			,
			#{item.dir_ass_amount}
			,
			#{item.dir_med_amount}
			,
			#{item.indir_ass_man_amount}
			,
			#{item.indir_med_man_amount}
			,
			#{item.indir_ass_med_man_amount}
			,
			#{item.indir_med_ass_amount}

			from dual
		</foreach>
		)t
	</insert>

	<update id="update" parameterType="java.util.Map">

		UPDATE cost_dept_cost
		<trim prefix="SET" suffixOverrides=",">
			<if test="dept_no != null and dept_no != ''">
				dept_no = #{dept_no,jdbcType=INTEGER}
				,
			</if>
			<if test="cost_item_no != null and cost_item_no != ''">
				cost_item_no = #{cost_item_no,jdbcType=INTEGER}
				,
			</if>
			<if test="dir_amount != null and dir_amount != ''">
				dir_amount = #{dir_amount,jdbcType=INTEGER}
				,
			</if>
			<if test="dir_man_amount != null and dir_man_amount != ''">
				dir_man_amount = #{dir_man_amount,jdbcType=INTEGER}
				,
			</if>
			<if test="dir_ass_amount != null and dir_ass_amount != ''">
				dir_ass_amount = #{dir_ass_amount,jdbcType=INTEGER}
				,
			</if>
			<if test="dir_med_amount != null and dir_med_amount != ''">
				dir_med_amount = #{dir_med_amount,jdbcType=INTEGER}
				,
			</if>
			<if test="indir_ass_man_amount != null and indir_ass_man_amount != ''">
				indir_ass_man_amount =
				#{indir_ass_man_amount,jdbcType=INTEGER}
				,
			</if>
			<if test="indir_med_man_amount != null and indir_med_man_amount != ''">
				indir_med_man_amount =
				#{indir_med_man_amount,jdbcType=INTEGER}
				,
			</if>
			<if
				test="indir_ass_med_man_amount != null and indir_ass_med_man_amount != ''">
				indir_ass_med_man_amount =
				#{indir_ass_med_man_amount,jdbcType=INTEGER}
				,
			</if>
			<if test="indir_med_ass_amount != null and indir_med_ass_amount != ''">
				indir_med_ass_amount =
				#{indir_med_ass_amount,jdbcType=INTEGER}
				,
			</if>
		</trim>
		<where>
			<if test="group_id != null and group_id != ''">
				AND group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND dept_id = #{dept_id,jdbcType=INTEGER}
			</if>
			<if test="dept_no != null and dept_no != ''">
				AND dept_no = #{dept_no,jdbcType=INTEGER}
			</if>
			<if test="cost_item_id != null and cost_item_id != ''">
				AND cost_item_id = #{cost_item_id,jdbcType=INTEGER}
			</if>
			<if test="cost_item_no != null and cost_item_no != ''">
				AND cost_item_no = #{cost_item_no,jdbcType=INTEGER}
			</if>
			<if test="source_id != null and source_id != ''">
				AND source_id = #{source_id,jdbcType=INTEGER}
			</if>
			<if test="dir_amount != null and dir_amount != ''">
				AND dir_amount = #{dir_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_man_amount != null and dir_man_amount != ''">
				AND dir_man_amount = #{dir_man_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_ass_amount != null and dir_ass_amount != ''">
				AND dir_ass_amount = #{dir_ass_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_med_amount != null and dir_med_amount != ''">
				AND dir_med_amount = #{dir_med_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_ass_man_amount != null and indir_ass_man_amount != ''">
				AND indir_ass_man_amount =
				#{indir_ass_man_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_med_man_amount != null and indir_med_man_amount != ''">
				AND indir_med_man_amount =
				#{indir_med_man_amount,jdbcType=INTEGER}
			</if>
			<if
				test="indir_ass_med_man_amount != null and indir_ass_med_man_amount != ''">
				AND indir_ass_med_man_amount =
				#{indir_ass_med_man_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_med_ass_amount != null and indir_med_ass_amount != ''">
				AND indir_med_ass_amount =
				#{indir_med_ass_amount,jdbcType=INTEGER}
			</if>
		</where>
	</update>
	<update id="updateBatch" parameterType="java.util.List">

		<foreach collection="list" item="item" index="index" open="begin"
			close=";end;" separator=";">
			UPDATE cost_dept_cost
			<trim prefix="SET" suffixOverrides=",">
				<if test="item.dept_no != null and item.dept_no != ''">
					dept_no = #{item.dept_no,jdbcType=INTEGER}
					,
				</if>
				<if test="item.cost_item_no != null and item.cost_item_no != ''">
					cost_item_no = #{item.cost_item_no,jdbcType=INTEGER}
					,
				</if>
				<if test="item.dir_amount != null and item.dir_amount != ''">
					dir_amount = #{item.dir_amount,jdbcType=INTEGER}
					,
				</if>
				<if test="item.dir_man_amount != null and item.dir_man_amount != ''">
					dir_man_amount = #{item.dir_man_amount,jdbcType=INTEGER}
					,
				</if>
				<if test="item.dir_ass_amount != null and item.dir_ass_amount != ''">
					dir_ass_amount = #{item.dir_ass_amount,jdbcType=INTEGER}
					,
				</if>
				<if test="item.dir_med_amount != null and item.dir_med_amount != ''">
					dir_med_amount = #{item.dir_med_amount,jdbcType=INTEGER}
					,
				</if>
				<if
					test="item.indir_ass_man_amount != null and item.indir_ass_man_amount != ''">
					indir_ass_man_amount =
					#{item.indir_ass_man_amount,jdbcType=INTEGER}
					,
				</if>
				<if
					test="item.indir_med_man_amount != null and item.indir_med_man_amount != ''">
					indir_med_man_amount =
					#{item.indir_med_man_amount,jdbcType=INTEGER}
					,
				</if>
				<if
					test="item.indir_ass_med_man_amount != null and item.indir_ass_med_man_amount != ''">
					indir_ass_med_man_amount =
					#{item.indir_ass_med_man_amount,jdbcType=INTEGER}
					,
				</if>
				<if
					test="item.indir_med_ass_amount != null and item.indir_med_ass_amount != ''">
					indir_med_ass_amount =
					#{item.indir_med_ass_amount,jdbcType=INTEGER}
					,
				</if>
			</trim>
			<where>
				<if test="item.group_id != null and item.group_id != ''">
					AND group_id = #{item.group_id,jdbcType=INTEGER}
				</if>
				<if test="item.hos_id != null and item.hos_id != ''">
					AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				</if>
				<if test="item.copy_code != null and item.copy_code != ''">
					AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				</if>
				<if test="item.acc_year != null and item.acc_year != ''">
					AND acc_year = #{item.acc_year,jdbcType=VARCHAR}
				</if>
				<if test="item.acc_month != null and item.acc_month != ''">
					AND acc_month = #{item.acc_month,jdbcType=VARCHAR}
				</if>
				<if test="item.dept_id != null and item.dept_id != ''">
					AND dept_id = #{item.dept_id,jdbcType=INTEGER}
				</if>
				<if test="item.dept_no != null and item.dept_no != ''">
					AND dept_no = #{item.dept_no,jdbcType=INTEGER}
				</if>
				<if test="item.cost_item_id != null and item.cost_item_id != ''">
					AND cost_item_id = #{item.cost_item_id,jdbcType=INTEGER}
				</if>
				<if test="item.cost_item_no != null and item.cost_item_no != ''">
					AND cost_item_no = #{item.cost_item_no,jdbcType=INTEGER}
				</if>
				<if test="item.source_id != null and item.source_id != ''">
					AND source_id = #{item.source_id,jdbcType=INTEGER}
				</if>
				<if test="item.dir_amount != null and item.dir_amount != ''">
					AND dir_amount = #{item.dir_amount,jdbcType=INTEGER}
				</if>
				<if test="item.dir_man_amount != null and item.dir_man_amount != ''">
					AND dir_man_amount =
					#{item.dir_man_amount,jdbcType=INTEGER}
				</if>
				<if test="item.dir_ass_amount != null and item.dir_ass_amount != ''">
					AND dir_ass_amount =
					#{item.dir_ass_amount,jdbcType=INTEGER}
				</if>
				<if test="item.dir_med_amount != null and item.dir_med_amount != ''">
					AND dir_med_amount =
					#{item.dir_med_amount,jdbcType=INTEGER}
				</if>
				<if
					test="item.indir_ass_man_amount != null and item.indir_ass_man_amount != ''">
					AND indir_ass_man_amount =
					#{item.indir_ass_man_amount,jdbcType=INTEGER}
				</if>
				<if
					test="item.indir_med_man_amount != null and item.indir_med_man_amount != ''">
					AND indir_med_man_amount =
					#{item.indir_med_man_amount,jdbcType=INTEGER}
				</if>
				<if
					test="item.indir_ass_med_man_amount != null and item.indir_ass_med_man_amount != ''">
					AND indir_ass_med_man_amount =
					#{item.indir_ass_med_man_amount,jdbcType=INTEGER}
				</if>
				<if
					test="item.indir_med_ass_amount != null and item.indir_med_ass_amount != ''">
					AND indir_med_ass_amount =
					#{item.indir_med_ass_amount,jdbcType=INTEGER}
				</if>
			</where>
		</foreach>
	</update>

	<delete id="delete" parameterType="java.util.Map">

		DELETE FROM cost_dept_cost
		<where>
			<if test="group_id != null and group_id != ''">
				AND group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND dept_id = #{dept_id,jdbcType=INTEGER}
			</if>
			<if test="dept_no != null and dept_no != ''">
				AND dept_no = #{dept_no,jdbcType=INTEGER}
			</if>
			<if test="cost_item_id != null and cost_item_id != ''">
				AND cost_item_id = #{cost_item_id,jdbcType=INTEGER}
			</if>
			<if test="cost_item_no != null and cost_item_no != ''">
				AND cost_item_no = #{cost_item_no,jdbcType=INTEGER}
			</if>
			<if test="source_id != null and source_id != ''">
				AND source_id = #{source_id,jdbcType=INTEGER}
			</if>
			<if test="dir_amount != null and dir_amount != ''">
				AND dir_amount = #{dir_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_man_amount != null and dir_man_amount != ''">
				AND dir_man_amount = #{dir_man_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_ass_amount != null and dir_ass_amount != ''">
				AND dir_ass_amount = #{dir_ass_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_med_amount != null and dir_med_amount != ''">
				AND dir_med_amount = #{dir_med_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_ass_man_amount != null and indir_ass_man_amount != ''">
				AND indir_ass_man_amount =
				#{indir_ass_man_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_med_man_amount != null and indir_med_man_amount != ''">
				AND indir_med_man_amount =
				#{indir_med_man_amount,jdbcType=INTEGER}
			</if>
			<if
				test="indir_ass_med_man_amount != null and indir_ass_med_man_amount != ''">
				AND indir_ass_med_man_amount =
				#{indir_ass_med_man_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_med_ass_amount != null and indir_med_ass_amount != ''">
				AND indir_med_ass_amount =
				#{indir_med_ass_amount,jdbcType=INTEGER}
			</if>
		</where>
	</delete>
	<delete id="deleteBatch" parameterType="java.util.List">
		DELETE FROM cost_dept_cost
		<where>
			<foreach collection="list" index="index" item="item" open="("
				separator="or" close=")">
				<if test="item.group_id != null and item.group_id != ''">
					AND group_id = #{item.group_id,jdbcType=INTEGER}
				</if>
				<if test="item.hos_id != null and item.hos_id != ''">
					AND hos_id = #{item.hos_id,jdbcType=INTEGER}
				</if>
				<if test="item.copy_code != null and item.copy_code != ''">
					AND copy_code = #{item.copy_code,jdbcType=VARCHAR}
				</if>
				<if test="item.acc_year != null and item.acc_year != ''">
					AND acc_year = #{item.acc_year,jdbcType=VARCHAR}
				</if>
				<if test="item.acc_month != null and item.acc_month != ''">
					AND acc_month = #{item.acc_month,jdbcType=VARCHAR}
				</if>
				<if test="item.dept_id != null and item.dept_id != ''">
					AND dept_id = #{item.dept_id,jdbcType=INTEGER}
				</if>
				<if test="item.dept_no != null and item.dept_no != ''">
					AND dept_no = #{item.dept_no,jdbcType=INTEGER}
				</if>
				<if test="item.cost_item_id != null and item.cost_item_id != ''">
					AND cost_item_id = #{item.cost_item_id,jdbcType=INTEGER}
				</if>
				<if test="item.cost_item_no != null and item.cost_item_no != ''">
					AND cost_item_no = #{item.cost_item_no,jdbcType=INTEGER}
				</if>
				<if test="item.source_id != null and item.source_id != ''">
					AND source_id = #{item.source_id,jdbcType=INTEGER}
				</if>
				<if test="item.dir_amount != null and item.dir_amount != ''">
					AND dir_amount = #{item.dir_amount,jdbcType=INTEGER}
				</if>
				<if test="item.dir_man_amount != null and item.dir_man_amount != ''">
					AND dir_man_amount =
					#{item.dir_man_amount,jdbcType=INTEGER}
				</if>
				<if test="item.dir_ass_amount != null and item.dir_ass_amount != ''">
					AND dir_ass_amount =
					#{item.dir_ass_amount,jdbcType=INTEGER}
				</if>
				<if test="item.dir_med_amount != null and item.dir_med_amount != ''">
					AND dir_med_amount =
					#{item.dir_med_amount,jdbcType=INTEGER}
				</if>
				<if
					test="item.indir_ass_man_amount != null and item.indir_ass_man_amount != ''">
					AND indir_ass_man_amount =
					#{item.indir_ass_man_amount,jdbcType=INTEGER}
				</if>
				<if
					test="item.indir_med_man_amount != null and item.indir_med_man_amount != ''">
					AND indir_med_man_amount =
					#{item.indir_med_man_amount,jdbcType=INTEGER}
				</if>
				<if
					test="item.indir_ass_med_man_amount != null and item.indir_ass_med_man_amount != ''">
					AND indir_ass_med_man_amount =
					#{item.indir_ass_med_man_amount,jdbcType=INTEGER}
				</if>
				<if
					test="item.indir_med_ass_amount != null and item.indir_med_ass_amount != ''">
					AND indir_med_ass_amount =
					#{item.indir_med_ass_amount,jdbcType=INTEGER}
				</if>
			</foreach>
		</where>
	</delete>
	<select id="query" parameterType="java.util.Map" resultMap="costDeptCost">
		SELECT
		a.group_id,
		a.hos_id,
		a.copy_code,
		a.acc_year,
		a.acc_month,
		a.acc_year||a.acc_month as acc_year_month,
		a.dept_id,
		dept_code,
		dept_name,
		a.cost_item_id,
		cost_item_code,
		cost_item_name,
		a.source_id,
		source_code,
		source_name,
		dir_amount,
		dir_man_amount,
		dir_ass_amount,
		dir_med_amount,
		indir_ass_man_amount,
		indir_med_man_amount,
		indir_ass_med_man_amount,
		indir_med_ass_amount
		FROM COST_DEPT_COST a
		left join hos_dept_dict b on
		b.group_id=a.group_id and b.hos_id=a.hos_id
		and b.dept_id=a.dept_id 
		and b.is_stop=0
		left join cost_item_dict_no c on
		c.group_id=a.group_id and
		c.hos_id=a.hos_id and c.copy_code=a.copy_code
		and
		c.cost_item_id=a.cost_item_id and c.is_stop=0
		left join hos_source d on d.group_id=a.group_id and d.hos_id=a.hos_id
		and
		d.source_id=a.source_id

		<where>
			<if test="group_id != null and group_id != ''">
				AND a.group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND a.acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND a.acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND a.dept_id = #{dept_id,jdbcType=INTEGER}
			</if>
			
			<if test="cost_item_id != null and cost_item_id != ''">
				AND a.cost_item_id = #{cost_item_id,jdbcType=INTEGER}
			</if>
			
			<if test="source_id != null and source_id != ''">
				AND a.source_id = #{source_id,jdbcType=INTEGER}
			</if>
		</where>
		order by dept_code,cost_item_code,source_code asc
	</select>
	
	<select id="queryCostDeptCostPrint" parameterType="java.util.Map" resultType="java.util.Map">
		SELECT
		a.group_id,
		a.hos_id,
		a.copy_code,
		a.acc_year,
		a.acc_month,
		a.acc_year||a.acc_month as acc_year_month,
		a.dept_id,
		dept_code,
		dept_name,
		a.cost_item_id,
		cost_item_code,
		cost_item_name,
		a.source_id,
		source_code,
		source_name,
		dir_amount,
		dir_man_amount,
		dir_ass_amount,
		dir_med_amount,
		indir_ass_man_amount,
		indir_med_man_amount,
		indir_ass_med_man_amount,
		indir_med_ass_amount
		FROM COST_DEPT_COST a
		left join hos_dept_dict b on
		b.group_id=a.group_id and b.hos_id=a.hos_id
		and b.dept_id=a.dept_id and
		b.is_stop=0
		left join cost_item_dict_no c on
		c.group_id=a.group_id and
		c.hos_id=a.hos_id and c.copy_code=a.copy_code
		and
		c.cost_item_id=a.cost_item_id and c.is_stop=0
		left join hos_source d on d.group_id=a.group_id and d.hos_id=a.hos_id
		and
		d.source_id=a.source_id

		<where>
			<if test="group_id != null and group_id != ''">
				AND a.group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND a.hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND a.copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND a.acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND a.acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND a.dept_id = #{dept_id,jdbcType=INTEGER}
			</if>
			
			<if test="cost_item_id != null and cost_item_id != ''">
				AND a.cost_item_id = #{cost_item_id,jdbcType=INTEGER}
			</if>
			
			<if test="source_id != null and source_id != ''">
				AND a.source_id = #{source_id,jdbcType=INTEGER}
			</if>
		</where>
		order by dept_code,cost_item_code,source_code asc
	</select>
	
	<select id="queryByCode" resultMap="costDeptCost" parameterType="java.util.Map">

		SELECT
		group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		cost_item_id,
		source_id,
		dir_amount,
		dir_man_amount,
		dir_ass_amount,
		dir_med_amount,
		indir_ass_man_amount,
		indir_med_man_amount,
		indir_ass_med_man_amount,
		indir_med_ass_amount
		FROM cost_dept_cost
		WHERE
		group_id = #{group_id,jdbcType=INTEGER} and
		hos_id = #{hos_id,jdbcType=INTEGER} and
		copy_code =
		#{copy_code,jdbcType=VARCHAR} and
		acc_year =
		#{acc_year,jdbcType=VARCHAR} and
		acc_month =
		#{acc_month,jdbcType=VARCHAR} and
		dept_id = #{dept_id,jdbcType=INTEGER}
		and
		cost_item_id = #{cost_item_id,jdbcType=INTEGER} and
		source_id =
		#{source_id,jdbcType=INTEGER}

	</select>
	<select id="queryByUniqueness" resultMap="costDeptCost"
		parameterType="java.util.Map">

		SELECT
		group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		cost_item_id,
		source_id,
		dir_amount,
		dir_man_amount,
		dir_ass_amount,
		dir_med_amount,
		indir_ass_man_amount,
		indir_med_man_amount,
		indir_ass_med_man_amount,
		indir_med_ass_amount
		FROM COST_DEPT_COST
		<where>
			<if test="group_id != null and group_id != ''">
				AND group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND dept_id = #{dept_id,jdbcType=INTEGER}
			</if>
			
			<if test="cost_item_id != null and cost_item_id != ''">
				AND cost_item_id = #{cost_item_id,jdbcType=INTEGER}
			</if>
			
			<if test="source_id != null and source_id != ''">
				AND source_id = #{source_id,jdbcType=INTEGER}
			</if>
			<if test="dir_amount != null and dir_amount != ''">
				AND dir_amount = #{dir_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_man_amount != null and dir_man_amount != ''">
				AND dir_man_amount = #{dir_man_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_ass_amount != null and dir_ass_amount != ''">
				AND dir_ass_amount = #{dir_ass_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_med_amount != null and dir_med_amount != ''">
				AND dir_med_amount = #{dir_med_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_ass_man_amount != null and indir_ass_man_amount != ''">
				AND indir_ass_man_amount =
				#{indir_ass_man_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_med_man_amount != null and indir_med_man_amount != ''">
				AND indir_med_man_amount =
				#{indir_med_man_amount,jdbcType=INTEGER}
			</if>
			<if
				test="indir_ass_med_man_amount != null and indir_ass_med_man_amount != ''">
				AND indir_ass_med_man_amount =
				#{indir_ass_med_man_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_med_ass_amount != null and indir_med_ass_amount != ''">
				AND indir_med_ass_amount =
				#{indir_med_ass_amount,jdbcType=INTEGER}
			</if>
		</where>
		order by dept_id asc
	</select>
	<select id="queryExists" resultMap="costDeptCost" parameterType="java.util.Map">

		SELECT
		group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		cost_item_id,
		source_id,
		dir_amount,
		dir_man_amount,
		dir_ass_amount,
		dir_med_amount,
		indir_ass_man_amount,
		indir_med_man_amount,
		indir_ass_med_man_amount,
		indir_med_ass_amount
		FROM COST_DEPT_COST
		<where>
			<if test="group_id != null and group_id != ''">
				AND group_id = #{group_id,jdbcType=INTEGER}
			</if>
			<if test="hos_id != null and hos_id != ''">
				AND hos_id = #{hos_id,jdbcType=INTEGER}
			</if>
			<if test="copy_code != null and copy_code != ''">
				AND copy_code = #{copy_code,jdbcType=VARCHAR}
			</if>
			<if test="acc_year != null and acc_year != ''">
				AND acc_year = #{acc_year,jdbcType=VARCHAR}
			</if>
			<if test="acc_month != null and acc_month != ''">
				AND acc_month = #{acc_month,jdbcType=VARCHAR}
			</if>
			<if test="dept_id != null and dept_id != ''">
				AND dept_id = #{dept_id,jdbcType=INTEGER}
			</if>
			
			<if test="cost_item_id != null and cost_item_id != ''">
				AND cost_item_id = #{cost_item_id,jdbcType=INTEGER}
			</if>
			
			<if test="source_id != null and source_id != ''">
				AND source_id = #{source_id,jdbcType=INTEGER}
			</if>
			<if test="dir_amount != null and dir_amount != ''">
				AND dir_amount = #{dir_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_man_amount != null and dir_man_amount != ''">
				AND dir_man_amount = #{dir_man_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_ass_amount != null and dir_ass_amount != ''">
				AND dir_ass_amount = #{dir_ass_amount,jdbcType=INTEGER}
			</if>
			<if test="dir_med_amount != null and dir_med_amount != ''">
				AND dir_med_amount = #{dir_med_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_ass_man_amount != null and indir_ass_man_amount != ''">
				AND indir_ass_man_amount =
				#{indir_ass_man_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_med_man_amount != null and indir_med_man_amount != ''">
				AND indir_med_man_amount =
				#{indir_med_man_amount,jdbcType=INTEGER}
			</if>
			<if
				test="indir_ass_med_man_amount != null and indir_ass_med_man_amount != ''">
				AND indir_ass_med_man_amount =
				#{indir_ass_med_man_amount,jdbcType=INTEGER}
			</if>
			<if test="indir_med_ass_amount != null and indir_med_ass_amount != ''">
				AND indir_med_ass_amount =
				#{indir_med_ass_amount,jdbcType=INTEGER}
			</if>
		</where>
		order by dept_id asc
	</select>
	<select id="queryDeptDirData" resultMap="costDeptDriData"
		parameterType="java.util.Map">
		select a.group_id,
		a.hos_id,
		a.copy_code,
		a.acc_year,
		a.acc_month,
		a.dept_id,
		a.dept_code,
		a.dept_name,
		a.cost_item_id,
		a.cost_item_code,
		a.cost_item_name,
		a.source_id,
		a.source_code,
		a.source_name,
		a.dir_amount,
		a.type_code,
		a.type_name,
		a.natur_code,
		a.para_type_code,
		a.para_type_name,
		a.peer_flag,
		a.para_code,
		a.para_name,
		para_value,
		para_value_name from(
		select
		a.group_id,a.hos_id,a.copy_code,a.acc_year,a.acc_month,a.dept_id,t1.dept_code,t1.dept_name,a.cost_item_id,c.cost_item_code,c.cost_item_name,
		a.source_id,t3.source_code,t3.source_name,a.dir_amount,b.type_code,t4.type_name,b.natur_code,c.para_type_code,d.type_name
		para_type_name,decode(t2.dept_id,null,0,1)
		peer_flag,b.para_code,cn.para_name
		from cost_dept_dri_data a
		left join
		acc_dept_attr b on
		b.group_id=a.group_id and b.hos_id=a.hos_id
		and
		b.dept_id=a.dept_id
		left join cost_item_dict_no c on
		c.group_id=a.group_id and
		c.hos_id=a.hos_id and c.copy_code=a.copy_code
		and
		c.cost_item_id=a.cost_item_id 
		left join COST_PARA_TYPE d on d.group_id=c.group_id and
		d.hos_id=c.hos_id
		and d.copy_code=c.copy_code and
		d.type_code=c.para_type_code
		left
		join
		hos_dept_dict t1 on
		a.group_id=t1.group_id and a.hos_id=t1.hos_id
		and
		a.dept_id=t1.dept_id
		and t1.is_stop=0
		left join hos_source
		t3 on
		t3.group_id=a.group_id and t3.hos_id=a.hos_id and
		t3.source_id=a.source_id
		left join acc_dept_type t4 on
		t4.type_code=b.type_code
		left join COST_PARA_NATUR cn on b.para_code =
		cn.para_code
		and b.group_id = cn.group_id
		and b.hos_id = cn.hos_id
		left
		join (
		select
		distinct t1.dept_id
		from cost_para_dept t1,
		cost_para_server_dept t2
		where
		t1.group_id = t2.group_id
		and t1.hos_id =
		t2.hos_id
		and t1.copy_code =
		t2.copy_code
		and t1.acc_year=t2.acc_year
		and
		t1.acc_month=t2.acc_month
		and t1.bill_code = t2.bill_code
		and
		t1.type_code = t2.type_code
		and
		t1.group_id=#{group_id,jdbcType=INTEGER}
		and
		t1.hos_id=#{hos_id,jdbcType=INTEGER} and
		t1.copy_code=#{copy_code,jdbcType=VARCHAR} and
		t1.acc_year=#{acc_year,jdbcType=VARCHAR}
		and t1.acc_month=
		#{acc_month,jdbcType=VARCHAR}
		) t2 on a.dept_id=t2.dept_id 
		where
		a.group_id = #{group_id,jdbcType=INTEGER}
		AND a.hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND a.copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND a.acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND a.acc_month =
		#{acc_month,jdbcType=VARCHAR}
		<!-- and t1.is_last=1 and t1.is_stop=0 -->
		and c.is_last=1 and c.is_stop=0
		) a
		left join ( 
		select a.natur_code, a.type_code,a.para_value,b.para_name para_value_name
		from cost_para_set a
		left join COST_DEPT_PARA_DICT b
		on b.group_id =a.group_id
		and b.hos_id =a.hos_id and b.copy_code =a.copy_code and b.para_code
		=a.para_value
		where a.group_id=#{group_id,jdbcType=INTEGER} and
		a.hos_id=#{hos_id,jdbcType=INTEGER} and
		a.copy_code=#{copy_code,jdbcType=VARCHAR} and
		a.acc_year=#{acc_year,jdbcType=VARCHAR} and
		a.acc_month=#{acc_month,jdbcType=VARCHAR}
		) t5 on a.para_code=t5.natur_code and a.para_type_code=t5.type_code

		order by type_code,dept_code,cost_item_code,source_id asc
	</select>
	<select id="queryDeptAmount" resultMap="costDeptParaNumMap"
		parameterType="java.util.Map">
		select t1.dept_id,
		
		t2.dept_code,
		t2.dept_name,
		t1.server_dept_id,
		
		t3.dept_code server_dept_code,
		t3.dept_name server_dept_name,
		para_code,
		para_type_code,
		num_amount
		from
		v_cost_para_dept t1
		left join hos_dept_dict
		t2
		on t1.group_id =
		t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.dept_id
		= t2.dept_id
		and
		
		left join hos_dept_dict
		t3
		on t1.group_id =
		t3.group_id
		and
		t1.hos_id = t3.hos_id
		and
		t1.server_dept_id = t3.dept_id
		
		<where>
			AND t1.group_id = #{group_id,jdbcType=INTEGER}
			AND t1.hos_id =
			#{hos_id,jdbcType=INTEGER}
			AND copy_code =
			#{copy_code,jdbcType=VARCHAR}
			AND acc_year =
			#{acc_year,jdbcType=VARCHAR}
			AND acc_month =
			#{acc_month,jdbcType=VARCHAR}
			and num_amount!=0
			and t2.is_last=1
			and
			t3.is_last=1
		</where>
		order by t1.dept_id,server_dept_id,para_code,para_type_code asc
	</select>
	<select id="queryDeptSumAmount" resultMap="costDeptParaNumMap"
		parameterType="java.util.Map">
		select t1.dept_id,
		
		t2.dept_code,
		t2.dept_name,
		para_code,
		para_type_code,
		sum(num_amount) num_amount
		from v_cost_para_dept t1
		left
		join hos_dept_dict t2
		on t1.group_id = t2.group_id
		and t1.hos_id =
		t2.hos_id
		and t1.dept_id = t2.dept_id
		
		<where>
			AND t1.group_id = #{group_id,jdbcType=INTEGER}
			AND t1.hos_id =
			#{hos_id,jdbcType=INTEGER}
			AND copy_code =
			#{copy_code,jdbcType=VARCHAR}
			AND acc_year =
			#{acc_year,jdbcType=VARCHAR}
			AND acc_month =
			#{acc_month,jdbcType=VARCHAR}
			and num_amount!=0
			and t2.is_last=1
		</where>
		group by t1.dept_id,
		
		t2.dept_code,
		t2.dept_name,
		para_code,
		para_type_code
		order by
		dept_id,para_type_code asc
	</select>
	<select id="queryDeptParaData" resultMap="costDeptParaMap"
		parameterType="java.util.Map">
		select t1.group_id,
		t1.hos_id,
		t1.copy_code,
		t1.acc_year,
		t1.acc_month,
		t1.type_code,
		t1.natur_code,
		t1.dept_id,
		t4.dept_code,
		t4.dept_name,
		t3.type_code para_type_code,
		t3.para_value para_code,
		t1.bill_code
		from
		COST_PARA_DEPT
		t1
		inner join cost_para_bill t2
		on
		t1.group_id =
		t2.group_id
		and
		t1.hos_id = t2.hos_id
		and t1.copy_code =
		t2.copy_code
		and
		t1.acc_year =
		t2.acc_year
		and t1.acc_month = t2.acc_month
		and
		t1.bill_code =
		t2.bill_code

		inner join cost_para_set t3
		on
		t3.group_id
		= t1.group_id
		and t3.hos_id =
		t1.hos_id
		and t3.copy_code =
		t1.copy_code
		and t3.acc_year = t1.acc_year
		and t3.acc_month =
		t1.acc_month
		and
		t3.natur_code = t1.para_code

		inner
		join hos_dept_dict t4
		on t1.group_id
		=
		t4.group_id
		and t1.hos_id =
		t4.hos_id
		and t1.dept_id = t4.dept_id
		
		<where>
			AND t1.group_id = #{group_id,jdbcType=INTEGER}
			AND t1.hos_id =
			#{hos_id,jdbcType=INTEGER}
			AND t1.copy_code =
			#{copy_code,jdbcType=VARCHAR}
			AND t1.acc_year =
			#{acc_year,jdbcType=VARCHAR}
			AND t1.acc_month =
			#{acc_month,jdbcType=VARCHAR}
			and t4.is_last=1
			and
			t3.bill_type=#{bill_type,jdbcType=VARCHAR}
			and t2.cost_type_code =
			#{cost_type_code,jdbcType=VARCHAR}

		</where>
		order by
		type_code,dept_code,para_code,para_type_code asc

	</select>
	<select id="queryServerDeptParaData" resultMap="costServerDeptParaMap"
		parameterType="java.util.Map">
		select distinct t1.bill_code,t1.type_code server_type_code,
		t1.natur_code server_natur_code,
		t1.dept_id server_dept_id,t4.dept_code
		server_dept_code,t4.dept_name
		server_dept_name
		from
		cost_para_server_dept t1
		inner join cost_para_bill
		t2
		on
		t1.group_id =
		t2.group_id
		and t1.hos_id = t2.hos_id
		and t1.copy_code
		=
		t2.copy_code
		and
		t1.acc_year = t2.acc_year
		and t1.acc_month =
		t2.acc_month
		and
		t1.bill_code = t2.bill_code

		inner join hos_dept_dict t4
		on
		t1.group_id = t4.group_id
		and t1.hos_id =
		t4.hos_id
		and t1.dept_id =
		t4.dept_id
		
		<where>
			AND t1.group_id = #{group_id,jdbcType=INTEGER}
			AND t1.hos_id =
			#{hos_id,jdbcType=INTEGER}
			AND t1.copy_code =
			#{copy_code,jdbcType=VARCHAR}
			AND t1.acc_year =
			#{acc_year,jdbcType=VARCHAR}
			AND t1.acc_month =
			#{acc_month,jdbcType=VARCHAR}
			and t4.is_last=1
			and t2.cost_type_code
			=#{cost_type_code,jdbcType=VARCHAR}

		</where>
		order by
		server_natur_code,server_dept_code asc
	</select>


	<select id="queryDeptParaListData" resultMap="costDeptParaListData"
		parameterType="java.util.Map">
		SELECT
		t1.type_code,t1.natur_code,t1.server_type_code,t1.server_natur_code,t1.dept_id,t2.dept_code,t2.dept_name,
		server_dept_id,t3.dept_code
		server_dept_code,t3.dept_name
		server_dept_name,para_type_code,para_code,decode(t4.dept_id,null,0,1)
		peer_flag
		FROM v_cost_para_dept_map t1
		left join hos_dept_dict t2
		on
		t1.group_id = t2.group_id
		and t1.hos_id =
		t2.hos_id
		and t1.dept_id =
		t2.dept_id
		
		left join hos_dept_dict t3
		on
		t1.group_id = t3.group_id
		and
		t1.hos_id = t3.hos_id
		and
		t1.server_dept_id
		= t3.dept_id
		
		
		left join (
		select
		distinct dept_id from v_cost_para_dept_map t
		where
		type_code=server_type_code
		and
		group_id=#{group_id,jdbcType=INTEGER}
		and
		hos_id=#{hos_id,jdbcType=INTEGER} and
		copy_code=#{copy_code,jdbcType=VARCHAR} and
		acc_year=#{acc_year,jdbcType=VARCHAR}
		and acc_month=
		#{acc_month,jdbcType=VARCHAR}
		) t4 on t1.dept_id=t4.dept_id 
		<where>
			AND t1.group_id = #{group_id,jdbcType=INTEGER}
			AND t1.hos_id =
			#{hos_id,jdbcType=INTEGER}
			AND copy_code =
			#{copy_code,jdbcType=VARCHAR}
			AND acc_year =
			#{acc_year,jdbcType=VARCHAR}
			AND acc_month =
			#{acc_month,jdbcType=VARCHAR}
			and t2.is_last=1
			and t3.is_last=1
		</where>
		order by
		type_code,dept_id,server_dept_id,para_code,para_type_code asc
	</select>


	<select id="queryDeptNumAmount" resultMap="costDeptParaNumMap"
		parameterType="java.util.Map">

		<!-- 门诊工作量 -->
		select group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		
		dept_id server_dept_id,
		
		'03' para_code,
		sum(nvl(clinic_num, 0)) num_amount
		from COST_CLINIC_WORK a
		where
		group_id =
		#{group_id,jdbcType=INTEGER}
		AND hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND
		copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND acc_month =
		#{acc_month,jdbcType=VARCHAR}
		and exists(select 1 from cost_para_set t1
		where t1.group_id=a.group_id and t1.hos_id=a.hos_id
		and
		t1.copy_code=a.copy_code and t1.acc_year=a.acc_year and
		t1.acc_month=a.acc_month
		and t1.para_value='03')
		group by
		group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id
		<!--住院工作量 -->
		union all
		select group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		
		dept_id server_dept_id,
		
		'03' para_code,
		sum(nvl(bed_use_day_num, 0)) num_amount
		from COST_INHOS_WORK a
		where
		group_id = #{group_id,jdbcType=INTEGER}
		AND hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND acc_month =
		#{acc_month,jdbcType=VARCHAR}
		and exists(select 1 from cost_para_set t1
		where t1.group_id=a.group_id and t1.hos_id=a.hos_id
		and
		t1.copy_code=a.copy_code and t1.acc_year=a.acc_year and
		t1.acc_month=a.acc_month
		and t1.para_value='03')
		group by
		group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id
	
		<!--人员 -->
		union all
		select group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		
		dept_id server_dept_id,
	
		'01' para_code,
		sum(nvl(alldept_num, 0)) num_amount
		from COST_DEPT_PEOPLE a
		where
		group_id
		= #{group_id,jdbcType=INTEGER}
		AND hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND acc_month =
		#{acc_month,jdbcType=VARCHAR}
		and exists(select 1 from cost_para_set t1
		where t1.group_id=a.group_id and t1.hos_id=a.hos_id
		and
		t1.copy_code=a.copy_code and t1.acc_year=a.acc_year and
		t1.acc_month=a.acc_month
		and t1.para_value='01')
		group by
		group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id
		<!--面积 -->
		union all
		select group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		
		dept_id server_dept_id,
		
		'02' para_code,
		sum(nvl(arear, 0)) num_amount
		from COST_DEPT_AREA a
		where
		group_id =
		#{group_id,jdbcType=INTEGER}
		AND hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND
		copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND acc_month =
		#{acc_month,jdbcType=VARCHAR}
		and exists(select 1 from cost_para_set t1
		where t1.group_id=a.group_id and t1.hos_id=a.hos_id
		and
		t1.copy_code=a.copy_code and t1.acc_year=a.acc_year and
		t1.acc_month=a.acc_month
		and t1.para_value='02')
		group by group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id
		union all

		<!--服务量 -->
		select group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		server_dept_id
		dept_id,
		
		server_by_dept_id server_dept_id,
		
		'05' para_code,
		sum(nvl(server_num,
		0)) num_amount
		from cost_inner_server a
		where
		group_id =
		#{group_id,jdbcType=INTEGER}
		AND hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND
		copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND acc_month =
		#{acc_month,jdbcType=VARCHAR}
		and exists(select 1 from cost_para_set t1
		where t1.group_id=a.group_id and t1.hos_id=a.hos_id
		and
		t1.copy_code=a.copy_code and t1.acc_year=a.acc_year and
		t1.acc_month=a.acc_month
		and t1.para_value='05')
		group by group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		server_dept_id,
		
		server_by_dept_id
		<!--收支结余 -->
		union all
		select group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		exec_dept_id dept_id,
		
		appl_dept_id server_dept_id,
		
		'06' para_code,
		sum(nvl(money, 0))
		num_amount
		from cost_income a
		where
		group_id =
		#{group_id,jdbcType=INTEGER}
		AND hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND
		copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND acc_month =
		#{acc_month,jdbcType=VARCHAR}
		and exists(select 1 from cost_para_set t1
		where t1.group_id=a.group_id and t1.hos_id=a.hos_id
		and
		t1.copy_code=a.copy_code and t1.acc_year=a.acc_year and
		t1.acc_month=a.acc_month
		and t1.para_value='06')
		group by group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		exec_dept_id,
		
		appl_dept_id
		union all
		<!--药房收入 -->
		select t1.group_id,
		t1.hos_id,
		t1.copy_code,
		t1.acc_year,
		t1.acc_month,
		dept_id,
		
		server_dept_id,
		
		para_code,
		num_amount
		from (select a.group_id,
		a.hos_id,
		a.copy_code,
		a.acc_year,
		a.acc_month,
		a.exec_dept_id server_dept_id,
		
		'06'
		para_code,
		sum(nvl(money, 0)) num_amount
		from cost_income a
		inner join
		acc_dept_attr c
		on a.group_id = c.group_id
		and a.hos_id = c.hos_id
		and
		a.exec_dept_id = c.dept_id
		and c.natur_code = '04'
		where
		a.group_id =
		#{group_id,jdbcType=INTEGER}
		AND a.hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND a.copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND a.acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND a.acc_month =
		#{acc_month,jdbcType=VARCHAR}
		and exists(select 1 from cost_para_set t1
		where t1.group_id=a.group_id and t1.hos_id=a.hos_id
		and
		t1.copy_code=a.copy_code and t1.acc_year=a.acc_year and
		t1.acc_month=a.acc_month
		and t1.para_value='06')
		group by a.group_id,
		a.hos_id,
		a.copy_code,
		a.acc_year,
		a.acc_month,
		a.exec_dept_id) t1
		left join
		hos_dept_dict b
		on
		t1.group_id = b.group_id
		and t1.hos_id =
		b.hos_id
		and
		exists (select 1
		from acc_dept_attr a
		where
		a.group_id =
		b.group_id
		and
		a.hos_id =
		b.hos_id
		and a.dept_id = b.dept_id
		and
		a.natur_code = '03')
		where
		t1.group_id = #{group_id,jdbcType=INTEGER}
		AND t1.hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND t1.copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND t1.acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND t1.acc_month =
		#{acc_month,jdbcType=VARCHAR}
		
		and
		nvl(t1.server_dept_id,'')!=''
		union all
		<!--自定义 -->
		select group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		
		dept_id server_dept_id,
	
		para_code,
		sum(nvl(para_value, 0)) num_amount
		from COST_USER_DEFINED_PARA a
		where
		group_id = #{group_id,jdbcType=INTEGER}
		AND hos_id =
		#{hos_id,jdbcType=INTEGER}
		AND copy_code =
		#{copy_code,jdbcType=VARCHAR}
		AND acc_year =
		#{acc_year,jdbcType=VARCHAR}
		AND acc_month =
		#{acc_month,jdbcType=VARCHAR}
		and para_value!=0
		and exists(select 1 from
		cost_para_set t1 where t1.group_id=a.group_id and t1.hos_id=a.hos_id
		and t1.copy_code=a.copy_code and t1.acc_year=a.acc_year and
		t1.acc_month=a.acc_month
		and t1.para_value=a.para_code)
		group by
		group_id,
		hos_id,
		copy_code,
		acc_year,
		acc_month,
		dept_id,
		
		para_code
		order by
		dept_id,server_dept_id,para_code asc
	</select>
<!-- 成本分摊存储过程 -->
	<select id="saveCostDeptCostProc" statementType="CALLABLE"
		parameterType="java.util.Map" resultType="java.util.Map"> 
		<![CDATA[
	  {call pkg_cost_app.prc_cost_dept_cost(#{group_id},#{hos_id},#{copy_code},#{acc_year},#{acc_month}, #{prm_AppCode,jdbcType=INTEGER,mode=OUT},
	        #{prm_ErrTxt,jdbcType=VARCHAR,mode=OUT})}
	  ]]>
	</select>
	<!-- 成本分摊存储过程 -->
	<select id="saveCostDeptCostCheckProc" statementType="CALLABLE"
		parameterType="java.util.Map" resultType="java.util.Map"> 
		<![CDATA[
	  {call pkg_cost_app.prc_check_data(#{group_id},#{hos_id},#{copy_code},#{acc_year},#{acc_month}, #{prm_AppCode,jdbcType=INTEGER,mode=OUT},
	        #{prm_ErrTxt,jdbcType=VARCHAR,mode=OUT})}
	  ]]>
	</select>
	
	<select id="queryCheck" parameterType="java.util.Map" resultMap="costDeptCostCheck">
		select group_id,hos_id,copy_code,message_code,message_name,message_note from cost_message_check_share 
		where group_id = #{group_id,jdbcType=INTEGER}
		AND hos_id = #{hos_id,jdbcType=INTEGER}
		AND copy_code = #{copy_code,jdbcType=VARCHAR}
		order by message_code
	</select>
</mapper>

